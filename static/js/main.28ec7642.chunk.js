/*! For license information please see main.28ec7642.chunk.js.LICENSE.txt */
(this.webpackJsonpmorpheus_retailer_lite=this.webpackJsonpmorpheus_retailer_lite||[]).push([[0],[,,,,,,,function(e,t,a){"use strict";var s,r=window.$,n=a(23),i=a(9),o=a(35).EventEmitter,l=a(11),c=a(64),u=a(17),d={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,a,s,r,n,i,o,l="",c=0;for(e=d._utf8Encode(e);c<e.length;)r=(t=e.charCodeAt(c++))>>2,n=(3&t)<<4|(a=e.charCodeAt(c++))>>4,i=(15&a)<<2|(s=e.charCodeAt(c++))>>6,o=63&s,isNaN(a)?i=o=64:isNaN(s)&&(o=64),l=l+d._keyStr.charAt(r)+d._keyStr.charAt(n)+d._keyStr.charAt(i)+d._keyStr.charAt(o);return l},decode:function(e){var t,a,s,r,n,i,o="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=d._keyStr.indexOf(e.charAt(l++))<<2|(r=d._keyStr.indexOf(e.charAt(l++)))>>4,a=(15&r)<<4|(n=d._keyStr.indexOf(e.charAt(l++)))>>2,s=(3&n)<<6|(i=d._keyStr.indexOf(e.charAt(l++))),o+=String.fromCharCode(t),64!=n&&(o+=String.fromCharCode(a)),64!=i&&(o+=String.fromCharCode(s));return o=d._utf8Decode(o)},_utf8Encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",a=0;a<e.length;a++){var s=e.charCodeAt(a);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t},_utf8Decode:function(e){for(var t="",a=0,s=0,r=0,n=0;a<e.length;)(s=e.charCodeAt(a))<128?(t+=String.fromCharCode(s),a++):s>191&&s<224?(r=e.charCodeAt(a+1),t+=String.fromCharCode((31&s)<<6|63&r),a+=2):(r=e.charCodeAt(a+1),n=e.charCodeAt(a+2),t+=String.fromCharCode((15&s)<<12|(63&r)<<6|63&n),a+=3);return t}},m=window.location.origin+window.location.pathname.split("mobile-sales")[0],h=l({},o.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},baseUrl:m,assetsUrl:m+"protected/modules/mobilesales/assets/",apiUrl:m+"api/",customerLibraryCategoryID:1,globalLibraryCategoryID:2,saveAppData:function(){var e={location:h.location};localStorage.app=JSON.stringify(e)},getUnixTime:function(e){return e||(e=new Date),Math.floor(e.getTime()/1e3)},getUnixTimeStartOfDay:function(e){return e||(e=new Date),e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),this.getUnixTime(e)},getUnixTimeInMs:function(e){return e||(e=new Date),e.getTime()},isBeforeToday:function(e){return!e||e<this.getUnixTimeStartOfDay()},base64Encode:d.encode,getHTTPAuthStringForCredentials:function(e,t){return"Basic "+d.encode(e+":"+t)},getHTTPAuthString:function(){return this.getHTTPAuthStringForCredentials(c.getUsername(),c.getPassword())},getURLAuthString:function(){return"username="+c.getUsername()+"&password="+c.getPassword()},initApp:function(){if(u.options.timeOut=2e3,u.options.extendedTimeOut=1e3,localStorage.app){var e=JSON.parse(localStorage.app);h.location=e.location?e.location:h.location}},isLoggedIn:function(){return c.hasUser()},getUserID:function(){return c.getID()},getCompanyCurrency:function(){return c.getCompanyCurrency()},isPriceListsCheckNeeded:function(){return c.areCompanyPriceListsEnabled()},isProductRulesCheckNeeded:function(){return c.doCompanyProductRulesExist()},getB2BCustomerID:function(){return c.getB2BCustomerID()},refreshBackgroundImage:function(){var e=c.getCompanyBackground();document.getElementById("appbg").style.backgroundImage=null!=e&&""!=e?"url('data:image/png;base64,"+e+"')":null},screenData:{title:"Retailer Lite"},setScreenTitle:function(e){h.screenData.title=null!=e?e:"Retailer Lite",h.emitChange()},location:{lat:null,lng:null,string:""},refreshGeolocation:function(){s=navigator.geolocation.watchPosition((function(e){navigator.geolocation.clearWatch(s),h.location.lat=e.coords.latitude,h.location.lng=e.coords.longitude,h.location.string=e.coords.latitude+","+e.coords.longitude,h.saveAppData(),h.emitChange()}))},getLocalStorageUsage:function(){return 2*JSON.stringify(localStorage).length/5242880},getDistanceBetweenLatLonPointsInKm:function(e,t,a,s){var r=this.deg2rad(a-e),n=this.deg2rad(s-t),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.deg2rad(e))*Math.cos(this.deg2rad(a))*Math.sin(n/2)*Math.sin(n/2),o=6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)));return Math.round(o)},deg2rad:function(e){return e*(Math.PI/180)},uuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},formatInteger:function(e,t,a){t=null!=t&&t;var s=(a=null!=a&&a)?"":0,r=e.replace(/[^\d]/g,"");if(""!==r){var n=parseInt(r);r=t?r:n,s=n}return{value:s,displayValue:r}},formatDecimal:function(e,t,a){t=null!=t&&t;var s=(a=null!=a&&a)?"":0,r=e.replace(/[^\d.,]/g,"");if(""!==r){var n=parseFloat(r.replace(",","."));r=t?r:n,s=n}return{value:s,displayValue:r}},formatCurrency:function(e,t,a){t=null!=t&&t;var s=(a=null!=a&&a)?"":0,r=e.replace(/[^\d.,]/g,"");if(""!==r){var n=parseFloat(r.replace(",",".")).toFixed(2);r=t?r:n,s=parseFloat(n)}return{value:s,displayValue:r}},formatCurrencyNumber:function(e){var t=parseFloat(e).toFixed(2);return{value:parseFloat(t),displayValue:t}},restrictNumber:function(e,t,a,s,r){if(e>0)if(null!=a&&a>0&&e<a)t=(e=a).toString();else if(null!=s&&s>0&&e>s)t=(e=s).toString();else if(null!=r&&r){var n=this.fixNumber(e%a);n>0&&n!=a&&(t=(e=this.fixNumber(e-n)).toString())}return{value:e,displayValue:t}},fixNumber:function(e){return parseFloat(e.toFixed(4))},hasPrefix:function(e,t){return e.toString().substr(0,t.length)==t},isLocalID:function(e){return this.hasPrefix(e,"l-")},sanitiseForSecureURL:function(e){return e.replace("http://","https://")},postCompletedActionDispatchCallbacks:{},setPostCompletedActionDispatchCallback:function(e,t,a,s){h.postCompletedActionDispatchCallbacks[e]={context:t,callback:a,args:s}},clearPostCompletedActionDispatchCallback:function(e){h.postCompletedActionDispatchCallbacks[e]=null},executePostCompletedActionDispatchCallback:function(e){null!=h.postCompletedActionDispatchCallbacks[e]&&(h.postCompletedActionDispatchCallbacks[e].context[h.postCompletedActionDispatchCallbacks[e].callback].apply(h.postCompletedActionDispatchCallbacks[e].context,h.postCompletedActionDispatchCallbacks[e].args),h.clearPostCompletedActionDispatchCallback(e))},currentQueueAction:null,setCurrentQueueAction:function(e){this.currentQueueAction=e},clearCurrentQueueAction:function(){this.currentQueueAction=null},currentQueuePercentageComplete:null,setCurrentPercentageComplete:function(e){this.currentQueuePercentageComplete=e},clearCurrentPercentageComplete:function(){this.currentQueuePercentageComplete=null},dispatch:function(e){null==e.queueActionType&&null!=this.currentQueueAction&&(e.queueActionType=this.currentQueueAction),null==e.queueActionStatus&&null!=this.currentQueueAction&&(e.queueActionStatus=i.PENDING),null==e.queuePercentageComplete&&null!=this.currentQueueAction&&null!=this.currentQueuePercentageComplete&&(e.queuePercentageComplete=this.currentQueuePercentageComplete),n.dispatch(e),e.actionStatus!=i.PENDING&&this.executePostCompletedActionDispatchCallback(e.actionType)},executeActionQueue:function(e,t){var a=r.Deferred();if(e.length){var s=0;h.setCurrentQueueAction(t),h.setCurrentPercentageComplete(0),h.dispatch({queueActionType:t,queueActionStatus:i.PENDING,queuePercentageComplete:0,resetTracking:!0});var n={},o=!0,l=!0;!function r(c){c.args=null!=c.args?c.args.map((function(e){return"string"==typeof e&&"add:"==e.substr(0,4)?n[e.substr(4)]:e})):[],c.context[c.action].apply(c.context,c.args).fail((function(t){o=!1,null!=t&&t.partial&&(l=!1),null!=c.onFail&&c.onFail(t),c.stopOnFail&&(e=[])})).done((function(e){if(l=!1,null!=e&&e.partial&&(o=!1),null!=c.onDone&&c.onDone(e),null!=e&&null!=e.results)for(var t in e.results)n[t]=e.results[t]})).always((function(n){if(s+=c.completionWeighting,h.setCurrentPercentageComplete(parseFloat(100*s)),e.length>0)r(e.shift());else{var u=o?i.OK:l?i.ERROR:i.PARTIAL;h.dispatch({queueActionType:t,queueActionStatus:u,queuePercentageComplete:100}),h.clearCurrentQueueAction(),h.clearCurrentPercentageComplete(),a.resolve()}}))}(e.shift())}else a.resolve();return a}});e.exports=h},,function(e,t,a){"use strict";var s=a(139);e.exports=s({PENDING:null,ERROR:null,PARTIAL:null,OK:null})},function(e,t,a){"use strict";var s=a(0),r=a.n(s);t.a=function(e){var t=e.isVisible,a=e.style;return r.a.createElement("div",{className:t?"cssload-container show":"hidden",style:a},r.a.createElement("div",{className:t?"cssload-wheel":""}))}},,,,,function(e,t,a){"use strict";var s=a(139);e.exports=s({INITIALISE:null,USER_LOGIN:null,USER_LOGOUT:null,USER_DELETE_DATA:null,USER_PASSWORD_RESET_REQUEST:null,USER_REFRESH:null,LIBRARY_REFRESH:null,CALLS_REFRESH:null,CUSTOMERS_SEARCH_LOCAL:null,CUSTOMERS_SEARCH_SERVER:null,CUSTOMER_REQUEST:null,CUSTOMER_REFRESH:null,CUSTOMER_ENTER:null,CUSTOMER_EXIT:null,CUSTOMER_VISITS_SUBMIT:null,CUSTOMER_ADD_COMMENT:null,CUSTOMER_DETAILS_EDIT_SAVE:null,CUSTOMER_DETAILS_EDIT_COMPLETE:null,CUSTOMER_DETAILS_EDIT_CANCEL:null,CUSTOMER_LOCATIONS_EDIT_ADD:null,CUSTOMER_LOCATIONS_EDIT_SAVE:null,CUSTOMER_LOCATIONS_EDIT_COMPLETE:null,CUSTOMER_LOCATIONS_EDIT_CANCEL:null,CUSTOMER_CONTACTS_EDIT_ADD:null,CUSTOMER_CONTACTS_EDIT_SAVE:null,CUSTOMER_CONTACTS_EDIT_COMPLETE:null,CUSTOMER_CONTACTS_EDIT_CANCEL:null,CUSTOMER_EDIT_CANCEL:null,CUSTOMER_EDITS_SUBMIT:null,ADMIN_AUDITS_REFRESH:null,AUDITS_REFRESH:null,AUDIT_ANSWER_SAVE:null,CALL_AUDITS_RUN_REPORT:null,AUDITS_SUBMIT:null,SALES_REFRESH:null,ORDER_SAVE:null,ORDER_CANCEL:null,ORDERS_SUBMIT:null,PRODUCTS_SEARCH_LOCAL:null,PRODUCTS_SEARCH_SERVER:null,APP_DATA_SUBMIT:null,ONLINE_SALES_REFRESH:null,CUSTOMERS_SALES_REFRESH:null,CALLS_RELATED_REFRESH:null,PAST_ORDERS_CUSTOMERS_REFRESH:null,ALL_REFRESH:null,AUDITS_RELATED_SUBMIT:null,ORDERS_RELATED_SUBMIT:null})},,,,function(e,t,a){"use strict";var s=a(29),r=a.n(s),n={init:function(){r.a.config({name:"Retailer Lite",size:52428800,storeName:"retailerlitesalesstorage",version:1})},get:function(e){return Array.isArray(e)?Promise.all(e.map((function(e){return r.a.getItem(e)}))).then((function(t){return t.map((function(t,a){return[e[a],t]}))})):r.a.getItem(e)},set:function(e,t){return Array.isArray(e)?Promise.all(e.map((function(e){return r.a.setItem(e[0],e[1])}))).then((function(t){return e})):r.a.setItem(e,t)},INDEXEDDB:r.a.INDEXEDDB,WEBSQL:r.a.WEBSQL,LOCALSTORAGE:r.a.LOCALSTORAGE,ready:function(){return r.a.ready()},driver:function(){return r.a.driver()},defineDriver:function(e){return r.a.defineDriver(e)},setDriver:function(e){return r.a.setDriver(e)}};t.a=n},function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(9),i=a(37),o=a(142),l=a(55),c=a(35).EventEmitter,u=a(11),d=a(13),m=a(7),h={},p={customers:{},fields:[{name:"name",label:"Company Name",order:-10},{name:"unique_code",label:"Unique Code",order:-9},{name:"account_number",label:"Account Number",order:-8},{name:"phone",label:"Phone",order:-7}],fieldsRefreshed:null,locationFields:[{name:"description",label:"Description",order:-10},{name:"address_1",label:"Address 1",order:-9},{name:"address_2",label:"Address 2",order:-8},{name:"city",label:"City",order:-7},{name:"zip",label:"Zip",order:-5},{name:"latitude",label:"Latitude",order:-3},{name:"longitude",label:"Longitude",order:-2}],locationFieldsRefreshed:null,contactFields:[{name:"first_name",label:"First Name",order:-10},{name:"last_name",label:"Last Name",order:-9},{name:"email",label:"Email",order:-8},{name:"office_phone",label:"Office Phone",order:-7},{name:"cell_phone",label:"Cell Phone",order:-6},{name:"fax",label:"Fax",order:-5}],contactFieldsRefreshed:null},g={},f={},E=null,S={},C={},y=[],R="",b=1,_=10,v=null,N=null,T=[],O="",L=1,D=10,I=null,A=null,P=!1,x=u({},c.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(e){var t=n.OK;switch(e){case r.CUSTOMER_REQUEST:case r.CUSTOMER_EDITS_SUBMIT:case r.CUSTOMERS_SEARCH_LOCAL:case r.CUSTOMERS_SEARCH_SERVER:t=null!=C[e]?C[e]:n.OK;break;default:t=null!=C.default?C.default:n.OK}return t},getCustomers:function(){var e=[];for(var t in h)null!=h[t]&&e.push(h[t]);return e},getCustomer:function(e){return h[e]},getEditedCustomer:function(e){var t=null;"new"==e&&(e=this.getNewID()),(t=this.getCustomerDetailsEdits(e)).id=e,t.locations=[];var a=this.getCustomerLocationsEdits(e);for(var s in a)null!=a[s]&&t.locations.push(a[s]);t.contacts=[];var r=this.getCustomerContactsEdits(e);for(var n in r)null!=r[n]&&t.contacts.push(r[n]);return t},getActiveCustomersCount:function(){return d.filter(h,(function(e){return null!=e&&1==e.is_active})).length},getCustomerIDs:function(){var e=[];for(var t in h)null!=h[t]&&e.push(parseInt(t));return e},getLastRefreshForCustomer:function(e){return p.customers[e]?p.customers[e].refreshed:null},getFields:function(){return p.fields},getLastRefreshForFields:function(){return p.fieldsRefreshed},getLocationFields:function(){return p.locationFields},getLastRefreshForLocationFields:function(){return p.locationFieldsRefreshed},getContactFields:function(){return p.contactFields},getLastRefreshForContactFields:function(){return p.contactFieldsRefreshed},getNewID:function(){return"l-"+m.uuidv4()},getCustomerLocation:function(e,t){var a=null;return null!=h[e]&&null!=h[e].locations&&h[e].locations.length&&(a=d.find(h[e].locations,{id:parseInt(t)})),a},getCustomerEdits:function(e){return null==g[e]||d.isEmpty(g[e].details)&&d.isEmpty(g[e].locations)&&d.isEmpty(g[e].contacts)?null:g[e]},getCustomerDetailsEdits:function(e){for(var t=null!=g[e]&&null!=g[e].details,a={},s=0;s<p.fields.length;s++){var r=p.fields[s];a[r.name]=t&&null!=g[e].details[r.name]?g[e].details[r.name]:null!=h[e]?h[e][r.name]:null}return a},getCustomerLocationsEdits:function(e){var t=m.isLocalID(e),a=null!=g[e]&&null!=g[e].locations,s={};if(t||null!=h[e]){var r=[];if(!t&&null!=h[e].locations)for(var n=0;n<h[e].locations.length;n++){var i=h[e].locations[n];r.push(h[e].locations[n].id);var o=a&&null!=g[e].locations[i.id];s[i.id]={};for(var l=0;l<p.locationFields.length;l++){var c=p.locationFields[l];s[i.id][c.name]=o&&null!=g[e].locations[i.id][c.name]?g[e].locations[i.id][c.name]:i[c.name]}}if(a)for(var u in g[e].locations)d.includes(r,parseInt(u))||(s[u]=g[e].locations[u])}return s},getCustomerLocationLastEdited:function(e){return null!=f[e]&&null!=f[e].location?f[e].location:null},setCustomerLocationLastEdited:function(e,t){null==f[e]&&(f[e]={}),f[e].location=t},getFreshLocationObject:function(){return{description:"",address_1:"",address_2:"",city:"",country_id:47,zip:"",latitude:"",longitude:""}},getCustomerContactsEdits:function(e){var t=m.isLocalID(e),a=null!=g[e]&&null!=g[e].contacts,s={};if(t||null!=h[e]){var r=[];if(!t&&null!=h[e].contacts)for(var n=0;n<h[e].contacts.length;n++){var i=h[e].contacts[n];r.push(h[e].contacts[n].id);var o=a&&null!=g[e].contacts[i.id];s[i.id]={};for(var l=0;l<p.contactFields.length;l++){var c=p.contactFields[l];s[i.id][c.name]=o&&null!=g[e].contacts[i.id][c.name]?g[e].contacts[i.id][c.name]:i[c.name]}}if(a)for(var u in g[e].contacts)d.includes(r,parseInt(u))||(s[u]=g[e].contacts[u])}return s},getCustomerContactLastEdited:function(e){return null!=f[e]&&null!=f[e].contact?f[e].contact:null},setCustomerContactLastEdited:function(e,t){null==f[e]&&(f[e]={}),f[e].contact=t},getFreshContactObject:function(){return{first_name:"",last_name:"",email:"",office_phone:"",cell_phone:"",fax:""}},getCustomerLastCreated:function(){return E},setCustomerLastCreated:function(e){E=e},getValidCustomerVisits:function(){var e=[];for(var t in S)if(null!=S[t])for(var a in S[t])if(null!=S[t][a]){var s=S[t][a];null!=s.date&&null!=s.end_time&&e.push(s)}return e},isCustomerVisited:function(e){var t=m.getUnixTimeStartOfDay()+"";return null!=S[t]&&null!=S[t][e]},getSearchResults:function(e){return e==l.SERVER?T:y},getSearchTerm:function(e){return e==l.SERVER?O:R},getSearchPage:function(e){return e==l.SERVER?L:b},getSearchPageSize:function(e){return e==l.SERVER?D:_},getSearchTotal:function(e){return e==l.SERVER?I:v},getSearchTotalPages:function(e){return e==l.SERVER?A:N},wasRequestSuccessful:function(){return P},resetRequestSuccessful:function(){P=!1},purgeDataExceptForIds:function(e){for(var t in h)d.includes(e,t)||(h[t]=void 0);for(var t in p.customers)d.includes(e,t)||(p.customers[t]=void 0);for(var t in g)d.includes(e,t)||(g[t]=void 0)},saveCustomer:function(e,t){h[e]||(h[e]={}),h[e]=t,p.customers[e]||(p.customers[e]={}),p.customers[e].refreshed=m.getUnixTime()},saveCustomerFields:function(e){for(var t in e)if("name"==t)p.fields[d.findIndex(p.fields,{name:"name"})].label=e[t].label;else if("varchar"==e[t].type){var a=d.findIndex(p.fields,{name:t}),s={name:t,label:e[t].label,order:parseInt(e[t].order)};-1!=a?p.fields[a]=s:p.fields.push(s)}p.fields=d.sortBy(p.fields,"order"),p.fieldsRefreshed=m.getUnixTime()},exportData:function(){return'{"customers":'+JSON.stringify(h)+',"customersMeta":'+JSON.stringify(p)+',"customerEdits":'+JSON.stringify(g)+',"customerVisits":'+JSON.stringify(S)+"}"}});s.register((function(e){switch(e.actionType){case r.INITIALISE:if(localStorage.customers&&(h=JSON.parse(localStorage.customers)),localStorage.customersMeta){var t=JSON.parse(localStorage.customersMeta);null==t.customers||null==t.locationFields||null==t.contactFields?(localStorage.customersMeta=JSON.stringify(p),console.log("Updated legacy customer meta data")):(console.log("Customer meta data up to date"),p=JSON.parse(localStorage.customersMeta))}localStorage.customerEdits&&(g=JSON.parse(localStorage.customerEdits)),localStorage.customerVisits&&(S=JSON.parse(localStorage.customerVisits)),x.emitChange();break;case r.CALLS_REFRESH:if(e.actionStatus==n.OK){var a=d.keysIn(e.callsData);x.purgeDataExceptForIds(a),localStorage.customers=JSON.stringify(h),localStorage.customersMeta=JSON.stringify(p),localStorage.customerEdits=JSON.stringify(g)}break;case r.CUSTOMER_REFRESH:e.actionStatus!=n.OK&&e.actionStatus!=n.PARTIAL||(null!=e.customerData&&x.saveCustomer(e.customerID,e.customerData),null!=e.customerFieldData&&x.saveCustomerFields(e.customerFieldData),localStorage.customers=JSON.stringify(h),localStorage.customersMeta=JSON.stringify(p)),C.default=e.actionStatus,x.emitChange();break;case r.SALES_REFRESH:var s=!1;if(e.entity==i.CUSTOMER){if(e.batchStatus==n.OK&&(null!=e.batchFieldData&&x.saveCustomerFields(e.batchFieldData),null!=e.batchCustomers))for(var l=0;l<e.batchCustomers.length;l++)null!=e.batchCustomers[l]&&x.saveCustomer(e.batchCustomers[l].id,e.batchCustomers[l]);e.entityStatus!=n.PENDING&&(localStorage.customers=JSON.stringify(h),localStorage.customersMeta=JSON.stringify(p),s=!0)}s&&x.emitChange();break;case r.CUSTOMER_DETAILS_EDIT_SAVE:case r.CUSTOMER_DETAILS_EDIT_COMPLETE:if((V=m.isLocalID(e.customerID))||null!=h[e.customerID]){null==g[e.customerID]&&(g[e.customerID]={}),g[e.customerID].details={};for(l=0;l<p.fields.length;l++){var c=p.fields[l];(V&&null!=e.customerDetailsEditData[c.name]||!V&&e.customerDetailsEditData[c.name]!=h[e.customerID][c.name])&&(g[e.customerID].details[c.name]=e.customerDetailsEditData[c.name])}localStorage.customerEdits=JSON.stringify(g),x.emitChange()}break;case r.CUSTOMER_DETAILS_EDIT_CANCEL:null!=g[e.customerID]&&null!=g[e.customerID].details&&(g[e.customerID].details=void 0,localStorage.customerEdits=JSON.stringify(g),x.emitChange());break;case r.CUSTOMER_LOCATIONS_EDIT_ADD:if((V=m.isLocalID(e.customerID))||null!=h[e.customerID]){null==g[e.customerID]&&(g[e.customerID]={}),null==g[e.customerID].locations&&(g[e.customerID].locations={});var u=x.getNewID();g[e.customerID].locations[u]=x.getFreshLocationObject(),x.setCustomerLocationLastEdited(e.customerID,u),localStorage.customerEdits=JSON.stringify(g),x.emitChange()}break;case r.CUSTOMER_LOCATIONS_EDIT_SAVE:case r.CUSTOMER_LOCATIONS_EDIT_COMPLETE:if((V=m.isLocalID(e.customerID))||null!=h[e.customerID]){null==g[e.customerID]&&(g[e.customerID]={}),g[e.customerID].locations={};var U=!1;for(var F in e.customerLocationsEditData){var w=e.customerLocationsEditData[F];if(V||m.isLocalID(F))g[e.customerID].locations[F]=w,U=!0;else{for(var M={},k=!1,q=d.find(h[e.customerID].locations,{id:parseInt(F)}),B=0;B<p.locationFields.length;B++){var H=p.locationFields[B];w[H.name]!=q[H.name]&&(M[H.name]=w[H.name],k=!0,U=!0)}k&&(g[e.customerID].locations[F]=M)}}U||(g[e.customerID].locations={}),null!=e.lastEditedLocationID&&x.setCustomerLocationLastEdited(e.customerID,e.lastEditedLocationID),localStorage.customerEdits=JSON.stringify(g),x.emitChange()}break;case r.CUSTOMER_LOCATIONS_EDIT_CANCEL:null!=g[e.customerID]&&null!=g[e.customerID].locations&&(g[e.customerID].locations=void 0,x.setCustomerLocationLastEdited(e.customerID,null),localStorage.customerEdits=JSON.stringify(g),x.emitChange());break;case r.CUSTOMER_CONTACTS_EDIT_ADD:if((V=m.isLocalID(e.customerID))||null!=h[e.customerID]){null==g[e.customerID]&&(g[e.customerID]={}),null==g[e.customerID].contacts&&(g[e.customerID].contacts={});var j=x.getNewID();g[e.customerID].contacts[j]=x.getFreshContactObject(),x.setCustomerContactLastEdited(e.customerID,j),localStorage.customerEdits=JSON.stringify(g),x.emitChange()}break;case r.CUSTOMER_CONTACTS_EDIT_SAVE:case r.CUSTOMER_CONTACTS_EDIT_COMPLETE:var V;if((V=m.isLocalID(e.customerID))||null!=h[e.customerID]){null==g[e.customerID]&&(g[e.customerID]={}),g[e.customerID].contacts={};var G=!1;for(var K in e.customerContactsEditData){var W=e.customerContactsEditData[K];if(V||m.isLocalID(K))g[e.customerID].contacts[K]=W,G=!0;else{var z={},J=!1,Y=d.find(h[e.customerID].contacts,{id:parseInt(K)});for(B=0;B<p.contactFields.length;B++){var Q=p.contactFields[B];W[Q.name]!=Y[Q.name]&&(z[Q.name]=W[Q.name],J=!0,G=!0)}J&&(g[e.customerID].contacts[K]=z)}}G||(g[e.customerID].contacts={}),null!=e.lastEditedContactID&&x.setCustomerContactLastEdited(e.customerID,e.lastEditedContactID),localStorage.customerEdits=JSON.stringify(g),x.emitChange()}break;case r.CUSTOMER_CONTACTS_EDIT_CANCEL:null!=g[e.customerID]&&null!=g[e.customerID].contacts&&(g[e.customerID].contacts=void 0,x.setCustomerContactLastEdited(e.customerID,null),localStorage.customerEdits=JSON.stringify(g),x.emitChange());break;case r.CUSTOMER_EDIT_CANCEL:null!=g[e.customerID]&&(g[e.customerID]=void 0,x.setCustomerLocationLastEdited(e.customerID,null),x.setCustomerContactLastEdited(e.customerID,null),localStorage.customerEdits=JSON.stringify(g),x.emitChange());break;case r.CUSTOMER_EDITS_SUBMIT:if(C[e.actionType]=e.actionStatus,null!=e.entity&&(e.entityStatus==n.OK||e.entityStatus==n.PARTIAL))if(e.entity==o.CUSTOMER_DETAILS)null!=g[e.customerID]&&(g[e.customerID].details=void 0),null!=e.newCustomerID&&x.setCustomerLastCreated(e.newCustomerID);else if(e.entity==o.CUSTOMER_LOCATIONS){if(null!=g[e.customerID])if(e.entityStatus==n.OK)g[e.customerID].locations=void 0;else for(B=0;B<e.submittedIDs.length;B++)g[e.customerID].locations[e.submittedIDs[B]]=void 0}else if(e.entity==o.CUSTOMER_CONTACTS&&null!=g[e.customerID])if(e.entityStatus==n.OK)g[e.customerID].contacts=void 0;else for(B=0;B<e.submittedIDs.length;B++)g[e.customerID].contacts[e.submittedIDs[B]]=void 0;e.actionStatus!=n.PENDING&&(e.actionStatus==n.OK&&null!=g[e.customerID]&&(g[e.customerID]=void 0),localStorage.customerEdits=JSON.stringify(g)),x.emitChange();break;case r.CUSTOMERS_SEARCH_LOCAL:C[e.actionType]=e.actionStatus,R=e.searchTerm,b=e.searchPage,_=e.searchPageSize?e.searchPageSize:10;var X=[];d.forEach(R.split(" "),(function(e){var t=e.trim();""!=t&&X.push(t.toLowerCase())}));var $=d.filter(h,(function(e){if(null==e||0==e.is_active)return!1;for(var t=null!=e.name?e.name.toLowerCase():"",a=null!=e.unique_code?e.unique_code.toLowerCase():"",s=0;s<X.length;s++)if(-1===t.indexOf(X[s])&&-1===a.indexOf(X[s]))return!1;return!0}));v=$.length,N=Math.floor(v/_)+(v%_>0?1:0);var Z=((b=0==N||b<1?1:b>N?N:b)-1)*_;y=$.slice(Z,Z+_),x.emitChange();break;case r.CUSTOMERS_SEARCH_SERVER:e.actionStatus==n.OK&&(T=e.resultsData,I=e.total,A=e.totalPages),C[e.actionType]=e.actionStatus,O=e.searchTerm,L=e.searchPage,D=e.searchPageSize?e.searchPageSize:10,x.emitChange();break;case r.CUSTOMER_REQUEST:C[e.actionType]=e.actionStatus,P=e.actionStatus==n.OK||P,x.emitChange();break;case r.CUSTOMER_ENTER:var ee=new Date(1e3*e.entryTimestamp);ee=m.getUnixTimeStartOfDay(ee),S[te=ee+""]||(S[te]={}),S[te][e.customerID]||(S[te][e.customerID]={customer_id:e.customerID,date:ee,start_time:e.entryTimestamp,end_time:e.entryTimestamp},localStorage.customerVisits=JSON.stringify(S));break;case r.CUSTOMER_EXIT:var te;ee=m.getUnixTimeStartOfDay();null!=S[te=ee+""]&&null!=S[te][e.customerID]&&(S[te][e.customerID].end_time=e.exitTimestamp,localStorage.customerVisits=JSON.stringify(S));break;case r.CUSTOMER_VISITS_SUBMIT:if(e.actionStatus==n.OK&&null!=e.customerVisitData&&e.customerVisitData.length){for(B=0;B<e.customerVisitData.length;B++){var ae=e.customerVisitData[B].date+"",se=e.customerVisitData[B].customer_id;null!=S[ae]&&null!=S[ae][se]&&(S[ae][se]=void 0)}for(var re in S)if(null!=S[re]){var ne=!0;for(var ie in S[re])null!=S[re][ie]&&(ne=!1);ne&&(S[re]=void 0)}localStorage.customerVisits=JSON.stringify(S)}break;case r.USER_DELETE_DATA:h={},p={customers:{},fields:[{name:"name",label:"Company Name",order:-10},{name:"unique_code",label:"Unique Code",order:-9},{name:"account_number",label:"Account Number",order:-8},{name:"phone",label:"Phone",order:-7}],fieldsRefreshed:null,locationFields:[{name:"description",label:"Description",order:-10},{name:"address_1",label:"Address 1",order:-9},{name:"address_2",label:"Address 2",order:-8},{name:"city",label:"City",order:-7},{name:"zip",label:"Zip",order:-5},{name:"latitude",label:"Latitude",order:-3},{name:"longitude",label:"Longitude",order:-2}],locationFieldsRefreshed:null,contactFields:[{name:"first_name",label:"First Name",order:-10},{name:"last_name",label:"Last Name",order:-9},{name:"email",label:"Email",order:-8},{name:"office_phone",label:"Office Phone",order:-7},{name:"cell_phone",label:"Cell Phone",order:-6},{name:"fax",label:"Fax",order:-5}],contactFieldsRefreshed:null},g={},f={},E=null,S={},y=[],R="",b=1,_=10,v=null,N=null,T=[],O="",L=1,D=10,I=null,A=null,localStorage.customers=JSON.stringify(h),localStorage.customersMeta=JSON.stringify(p),localStorage.customerEdits=JSON.stringify(g),localStorage.customerVisits=JSON.stringify(S),x.emitChange()}})),e.exports=x},function(e,t,a){var s=a(22),r={appVersion:"1.54.0",defaultActiveProfile:s.PROFILE_WEB,activeProfile:"",profiles:{},setProfile:function(e){r.activeProfile=e},get:function(e){return null!=r.profiles[r.activeProfile][e]?r.profiles[r.activeProfile][e]:r.profiles[s.PROFILE_DEFAULT][e]}};r.activeProfile=r.defaultActiveProfile,r.profiles[s.PROFILE_DEFAULT]={},r.profiles[s.PROFILE_DEFAULT][s.UI_BUTTON_CALL_LIST]=!0,r.profiles[s.PROFILE_DEFAULT][s.UI_BUTTON_LIBRARY]=!0,r.profiles[s.PROFILE_DEFAULT][s.UI_BUTTON_CUSTOMERS]=!0,r.profiles[s.PROFILE_DEFAULT][s.UI_BUTTON_CUSTOMER_FILES]=!0,r.profiles[s.PROFILE_DEFAULT][s.UI_BUTTON_CUSTOMER_COMMENTS]=!0,r.profiles[s.PROFILE_DEFAULT][s.UI_BUTTON_CHANGE_CUSTOMER]=!0,r.profiles[s.PROFILE_DEFAULT][s.FUNC_ONLINE_PRODUCTS]=!1,r.profiles[s.PROFILE_DEFAULT][s.FUNC_ONLINE_CUSTOMERS]=!1,r.profiles[s.PROFILE_DEFAULT][s.FUNC_CUSTOMER_AUTOSELECTION]=!1,r.profiles[s.PROFILE_DEFAULT][s.FUNC_EDIT_ORDER_PRICING]=!0,r.profiles[s.PROFILE_WEB]={},r.profiles[s.PROFILE_WEB][s.FUNC_ONLINE_PRODUCTS]=!0,r.profiles[s.PROFILE_WEB][s.FUNC_ONLINE_CUSTOMERS]=!0,r.profiles[s.PROFILE_B2B]={},r.profiles[s.PROFILE_B2B][s.UI_BUTTON_CALL_LIST]=!1,r.profiles[s.PROFILE_B2B][s.UI_BUTTON_LIBRARY]=!1,r.profiles[s.PROFILE_B2B][s.UI_BUTTON_CUSTOMERS]=!1,r.profiles[s.PROFILE_B2B][s.UI_BUTTON_CUSTOMER_FILES]=!1,r.profiles[s.PROFILE_B2B][s.UI_BUTTON_CUSTOMER_COMMENTS]=!1,r.profiles[s.PROFILE_B2B][s.UI_BUTTON_CHANGE_CUSTOMER]=!1,r.profiles[s.PROFILE_B2B][s.FUNC_ONLINE_PRODUCTS]=!0,r.profiles[s.PROFILE_B2B][s.FUNC_ONLINE_CUSTOMERS]=!0,r.profiles[s.PROFILE_B2B][s.FUNC_CUSTOMER_AUTOSELECTION]=!0,r.profiles[s.PROFILE_B2B][s.FUNC_EDIT_ORDER_PRICING]=!1,r.profiles[s.PROFILE_NATIVE]={},e.exports=r},function(e,t,a){"use strict";e.exports={PROFILE_DEFAULT:"profile_default",PROFILE_WEB:"profile_web",PROFILE_NATIVE:"profile_native",PROFILE_B2B:"profile_b2b",UI_BUTTON_CALL_LIST:"ui_button_call_list",UI_BUTTON_LIBRARY:"ui_button_library",UI_BUTTON_CUSTOMERS:"ui_button_customers",UI_BUTTON_CUSTOMER_FILES:"ui_button_customer_files",UI_BUTTON_CUSTOMER_COMMENTS:"ui_button_customer_comments",UI_BUTTON_CHANGE_CUSTOMER:"ui_button_change_customer",UI_BUTTON_REQUEST_CUSTOMER:"ui_button_request_customer",FUNC_ONLINE_PRODUCTS:"func_online_products",FUNC_ONLINE_CUSTOMERS:"func_online_customers",FUNC_CUSTOMER_AUTOSELECTION:"func_customer_autoselection",FUNC_EDIT_ORDER_PRICING:"func_edit_order_pricing",FUNC_ORDER_AUTO_SUBMISSION:"func_order_auto_submission"}},function(e,t,a){var s=a(249).Dispatcher;e.exports=new s},,function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(9),i=a(54),o=a(35).EventEmitter,l=a(11),c=a(13),u=a(7),d={},m={refreshed:null},h=n.OK,p=u.getUnixTimeStartOfDay()+"",g=l({},o.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(){return h},getAllCalls:function(){return c.has(c.sample(d),"start_time")?c.sortBy(c.map(d,(function(e,t){return e.completed=null!=m[t]&&m[t].completed,e.submitted=null!=m[t]&&m[t].submitted,e})),"start_time"):c.map(d,(function(e,t){return e.completed=null!=m[t]&&m[t].completed,e.submitted=null!=m[t]&&m[t].submitted,e}))},getCallById:function(e){return d[e]},getLastRefresh:function(){return m.refreshed},getCallCustomerIDs:function(){return c.keysIn(d).map((function(e){return parseInt(e)}))},purgeData:function(){m={refreshed:m.refreshed}},purgeDataForIds:function(e){var t=e.length;if(t)for(var a=0;a<t;a++)m[e[a]]=void 0},purgeDataExceptForIds:function(e){for(var t in m)"refreshed"==t||c.includes(e,t)||(m[t]=void 0)},exportData:function(){return'{"calls":'+JSON.stringify(d)+',"callsMeta":'+JSON.stringify(m)+',"currentCallDate":'+JSON.stringify(p)+"}"}});s.register((function(e){switch(e.actionType){case r.INITIALISE:localStorage.calls&&(d=JSON.parse(localStorage.calls)),localStorage.callsMeta&&(m=JSON.parse(localStorage.callsMeta)),localStorage.currentCallDate&&(p=JSON.parse(localStorage.currentCallDate)),g.emitChange();break;case r.CALLS_REFRESH:e.actionStatus==n.OK&&(d=e.callsData,m.refreshed=u.getUnixTime(),e.callDate+""!=p&&(g.purgeData(),p=e.callDate+"",localStorage.currentCallDate=JSON.stringify(p)),localStorage.calls=JSON.stringify(d),localStorage.callsMeta=JSON.stringify(m)),h=e.actionStatus,g.emitChange();break;case r.CUSTOMER_EXIT:e.callAuditsCompleted&&(m[e.customerID]||(m[e.customerID]={}),m[e.customerID].completed=!0,localStorage.callsMeta=JSON.stringify(m),h=n.OK,g.emitChange());break;case r.AUDITS_SUBMIT:if(e.actionStatus!=n.PENDING&&e.auditsType==i.CALL){if(null!=e.submittedIDs[p])for(var t in e.submittedIDs[p])e.failedIDs[p]&&e.failedIDs[p][t]||null==m[t]||(m[t].submitted=!0);localStorage.callsMeta=JSON.stringify(m)}h=e.actionStatus,g.emitChange();break;case r.USER_DELETE_DATA:d={},m={refreshed:null},localStorage.calls=JSON.stringify(d),localStorage.callsMeta=JSON.stringify(m),g.emitChange()}})),e.exports=g},function(e,t,a){"use strict";a.r(t),function(e){var t=a(1),s=a.n(t);window.$=s.a;var r=a(23),n=a(15),i=a(42),o=a(66),l=a(30),c=a(9),u=a(54),d=a(142),m=a(13),h=a(7),p=a(17),g=null,f={doAfterAccessCheck:function(e,t){"refreshCalls"==e||"refreshCallsAndRelatedData"==e?r.dispatch({actionType:n.CALLS_REFRESH,actionStatus:c.PENDING}):"refreshCustomer"==e&&r.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.PENDING,customerID:null!=t?t[0]:t}),i.checkAccess(this[e],t,this)},refreshCallsAndRelatedData:function(e){null==e&&(e=!0);var t=[{context:i,action:"refreshUser",args:null,completionWeighting:.05,stopOnFail:!0},{context:this,action:"refreshCalls",args:null,completionWeighting:.3,stopOnFail:!0},{context:o,action:"refreshAdminAudits",args:["add:callCustomerIDs"],completionWeighting:.1},{context:o,action:"prepareCustomerAuditData",args:["add:callCustomerIDs"],completionWeighting:0},{context:o,action:"refreshAuditsForCustomers",args:["add:customerAuditIDObjs"],completionWeighting:.2},{context:l,action:"refreshCustomers",args:["add:callCustomerIDs"],completionWeighting:.2,stopOnFail:!0},{context:l,action:"refreshPriceLists",args:["add:callCustomerIDs"],completionWeighting:.075},{context:l,action:"refreshProductRules",args:["add:callCustomerIDs"],completionWeighting:.075}];return h.executeActionQueue(t,n.CALLS_RELATED_REFRESH)},refreshCalls:function(){h.dispatch({actionType:n.CALLS_REFRESH,actionStatus:c.PENDING});var e=s.a.Deferred(),t=h.getUnixTimeStartOfDay();return s.a.ajax({url:h.apiUrl+"audit/getUsersCallCycle",type:"GET",data:{user_id:h.getUserID(),date:t},headers:{Authorization:h.getHTTPAuthString()},success:function(e){},error:function(){},complete:function(){},dataType:"json"}).fail((function(){h.dispatch({actionType:n.CALLS_REFRESH,actionStatus:c.ERROR,callDate:t}),e.reject()})).done((function(a){if(a.status){var s=m.indexBy(a.results.stores,"store_id");h.dispatch({actionType:n.CALLS_REFRESH,actionStatus:c.OK,callDate:t,callsData:s});var r=m.keysIn(s);e.resolve({results:{callCustomerIDs:r}})}else"The user is not scheduled to visit any stores"==a.error.substr(0,45)?(h.dispatch({actionType:n.CALLS_REFRESH,actionStatus:c.OK,callDate:t,callsData:{}}),e.resolve({results:{callCustomerIDs:[]}})):(h.dispatch({actionType:n.CALLS_REFRESH,actionStatus:c.ERROR,callDate:t}),e.reject())})),e},searchCustomersOnServer:function(e,t,a){null!=g&&g.abort(),null==e&&(e=""),null==t&&(t=1),null==a&&(a=5),r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:c.PENDING,searchTerm:e,searchPage:t,searchPageSize:a});for(var i=e.split(" "),o="",l=0;l<i.length;l++){var u=i[l].trim();""!=u&&(o+=(o.length?",":"")+u)}g=s.a.ajax({url:h.apiUrl+"customer/list",type:"GET",data:{pageSize:a,page:t,filters:o},headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:c.ERROR,searchTerm:e,searchPage:t,searchPageSize:a})})).done((function(s){s.status?r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:c.OK,searchTerm:e,searchPage:parseInt(s.results.currentPage),searchPageSize:a,total:parseInt(s.results.totalCount),totalPages:parseInt(s.results.totalPages),resultsData:null!=s.results.records?s.results.records:[]}):r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:c.ERROR,searchTerm:e,searchPage:t,searchPageSize:a})}))},requestCustomer:function(e){r.dispatch({actionType:n.CUSTOMER_REQUEST,actionStatus:c.PENDING,customer:e});var t=h.getUnixTimeStartOfDay();s.a.ajax({url:h.apiUrl+"audit/requestStore",type:"POST",data:{user_id:h.getUserID(),store_id:e.id,date:t},headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){r.dispatch({actionType:n.CUSTOMER_REQUEST,actionStatus:c.ERROR,customer:e})})).done((function(t){t.status?(r.dispatch({actionType:n.CUSTOMER_REQUEST,actionStatus:c.OK,customer:e}),p.success(e.name+" added to call list")):"The user is already scheduled to visit this store from a previous override"==t.error||"The user is already scheduled to visit this store from their call cycle"==t.error?(r.dispatch({actionType:n.CUSTOMER_REQUEST,actionStatus:c.OK,customer:e,info:"This customer is already in your call list"}),p.success(e.name+" is already in your call list")):r.dispatch({actionType:n.CUSTOMER_REQUEST,actionStatus:c.ERROR,customer:e})}))},submitAuditsAndRelatedData:function(e,t,a){var s=[{context:this,action:"submitAudits",args:[e],completionWeighting:.5},{context:this,action:"submitAudits",args:[null,t],completionWeighting:.3},{context:l,action:"submitCustomerVisits",args:[a],completionWeighting:.2}];return h.executeActionQueue(s,n.AUDITS_RELATED_SUBMIT)},submitAudits:function(e,t){var a=s.a.Deferred(),r=null!=e&&e.length,i=null!=t&&t.length;if(!r&&!i)return a.resolve(),a;var o=!1,l=e,d=null;r&&i?d=t:i&&(o=!0,l=t),h.dispatch({actionType:n.AUDITS_SUBMIT,actionStatus:c.PENDING,auditsType:o?u.ADMIN:u.CALL});var m=!0,p=!0,g={},E={};return function e(t){s.a.ajax({url:h.apiUrl+(o?"audit/saveAdminAuditAnswers":"audit/saveAuditAnswers"),type:"POST",data:{entry:t.entry,exit:t.exit,audit_answers:JSON.stringify(t.audit_answers)},headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){m=!1,E[t.call_date]||(E[t.call_date]={}),E[t.call_date][t.customer_id]||(E[t.call_date][t.customer_id]=[]),E[t.call_date][t.customer_id].push(t.audit_answers.audit_id+(o?"-"+t.audit_idx:""))})).done((function(e){e.status?(p=!1,g[t.call_date]||(g[t.call_date]={}),g[t.call_date][t.customer_id]||(g[t.call_date][t.customer_id]=[]),g[t.call_date][t.customer_id].push(t.audit_answers.audit_id+(o?"-"+t.audit_idx:""))):(m=!1,E[t.call_date]||(E[t.call_date]={}),E[t.call_date][t.customer_id]||(E[t.call_date][t.customer_id]=[]),E[t.call_date][t.customer_id].push(t.audit_answers.audit_id+(o?"-"+t.audit_idx:"")))})).always((function(){if(l.length>0)e(l.shift());else{var t=m?c.OK:p?c.ERROR:c.PARTIAL;h.dispatch({actionType:n.AUDITS_SUBMIT,actionStatus:t,auditsType:o?u.ADMIN:u.CALL,submittedIDs:g,failedIDs:E}),t==c.ERROR?a.reject():a.resolve({partial:t==c.PARTIAL}),null!=d&&f.submitAudits(null,d)}}))}(l.shift()),a},refreshCustomer:function(e,t,a){h.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.PENDING,customerID:e,addToOrderIDs:a}),s.a.ajax({url:h.apiUrl+"customer/detail",type:"GET",data:{id:e},headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){h.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.ERROR,customerID:e,addToOrderIDs:a})})).done((function(r){r.status?t?s.a.ajax({url:h.apiUrl+"general/getCustomFields",type:"GET",data:{table:"customer"},headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){h.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.PARTIAL,customerID:e,customerData:r.results,addToOrderIDs:a})})).done((function(t){t.status?h.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.OK,customerID:e,customerData:r.results,customerFieldData:t.results,addToOrderIDs:a}):h.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.PARTIAL,customerID:e,customerData:r.results,addToOrderIDs:a})})):h.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.OK,customerID:e,customerData:r.results,addToOrderIDs:a}):h.dispatch({actionType:n.CUSTOMER_REFRESH,actionStatus:c.ERROR,customerID:e,addToOrderIDs:a})}))},addCustomerComment:function(e,t){r.dispatch({actionType:n.CUSTOMER_ADD_COMMENT,actionStatus:c.PENDING,customerID:e,comment:t}),s.a.ajax({context:this,url:h.apiUrl+"customer/addComment",type:"POST",data:{customer_id:e,comment:t,date:h.getUnixTime()},headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){r.dispatch({actionType:n.CUSTOMER_ADD_COMMENT,actionStatus:c.ERROR,customerID:e,comment:t})})).done((function(a){a.status?(r.dispatch({actionType:n.CUSTOMER_ADD_COMMENT,actionStatus:c.OK,customerID:e,comment:t}),this.refreshCustomer(e)):r.dispatch({actionType:n.CUSTOMER_ADD_COMMENT,actionStatus:c.ERROR,customerID:e,comment:t})}))},saveCustomerDetailsEdit:function(e,t){r.dispatch({actionType:n.CUSTOMER_DETAILS_EDIT_SAVE,actionStatus:c.OK,customerID:e,customerDetailsEditData:t})},completeCustomerDetailsEdit:function(e,t){r.dispatch({actionType:n.CUSTOMER_DETAILS_EDIT_COMPLETE,actionStatus:c.OK,customerID:e,customerDetailsEditData:t})},cancelCustomerDetailsEdit:function(e){r.dispatch({actionType:n.CUSTOMER_DETAILS_EDIT_CANCEL,actionStatus:c.OK,customerID:e})},addCustomerLocation:function(e){r.dispatch({actionType:n.CUSTOMER_LOCATIONS_EDIT_ADD,actionStatus:c.OK,customerID:e})},saveCustomerLocationsEdit:function(e,t,a){r.dispatch({actionType:n.CUSTOMER_LOCATIONS_EDIT_SAVE,actionStatus:c.OK,customerID:e,customerLocationsEditData:t,lastEditedLocationID:null!=a?a:null})},completeCustomerLocationsEdit:function(e,t){r.dispatch({actionType:n.CUSTOMER_LOCATIONS_EDIT_COMPLETE,actionStatus:c.OK,customerID:e,customerLocationsEditData:t})},cancelCustomerLocationsEdit:function(e){r.dispatch({actionType:n.CUSTOMER_LOCATIONS_EDIT_CANCEL,actionStatus:c.OK,customerID:e})},addCustomerContact:function(e){r.dispatch({actionType:n.CUSTOMER_CONTACTS_EDIT_ADD,actionStatus:c.OK,customerID:e})},saveCustomerContactsEdit:function(e,t,a){r.dispatch({actionType:n.CUSTOMER_CONTACTS_EDIT_SAVE,actionStatus:c.OK,customerID:e,customerContactsEditData:t,lastEditedContactID:null!=a?a:null})},completeCustomerContactsEdit:function(e,t){r.dispatch({actionType:n.CUSTOMER_CONTACTS_EDIT_COMPLETE,actionStatus:c.OK,customerID:e,customerContactsEditData:t})},cancelCustomerContactsEdit:function(e){r.dispatch({actionType:n.CUSTOMER_CONTACTS_EDIT_CANCEL,actionStatus:c.OK,customerID:e})},cancelCustomerEdit:function(e){r.dispatch({actionType:n.CUSTOMER_EDIT_CANCEL,actionStatus:c.OK,customerID:e})},submitCustomerEdits:function(e,t,a){if(!(m.isEmpty(t)||m.isEmpty(t.details)&&m.isEmpty(t.locations)&&m.isEmpty(t.contacts))){r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e}),null==a&&(a=!0);var s=[];m.isEmpty(t.details)||s.push({action:"submitCustomerDetailsEdits",args:[e,t.details]}),m.isEmpty(t.locations)||s.push({action:"submitCustomerLocationsEdits",args:[e,t.locations]}),m.isEmpty(t.contacts)||s.push({action:"submitCustomerContactsEdits",args:[e,t.contacts]});var i=h.isLocalID(e),o=null,l=!0,u=!0,d=function(t){i&&null!=o&&o>0&&t.args.push(o),this[t.action].apply(this,t.args).done((function(e,a){u=!1,e&&(l=!1),"submitCustomerDetailsEdits"==t.action&&i&&null!=a&&a>0&&(o=a)})).fail((function(e){l=!1,e&&(u=!1),"submitCustomerDetailsEdits"==t.action&&i&&(s=[])})).always((function(){if(s.length>0)d(s.shift());else{var t=l?c.OK:u?c.ERROR:c.PARTIAL;r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:t,customerID:e,newCustomerID:o}),a&&t!=c.ERROR&&f.refreshCustomer(i&&null!=o&&o>0?o:e)}}))}.bind(this);d(s.shift())}},submitCustomerDetailsEdits:function(e,t){var a=s.a.Deferred(),i=h.isLocalID(e);return m.isEmpty(t)?(r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_DETAILS,entityStatus:i?c.ERROR:c.OK}),i?a.reject():a.resolve()):(r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_DETAILS,entityStatus:c.PENDING}),i||(t.id=e),s.a.ajax({url:h.apiUrl+(i?"customer/add":"customer/update"),type:"POST",data:t,headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_DETAILS,entityStatus:c.ERROR}),a.reject()})).done((function(t){if(t.status){var s=i?t.results.id:null;r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,newCustomerID:s,entity:d.CUSTOMER_DETAILS,entityStatus:c.OK}),a.resolve(!1,s)}else r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_DETAILS,entityStatus:c.ERROR}),a.reject()}))),a},submitCustomerLocationsEdits:function(e,t,a){var i=s.a.Deferred();if(m.isEmpty(t))r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_LOCATIONS,entityStatus:c.OK}),i.resolve();else{r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_LOCATIONS,entityStatus:c.PENDING});var o=m.keysIn(t),l=!0,u=!0,p=[],g=[],f=function(m){var E=h.isLocalID(m);E?t[m].customer_id=null!=a&&a>0?a:e:t[m].id=m,s.a.ajax({url:h.apiUrl+(E?"customer/addAddress":"customer/updateAddress"),type:"POST",data:t[m],headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){l=!1,g.push(m)})).done((function(e){e.status?(u=!1,p.push(m)):(l=!1,g.push(m))})).always((function(){if(o.length>0)f(o.shift());else{var t=l?c.OK:u?c.ERROR:c.PARTIAL;r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_LOCATIONS,entityStatus:t,submittedIDs:p,failedIDs:g}),t==c.ERROR?i.reject():i.resolve(t==c.PARTIAL)}}))}.bind(this);f(o.shift())}return i},submitCustomerContactsEdits:function(e,t,a){var i=s.a.Deferred();if(m.isEmpty(t))r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_CONTACTS,entityStatus:c.OK}),i.resolve();else{r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_CONTACTS,entityStatus:c.PENDING});var o=m.keysIn(t),l=!0,u=!0,p=[],g=[],f=function(m){var E=h.isLocalID(m);E?t[m].customer_id=null!=a&&a>0?a:e:t[m].id=m,s.a.ajax({url:h.apiUrl+(E?"customer/addContact":"customer/updateContact"),type:"POST",data:t[m],headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){l=!1,g.push(m)})).done((function(e){e.status?(u=!1,p.push(m)):(l=!1,g.push(m))})).always((function(){if(o.length>0)f(o.shift());else{var t=l?c.OK:u?c.ERROR:c.PARTIAL;r.dispatch({actionType:n.CUSTOMER_EDITS_SUBMIT,actionStatus:c.PENDING,customerID:e,entity:d.CUSTOMER_CONTACTS,entityStatus:t,submittedIDs:p,failedIDs:g}),t==c.ERROR?i.reject():i.resolve(t==c.PARTIAL)}}))}.bind(this);f(o.shift())}return i}};e.exports=f}.call(this,a(36)(e))},function(e,t,a){"use strict";a.r(t),function(e){var t=a(155),s=a(23),r=a(15),n=a(9),i=a(104),o=a(37),l=a(35).EventEmitter,c=a(11),u=a(13),d=a(7),m={},h={},p={refreshed:null,retryIDs:[]},g={},f={},E={},S={},C=n.OK,y=null,R=c({},l.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(){return C},getNewID:function(){return"l-"+d.uuidv4()},getFreshOrderObject:function(e){var t=d.getCompanyCurrency(),a=this.getDefaultPaymentTerm(),s=null!=a?a.id:null,r=this.getDefaultTaxClass(),n=null!=r?r.id:null,o=this.getDefaultCarrier(),l=null!=o?o.id:null,c=null!=e?e:this.getNewID();return{id:c,hash:c,customer_id:null,customer_name:"",currency_id:t.id,currency_display_name:t.name,currency_display_symbol:t.symbol,payment_terms_id:s,carrier_id:l,po:"",expected_date:null,review:"",tax_class_id:n,billing_location_id:0,shipping_location_id:0,items:[],itemsEdited:!1,subtotal:0,subtotal_display:"0.00",adjustment:0,adjustment_display:"0.00",shipping:0,shipping_display:"0.00",tax:0,tax_display:"0.00",total:0,total_display:"0.00",status:i.INCOMPLETE}},getOrders:function(){var e=[];for(var t in m)null!=m[t]&&e.push(m[t]);return e},getOrder:function(e){return null!=e?m[e]:this.getFreshOrderObject()},getPastOrders:function(){var e=[];for(var t in h)null!=h[t]&&e.push(h[t]);return e},getPastOrder:function(e){return h[e]},getPastOrdersLastRefresh:function(){return p.refreshed},getPastOrdersRefreshRetryIDs:function(){return p.retryIDs},calculateTotals:function(e){var t,a=m[e],s=this.getTaxClass(a.tax_class_id),r=null!=s?s.percent:0;for(a.subtotal=0,a.tax=0,t=0;t<a.items.length;t++)if(null!=a.items[t]){a.items[t].total=a.items[t].price*a.items[t].quantity;var n=d.formatCurrencyNumber(a.items[t].total);if(a.items[t].total=n.value,a.items[t].total_display=n.displayValue,a.subtotal+=a.items[t].total,a.items[t].is_taxable){var i=r;if(parseInt(a.items[t].tax_class_id)>0){var o=this.getTaxClass(a.items[t].tax_class_id);null!=o&&(i=o.percent)}a.tax+=a.items[t].total*(i/100)}}var l=d.formatCurrencyNumber(a.subtotal);a.subtotal=l.value,a.subtotal_display=l.displayValue,a.tax+=a.adjustment*(r/100),a.tax+=a.shipping*(r/100);var c=d.formatCurrencyNumber(a.tax);a.tax=c.value,a.tax_display=c.displayValue,a.total=a.subtotal+a.adjustment+a.shipping+a.tax;var u=d.formatCurrencyNumber(a.total);a.total=u.value,a.total_display=u.displayValue},getOrderSubmission:function(e){var t={id:e,hash:null!=m[e].hash?m[e].hash:e,customer_id:m[e].customer_id,currency_id:m[e].currency_id,payment_terms_id:m[e].payment_terms_id,carrier_id:m[e].carrier_id,tax_class_id:m[e].tax_class_id};if(null!=m[e].po&&""!=m[e].po&&(t.po=m[e].po),null!=m[e].expected_date&&(t.expected_date=m[e].expected_date),null!=m[e].review&&""!=m[e].review&&(t.review=m[e].review),null!=m[e].adjustment&&m[e].adjustment>0&&(t.adjustment_amount=m[e].adjustment,t.adjustment_manual_amount=m[e].adjustment),null!=m[e].shipping&&m[e].shipping>0&&(t.shipping_amount=m[e].shipping),null!=m[e].billing_location_id&&m[e].billing_location_id>0&&(t.billing_location_id=m[e].billing_location_id),null!=m[e].shipping_location_id&&m[e].shipping_location_id>0&&(t.shipping_location_id=m[e].shipping_location_id),m[e].items.length){for(var a=[],s=0;s<m[e].items.length;s++)if(null!=m[e].items[s]){var r={product_id:m[e].items[s].product_id,qty:m[e].items[s].quantity,tax_class_id:m[e].items[s].tax_class_id};null!=m[e].items[s].price_orig&&m[e].items[s].price_orig==m[e].items[s].price||(r.price=m[e].items[s].price),a.push(r)}t.order_items=JSON.stringify(a)}return t},getOrderSubmissions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=[];if(e.length){var s,r=Object(t.a)(e);try{for(r.s();!(s=r.n()).done;){var n=s.value;null!=m[n]&&m[n].status==i.PLACED&&a.push(this.getOrderSubmission(n))}}catch(l){r.e(l)}finally{r.f()}}else for(var o in m)null!=m[o]&&m[o].status==i.PLACED&&a.push(this.getOrderSubmission(o));return a},getOrderCustomerIDs:function(e){e=null==e||e;var t=[];for(var a in m)null!=m[a]&&null!=m[a].customer_id&&t.push(parseInt(m[a].customer_id));if(e)for(var a in h)null!=h[a]&&null!=h[a].customer_id&&t.push(parseInt(h[a].customer_id));return t},getPaymentTerms:function(){var e=[];for(var t in g)null!=g[t]&&e.push(g[t]);return e},getPaymentTerm:function(e){return g[e]},getDefaultPaymentTerm:function(){for(var e in g)if(null!=g[e])return g[e];return null},getTaxClasses:function(){var e=[];for(var t in f)null!=f[t]&&e.push(f[t]);return e},getTaxClass:function(e){return f[e]},getDefaultTaxClass:function(){for(var e in f)if(null!=f[e])return f[e];return null},getCarriers:function(){var e=[];for(var t in E)null!=E[t]&&e.push(E[t]);return e},getCarrier:function(e){return E[e]},getDefaultCarrier:function(){for(var e in E)if(null!=E[e])return E[e];return null},getCurrencies:function(){var e=[];for(var t in S)null!=S[t]&&e.push(S[t]);return e},getCurrency:function(e){return S[e]},getCurrencyOrDefault:function(e){return null!=e&&null!=S[e]?S[e]:d.getCompanyCurrency()},exportData:function(){return'{"orders":'+JSON.stringify(m)+',"pastOrders":'+JSON.stringify(h)+',"pastOrdersMeta":'+JSON.stringify(p)+',"paymentTerms":'+JSON.stringify(g)+',"taxClasses":'+JSON.stringify(f)+',"carriers":'+JSON.stringify(E)+',"currencies":'+JSON.stringify(S)+"}"}});s.register((function(e){switch(e.actionType){case r.INITIALISE:localStorage.orders&&(m=JSON.parse(localStorage.orders)),localStorage.pastOrders&&(h=JSON.parse(localStorage.pastOrders)),localStorage.pastOrdersMeta&&(p=JSON.parse(localStorage.pastOrdersMeta)),localStorage.paymentTerms&&(g=JSON.parse(localStorage.paymentTerms)),localStorage.taxClasses&&(f=JSON.parse(localStorage.taxClasses)),localStorage.carriers&&(E=JSON.parse(localStorage.carriers)),localStorage.currencies&&(S=JSON.parse(localStorage.currencies)),R.emitChange();break;case r.ORDER_SAVE:m[e.orderData.id]=e.orderData,m[e.orderData.id].items.length&&(m[e.orderData.id].itemsEdited=!0),R.calculateTotals(e.orderData.id),localStorage.orders=JSON.stringify(m),R.emitChange();break;case r.ORDER_CANCEL:m[e.orderID]=void 0,localStorage.orders=JSON.stringify(m),R.emitChange();break;case r.ORDERS_SUBMIT:if(e.actionStatus==n.OK||e.actionStatus==n.PARTIAL){for(var t=0,a=e.submittedIDs.length;t<a;t++)m[e.submittedIDs[t]]=void 0;localStorage.orders=JSON.stringify(m)}C=e.actionStatus,R.emitChange();break;case r.CUSTOMER_REFRESH:if(e.actionStatus==n.OK||e.actionStatus==n.PARTIAL){var s=null!=e.addToOrderIDs&&e.addToOrderIDs.length,i=null;if(s){var l;for(l=0;l<e.addToOrderIDs.length;l++){var c=e.addToOrderIDs[l];m[c]||(m[c]=R.getFreshOrderObject(c))}i=R.getCurrencyOrDefault(e.customerData.default_currency_id)}for(var b in m)if(null!=m[b]){var _=s&&u.includes(e.addToOrderIDs,b);(_||m[b].customer_id==e.customerID)&&(m[b].customer_id=e.customerData.id,m[b].customer_name=e.customerData.name,_&&(m[b].expected_date=null!=e.customerData.default_lead_time?d.getUnixTimeStartOfDay()+86400*e.customerData.default_lead_time:null,m[b].payment_terms_id=null==m[b].payment_terms_id&&null!=e.customerData.payment_term?e.customerData.payment_term:m[b].payment_terms_id,m[b].currency_id=i.id,m[b].currency_display_name=i.name,m[b].currency_display_symbol=i.symbol,m[b].billing_location_id=0,m[b].shipping_location_id=0))}localStorage.orders=JSON.stringify(m),R.emitChange()}break;case r.SALES_REFRESH:var v=!1;if(e.entity==o.ORDER){if(e.batchStatus==n.OK&&null!=e.batchOrders)for(t=0;t<e.batchOrders.length;t++)null!=e.batchOrders[t]&&(h[e.batchOrders[t].id]=e.batchOrders[t]);if(e.entityStatus==n.PENDING){if(null!=e.allOrderIDs){for(var b in h)null==h[b]||u.includes(e.allOrderIDs,b)||(h[b]=void 0);y=e.allOrderIDs}}else{if(localStorage.pastOrders=JSON.stringify(h),e.entityStatus!=n.ERROR&&(p.refreshed=null!=e.newLastRefreshTimestamp?e.newLastRefreshTimestamp:d.getUnixTimeStartOfDay(),p.retryIDs=e.failedOrderIDs),null!=y){for(t=0;t<y.length;t++){var N=y[t];null!=h[N]||u.includes(p.retryIDs,N)||p.retryIDs.push(N)}y=null}localStorage.pastOrdersMeta=JSON.stringify(p),v=!0}}else if(e.entity==o.PAYMENT_TERM){if(e.entityStatus==n.OK){g={};for(t=0;t<e.arrPaymentTerms.length;t++){var T=e.arrPaymentTerms[t];g[T.id]={id:T.id,name:T.name}}v=!0,localStorage.paymentTerms=JSON.stringify(g)}}else if(e.entity==o.TAX_CLASS){if(e.entityStatus==n.OK){f={};for(t=0;t<e.arrTaxClasses.length;t++){var O=e.arrTaxClasses[t];f[O.id]={id:O.id,name:O.name,percent:parseFloat(O.percent)}}v=!0,localStorage.taxClasses=JSON.stringify(f)}}else if(e.entity==o.CARRIER){if(e.entityStatus==n.OK){E={};for(t=0;t<e.arrCarriers.length;t++){var L=e.arrCarriers[t];E[L.id]={id:L.id,name:L.name}}v=!0,localStorage.carriers=JSON.stringify(E)}}else if(e.entity==o.CURRENCY&&e.entityStatus==n.OK){S={};for(t=0;t<e.arrCurrencies.length;t++){var D=e.arrCurrencies[t];S[D.id]={id:D.id,name:D.name,symbol:D.symbol,code:D.code}}v=!0,localStorage.currencies=JSON.stringify(S)}v&&R.emitChange();break;case r.USER_DELETE_DATA:m={},h={},p={refreshed:null,retryIDs:[]},g={},f={},E={},S={},localStorage.orders=JSON.stringify(m),localStorage.pastOrders=JSON.stringify(h),localStorage.pastOrdersMeta=JSON.stringify(p),localStorage.paymentTerms=JSON.stringify(g),localStorage.taxClasses=JSON.stringify(f),localStorage.carriers=JSON.stringify(E),localStorage.currencies=JSON.stringify(S),R.emitChange()}})),e.exports=R}.call(this,a(36)(e))},,,function(e,t,a){"use strict";a.r(t),function(e){var t=a(1),s=a.n(t);window.$=s.a;var r=a(23),n=a(15),i=a(42),o=a(9),l=a(37),c=a(22),u=a(21),d=a(7),m=a(13),h=a(17),p=null,g=null,f=function(e){for(var t in e)null!=e[t]&&(e[t].product.files=[],e[t].variant_options=[],e[t].vendors=[],e[t].inventory=[],e[t].extensions=[]);return e},E={doAfterAccessCheck:function(e,t){"submitOrders"==e&&r.dispatch({actionType:n.ORDERS_SUBMIT,actionStatus:o.PENDING}),i.checkAccess(this[e],t)},saveOrder:function(e){r.dispatch({actionType:n.ORDER_SAVE,actionStatus:o.OK,orderData:e})},cancelOrder:function(e){r.dispatch({actionType:n.ORDER_CANCEL,actionStatus:o.OK,orderID:e})},submitOrdersAndRelatedData:function(e,t){var a=[{context:this,action:"submitOrders",args:[e],completionWeighting:.8},{context:this,action:"submitCustomerVisits",args:[t],completionWeighting:.2}];return d.executeActionQueue(a,n.ORDERS_RELATED_SUBMIT)},submitOrders:function(e){var t=s.a.Deferred();if(null==e||!e.length)return t.resolve(),t;d.dispatch({actionType:n.ORDERS_SUBMIT,actionStatus:o.PENDING});var a=!0,r=!0,i=[],l=[],c=function(u){s.a.ajax({url:d.apiUrl+"order/createOrder",type:"POST",data:u,headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){a=!1,l.push(u.id)})).done((function(e){e.status?(r=!1,i.push(u.id)):(a=!1,l.push(u.id))})).always((function(){if(e.length>0)c(e.shift());else{var s=a?o.OK:r?o.ERROR:o.PARTIAL;d.dispatch({actionType:n.ORDERS_SUBMIT,actionStatus:s,submittedIDs:i,failedIDs:l}),s==o.ERROR?t.reject():t.resolve({partial:s==o.PARTIAL})}}))}.bind(this);return c(e.shift()),t},enterCustomer:function(e){r.dispatch({actionType:n.CUSTOMER_ENTER,actionStatus:o.OK,customerID:e,entryTimestamp:d.getUnixTime()})},exitCustomer:function(e,t){r.dispatch({actionType:n.CUSTOMER_EXIT,actionStatus:o.OK,customerID:e,exitTimestamp:d.getUnixTime(),callAuditsCompleted:null!=t&&t}),d.getLocalStorageUsage()>.8&&h.warning("Your storage usage is high. Please submit your audits or orders to free up space.")},submitCustomerVisits:function(e){var t=s.a.Deferred();return null!=e&&e.length?(d.dispatch({actionType:n.CUSTOMER_VISITS_SUBMIT,actionStatus:o.PENDING}),s.a.ajax({url:d.apiUrl+"user/recordCustomerVisit",type:"POST",data:{data:JSON.stringify(e)},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.CUSTOMER_VISITS_SUBMIT,actionStatus:o.ERROR}),t.reject()})).done((function(a){a.status?(d.dispatch({actionType:n.CUSTOMER_VISITS_SUBMIT,actionStatus:o.OK,customerVisitData:e}),t.resolve()):(d.dispatch({actionType:n.CUSTOMER_VISITS_SUBMIT,actionStatus:o.ERROR}),t.reject())})),t):(t.resolve(),t)},searchCustomers:function(e,t,a){u.get(c.FUNC_ONLINE_CUSTOMERS)?this.searchCustomersRemotely(e,t,a):this.searchCustomersLocally(e,t,a)},searchCustomersLocally:function(e,t,a){null==e&&(e=""),null==t&&(t=1),null==a&&(a=10),r.dispatch({actionType:n.CUSTOMERS_SEARCH_LOCAL,actionStatus:o.OK,searchTerm:e,searchPage:t,searchPageSize:a})},searchCustomersRemotely:function(e,t,a){null!=p&&p.abort(),null==e&&(e=""),null==t&&(t=1),null==a&&(a=10),r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:o.PENDING,searchTerm:e,searchPage:t,searchPageSize:a});for(var i=e.split(" "),l="",c=0;c<i.length;c++){var u=i[c].trim();""!=u&&(l+=(l.length?",":"")+u)}p=s.a.ajax({url:d.apiUrl+"customer/list",type:"GET",data:{pageSize:a,page:t,filters:l},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:o.ERROR,searchTerm:e,searchPage:t,searchPageSize:a})})).done((function(s){s.status?r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:o.OK,searchTerm:e,searchPage:parseInt(s.results.currentPage),searchPageSize:a,total:parseInt(s.results.totalCount),totalPages:parseInt(s.results.totalPages),resultsData:null!=s.results.records?s.results.records:[]}):r.dispatch({actionType:n.CUSTOMERS_SEARCH_SERVER,actionStatus:o.ERROR,searchTerm:e,searchPage:t,searchPageSize:a})}))},searchProducts:function(e,t,a,s,r){u.get(c.FUNC_ONLINE_PRODUCTS)?this.searchProductsRemotely(e,t,a,s,r):this.searchProductsLocally(e,t,a,s,r)},searchProductsLocally:function(e,t,a,s,i){null==e&&(e=""),null==t&&(t=1),null==a&&(a=25),r.dispatch({actionType:n.PRODUCTS_SEARCH_LOCAL,actionStatus:o.OK,searchTerm:e,searchPage:t,searchPageSize:a,searchFilters:s,customerID:i})},searchProductsRemotely:function(e,t,a,i,l){null!=g&&g.abort(),null==e&&(e=""),null==t&&(t=1),null==a&&(a=25),r.dispatch({actionType:n.PRODUCTS_SEARCH_SERVER,actionStatus:o.PENDING,searchTerm:e,searchPage:t,searchPageSize:a,searchFilters:i,customerID:l});for(var c=e.split(" "),u="",m=0;m<c.length;m++){var h=c[m].trim();""!=h&&(u+=(u.length?",":"")+h)}var p=!1,f=null,E=null;null!=i&&(p=null!=i.featured&&i.featured,f=null!=i.customerProducts?i.customerProducts:null,null!=i.categories&&i.categories.length&&(E=i.categories.join())),g=s.a.ajax({url:d.apiUrl+"product/list",type:"GET",data:{pageSize:a,page:t,filters:u,featured:p,customerProducts:f,categories:E,customerID:l,includeDetail:!0},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){r.dispatch({actionType:n.PRODUCTS_SEARCH_SERVER,actionStatus:o.ERROR,searchTerm:e,searchPage:t,searchPageSize:a,searchFilters:i,customerID:l})})).done((function(s){s.status?r.dispatch({actionType:n.PRODUCTS_SEARCH_SERVER,actionStatus:o.OK,searchTerm:e,searchPage:parseInt(s.results.currentPage),searchPageSize:a,searchFilters:i,customerID:l,total:parseInt(s.results.totalCount),totalPages:parseInt(s.results.totalPages),resultsData:null!=s.results.records?s.results.records:[]}):r.dispatch({actionType:n.PRODUCTS_SEARCH_SERVER,actionStatus:o.ERROR,searchTerm:e,searchPage:t,searchPageSize:a,searchFilters:i,customerID:l})}))},combineCustomers:function(e,t){return e=e.map((function(e){return parseInt(e)})),t=t.map((function(e){return parseInt(e)})),s.a.Deferred().resolve({results:{customerIDs:m.union(e,t)}})},refreshSalesData:function(e,t,a,s,r){null==r&&(r=[]);var o=[{context:i,action:"refreshUser",args:null,completionWeighting:.08,stopOnFail:!0},{context:this,action:"refreshPaymentTerms",args:null,completionWeighting:.04},{context:this,action:"refreshTaxClasses",args:null,completionWeighting:.04},{context:this,action:"refreshCarriers",args:null,completionWeighting:.04},{context:this,action:"refreshCurrencies",args:null,completionWeighting:.04},{context:this,action:"refreshProducts",args:[e,t],completionWeighting:.35},{context:this,action:"refreshCategories",args:null,completionWeighting:.04},{context:this,action:"refreshPastOrders",args:[a,s],completionWeighting:.08},{context:this,action:"combineCustomers",args:[r,"add:pastOrderCustomerIDs"],completionWeighting:0},{context:this,action:"refreshCustomers",args:["add:customerIDs"],completionWeighting:.13},{context:this,action:"refreshPriceLists",args:["add:customerIDs"],completionWeighting:.08},{context:this,action:"refreshProductRules",args:["add:customerIDs"],completionWeighting:.08}];return d.executeActionQueue(o,n.SALES_REFRESH)},refreshSalesDataForOnline:function(){var e=[{context:i,action:"refreshUser",args:null,completionWeighting:.2,stopOnFail:!0},{context:this,action:"refreshPaymentTerms",args:null,completionWeighting:.15},{context:this,action:"refreshTaxClasses",args:null,completionWeighting:.15},{context:this,action:"refreshCarriers",args:null,completionWeighting:.15},{context:this,action:"refreshCurrencies",args:null,completionWeighting:.15},{context:this,action:"refreshCategories",args:null,completionWeighting:.2}];return u.get(c.FUNC_CUSTOMER_AUTOSELECTION)&&(e[5].completionWeighting=.1,e.push({context:this,action:"refreshCustomers",args:[[d.getB2BCustomerID()]],completionWeighting:.1})),d.executeActionQueue(e,n.ONLINE_SALES_REFRESH)},refreshCustomersAndSalesData:function(e){var t=[{context:i,action:"refreshUser",args:null,completionWeighting:.1,stopOnFail:!0},{context:this,action:"refreshCustomers",args:[e],completionWeighting:.4,stopOnFail:!0},{context:this,action:"refreshPriceLists",args:[e],completionWeighting:.25},{context:this,action:"refreshProductRules",args:[e],completionWeighting:.25}];return d.executeActionQueue(t,n.CUSTOMERS_SALES_REFRESH)},refreshPastOrdersAndAssociatedCustomers:function(e,t){var a=[{context:i,action:"refreshUser",args:null,completionWeighting:.2,stopOnFail:!0},{context:this,action:"refreshPastOrders",args:[e,t],completionWeighting:.4,stopOnFail:!0},{context:this,action:"refreshCustomers",args:["add:pastOrderCustomerIDs"],completionWeighting:.4}];return u.get(c.FUNC_ONLINE_CUSTOMERS)||(a[0].completionWeighting=.1,a[1].completionWeighting=.3,a[2].completionWeighting=.3,a[2].stopOnFail=!0,a.push({context:this,action:"refreshPriceLists",args:["add:pastOrderCustomerIDs"],completionWeighting:.15}),a.push({context:this,action:"refreshProductRules",args:["add:pastOrderCustomerIDs"],completionWeighting:.15})),d.executeActionQueue(a,n.PAST_ORDERS_CUSTOMERS_REFRESH)},refreshProducts:function(e,t){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:o.PENDING}),null==e&&(e=0);var a=d.getUnixTime();null==t&&(t=[]);var r=s.a.Deferred();return s.a.ajax({context:this,url:d.apiUrl+"product/getUpdates",type:"GET",data:{date:e},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:o.ERROR}),r.reject()})).done((function(s){if(s.status){var i=m.uniq(s.results.all);d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:o.PENDING,allProductIDs:i});var c=[];0==e?c=i:(i.length>0&&t.length>0&&(t=m.filter(t,(function(e){return m.includes(i,e)}))),c=m.union(s.results.changed,t)),this.refreshProductsBatched(c,a).fail((function(){r.reject()})).done((function(e){r.resolve(e)}))}else d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:o.ERROR}),r.reject()})),r},refreshProductsBatched:function(e,t){var a=s.a.Deferred(),r=e.length,i=[];if(null==t&&(t=d.getUnixTime()),r){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:o.PENDING});var c=!0,u=!0,h=0,p=h+10>r?r:h+10,g=function(E){s.a.ajax({url:d.apiUrl+"product/detailBatch",type:"GET",data:{ids:E.join()},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){c=!1,i=m.union(i,E)})).done((function(e){if(e.status)if(m.isEmpty(e.results.successes))c=!1,i=m.union(i,E);else{u=!1;for(var t=0;t<E.length;t++){var a=E[t];null==e.results.successes[a]&&(i.push(a),c=!1)}d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:o.PENDING,batchStatus:o.OK,batchItems:f(e.results.successes),percentageComplete:parseFloat(p/r*100)})}else c=!1,i=m.union(i,E)})).always((function(){if(p<r)p=(h=p)+10>r?r:h+10,g(e.slice(h,p));else{var s=c?o.OK:u?o.ERROR:o.PARTIAL;d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:s,failedProductIDs:i,newLastRefreshTimestamp:t}),s==o.ERROR?a.reject():a.resolve({partial:s==o.PARTIAL})}}))}.bind(this);g(e.slice(h,p))}else d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT,entityStatus:o.OK,failedProductIDs:i,newLastRefreshTimestamp:t}),a.resolve();return a},refreshCategories:function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CATEGORY,entityStatus:o.PENDING});var e=s.a.Deferred();return s.a.ajax({url:d.apiUrl+"category/tree",type:"GET",headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CATEGORY,entityStatus:o.ERROR}),e.reject()})).done((function(t){t.status?(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CATEGORY,entityStatus:o.OK,arrCategoryTree:t.results}),e.resolve()):(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CATEGORY,entityStatus:o.ERROR}),e.reject())})),e},refreshCustomers:function(e){e=e.slice();var t=s.a.Deferred(),a=e.length,r=!0,i=!0;return s.a.ajax({url:d.apiUrl+"general/getCustomFields",type:"GET",data:{table:"customer"},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){r=!1})).done((function(e){e.status?(i=!1,d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CUSTOMER,entityStatus:o.PENDING,batchStatus:o.OK,batchFieldData:e.results,percentageComplete:parseFloat(1/(a+1)*100)})):r=!1})).always((function(){if(a){var c=function(u){s.a.ajax({url:d.apiUrl+"customer/detail",type:"GET",data:{id:u},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){r=!1})).done((function(t){t.status?(i=!1,d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CUSTOMER,entityStatus:o.PENDING,batchStatus:o.OK,batchCustomers:[t.results],percentageComplete:parseFloat((a-e.length+1)/(a+1)*100)})):r=!1})).always((function(){if(e.length>0)c(e.shift());else{var a=r?o.OK:i?o.ERROR:o.PARTIAL;d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CUSTOMER,entityStatus:a}),a==o.ERROR?t.reject():t.resolve({partial:a==o.PARTIAL})}}))}.bind(this);c(e.shift())}else{var u=r?o.OK:o.PARTIAL;d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CUSTOMER,entityStatus:u}),t.resolve({partial:u==o.PARTIAL})}})),t},refreshPriceLists:function(e){var t=s.a.Deferred(),a=e.length;if(d.isPriceListsCheckNeeded()&&a){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRICE_LIST,entityStatus:o.PENDING});var r=!0,i=!0,c=0,u=c+10>a?a:c+10,h=function(p){s.a.ajax({url:d.apiUrl+"pricelist/pricelistBatch",type:"GET",data:{ids:p.join()},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){r=!1})).done((function(e){e.status?(i=!1,m.isEmpty(e.results.successes)||d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRICE_LIST,entityStatus:o.PENDING,batchStatus:o.OK,batchItems:e.results.successes,percentageComplete:parseFloat(u/a*100)})):r=!1})).always((function(){if(u<a)u=(c=u)+10>a?a:c+10,h(e.slice(c,u));else{var s=r?o.OK:i?o.ERROR:o.PARTIAL;d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRICE_LIST,entityStatus:s}),s==o.ERROR?t.reject():t.resolve({partial:s==o.PARTIAL})}}))}.bind(this);h(e.slice(c,u))}else d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRICE_LIST,entityStatus:o.OK}),t.resolve();return t},refreshProductRules:function(e){var t=s.a.Deferred(),a=e.length;if(d.isProductRulesCheckNeeded()&&a){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT_RULE,entityStatus:o.PENDING});var r=!0,i=!0,c=0,u=c+10>a?a:c+10,h=function(p){s.a.ajax({url:d.apiUrl+"productrule/productruleBatch",type:"GET",data:{ids:p.join()},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){r=!1})).done((function(e){e.status?(i=!1,m.isEmpty(e.results.successes)||d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT_RULE,entityStatus:o.PENDING,batchStatus:o.OK,batchItems:e.results.successes,percentageComplete:parseFloat(u/a*100)})):r=!1})).always((function(){if(u<a)u=(c=u)+10>a?a:c+10,h(e.slice(c,u));else{var s=r?o.OK:i?o.ERROR:o.PARTIAL;d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT_RULE,entityStatus:s}),s==o.ERROR?t.reject():t.resolve({partial:s==o.PARTIAL})}}))}.bind(this);h(e.slice(c,u))}else d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PRODUCT_RULE,entityStatus:o.OK}),t.resolve();return t},refreshPaymentTerms:function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PAYMENT_TERM,entityStatus:o.PENDING});var e=s.a.Deferred();return s.a.ajax({url:d.apiUrl+"admin/paymentTerms",type:"GET",data:{company_id:1},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PAYMENT_TERM,entityStatus:o.ERROR}),e.reject()})).done((function(t){t.status?(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PAYMENT_TERM,entityStatus:o.OK,arrPaymentTerms:t.results}),e.resolve()):(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.PAYMENT_TERM,entityStatus:o.ERROR}),e.reject())})),e},refreshTaxClasses:function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.TAX_CLASS,entityStatus:o.PENDING});var e=s.a.Deferred();return s.a.ajax({url:d.apiUrl+"admin/taxClasses",type:"GET",data:{company_id:1},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.TAX_CLASS,entityStatus:o.ERROR}),e.reject()})).done((function(t){t.status?(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.TAX_CLASS,entityStatus:o.OK,arrTaxClasses:t.results}),e.resolve()):(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.TAX_CLASS,entityStatus:o.ERROR}),e.reject())})),e},refreshCarriers:function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CARRIER,entityStatus:o.PENDING});var e=s.a.Deferred();return s.a.ajax({url:d.apiUrl+"admin/carriers",type:"GET",headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CARRIER,entityStatus:o.ERROR}),e.reject()})).done((function(t){t.status?(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CARRIER,entityStatus:o.OK,arrCarriers:t.results}),e.resolve()):(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CARRIER,entityStatus:o.ERROR}),e.reject())})),e},refreshCurrencies:function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CURRENCY,entityStatus:o.PENDING});var e=s.a.Deferred();return s.a.ajax({url:d.apiUrl+"admin/currencies",type:"GET",headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CURRENCY,entityStatus:o.ERROR}),e.reject()})).done((function(t){t.status?(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CURRENCY,entityStatus:o.OK,arrCurrencies:t.results}),e.resolve()):(d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.CURRENCY,entityStatus:o.ERROR}),e.reject())})),e},refreshPastOrders:function(e,t){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:o.PENDING}),null==e&&(e=0);var a=d.getUnixTime();null==t&&(t=[]);var r=s.a.Deferred();return s.a.ajax({context:this,url:d.apiUrl+"order/getUpdates",type:"GET",data:{date:e,user_id:d.getUserID()},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:o.ERROR}),r.reject()})).done((function(s){if(s.status){var i=m.uniq(s.results.all);d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:o.PENDING,allOrderIDs:i});var c=[];0==e?c=i:(i.length>0&&t.length>0&&(t=m.filter(t,(function(e){return m.includes(i,e)}))),c=m.union(s.results.changed,t)),E.refreshPastOrdersSpecified(c,a).fail((function(){r.reject()})).done((function(e){r.resolve(e)}))}else d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:o.ERROR}),r.reject()})),r},refreshPastOrdersSpecified:function(e,t){e=e.slice();var a=s.a.Deferred(),r=e.length,i=[];if(null==t&&(t=d.getUnixTime()),r){d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:o.PENDING});var c=[],u=!0,h=!0,p=function(g){s.a.ajax({url:d.apiUrl+"order/getOrder",type:"GET",data:{id:g},headers:{Authorization:d.getHTTPAuthString()},dataType:"json"}).fail((function(){u=!1,i.push(g)})).done((function(t){t.status?(h=!1,t.results.id=g,c.push(parseInt(t.results.customer_id)),d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:o.PENDING,batchStatus:o.OK,batchOrders:[t.results],percentageComplete:parseFloat((r-e.length)/r*100)})):(u=!1,i.push(g))})).always((function(){if(e.length>0)p(e.shift());else{var s=u?o.OK:h?o.ERROR:o.PARTIAL;d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:s,failedOrderIDs:i,newLastRefreshTimestamp:t}),s==o.ERROR?a.reject():a.resolve({partial:s==o.PARTIAL,results:{pastOrderCustomerIDs:m.uniq(c)}})}}))}.bind(this);p(e.shift())}else d.dispatch({actionType:n.SALES_REFRESH,actionStatus:o.PENDING,entity:l.ORDER,entityStatus:o.OK,failedOrderIDs:i,newLastRefreshTimestamp:t}),a.resolve({results:{pastOrderCustomerIDs:[]}});return a}};e.exports=E}.call(this,a(36)(e))},function(e,t,a){"use strict";var s=a(0),r=a.n(s);t.a=function(e){var t=e.isVisible,a=e.info;(null==a.page||a.page<=0)&&(a.page=1,t=!1),(null==a.pageSize||a.pageSize<=0)&&(a.pageSize=1,t=!1),(null==a.total||a.total<=0)&&(a.total=0,t=!1),(null==a.totalPages||a.totalPages<=0)&&(a.totalPages=1,t=!1);var s=(a.page-1)*a.pageSize+1,n=a.page==a.totalPages?a.total:a.page*a.pageSize;return r.a.createElement("div",{className:"search-results-info "+(t?"show":"hidden")},r.a.createElement("div",{className:"search-results-info-box"},s==n?s:s+"-"+n," / ",r.a.createElement("span",{className:"text-primary"},a.total)))}},,,,,,function(e,t,a){"use strict";e.exports={ORDER:"order",CUSTOMER:"customer",PRODUCT:"product",CATEGORY:"category",PAYMENT_TERM:"payment_term",TAX_CLASS:"tax_class",CARRIER:"carrier",CURRENCY:"currency",PRICE_LIST:"price_list",PRODUCT_RULE:"product_rule"}},function(e,t,a){"use strict";var s={readyPromises:[],getReady:function(){return this.readyPromises.length?Promise.all(this.readyPromises):Promise.resolve()},setReady:function(e){this.readyPromises.push(e)},resetReady:function(){this.readyPromises=[]}};t.a=s},,,,function(e,t,a){"use strict";a.r(t),function(e){var t=a(1),s=a.n(t);window.$=s.a;var r=a(23),n=a(15),i=a(9),o=a(22),l=a(21),c=a(7),u=a(17),d=function(e){return null!=e.company&&null!=e.company.logo&&(e.company.logo=void 0),null!=e.licensing&&(e.licensing=void 0),e.fullName=null!=e.first_name&&e.first_name.length&&null!=e.last_name&&e.last_name.length?e.first_name+" "+e.last_name:e.name,e},m=function(e){return"admin"==e.email&&1==e.id||0==e.is_b2b_user&&null!=e.licensing.web_app&&(e.licensing.web_app.permanent>0||e.licensing.web_app.expires>c.getUnixTime())||1==e.is_b2b_user&&null!=e.licensing.b2b&&(e.licensing.b2b.permanent>0||e.licensing.b2b.expires>c.getUnixTime())},h=function(e){l.setProfile(1==e.is_b2b_user?o.PROFILE_B2B:l.defaultActiveProfile)},p={login:function(e,t){r.dispatch({actionType:n.USER_LOGIN,actionStatus:i.PENDING}),s.a.ajax({url:c.apiUrl+"general/getUserInfo",type:"GET",headers:{Authorization:c.getHTTPAuthStringForCredentials(e.username,e.password)},dataType:"json",timeout:3e4}).fail((function(e,t){r.dispatch({actionType:n.USER_LOGIN,actionStatus:i.ERROR,loginError:"timeout"==t?"Login timed out. Please try again.":"Unable to login. Please check your connection and try again."})})).done((function(a){a.status?m(a.results)?(h(a.results),a.results.username=e.username,a.results.password=e.password,r.dispatch({actionType:n.USER_LOGIN,actionStatus:i.OK,userData:d(a.results)}),t&&r.dispatch({actionType:n.USER_DELETE_DATA,actionStatus:i.OK})):r.dispatch({actionType:n.USER_LOGIN,actionStatus:i.ERROR,loginError:"You do not have permission to access this app"}):r.dispatch({actionType:n.USER_LOGIN,actionStatus:i.ERROR,loginError:"Invalid username"==a.error||"Invalid password"==a.error||"Password expired"==a.error?a.error:"Unable to login"})}))},logout:function(){r.dispatch({actionType:n.USER_LOGOUT,actionStatus:i.OK})},refreshUser:function(e){c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.PENDING});var t=s.a.Deferred();return s.a.ajax({context:this,url:c.apiUrl+"general/getUserInfo",type:"GET",headers:{Authorization:c.getHTTPAuthString()},dataType:"json"}).fail((function(e,a){c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.ERROR}),t.reject()})).done((function(a){a.status?m(a.results)?(h(a.results),e?s.a.ajax({url:c.apiUrl+"general/getCustomFields",type:"GET",data:{table:"user"},headers:{Authorization:c.getHTTPAuthString()},dataType:"json"}).fail((function(){c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.PARTIAL,userData:d(a.results)}),t.resolve({partial:!0})})).done((function(e){e.status?(c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.OK,userData:d(a.results),userFieldData:e.results,userFieldDataTS:c.getUnixTime()}),t.resolve()):(c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.PARTIAL,userData:d(a.results)}),t.resolve({partial:!0}))})):(c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.OK,userData:d(a.results)}),t.resolve())):(c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.ERROR}),t.reject(),u.error("You do not have permission to access this app"),this.logout()):(c.dispatch({actionType:n.USER_REFRESH,actionStatus:i.ERROR}),t.reject())})),t},checkAccess:function(e,t,a){null==a&&(a=null),s.a.ajax({context:this,url:c.apiUrl+"general/getUserInfo",type:"GET",headers:{Authorization:c.getHTTPAuthString()},dataType:"json",timeout:2e4}).fail((function(s,r){e.apply(a,t)})).done((function(s){s.status&&m(s.results)?(h(s.results),e.apply(a,t)):(u.error("You do not have permission to access this app"),this.logout())}))},requestPasswordReset:function(e){null!=e&&e.length&&(r.dispatch({actionType:n.USER_PASSWORD_RESET_REQUEST,actionStatus:i.PENDING,email:e}),s.a.ajax({url:c.apiUrl+"public/requestAdminPasswordReset",type:"POST",data:{email:e},headers:{Authorization:c.getHTTPAuthString()},dataType:"json"}).fail((function(){r.dispatch({actionType:n.USER_PASSWORD_RESET_REQUEST,actionStatus:i.ERROR,email:e})})).done((function(t){t.status?r.dispatch({actionType:n.USER_PASSWORD_RESET_REQUEST,actionStatus:i.OK,email:e}):r.dispatch({actionType:n.USER_PASSWORD_RESET_REQUEST,actionStatus:i.ERROR,email:e})})))}};e.exports=p}.call(this,a(36)(e))},function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(9),i=a(37),o=a(35).EventEmitter,l=a(11),c=a(22),u=a(21),d=a(7),m={},h={},p={},g={};g[r.SALES_REFRESH]={},g[r.SALES_REFRESH][i.PAYMENT_TERM]=.04,g[r.SALES_REFRESH][i.TAX_CLASS]=.04,g[r.SALES_REFRESH][i.CARRIER]=.04,g[r.SALES_REFRESH][i.CURRENCY]=.04,g[r.SALES_REFRESH][i.PRODUCT]=.35,g[r.SALES_REFRESH][i.CATEGORY]=.04,g[r.SALES_REFRESH][i.ORDER]=.08,g[r.SALES_REFRESH][i.CUSTOMER]=.13,g[r.SALES_REFRESH][i.PRICE_LIST]=.08,g[r.SALES_REFRESH][i.PRODUCT_RULE]=.08,g[r.ONLINE_SALES_REFRESH]={},g[r.ONLINE_SALES_REFRESH][i.PAYMENT_TERM]=.15,g[r.ONLINE_SALES_REFRESH][i.TAX_CLASS]=.15,g[r.ONLINE_SALES_REFRESH][i.CARRIER]=.15,g[r.ONLINE_SALES_REFRESH][i.CURRENCY]=.15,g[r.ONLINE_SALES_REFRESH][i.CATEGORY]=.2,g[r.CUSTOMERS_SALES_REFRESH]={},g[r.CUSTOMERS_SALES_REFRESH][i.CUSTOMER]=.4,g[r.CUSTOMERS_SALES_REFRESH][i.PRICE_LIST]=.25,g[r.CUSTOMERS_SALES_REFRESH][i.PRODUCT_RULE]=.25,g[r.CALLS_RELATED_REFRESH]={},g[r.CALLS_RELATED_REFRESH][i.CUSTOMER]=.2,g[r.CALLS_RELATED_REFRESH][i.PRICE_LIST]=.075,g[r.CALLS_RELATED_REFRESH][i.PRODUCT_RULE]=.075,g[r.PAST_ORDERS_CUSTOMERS_REFRESH]={},g[r.PAST_ORDERS_CUSTOMERS_REFRESH][i.ORDER]=u.get(c.FUNC_ONLINE_CUSTOMERS)?.4:.3,g[r.PAST_ORDERS_CUSTOMERS_REFRESH][i.CUSTOMER]=u.get(c.FUNC_ONLINE_CUSTOMERS)?.4:.3,g[r.PAST_ORDERS_CUSTOMERS_REFRESH][i.PRICE_LIST]=.15,g[r.PAST_ORDERS_CUSTOMERS_REFRESH][i.PRODUCT_RULE]=.15,g[r.ALL_REFRESH]={},g[r.ALL_REFRESH][i.PRODUCT]=.3,g[r.ALL_REFRESH][i.ORDER]=.03,g[r.ALL_REFRESH][i.CUSTOMER]=.09,g[r.ALL_REFRESH][i.PRICE_LIST]=.03,g[r.ALL_REFRESH][i.PRODUCT_RULE]=.03;var f=l({},o.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(e){return m[e]?m[e].actionStatus:null},getLastTimestampForAction:function(e){return h[e]?h[e].modified:null},getLastTimestampForSuccessfulAction:function(e){return h[e]?h[e][n.OK]:null},getPercentageComplete:function(e){return p[e]?p[e].percentage:null},getEntityStatuses:function(e){return m[e]?m[e].entityStatuses:null},resetTracking:function(e){m[e]={},h[e]={},p[e]={}}});s.register((function(e){var t=0;switch(e.actionType){case r.APP_DATA_SUBMIT:case r.USER_PASSWORD_RESET_REQUEST:case r.CUSTOMER_ADD_COMMENT:m[e.actionType]=e,h[e.actionType]||(h[e.actionType]={}),h[e.actionType].modified=d.getUnixTimeInMs(),f.emitChange();break;case r.SALES_REFRESH:if(e.resetTracking&&f.resetTracking(e.actionType),m[e.actionType]||(m[e.actionType]={}),m[e.actionType].actionType=e.actionType,m[e.actionType].actionStatus=e.actionStatus,h[e.actionType]||(h[e.actionType]={}),h[e.actionType].modified=d.getUnixTimeInMs(),m[e.actionType].entityStatuses||(m[e.actionType].entityStatuses={}),p[e.actionType]||(p[e.actionType]={}),p[e.actionType].entityPercentages||(p[e.actionType].entityPercentages={}),null!=e.entity&&(m[e.actionType].entityStatuses[e.entity]=e.entityStatus,e.entity==i.PRODUCT||e.entity==i.ORDER||e.entity==i.CUSTOMER||e.entity==i.PRICE_LIST||e.entity==i.PRODUCT_RULE?e.entityStatus==n.PENDING?null!=e.percentageComplete?p[e.actionType].entityPercentages[e.entity]=e.percentageComplete:p[e.actionType].entityPercentages[e.entity]=0:p[e.actionType].entityPercentages[e.entity]=100:p[e.actionType].entityPercentages[e.entity]=e.entityStatus==n.PENDING?0:100),e.actionStatus==n.PENDING)for(var a in p[e.actionType].percentage=0,p[e.actionType].entityPercentages)p[e.actionType].percentage+=g[e.actionType][a]*p[e.actionType].entityPercentages[a];else p[e.actionType].percentage=100;null!=e.queueActionType&&null!=e.entity&&(e.resetTracking&&f.resetTracking(e.queueActionType),m[e.queueActionType]||(m[e.queueActionType]={}),m[e.queueActionType].actionType=e.queueActionType,m[e.queueActionType].actionStatus=e.queueActionStatus,h[e.queueActionType]||(h[e.queueActionType]={}),h[e.queueActionType].modified=d.getUnixTimeInMs(),m[e.queueActionType].entityStatuses||(m[e.queueActionType].entityStatuses={}),p[e.queueActionType]||(p[e.queueActionType]={}),p[e.queueActionType].entityPercentages||(p[e.queueActionType].entityPercentages={}),m[e.queueActionType].entityStatuses[e.entity]=e.entityStatus,e.entity!=i.PRODUCT&&e.entity!=i.ORDER&&e.entity!=i.CUSTOMER&&e.entity!=i.PRICE_LIST&&e.entity!=i.PRODUCT_RULE||e.entityStatus==n.PENDING&&null!=e.percentageComplete&&(t=e.percentageComplete*g[e.queueActionType][e.entity])),f.emitChange();break;case r.USER_DELETE_DATA:m={},h={},p={}}switch(e.queueActionType){case r.ALL_REFRESH:case r.SALES_REFRESH:case r.ONLINE_SALES_REFRESH:case r.CUSTOMERS_SALES_REFRESH:case r.CALLS_RELATED_REFRESH:case r.PAST_ORDERS_CUSTOMERS_REFRESH:e.resetTracking&&f.resetTracking(e.queueActionType),m[e.queueActionType]||(m[e.queueActionType]={}),m[e.queueActionType].actionType=e.queueActionType,m[e.queueActionType].actionStatus=e.queueActionStatus,h[e.queueActionType]||(h[e.queueActionType]={}),h[e.queueActionType].modified=d.getUnixTimeInMs(),p[e.queueActionType]||(p[e.queueActionType]={}),e.queueActionStatus==n.PENDING?(p[e.queueActionType].percentage=null!=e.queuePercentageComplete?e.queuePercentageComplete:0,t>0&&(p[e.queueActionType].percentage+=t)):(p[e.queueActionType].percentage=100,e.queueActionStatus==n.OK&&(h[e.queueActionType][n.OK]=d.getUnixTimeInMs())),f.emitChange()}})),e.exports=f},function(e,t,a){"use strict";a.r(t),function(e){var t=a(19),s=a(38),r=a(23),n=a(15),i=a(9),o=a(37),l=a(68),c=a(55),u=a(35).EventEmitter,d=a(11),m=a(13),h=a(22),p=a(21),g=a(7),f={products:{},productsMeta:{refreshed:null,retryIDs:[]},categories:{},categoryTree:[],priceLists:{},customerToPriceList:{},productRules:{},recentProducts:{},status:{},localSearchResults:[],localSearchTerm:"",localSearchPage:1,localSearchPageSize:25,localSearchFilters:null,localSearchTotal:null,localSearchTotalPages:null,serverSearchResults:[],serverSearchTerm:"",serverSearchPage:1,serverSearchPageSize:25,serverSearchFilters:null,serverSearchTotal:null,serverSearchTotalPages:null},E={allProductIDs:null,priceLists:{},customerToPriceList:{},productRules:{}},S=d({},u.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(e){var t=i.OK;switch(e){case n.PRODUCTS_SEARCH_LOCAL:case n.PRODUCTS_SEARCH_SERVER:t=null!=f.status[e]?f.status[e]:i.OK;break;default:t=null!=f.status.default?f.status.default:i.OK}return t},getLastRefresh:function(){return f.productsMeta.refreshed},getRefreshRetryIDs:function(){return f.productsMeta.retryIDs},getProducts:function(){var e=[];for(var t in f.products)null!=f.products[t]&&e.push(f.products[t]);return e},getProduct:function(e){return f.products[e]},getActiveProductsCount:function(){return m.filter(f.products,(function(e){return null!=e&&1==e.product.is_active&&0==e.product.is_disabled})).length},getCategory:function(e){return f.categories[e]},getCategoryTree:function(){return f.categoryTree},populateCategoriesFromTree:function(e){for(var t=0;t<e.length;t++)f.categories[e[t].id]={id:e[t].id,parent_id:e[t].parent_id,name:e[t].name},null!=e[t].children&&this.populateCategoriesFromTree(e[t].children)},getSearchResults:function(e){return e==c.SERVER?f.serverSearchResults:f.localSearchResults},getSearchTerm:function(e){return e==c.SERVER?f.serverSearchTerm:f.localSearchTerm},getSearchPage:function(e){return e==c.SERVER?f.serverSearchPage:f.localSearchPage},getSearchPageSize:function(e){return e==c.SERVER?f.serverSearchPageSize:f.localSearchPageSize},getSearchFilters:function(e){return e==c.SERVER?f.serverSearchFilters:f.localSearchFilters},getSearchTotal:function(e){return e==c.SERVER?f.serverSearchTotal:f.localSearchTotal},getSearchTotalPages:function(e){return e==c.SERVER?f.serverSearchTotalPages:f.localSearchTotalPages},exportData:function(){return"{"+["products","productsMeta","categories","categoryTree","priceLists","customerToPriceList","productRules","recentProducts"].map((function(e){return'"'+e+'":'+JSON.stringify(f[e])})).join()+"}"}});r.register((function(e){switch(e.actionType){case n.INITIALISE:localStorage.products?(f.products=JSON.parse(localStorage.products),localStorage.productsMeta&&(f.productsMeta=JSON.parse(localStorage.productsMeta)),t.a.set([["products",f.products],["productsMeta",f.productsMeta]]).then((function(){localStorage.removeItem("products"),localStorage.removeItem("productsMeta"),console.log("Successfully migrated product data from legacy storage")})).catch((function(e){console.log("Unsuccessfully migrated product data from legacy storage: ",e)})),S.emitChange(),s.a.setReady(Promise.resolve())):s.a.setReady(t.a.get(["products","productsMeta","categories","categoryTree","priceLists","customerToPriceList","productRules","recentProducts"]).then((function(e){e.forEach((function(e){null!=e[1]&&(f[e[0]]=e[1])}))})).catch((function(e){})).then((function(){S.emitChange()})));break;case n.CUSTOMER_REFRESH:p.get(h.FUNC_ONLINE_CUSTOMERS)||e.actionStatus!=i.OK&&e.actionStatus!=i.PARTIAL||null!=e.customerData&&(f.recentProducts[e.customerData.id]=e.customerData.products.map((function(e){return parseInt(e)})),t.a.set("recentProducts",f.recentProducts).catch((function(e){})),S.emitChange());break;case n.SALES_REFRESH:var a=!1;if(e.entity==o.PRODUCT){if(e.batchStatus==i.OK)for(var r in e.batchItems)null!=e.batchItems[r]&&(f.products[e.batchItems[r].product.id]=e.batchItems[r]);if(e.entityStatus==i.PENDING){if(null!=e.allProductIDs){for(var r in f.products)null==f.products[r]||m.includes(e.allProductIDs,r)||delete f.products[r];E.allProductIDs=e.allProductIDs}}else{if(t.a.set("products",f.products).catch((function(e){})),e.entityStatus!=i.ERROR&&(f.productsMeta.refreshed=null!=e.newLastRefreshTimestamp?e.newLastRefreshTimestamp:g.getUnixTimeStartOfDay(),f.productsMeta.retryIDs=e.failedProductIDs),null!=E.allProductIDs){for(var c=0;c<E.allProductIDs.length;c++){var u=E.allProductIDs[c];null!=f.products[u]||m.includes(f.productsMeta.retryIDs,u)||f.productsMeta.retryIDs.push(u)}E.allProductIDs=null}t.a.set("productsMeta",f.productsMeta).catch((function(e){})),a=!0}}else if(e.entity==o.PRICE_LIST){if(e.batchStatus==i.OK)for(c=0;c<e.batchItems.length;c++){var d=e.batchItems[c];null!=E.priceLists[d.id]?E.priceLists[d.id].customer_ids=m.union(E.priceLists[d.id].customer_ids,d.customer_ids):E.priceLists[d.id]=d;for(var C=0;C<d.customer_ids.length;C++)E.customerToPriceList[d.customer_ids[C]]=d.id}e.entityStatus!=i.PENDING&&(e.entityStatus!=i.ERROR&&(f.priceLists=E.priceLists,f.customerToPriceList=E.customerToPriceList,t.a.set([["priceLists",f.priceLists],["customerToPriceList",f.customerToPriceList]]).catch((function(e){}))),E.priceLists={},E.customerToPriceList={},a=!0)}else if(e.entity==o.PRODUCT_RULE){if(e.batchStatus==i.OK)for(c=0;c<e.batchItems.length;c++){var y=e.batchItems[c];if(null!=y.products&&""!=y.products)for(C=0;C<y.customer_ids.length;C++)E.productRules[y.customer_ids[C]]=y.products.split(",").map((function(e){return parseInt(e)}))}e.entityStatus!=i.PENDING&&(e.entityStatus!=i.ERROR&&(f.productRules=E.productRules,t.a.set("productRules",f.productRules).catch((function(e){}))),E.productRules={},a=!0)}else if(e.entity==o.CUSTOMER){if(e.batchStatus==i.OK&&null!=e.batchCustomers)for(c=0;c<e.batchCustomers.length;c++)null!=e.batchCustomers[c]&&(f.recentProducts[e.batchCustomers[c].id]=e.batchCustomers[c].products.map((function(e){return parseInt(e)})));e.entityStatus!=i.PENDING&&(t.a.set("recentProducts",f.recentProducts).catch((function(e){})),a=!0)}else e.entity==o.CATEGORY&&e.entityStatus==i.OK&&(f.categoryTree=e.arrCategoryTree,S.populateCategoriesFromTree(f.categoryTree),t.a.set([["categories",f.categories],["categoryTree",f.categoryTree]]).catch((function(e){})),a=!0);a&&S.emitChange();break;case n.PRODUCTS_SEARCH_LOCAL:f.status[e.actionType]=e.actionStatus,f.localSearchTerm=e.searchTerm,f.localSearchPage=e.searchPage,f.localSearchPageSize=e.searchPageSize?e.searchPageSize:25,f.localSearchFilters=e.searchFilters;var R=[];m.forEach(f.localSearchTerm.split(" "),(function(e){var t=e.trim();""!=t&&R.push(t.toLowerCase())}));var b=null,_=[],v=null!=f.localSearchFilters,N=!1,T=null,O=null;if(null!=e.customerID&&e.customerID>0){var L=f.customerToPriceList[e.customerID];null!=L&&(b=null!=f.priceLists[L]?f.priceLists[L].products:null),_=null!=f.productRules[e.customerID]?f.productRules[e.customerID]:[],v&&f.localSearchFilters.customerProducts==l.RECENT&&(T=null!=f.recentProducts[e.customerID]?f.recentProducts[e.customerID]:[])}v&&(null!=f.localSearchFilters.featured&&f.localSearchFilters.featured&&(N=!0),null!=f.localSearchFilters.categories&&f.localSearchFilters.categories.length&&(O=f.localSearchFilters.categories));var D=m.filter(f.products,(function(e){if(null==e)return!1;var t=e.categories;if(0==(e=e.product).is_active||1==e.is_disabled)return!1;if(N&&(null==e.is_featured||1!=e.is_featured))return!1;var a=null!=e.variants&&e.variants.length>0?e.variants[0].id:e.id;if(null!=T&&!m.includes(T,a))return!1;if(null!=O){if(!t.length)return!1;for(var s=!1,r=0;r<t.length;r++)if(m.includes(O,t[r].id)){s=!0;break}if(!s)return!1}for(var n=null!=e.name?e.name.toLowerCase():"",i=null!=e.SKU?e.SKU.toLowerCase():"",o=0;o<R.length;o++)if(-1===n.indexOf(R[o])&&-1===i.indexOf(R[o]))return!1;return(null==b||null!=b[a])&&!m.includes(_,a)}));f.localSearchTotal=D.length,f.localSearchTotalPages=Math.floor(f.localSearchTotal/f.localSearchPageSize)+(f.localSearchTotal%f.localSearchPageSize>0?1:0),f.localSearchPage=0==f.localSearchTotalPages||f.localSearchPage<1?1:f.localSearchPage>f.localSearchTotalPages?f.localSearchTotalPages:f.localSearchPage;var I=(f.localSearchPage-1)*f.localSearchPageSize;f.localSearchResults=D.slice(I,I+f.localSearchPageSize),f.localSearchResults=f.localSearchResults.map((function(e){var t=null!=e.product.variants&&e.product.variants.length>0?e.product.variants[0].id:e.product.id;return e.product.calc_price=null!=b?b[t]:e.product.base_price,e})),S.emitChange();break;case n.PRODUCTS_SEARCH_SERVER:e.actionStatus==i.OK&&(f.serverSearchResults=e.resultsData,f.serverSearchTotal=e.total,f.serverSearchTotalPages=e.totalPages),f.status[e.actionType]=e.actionStatus,f.serverSearchTerm=e.searchTerm,f.serverSearchPage=e.searchPage,f.serverSearchPageSize=e.searchPageSize?e.searchPageSize:25,f.serverSearchFilters=e.searchFilters,S.emitChange();break;case n.USER_DELETE_DATA:f.products={},f.productsMeta={refreshed:null,retryIDs:[]},f.categories={},f.categoryTree=[],f.priceLists={},f.customerToPriceList={},f.productRules={},f.recentProducts={},f.localSearchResults=[],f.localSearchTerm="",f.localSearchPage=1,f.localSearchPageSize=25,f.localSearchFilters=null,f.localSearchTotal=null,f.localSearchTotalPages=null,f.serverSearchResults=[],f.serverSearchTerm="",f.serverSearchPage=1,f.serverSearchPageSize=25,f.serverSearchFilters=null,f.serverSearchTotal=null,f.serverSearchTotalPages=null,t.a.set([["products",f.products],["productsMeta",f.productsMeta]]).catch((function(e){})),S.emitChange()}})),e.exports=S}.call(this,a(36)(e))},,,,,,,,,,function(e,t,a){"use strict";e.exports={CALL:"call",ADMIN:"admin"}},function(e,t,a){"use strict";e.exports={LOCAL:"local",SERVER:"server"}},,,function(e,t,a){"use strict";var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(10),u=a(7),d=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).preloadImage=function(){var e=new Image;e.onload=function(){r.setState({loaded:!0})},e.onerror=function(){r.setState({error:!0})},e.src=r.props.src},r.state={loaded:!1,error:!1},r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.preloadImage()}},{key:"componentWillReceiveProps",value:function(e){this.props.src!=e.src&&(this.setState({loaded:!1,error:!1}),this.preloadImage())}},{key:"render",value:function(){return this.props.visible?!this.state.loaded||this.state.error?this.props.placeholderSpinner&&!this.state.loaded?l.a.createElement(c.a,{style:this.props.placeholderSpinnerStyle,isVisible:!0}):l.a.createElement("img",{className:this.props.placeholderClassName||"placeholder",style:this.props.style,src:this.props.placeholderSrc}):l.a.createElement("img",{className:this.props.className,style:this.props.style,src:this.props.src}):null}}]),a}(l.a.Component);d.defaultProps={placeholderSrc:u.assetsUrl+"img/morpheus-m.png",placeholderSpinner:!1,visible:!0},t.a=d},,,,,,function(e,t,a){"use strict";a.r(t),function(e){var t=a(19),s=a(38),r=a(23),n=a(15),i=a(9),o=a(35).EventEmitter,l=a(11),c=a(13),u=a(22),d=a(21),m={user:{},userMeta:{lastUser:null,fields:[{name:"email",label:"Email",order:8},{name:"role",label:"Role",order:9}],fieldsRefreshed:null},status:i.OK,loginError:""},h=l({},o.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(){return m.status},getLoginError:function(){return m.loginError},hasUser:function(){return null!=m.user.id},getUser:function(){return m.user},getID:function(){return m.user?m.user.id:0},getUsername:function(){return m.user?m.user.username:""},getPassword:function(){return m.user?m.user.password:""},getName:function(){return m.user?m.user.name:""},getFullName:function(){return m.user?m.user.fullName:""},getEmail:function(){return m.user?m.user.email:""},getCompanyLogo:function(){return m.user&&m.user.company&&m.user.company.app_logo?m.user.company.app_logo:""},getCompanyBackground:function(){return m.user&&m.user.company&&m.user.company.app_background?m.user.company.app_background:""},getCompanyCurrency:function(){return m.user&&m.user.company?m.user.company.default_currency:{id:"10",name:"South African Rand",symbol:"R",code:"ZAR"}},areCompanyPriceListsEnabled:function(){return m.user&&m.user.company&&m.user.company.pricelist_enabled&&1==m.user.company.pricelist_enabled},doCompanyProductRulesExist:function(){return m.user&&m.user.company&&m.user.company.product_rules_exist&&1==m.user.company.product_rules_exist},getB2BCustomerID:function(){return m.user&&null!=m.user.b2b_customer_id?m.user.b2b_customer_id:null},isLastUser:function(e){return null!=m.userMeta.lastUser&&m.userMeta.lastUser.username==e},getLastUser:function(){return m.userMeta.lastUser},getFields:function(){return m.userMeta.fields},getLastRefreshForFields:function(){return m.userMeta.fieldsRefreshed},exportData:function(){return'{"user":'+JSON.stringify(m.user)+',"userMeta":'+JSON.stringify(m.userMeta)+"}"}});r.register((function(e){switch(e.actionType){case n.INITIALISE:localStorage.user?(m.user=JSON.parse(localStorage.user),localStorage.userMeta&&(m.userMeta=JSON.parse(localStorage.userMeta)),null!=m.user.is_b2b_user&&1==m.user.is_b2b_user&&d.setProfile(u.PROFILE_B2B),t.a.set([["user",m.user],["userMeta",m.userMeta]]).then((function(){localStorage.removeItem("user"),localStorage.removeItem("userMeta"),console.log("Successfully migrated user data from legacy storage")})).catch((function(e){console.log("Unsuccessfully migrated user data from legacy storage: ",e)})),h.emitChange(),s.a.setReady(Promise.resolve())):s.a.setReady(t.a.get(["user","userMeta"]).then((function(e){e.forEach((function(e){null!=e[1]&&(m[e[0]]=e[1])}))})).catch((function(e){})).then((function(){null!=m.user.is_b2b_user&&1==m.user.is_b2b_user&&d.setProfile(u.PROFILE_B2B),h.emitChange()})));break;case n.USER_LOGIN:e.actionStatus!=i.OK&&e.actionStatus!=i.ERROR||(m.user=e.actionStatus==i.OK?e.userData:{},m.loginError=e.actionStatus==i.OK?"":e.loginError,e.actionStatus==i.OK&&(m.userMeta.lastUser={id:e.userData.id,username:e.userData.username},t.a.set("userMeta",m.userMeta).catch((function(e){}))),t.a.set("user",m.user).catch((function(e){}))),m.status=e.actionStatus,h.emitChange();break;case n.USER_REFRESH:if(e.actionStatus==i.OK){if(m.user=c.assign(e.userData,{username:h.getUsername(),password:h.getPassword()}),m.userMeta.lastUser={id:e.userData.id,username:e.userData.username},null!=e.userFieldData){for(var a in e.userFieldData)if("varchar"==e.userFieldData[a].type||"date"==e.userFieldData[a].type){var r=c.findIndex(m.userMeta.fields,{name:a}),o={name:a,label:e.userFieldData[a].label,order:parseInt(e.userFieldData[a].order)};-1!=r?m.userMeta.fields[r]=o:m.userMeta.fields.push(o)}m.userMeta.fields=c.sortBy(m.userMeta.fields,"order"),m.userMeta.fieldsRefreshed=e.userFieldDataTS}t.a.set([["user",m.user],["userMeta",m.userMeta]]).catch((function(e){}))}m.status=e.actionStatus,h.emitChange();break;case n.USER_LOGOUT:m.user={},t.a.set("user",m.user).catch((function(e){})),m.status=e.actionStatus,h.emitChange();break;case n.USER_DELETE_DATA:m.userMeta={lastUser:m.userMeta.lastUser,fields:[{name:"email",label:"Email",order:8},{name:"role",label:"Role",order:9}],fieldsRefreshed:null},t.a.set("userMeta",m.userMeta).catch((function(e){})),h.emitChange()}})),e.exports=h}.call(this,a(36)(e))},function(e,t,a){"use strict";a.r(t),function(e){var t=a(1),s=a.n(t);window.$=s.a;a(23);var r=a(15),n=a(42),i=a(30),o=a(26),l=a(66),c=a(103),u=a(9),d=a(22),m=a(21),h=a(7),p=a(13),g={refreshAll:function(e,t,a,s,u){null==u&&(u=[]);var d=[{context:n,action:"refreshUser",args:null,completionWeighting:.03,stopOnFail:!0},{context:o,action:"refreshCalls",args:null,completionWeighting:.1,stopOnFail:!0},{context:l,action:"refreshAdminAudits",args:["add:callCustomerIDs"],completionWeighting:.025},{context:l,action:"prepareCustomerAuditData",args:["add:callCustomerIDs"],completionWeighting:0},{context:l,action:"refreshAuditsForCustomers",args:["add:customerAuditIDObjs"],completionWeighting:.15},{context:this,action:"combineCustomers",args:[u,"add:callCustomerIDs"],completionWeighting:0},{context:i,action:"refreshPaymentTerms",args:null,completionWeighting:.025},{context:i,action:"refreshTaxClasses",args:null,completionWeighting:.025},{context:i,action:"refreshCarriers",args:null,completionWeighting:.025},{context:i,action:"refreshCurrencies",args:null,completionWeighting:.025},{context:i,action:"refreshProducts",args:[e,t],completionWeighting:.3},{context:i,action:"refreshCategories",args:null,completionWeighting:.035},{context:i,action:"refreshPastOrders",args:[a,s],completionWeighting:.03},{context:this,action:"combineCustomers",args:["add:customerIDs","add:pastOrderCustomerIDs"],completionWeighting:0},{context:c,action:"refreshLibraryForCustomers",args:["add:customerIDs"],completionWeighting:.08},{context:i,action:"refreshCustomers",args:["add:customerIDs"],completionWeighting:.09,stopOnFail:!0},{context:i,action:"refreshPriceLists",args:["add:customerIDs"],completionWeighting:.03},{context:i,action:"refreshProductRules",args:["add:customerIDs"],completionWeighting:.03}];return h.executeActionQueue(d,r.ALL_REFRESH)},combineCustomers:function(e,t){return e=e.map((function(e){return parseInt(e)})),t=t.map((function(e){return parseInt(e)})),s.a.Deferred().resolve({results:{customerIDs:p.union(e,t)}})},submitAppData:function(e){var t=s.a.Deferred();if(null==e)return t.resolve(),t;h.dispatch({actionType:r.APP_DATA_SUBMIT,actionStatus:u.PENDING});var a=m.activeProfile==d.PROFILE_NATIVE?"Native":m.activeProfile==d.PROFILE_B2B?"B2B":"Web",n=m.appVersion;return s.a.ajax({url:h.apiUrl+"general/submitDb",type:"POST",data:{device_type:"Generic device",additional_parameters:JSON.stringify({"Device Type":"Generic device"}),app_version:"Morpheus Retailer Lite (".concat(a," Profile) ").concat(n),db_version:"1",db_file:e},headers:{Authorization:h.getHTTPAuthString()},dataType:"json"}).fail((function(){h.dispatch({actionType:r.APP_DATA_SUBMIT,actionStatus:u.ERROR}),t.reject()})).done((function(e){e.status?(h.dispatch({actionType:r.APP_DATA_SUBMIT,actionStatus:u.OK}),t.resolve()):(h.dispatch({actionType:r.APP_DATA_SUBMIT,actionStatus:u.ERROR}),t.reject())})),t}};e.exports=g}.call(this,a(36)(e))},function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(42),i=a(9),o=a(54),l=a(25),c=a(67),u=a(7),d=a(13),m=window.$,h={doAfterAccessCheck:function(e,t){"refreshAudits"==e&&null!=t&&t[1]&&t[1].length&&s.dispatch({actionType:r.AUDITS_REFRESH,actionStatus:i.PENDING,customerID:null!=t?t[0]:t}),n.checkAccess(this[e],t)},refreshAdminAudits:function(e){null==e&&(e=[]);var t=m.Deferred(),a=u.getUnixTimeStartOfDay();return 0==e.length?(u.dispatch({actionType:r.ADMIN_AUDITS_REFRESH,actionStatus:i.OK,customerIDs:e,date:a,adminAuditsCustomersData:{}}),t.resolve()):(u.dispatch({actionType:r.ADMIN_AUDITS_REFRESH,actionStatus:i.PENDING,customerIDs:e,date:a}),m.ajax({url:u.apiUrl+"audit/getAdminAudits",type:"GET",data:{date:a,limit_to_stores:JSON.stringify(e)},headers:{Authorization:u.getHTTPAuthString()},dataType:"json"}).fail((function(){u.dispatch({actionType:r.ADMIN_AUDITS_REFRESH,actionStatus:i.ERROR,customerIDs:e,date:a}),t.reject()})).done((function(s){if(s.status){var n,o={};if(s.results&&s.results.length)for(n=0;n<s.results.length;n++)o[s.results[n].audit_id]=s.results[n].limit_to_stores;u.dispatch({actionType:r.ADMIN_AUDITS_REFRESH,actionStatus:i.OK,customerIDs:e,date:a,adminAuditsCustomersData:o}),t.resolve()}else u.dispatch({actionType:r.ADMIN_AUDITS_REFRESH,actionStatus:i.ERROR,customerIDs:e,date:a}),t.reject()}))),t},refreshAudits:function(e,t,a){var s=m.Deferred(),n=null!=a&&a?o.ADMIN:o.CALL;if(t&&t.length){u.dispatch({actionType:r.AUDITS_REFRESH,actionStatus:i.PENDING,auditsType:n,customerID:e});var l=t.slice(0),c=!0,d=!0,h={};!function t(a){m.ajax({url:u.apiUrl+"audit/fetch",type:"GET",data:{audit_id:a},headers:{Authorization:u.getHTTPAuthString()},dataType:"json"}).fail((function(){c=!1})).done((function(e){e.status?(d=!1,h[a]=e.results):c=!1})).always((function(){if(l.length>0)t(l.shift());else{var a=c?i.OK:d?i.ERROR:i.PARTIAL;u.dispatch({actionType:r.AUDITS_REFRESH,actionStatus:a,auditsType:n,auditsData:h,customerID:e}),a==i.ERROR?s.reject():s.resolve({partial:a==i.PARTIAL})}}))}(l.shift())}else u.dispatch({actionType:r.AUDITS_REFRESH,actionStatus:i.OK,auditsType:n,auditsData:{},customerID:e}),s.resolve();return s},refreshAuditsForCustomers:function(e){null==e&&(e=[]);var t=m.Deferred();if(e.length){var a=[],s=!0,r=!0;!function n(o){o.auditIDs=d.difference(o.auditIDs,a),h.refreshAudits(o.customerID,o.auditIDs,o.isAdmin).fail((function(e){s=!1,null!=e&&e.partial&&(r=!1)})).done((function(e){r=!1,null!=e&&e.partial?s=!1:a=d.union(a,o.auditIDs)})).always((function(a){if(e.length>0)n(e.shift());else{var o=s?i.OK:r?i.ERROR:i.PARTIAL;o==i.ERROR?t.reject():t.resolve({partial:o==i.PARTIAL})}}))}(e.shift())}else t.resolve();return t},prepareCustomerAuditData:function(e){for(var t=[],a=0;a<e.length;a++){var s=l.getCallById(e[a]);t.push({customerID:s.store_id,auditIDs:s.audits,isAdmin:!1});var r=c.getAdminAuditIDsForCustomer(e[a]);r.length&&t.push({customerID:s.store_id,auditIDs:r,isAdmin:!0})}return m.Deferred().resolve({results:{customerAuditIDObjs:t}})},saveAuditAnswer:function(e,t){s.dispatch({actionType:r.AUDIT_ANSWER_SAVE,actionStatus:i.OK,auditType:null!=t&&t?o.ADMIN:o.CALL,auditAnswerData:e})}};e.exports=h},function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(9),i=a(54),o=a(35).EventEmitter,l=a(11),c=a(13),u=a(7),d={},m={},h={},p={},g={},f=n.OK,E=l({},o.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(){return f},getAudits:function(e,t,a){var s=null!=t&&t?m:d,r=[];if(e&&e.length){var n;for(null==a&&(a=!0),n=0;n<e.length;n++)this.isAuditValid(e[n],t)&&r.push(s[e[n]]);a&&(r=c.sortBy(r,(function(e){return!e.meta_data.is_compulsory})))}return r},getAdminAuditIDsForCustomer:function(e){var t=[];for(var a in h)h[a]&&!c.find(h[a],(function(t){return t==e}))||t.push(a);return t},getCustomerRestrictionsForAdminAudit:function(e){return h[e]},getAudit:function(e,t){return null!=t&&t?m[e]:d[e]},isAuditValid:function(e,t){var a,s=null!=t&&t?m:d;if(s[e]&&"enabled"==s[e].meta_data.status&&s[e].question_groups.length)for(a=0;a<s[e].question_groups.length;a++)if(s[e].question_groups[a]&&s[e].question_groups[a].questions.length)return!0;return!1},getLastRefreshForCustomer:function(e,t){return null!=t&&t?g[e]?g[e].refreshed:null:p[e]?p[e].refreshed:null},purgeMetaDataExceptForIds:function(e,t){var a=null!=t&&t?g:p;for(var s in a)c.includes(e,s)||(a[s]=void 0)},purgeAuditDataExceptForIds:function(e,t){var a=null!=t&&t?m:d,s=!(null!=t&&t);for(var r in a)c.includes(e,s?parseInt(r):r)||(a[r]=void 0)},exportData:function(){return'{"audits":'+JSON.stringify(d)+',"adminAudits":'+JSON.stringify(m)+',"adminAuditsCustomers":'+JSON.stringify(h)+',"auditsMeta":'+JSON.stringify(p)+',"adminAuditsMeta":'+JSON.stringify(g)+"}"}});s.register((function(e){switch(e.actionType){case r.INITIALISE:localStorage.audits&&(d=JSON.parse(localStorage.audits)),localStorage.adminAudits&&(m=JSON.parse(localStorage.adminAudits)),localStorage.adminAuditsCustomers&&(h=JSON.parse(localStorage.adminAuditsCustomers)),localStorage.auditsMeta&&(p=JSON.parse(localStorage.auditsMeta)),localStorage.adminAuditsMeta&&(g=JSON.parse(localStorage.adminAuditsMeta)),E.emitChange();break;case r.CALLS_REFRESH:if(e.actionStatus==n.OK){var t=c.keysIn(e.callsData);E.purgeMetaDataExceptForIds(t);var a=[];for(var s in e.callsData)null!=e.callsData[s].audits&&a.push(e.callsData[s].audits);var o=c.union.apply(null,a);E.purgeAuditDataExceptForIds(o),localStorage.audits=JSON.stringify(d),localStorage.auditsMeta=JSON.stringify(p)}break;case r.ADMIN_AUDITS_REFRESH:if(e.actionStatus==n.OK){E.purgeMetaDataExceptForIds(e.customerIDs,!0),h=e.adminAuditsCustomersData;o=c.keysIn(e.adminAuditsCustomersData);E.purgeAuditDataExceptForIds(o,!0),localStorage.adminAudits=JSON.stringify(m),localStorage.adminAuditsCustomers=JSON.stringify(h),localStorage.adminAuditsMeta=JSON.stringify(g)}f=e.actionStatus,E.emitChange();break;case r.AUDITS_REFRESH:if(e.actionStatus==n.OK||e.actionStatus==n.PARTIAL){var l=e.auditsType==i.ADMIN?m:d,S=e.auditsType==i.ADMIN?g:p;c.assign(l,e.auditsData),S[e.customerID]||(S[e.customerID]={}),S[e.customerID].refreshed=u.getUnixTime(),e.auditsType==i.ADMIN?(localStorage.adminAudits=JSON.stringify(l),localStorage.adminAuditsMeta=JSON.stringify(S)):(localStorage.audits=JSON.stringify(l),localStorage.auditsMeta=JSON.stringify(S))}f=e.actionStatus,E.emitChange();break;case r.USER_DELETE_DATA:d={},m={},h={},p={},g={},localStorage.audits=JSON.stringify(d),localStorage.adminAudits=JSON.stringify(m),localStorage.adminAuditsCustomers=JSON.stringify(h),localStorage.auditsMeta=JSON.stringify(p),localStorage.adminAuditsMeta=JSON.stringify(g),E.emitChange()}})),e.exports=E},function(e,t,a){"use strict";e.exports={ALL:"all",RECENT:"recent"}},function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(9),i=a(35).EventEmitter,o=a(11),l=(a(13),a(25)),c=a(76),u=a(7),d=a(54),m={},h={},p=n.OK,g=d.CALL,f=u.getUnixTimeStartOfDay()+"",E=o({},i.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(){return p},getStatusAuditType:function(){return g},getFreshCustomerAuditAnswersObject:function(e,t){if(null!=t&&t)return{customer_id:e,entry:null,exit:null,completed:!0,submitted:!1};var a=l.getCallById(e);return{customer_id:e,call_cycle_row_id:null!=a&&null!=a.call_cycle_row_id?a.call_cycle_row_id:null,call_cycle_override_id:null!=a&&null!=a.call_cycle_override_id?a.call_cycle_override_id:null,entry:null,exit:null,completed:!1,submitted:!1}},getAuditAnswersForCustomer:function(e,t){var a=null!=t&&t?h:m;return null!=a[f]&&null!=a[f][e]?a[f][e]:this.getFreshCustomerAuditAnswersObject(e,t)},getAuditAnswer:function(e,t,a,s){return null!=a&&a?(s=parseInt(s),h[f]&&h[f][e]&&h[f][e][t]&&h[f][e][t][s]?h[f][e][t][s]:{customer_id:e,audit_id:t,audit_idx:s,weight:0,score:0,completed:!1}):m[f]&&m[f][e]&&m[f][e][t]?m[f][e][t]:{customer_id:e,audit_id:t,weight:0,score:0,completed:!1}},getAuditSubmission:function(e,t,a,s,r){var n,i=(s=null!=s&&s)?h:m,o={customer_id:i[e][t].customer_id,call_date:e,entry:i[e][t].entry,exit:i[e][t].exit,audit_answers:{audit_id:a,final_score:0,date_of_visit:0,answers:[]}};for(var l in s?(r=parseInt(r),n=i[e][t][a][r],o.audit_idx=r,o.audit_answers.store_id=i[e][t].customer_id):(n=i[e][t][a],null!=i[e][t].call_cycle_override_id?o.audit_answers.call_cycle_override_id=i[e][t].call_cycle_override_id:o.audit_answers.call_cycle_row_id=i[e][t].call_cycle_row_id),null!=n.signatures&&n.signatures.length&&(o.audit_answers.signatures=n.signatures),n.weight>0&&(o.audit_answers.final_score=parseFloat(n.score/n.weight)),n)if("customer_id"!=l&&"audit_id"!=l&&"weight"!=l&&"score"!=l&&"completed"!=l&&"signatures"!=l){var u=n[l];if(u.visible&&u.answered){var d={audit_question_id:l,timestamp:u.timestamp,location:u.location};switch(u.timestamp>o.audit_answers.date_of_visit&&(o.audit_answers.date_of_visit=u.timestamp),u.type){case c.PRODUCT_FACING:d.facings=u.product_facings;case c.PRODUCT:d.answer=u.product_availability,d.price=u.product_price;break;case c.YES_NO:d.answer=u.yes_no;break;case c.FREE_TEXT:d.answer=u.free_text;break;case c.MULTIPLE_CHOICE:d.answer=u.options_selected;break;case c.MULTI_SELECT:d.answer=u.options_selected.join();break;case c.PHOTO:d.downloadable_file=u.image;break;case c.NUMERIC:d.answer=u.numeric;break;case c.CURRENCY:d.answer=u.currency;break;case c.DATE:d.answer=u.date;break;case c.BARCODE:d.answer=u.barcode;break;case c.SIGNATURE:d.signature_id=u.signature_id,d.signature_name=u.signature_name,d.signature_comments=u.signature_comments,d.signature_file=u.signature_file}o.audit_answers.answers.push(d)}}return o},getAuditSubmissions:function(e){var t=(e=null!=e&&e)?h:m,a=[];for(var s in t)if(null!=t[s])for(var r in t[s])if(null!=t[s][r]&&t[s][r].completed&&!t[s][r].submitted)for(var n in t[s][r]){if("customer_id"!=n&&"call_cycle_row_id"!=n&&"call_cycle_override_id"!=n&&"entry"!=n&&"exit"!=n&&"completed"!=n&&"submitted"!=n)if(null!=t[s][r][n])if(e){if(t[s][r][n].length){var i=void 0;for(i=0;i<t[s][r][n].length;i++){var o;if(null!=t[s][r][n][i]&&t[s][r][n][i].completed)(o=this.getAuditSubmission(s,r,n,e,i)).audit_answers.answers.length&&a.push(o)}}}else if(t[s][r][n].completed)(o=this.getAuditSubmission(s,r,n,e)).audit_answers.answers.length&&a.push(o)}return a},purgeData:function(e){var t=(e=null!=e&&e)?h:m,a=!0;for(var s in t)if(s!=f&&null!=t[s]){for(var r in a=!0,t[s])if(null!=t[s][r])if(t[s][r].submitted||!t[s][r].completed)t[s][r]=void 0;else if(e){var n=!0;for(var i in t[s][r])if("customer_id"!=i&&"entry"!=i&&"exit"!=i&&"completed"!=i&&"submitted"!=i&&null!=t[s][r][i]&&t[s][r][i].length){var o=void 0;for(o=0;o<t[s][r][i].length;o++)null!=t[s][r][i][o]&&(t[s][r][i][o].completed?n=!1:t[s][r][i][o]=null)}n?t[s][r]=void 0:a=!1}else a=!1;a&&(t[s]=void 0)}},exportData:function(){return'{"answers":'+JSON.stringify(m)+',"adminAnswers":'+JSON.stringify(h)+',"currentCallDate":'+JSON.stringify(f)+"}"}});s.register((function(e){switch(e.actionType){case r.INITIALISE:localStorage.answers&&(m=JSON.parse(localStorage.answers)),localStorage.adminAnswers&&(h=JSON.parse(localStorage.adminAnswers)),localStorage.currentCallDate&&(f=JSON.parse(localStorage.currentCallDate)),E.emitChange();break;case r.CALLS_REFRESH:e.actionStatus==n.OK&&(f=e.callDate+"",E.purgeData(),localStorage.answers=JSON.stringify(m),localStorage.currentCallDate=JSON.stringify(f));break;case r.ADMIN_AUDITS_REFRESH:e.actionStatus==n.OK&&(E.purgeData(!0),localStorage.adminAnswers=JSON.stringify(h));break;case r.CUSTOMER_ENTER:null!=l.getCallById(e.customerID)&&(m[f]||(m[f]={}),m[f][e.customerID]||(m[f][e.customerID]=E.getFreshCustomerAuditAnswersObject(e.customerID)),null==m[f][e.customerID].entry&&(m[f][e.customerID].entry=e.entryTimestamp,localStorage.answers=JSON.stringify(m)));break;case r.AUDIT_ANSWER_SAVE:(a=(t=e.auditType==d.ADMIN)?h:m)[f]||(a[f]={}),a[f][e.auditAnswerData.customer_id]||(a[f][e.auditAnswerData.customer_id]=E.getFreshCustomerAuditAnswersObject(e.auditAnswerData.customer_id,t),t||(a[f][e.auditAnswerData.customer_id].entry=u.getUnixTime())),a[f][e.auditAnswerData.customer_id][e.auditAnswerData.audit_id]||(a[f][e.auditAnswerData.customer_id][e.auditAnswerData.audit_id]=t?[]:{}),t?(a[f][e.auditAnswerData.customer_id][e.auditAnswerData.audit_id][e.auditAnswerData.audit_idx]=e.auditAnswerData,a[f][e.auditAnswerData.customer_id].submitted=!1,localStorage.adminAnswers=JSON.stringify(a)):(a[f][e.auditAnswerData.customer_id][e.auditAnswerData.audit_id]=e.auditAnswerData,localStorage.answers=JSON.stringify(a)),E.emitChange();break;case r.CUSTOMER_EXIT:(e.callAuditsCompleted||null!=m[f]&&null!=m[f][e.customerID])&&(m[f]||(m[f]={}),m[f][e.customerID]||(m[f][e.customerID]=E.getFreshCustomerAuditAnswersObject(e.customerID)),e.callAuditsCompleted&&(m[f][e.customerID].completed=!0),m[f][e.customerID].exit=e.exitTimestamp,localStorage.answers=JSON.stringify(m),E.emitChange());break;case r.AUDITS_SUBMIT:if(e.actionStatus!=n.PENDING){var t,a=(t=e.auditsType==d.ADMIN)?h:m;for(var s in e.submittedIDs)for(var i in e.submittedIDs[s]){e.failedIDs[s]&&e.failedIDs[s][i]||(a[s][i].submitted=!0);for(var o=e.submittedIDs[s][i],c=0,S=o.length;c<S;c++)if(t){var C=o[c].split("-");a[s][i][C[0]][parseInt(C[1])]=null}else a[s][i][o[c]]=void 0}t?localStorage.adminAnswers=JSON.stringify(a):localStorage.answers=JSON.stringify(a)}p=e.actionStatus,g=e.auditsType,E.emitChange();break;case r.USER_DELETE_DATA:m={},h={},localStorage.answers=JSON.stringify(m),localStorage.adminAnswers=JSON.stringify(h),E.emitChange()}})),e.exports=E},,,,,,,function(e,t,a){"use strict";e.exports={PRODUCT:"product",YES_NO:"yes/no",FREE_TEXT:"correct answer",MULTIPLE_CHOICE:"multiple choice",PHOTO:"photo",NUMERIC:"numeric",CURRENCY:"currency",DATE:"date",PRODUCT_FACING:"product facing",MULTI_SELECT:"multi select",BARCODE:"barcode",SIGNATURE:"signature"}},function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(9),i=a(35).EventEmitter,o=a(11),l=a(13),c=a(7),u={},d={},m={},h=n.OK,p=o({},i.prototype,{addChangeListener:function(e){this.on("change",e)},removeChangeListener:function(e){this.removeListener("change",e)},emitChange:function(){this.emit("change")},getStatus:function(){return h},getCategories:function(){return u},getCustomerCategories:function(){return u[c.customerLibraryCategoryID]&&u[c.customerLibraryCategoryID].children?u[c.customerLibraryCategoryID].children:{}},getGlobalCategories:function(){return u[c.globalLibraryCategoryID]&&u[c.globalLibraryCategoryID].children?u[c.globalLibraryCategoryID].children:{}},getCustomerCategoriesFileCounts:function(e){return this.getCategoriesFileCountsForKey(e,u,c.customerLibraryCategoryID)},getGlobalCategoriesFileCounts:function(){return this.getCategoriesFileCountsForKey("global",u,c.globalLibraryCategoryID)},getCategoriesFileCountsForKey:function(e,t,a){var s={};return this.getFileCountsForKey(e,t,s,a),s},getFile:function(e){return d[e]?d[e]:{name:"Unavailable"}},getLastRefreshForKey:function(e){return m[e]?m[e].refreshed:null},getFileCountsForKey:function(e,t,a,s){var r=0;for(var n in t)null!=s&&n!=s||(a[n]={fileCount:0,children:null},null!=t[n].assignments[e]&&(a[n].fileCount+=t[n].assignments[e].length),null!=t[n].children&&(a[n].children={},a[n].fileCount+=this.getFileCountsForKey(e,t[n].children,a[n].children)),r+=a[n].fileCount);return r},removeFileAssignmentsForKey:function(e,t,a){for(var s in t)null!=a&&s!=a||(null!=t[s].assignments[e]&&(t[s].assignments[e]=void 0),this.removeFileAssignmentsForKey(e,t[s].children))},mergeFileAssignmentsForKey:function(e,t,a,s){for(var r in t)null!=s&&r!=s||(l.isObject(t[r])&&!l.isArray(t[r])?(a[r]||(a[r]={}),this.mergeFileAssignmentsForKey(e,t[r],a[r])):a[r]=t[r])},exportData:function(){return'{"categories":'+JSON.stringify(u)+',"files":'+JSON.stringify(d)+',"libraryMeta":'+JSON.stringify(m)+"}"}});s.register((function(e){switch(e.actionType){case r.INITIALISE:localStorage.libraryCategories&&(u=JSON.parse(localStorage.libraryCategories)),localStorage.libraryFiles&&(d=JSON.parse(localStorage.libraryFiles)),localStorage.libraryMeta&&(m=JSON.parse(localStorage.libraryMeta)),p.emitChange();break;case r.LIBRARY_REFRESH:var t;if(e.actionStatus==n.OK||e.actionStatus==n.PARTIAL)null!=e.customerID&&e.customerID>0?(u[c.customerLibraryCategoryID]?p.removeFileAssignmentsForKey(e.customerID,u,c.customerLibraryCategoryID):u[c.customerLibraryCategoryID]={},l.isEmpty(e.categoryData[c.customerLibraryCategoryID])||p.mergeFileAssignmentsForKey(e.customerID,e.categoryData[c.customerLibraryCategoryID],u[c.customerLibraryCategoryID]),t=e.customerID):(u[c.globalLibraryCategoryID]=e.categoryData[c.globalLibraryCategoryID],t="global"),l.assign(d,e.fileData),m[t]||(m[t]={}),m[t].refreshed=c.getUnixTime(),localStorage.libraryCategories=JSON.stringify(u),localStorage.libraryFiles=JSON.stringify(d),localStorage.libraryMeta=JSON.stringify(m);h=e.actionStatus,p.emitChange();break;case r.USER_DELETE_DATA:u={},d={},m={},localStorage.libraryCategories=JSON.stringify(u),localStorage.libraryFiles=JSON.stringify(d),localStorage.libraryMeta=JSON.stringify(m),p.emitChange()}})),e.exports=p},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(10),u=a(85),d=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){var e=this.props,t=e.completed,a=e.colour,s=e.animation,r=e.height,n=e.className,i=e.children,o=Object(u.a)(e,["completed","colour","animation","height","className","children"]),c={backgroundColor:a,width:t+"%",transition:"width ".concat(s,"ms"),height:r};return l.a.createElement("div",Object.assign({className:n||"progressbar-container"},o),l.a.createElement("div",{className:"progressbar-progress",style:c},i))}}]),a}(l.a.Component);d.defaultProps={completed:0,colour:"#3BBEFF",animation:200,height:10};var m=d,h=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"modal fade in",style:{display:"block"},tabIndex:"-1",role:"dialog"},l.a.createElement("div",{className:"modal-dialog"},l.a.createElement("div",{className:"modal-content"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("h4",{className:"modal-title"},this.props.title)),l.a.createElement("div",{className:"modal-body"},l.a.createElement("div",{style:{textAlign:"center"}},l.a.createElement(c.a,{isVisible:this.props.isLoading}),this.props.description)),l.a.createElement("div",{className:"modal-footer"},l.a.createElement(m,{completed:this.props.percentage})))))}}]),a}(l.a.Component);h.defaultProps={percentage:0,title:"Progress",description:"",isLoading:!1};t.default=h},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(){return Object(s.a)(this,a),t.apply(this,arguments)}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"modal fade in",style:{display:"block"},tabIndex:"-1",role:"dialog"},l.a.createElement("div",{className:"modal-dialog"},l.a.createElement("div",{className:"modal-content"},l.a.createElement("div",{className:"modal-body"},l.a.createElement("div",{style:{textAlign:"center"}},this.props.description)),l.a.createElement("div",{className:"modal-footer",style:{textAlign:"center"}},l.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.props.onYes},l.a.createElement("i",{className:"fa fa-check"})," Yes"),l.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.props.onNo},l.a.createElement("i",{className:"fa fa-close"})," No")))))}}]),a}(l.a.Component);c.defaultProps={description:"Are you sure?"},t.default=c},,,,function(e,t,a){"use strict";var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(13),u=a(44),d=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleCategoryDeselection=function(t){t.preventDefault(),e.props.onDeselect(parseInt(t.currentTarget.dataset.id))},e.toggleCategorySelection=function(t){t.preventDefault();var a=t.target;1==a.dataset.selected?e.props.onDeselect(parseInt(a.dataset.id)):e.props.onSelect(parseInt(a.dataset.id))},e.renderCategoryTree=function(t){for(var a=[],s=0;s<t.length;s++){var r=t[s],n=c.includes(e.props.selections,r.id);a.push(l.a.createElement("div",{key:r.id,className:"panel cat-panel"+(n?" panel-primary":" panel-default")},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"cat-title-"+r.id},l.a.createElement("h4",{className:"panel-title"},null!=r.children?l.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#cat-content-"+r.id},r.name):l.a.createElement("a",{role:"button","data-id":r.id,"data-selected":n?1:0,href:"#",onClick:e.toggleCategorySelection},r.name))),null!=r.children?l.a.createElement("div",{className:"panel-collapse collapse",role:"tabpanel",id:"cat-content-"+r.id},l.a.createElement("div",{className:"panel-body"},e.renderCategoryTree(r.children))):null))}return a},e.renderSelectedCategory=function(t){return l.a.createElement("div",{key:t,className:"panel panel-primary cat-panel panel-selection"},l.a.createElement("div",{className:"panel-heading extra-control",role:"tab"},l.a.createElement("h4",{className:"panel-title"},u.getCategory(t).name),l.a.createElement("a",{className:"panel-edit",role:"button","data-id":t,href:"#",onClick:e.handleCategoryDeselection},l.a.createElement("i",{className:"fa fa-close"}))))},e}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"category-selection"},this.props.isOpen?this.props.categories.length?this.renderCategoryTree(this.props.categories):l.a.createElement("div",{className:"text-empty"},"No categories available"):this.props.selections.length?l.a.createElement("div",null,this.props.selections.map(this.renderSelectedCategory)):null)}}]),a}(l.a.Component);d.defaultProps={selections:[],isOpen:!1},t.a=d},function(e,t,a){"use strict";var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(58),u=a(31),d=a(7),m=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).updateAvailableImageHeight=function(){r.setState({availableImageHeight:Math.round(window.innerHeight/2)})},r.handleImageChange=function(e){e.preventDefault();var t=e.target.dataset.dir;r.setState((function(e){return{currentImageIndex:"prev"==t?e.currentImageIndex<1?r.props.images.length-1:e.currentImageIndex-1:e.currentImageIndex>r.props.images.length-2?0:e.currentImageIndex+1}}))},r.handleClose=function(){r.props.onClose()},r.state={currentImageIndex:0,availableImageHeight:0},r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.updateAvailableImageHeight(),window.addEventListener("resize",this.updateAvailableImageHeight)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateAvailableImageHeight)}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"modal fade in",style:{display:"block"},tabIndex:"-1",role:"dialog"},l.a.createElement("div",{className:"modal-dialog"},l.a.createElement("div",{className:"modal-content"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:this.handleClose},"\xd7"),null!=this.props.title&&this.props.title.length?l.a.createElement("h4",{className:"modal-title"},this.props.title):null),l.a.createElement("div",{className:"modal-body"},l.a.createElement("div",{className:"modal-image"},this.props.images.map((function(t,a){return l.a.createElement(c.a,{key:t.id,style:{maxHeight:e.state.availableImageHeight},placeholderSpinnerStyle:{marginTop:Math.round(e.state.availableImageHeight/4),marginBottom:Math.round(e.state.availableImageHeight/4)},src:d.sanitiseForSecureURL(t.image_url),placeholderSpinner:!0,visible:e.state.currentImageIndex==a})})))),this.props.images.length>1?l.a.createElement("div",{className:"modal-footer"},l.a.createElement("div",{className:"image-paging"},l.a.createElement(u.a,{isVisible:!0,info:{page:this.state.currentImageIndex+1,pageSize:1,total:this.props.images.length,totalPages:this.props.images.length}}),l.a.createElement("nav",null,l.a.createElement("ul",{className:"pager"},l.a.createElement("li",{className:"previous"},l.a.createElement("a",{href:"#","data-dir":"prev",onClick:this.handleImageChange},l.a.createElement("span",{"aria-hidden":"true"},"<")," Prev")),l.a.createElement("li",{className:"next"},l.a.createElement("a",{href:"#","data-dir":"next",onClick:this.handleImageChange},"Next ",l.a.createElement("span",{"aria-hidden":"true"},">"))))))):null)))}}]),a}(l.a.Component);m.defaultProps={title:null},t.a=m},,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";var s=a(23),r=a(15),n=a(42),i=a(9),o=a(7),l=a(13),c=window.$,u={doAfterAccessCheck:function(e,t){"refreshLibrary"==e&&s.dispatch({actionType:r.LIBRARY_REFRESH,actionStatus:i.PENDING,customerID:null!=t?t[0]:t}),n.checkAccess(this[e],t)},refreshLibrary:function(e){o.dispatch({actionType:r.LIBRARY_REFRESH,actionStatus:i.PENDING,customerID:e});var t=c.Deferred(),a=null!=e&&e>0,s=[],n=!0,u=!0,d={},m={};return c.ajax({url:o.apiUrl+"file/getCategoryIndex",type:"GET",data:{store_id:e,date:o.getUnixTime()},headers:{Authorization:o.getHTTPAuthString()},dataType:"json"}).fail((function(){o.dispatch({actionType:r.LIBRARY_REFRESH,actionStatus:i.ERROR,customerID:e}),t.reject()})).done((function(h){h.status?(h.results.length>0&&(d=function e(t,r,n,i){for(var c={},u=0,d=t.length;u<d;u++){var m;if(!t[u].processed&&t[u].parent_id==r)t[u].processed=!0,null==r?(n=t[u].category_id==(a?o.customerLibraryCategoryID:o.globalLibraryCategoryID),m=""+t[u].category_id,n&&t[u].files>0&&s.push({categoryID:t[u].category_id,treePath:m})):(m=i+".children."+t[u].category_id,n&&t[u].files>0&&s.push({categoryID:t[u].category_id,treePath:m})),c[t[u].category_id]={category_id:t[u].category_id,name:t[u].name,assignments:{},children:e(t,t[u].category_id,n,m)}}return l.isEmpty(c)?null:c}(h.results,null,!1,"")),s.length>0?(u=!1,function h(p){c.ajax({url:o.apiUrl+"file/getAssignedFiles",type:"GET",data:{store_id:e,category_id:p.categoryID,date:o.getUnixTime()},headers:{Authorization:o.getHTTPAuthString()},dataType:"json"}).fail((function(){n=!1})).done((function(t){if(t.status){if(u=!1,t.results.length>0){for(var s=[],r=0,i=t.results.length;r<i;r++)m[t.results[r].id]=t.results[r],s.push(t.results[r].id);l.set(d,p.treePath+".assignments."+(a?e:"global"),s)}}else n=!1})).always((function(){if(s.length>0)h(s.shift());else{var a=n?i.OK:u?i.ERROR:i.PARTIAL;o.dispatch({actionType:r.LIBRARY_REFRESH,actionStatus:a,customerID:e,categoryData:d,fileData:m}),a==i.ERROR?t.reject():t.resolve({partial:a==i.PARTIAL})}}))}(s.shift())):(o.dispatch({actionType:r.LIBRARY_REFRESH,actionStatus:i.OK,customerID:e,categoryData:d,fileData:m}),t.resolve())):(o.dispatch({actionType:r.LIBRARY_REFRESH,actionStatus:i.ERROR,customerID:e}),t.reject())})),t},refreshLibraryForCustomers:function(e,t){null==t&&(t=!0),e=e.slice(),t&&e.push(null);var a=c.Deferred();if(e.length){var s=!0,r=!0;!function t(n){u.refreshLibrary(n).fail((function(e){s=!1,null!=e&&e.partial&&(r=!1)})).done((function(e){r=!1,null!=e&&e.partial&&(s=!1)})).always((function(n){if(e.length>0)t(e.shift());else{var o=s?i.OK:r?i.ERROR:i.PARTIAL;o==i.ERROR?a.reject():a.resolve({partial:o==i.PARTIAL})}}))}(e.shift())}else a.resolve();return a}};e.exports=u},function(e,t,a){"use strict";e.exports={INCOMPLETE:11,PLACED:12}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";e.exports={CUSTOMER_DETAILS:"customer_details",CUSTOMER_LOCATIONS:"customer_locations",CUSTOMER_CONTACTS:"customer_contacts"}},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(10),i=a(31),o=window.$,l=r.a.createClass({displayName:"CustomerRequestList",getDefaultProps:function(){return{searchTerm:"",searchPage:1,searchPageSize:null,searchTotal:null,searchTotalPages:null,searchResults:[],isLoading:!1}},componentDidMount:function(){o("#customer-search").focus(),this.props.onSearch(this.props.searchTerm,this.props.searchPage)},handleSearchTermChange:function(e){var t=e.target.value;this.props.onSearch(t,1)},handleSearchPageChange:function(e){e.preventDefault();var t="prev"==e.target.dataset.dir?this.props.searchPage>1?this.props.searchPage-1:1:null!=this.props.searchTotalPages&&this.props.searchPage<this.props.searchTotalPages?this.props.searchPage+1:this.props.searchPage;t!=this.props.searchPage&&this.props.onSearch(this.props.searchTerm,t)},handleCustomerRequest:function(e){this.props.onRequest(e)},handleClose:function(){this.props.onFinish()},render:function(){return r.a.createElement("div",{className:"modal fade in",style:{display:"block"},tabIndex:"-1",role:"dialog"},r.a.createElement("div",{className:"modal-dialog"},r.a.createElement("div",{className:"modal-content"},r.a.createElement("div",{className:"modal-header"},r.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:this.handleClose},"\xd7"),r.a.createElement("h4",{className:"modal-title"},"Request Customers")),r.a.createElement("div",{className:"modal-body"},r.a.createElement("input",{type:"text",className:"form-control",id:"customer-search",placeholder:"Search",value:this.props.searchTerm,onChange:this.handleSearchTermChange,autoComplete:"off"}),r.a.createElement("div",{className:"mor-list mor-list-paging mor-list-paging-spaced"},r.a.createElement(n.a,{isVisible:this.props.isLoading}),r.a.createElement(i.a,{isVisible:!this.props.isLoading,info:{page:this.props.searchPage,pageSize:this.props.searchPageSize,total:this.props.searchTotal,totalPages:this.props.searchTotalPages}}),r.a.createElement("nav",null,r.a.createElement("ul",{className:"pager"},r.a.createElement("li",{className:1==this.props.searchPage?"previous disabled":"previous"},r.a.createElement("a",{href:"#","data-dir":"prev",onClick:this.handleSearchPageChange},r.a.createElement("span",{"aria-hidden":"true"},"<")," Prev")),r.a.createElement("li",{className:null==this.props.searchTotalPages||this.props.searchTotalPages<=1||this.props.searchPage==this.props.searchTotalPages?"next disabled":"next"},r.a.createElement("a",{href:"#","data-dir":"next",onClick:this.handleSearchPageChange},"Next ",r.a.createElement("span",{"aria-hidden":"true"},">"))))),this.props.searchResults.length?r.a.createElement("table",{className:"table table-striped table-spaced"},r.a.createElement("tbody",null,this.props.searchResults.map((function(e){return r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,r.a.createElement("span",null,e.name),r.a.createElement("br",null),e.unique_code?r.a.createElement("span",{className:"text-primary small pull-left"},e.unique_code):null),r.a.createElement("td",{className:"align-right"},r.a.createElement("button",{className:this.props.isLoading?"btn btn-primary disabled":"btn btn-primary",onClick:this.handleCustomerRequest.bind(this,{id:e.id,name:e.name})},"Request")))}),this))):r.a.createElement("div",{className:this.props.isLoading?"hidden":"text-muted"},"No customers found"))),r.a.createElement("div",{className:"modal-footer"},r.a.createElement("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal",onClick:this.handleClose},"Done")))))}});t.default=l},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(152),u=a.n(c),d=a(17),m=a(7),h=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).saveSignature=function(){r.props.onSave(r.signature)},r.signatureIsValid=function(){return!(null==r.signature.name||!r.signature.name.length||null==r.signature.file||!r.signature.file.length)},r.handleSignatureChange=function(e,t){t&&(r.signature.file=e.split(",")[1].replace(/\+/g,"%2B"),r.saveSignature())},r.handleSignatureClear=function(){r.setState((function(e){return e.oldSignaturePresent?{oldSignaturePresent:!1}:{clearSignature:m.getUnixTimeInMs()}})),r.signature.file="",r.saveSignature()},r.handleTextChange=function(e){r.signature[e.target.dataset.field]=e.target.value,r.saveSignature()},r.handleCancel=function(){r.signature.file="",r.signature.name="",r.signature.comments="",r.saveSignature(),r.props.onClose()},r.handleFinished=function(){r.signatureIsValid()?r.props.onClose():d.error("Please provide a signature and name")},r.signature=e.signature,r.state={clearSignature:null,oldSignaturePresent:null!=e.signature.file&&e.signature.file.length},r}return Object(r.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.signature=e.signature}},{key:"render",value:function(){return l.a.createElement("div",{className:"modal fade in",style:{display:"block"},tabIndex:"-1",role:"dialog"},l.a.createElement("div",{className:"modal-dialog"},l.a.createElement("div",{className:"modal-content"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:this.handleFinished},"\xd7"),l.a.createElement("h4",{className:"modal-title"},this.props.title)),l.a.createElement("div",{className:"modal-body"},this.state.oldSignaturePresent?l.a.createElement("div",{className:"form-group signature-pad"},l.a.createElement("img",{src:"data:image/png;base64,"+this.signature.file}),l.a.createElement("button",{type:"button",className:"close signature-pad-clear",onClick:this.handleSignatureClear},"\xd7")):l.a.createElement("div",{className:"form-group signature-pad"},l.a.createElement(u.a,{minWidth:"0.8",maxWidth:"1.5",backgroundColor:"rgb(255,255,255)",mimeType:"image/jpeg",quality:"0.8",onEnd:this.handleSignatureChange,clear:this.state.clearSignature}),null!=this.signature.file&&this.signature.file.length?l.a.createElement("button",{type:"button",className:"close signature-pad-clear",onClick:this.handleSignatureClear},"\xd7"):null),l.a.createElement("div",{className:"form-group"},l.a.createElement("input",{type:"text",className:"form-control",id:"signature-name","data-field":"name",placeholder:"Name",value:this.props.signature.name,onChange:this.handleTextChange,autoComplete:"off"})),l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("textarea",{className:"form-control",id:"signature-comments","data-field":"comments",placeholder:"Comments",rows:"3",value:this.props.signature.comments,onChange:this.handleTextChange,autoComplete:"off"}))),l.a.createElement("div",{className:"modal-footer",style:{textAlign:"center"}},l.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleCancel},l.a.createElement("i",{className:"fa fa-close"})," Cancel"),l.a.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleFinished},l.a.createElement("i",{className:"fa fa-check"})," Done")))))}}]),a}(l.a.Component);h.defaultProps={title:"Signature"},t.default=h},function(e,t,a){"use strict";function s(e,t,a){this.x=e,this.y=t,this.time=a||(new Date).getTime()}Object.defineProperty(t,"__esModule",{value:!0}),s.prototype.velocityFrom=function(e){return this.time!==e.time?this.distanceTo(e)/(this.time-e.time):1},s.prototype.distanceTo=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},t.default=s},,function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(13),i=a(270),o=r.a.createClass({displayName:"CategoryList",getDefaultProps:function(){return{filterTopCategoryId:null,categoryTree:{},categoryTreeCounts:{},isLoading:!1}},renderCategoryPanels:function(e,t,a){var s=[];for(var o in e)null!=a&&o!=a||s.push(r.a.createElement("div",{key:o,className:"panel panel-default cat-panel"+(0==t[o].fileCount&&n.isEmpty(e[o].children)?" cat-empty":"")},r.a.createElement("div",{className:"panel-heading",role:"tab",id:"cat-title-"+o},r.a.createElement("h4",{className:"panel-title"},r.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#cat-content-"+o},r.a.createElement("span",null,null!=a?null:e[o].name),r.a.createElement("div",{className:"cat-count"},t[o].fileCount)))),r.a.createElement("div",{className:"panel-collapse collapse"+(null!=a?" in":""),role:"tabpanel",id:"cat-content-"+o},n.isEmpty(e[o].assignments[this.props.assignmentKey])?null:r.a.createElement(i,{files:e[o].assignments[this.props.assignmentKey],categoryID:o,isLoading:this.props.isLoading}),n.isEmpty(e[o].children)?null:r.a.createElement("div",{className:"panel-body"},this.renderCategoryPanels(e[o].children,t[o].children)))));return s},render:function(){return r.a.createElement("div",{className:"panel-group mor-list",role:"tablist"},r.a.createElement("div",{className:this.props.isLoading?"cssload-container show":"hidden"},r.a.createElement("div",{className:this.props.isLoading?"cssload-wheel":""})),n.isEmpty(this.props.categoryTree)?r.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"Please refresh to obtain library files"):this.renderCategoryPanels(this.props.categoryTree,this.props.categoryTreeCounts,this.props.filterTopCategoryId))}});t.default=o},,,function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(10),u=a(31),d=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleSearchTermChange=function(t){var a=t.target.value;e.props.onSearch(a,1)},e.handleSearchPageChange=function(t){t.preventDefault();var a="prev"==t.target.dataset.dir?e.props.searchPage>1?e.props.searchPage-1:1:null!=e.props.searchTotalPages&&e.props.searchPage<e.props.searchTotalPages?e.props.searchPage+1:e.props.searchPage;a!=e.props.searchPage&&e.props.onSearch(e.props.searchTerm,a)},e.handleCustomerSelection=function(t){var a={id:t.target.dataset.id,name:t.target.dataset.name,is_approved_for_orders:t.target.dataset.approved};e.props.onSelect(a)},e.handleClose=function(){e.props.onFinish()},e.createCustomerRow=function(t){return l.a.createElement("tr",{key:t.id},l.a.createElement("td",null,l.a.createElement("span",null,t.name),l.a.createElement("br",null),t.unique_code?l.a.createElement("span",{className:"text-primary small pull-left"},t.unique_code):null),l.a.createElement("td",{className:"align-right"},l.a.createElement("button",{className:e.props.isLoading?"btn btn-primary disabled":"btn btn-primary","data-id":t.id,"data-name":t.name,"data-approved":t.is_approved_for_orders,onClick:e.handleCustomerSelection},"Select")))},e}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.props.onSearch(this.props.searchTerm,this.props.searchPage)}},{key:"render",value:function(){return l.a.createElement("div",{className:"modal fade in",style:{display:"block"},tabIndex:"-1",role:"dialog"},l.a.createElement("div",{className:"modal-dialog",style:{margin:0}},l.a.createElement("div",{className:"modal-content"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:this.handleClose},"\xd7"),l.a.createElement("h4",{className:"modal-title"},"Select Customer")),l.a.createElement("div",{className:"modal-body"},l.a.createElement("input",{type:"text",className:"form-control",id:"customer-search",placeholder:"Search",value:this.props.searchTerm,onChange:this.handleSearchTermChange,autoComplete:"off"}),l.a.createElement("div",{className:"mor-list mor-list-paging mor-list-paging-spaced"},l.a.createElement(c.a,{isVisible:this.props.isLoading}),l.a.createElement(u.a,{isVisible:!this.props.isLoading,info:{page:this.props.searchPage,pageSize:this.props.searchPageSize,total:this.props.searchTotal,totalPages:this.props.searchTotalPages}}),l.a.createElement("nav",null,l.a.createElement("ul",{className:"pager"},l.a.createElement("li",{className:1==this.props.searchPage?"previous disabled":"previous"},l.a.createElement("a",{href:"#","data-dir":"prev",onClick:this.handleSearchPageChange},l.a.createElement("span",{"aria-hidden":"true"},"<")," Prev")),l.a.createElement("li",{className:null==this.props.searchTotalPages||this.props.searchTotalPages<=1||this.props.searchPage==this.props.searchTotalPages?"next disabled":"next"},l.a.createElement("a",{href:"#","data-dir":"next",onClick:this.handleSearchPageChange},"Next ",l.a.createElement("span",{"aria-hidden":"true"},">"))))),this.props.searchResults.length?l.a.createElement("table",{className:"table table-striped table-spaced"},l.a.createElement("tbody",null,this.props.searchResults.map(this.createCustomerRow))):l.a.createElement("div",{className:this.props.isLoading?"hidden":"text-muted"},"No customers found"))),l.a.createElement("div",{className:"modal-footer"},l.a.createElement("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal",onClick:this.handleClose},"Done")))))}}]),a}(l.a.Component);d.defaultProps={searchTerm:"",searchPage:1,searchPageSize:null,searchTotal:null,searchTotalPages:null,searchResults:[],isLoading:!1},t.default=d},,function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),r=l(a(0)),n=l(a(145)),i=l(a(266)),o=a(267);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.style=a.props.style||{},a.style.width=a.style.width||"100%",a.style.height=a.style.height||"100%",a.style.msTouchAction="none",a.style.touchAction="none",a.clearVal=0,a.handleMouseDown=a.handleMouseDown.bind(a),a.handleMouseMove=a.handleMouseMove.bind(a),a.handleMouseUp=a.handleMouseUp.bind(a),a.handleMouseLeave=a.handleMouseLeave.bind(a),a.handleTouchStart=a.handleTouchStart.bind(a),a.handleTouchMove=a.handleTouchMove.bind(a),a.handleTouchEnd=a.handleTouchEnd.bind(a),a.strokeBegin=a.strokeBegin.bind(a),a.strokeUpdate=a.strokeUpdate.bind(a),a.strokeEnd=a.strokeEnd.bind(a),a.transformData=a.transformData.bind(a),a.isDataPresent=a.isDataPresent.bind(a),a.createPoint=a.createPoint.bind(a),a.addPoint=a.addPoint.bind(a),a.calculateCurveWidths=a.calculateCurveWidths.bind(a),a.drawPoint=a.drawPoint.bind(a),a.drawCurve=a.drawCurve.bind(a),a.drawDot=a.drawDot.bind(a),a.clear=a.clear.bind(a),a.reset=a.reset.bind(a),a}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"componentDidMount",value:function(){this.velocityFilterWeight=this.props.velocityFilterWeight||.7,this.minWidth=this.props.minWidth||.5,this.maxWidth=this.props.maxWidth||2.5,this.throttle=this.props.throttle||16,this.strokeMoveUpdate=this.throttle?(0,o.throttle)(this.strokeUpdate,this.throttle):this.strokeUpdate,this.strokeMoveUpdate=this.strokeUpdate,this.dotSize=this.props.dotSize||(this.minWidth+this.maxWidth)/2,this.penColor=this.props.penColor||"black",this.backgroundColor=this.props.backgroundColor||"rgba(0,0,0,0)",this.mimeType=this.props.mimeType||"image/png",this.blob=this.props.blob||!1,this.trim=this.props.trim||!1,this.quality=this.props.quality||1;var e=this.canvas;e.width=e.offsetWidth,e.height=e.offsetHeight,this.ctx=e.getContext("2d"),this.clear()}},{key:"componentWillReceiveProps",value:function(e){e.clear&&e.clear!==this.clearVal&&(this.clearVal=e.clear,this.clear())}},{key:"handleMouseDown",value:function(e){0===e.button&&(this.mouseButtonDown=!0,this.strokeBegin(e))}},{key:"handleMouseMove",value:function(e){this.mouseButtonDown&&this.strokeMoveUpdate(e)}},{key:"handleMouseUp",value:function(e){0===e.button&&this.mouseButtonDown&&(this.mouseButtonDown=!1,this.strokeEnd(e))}},{key:"handleMouseLeave",value:function(e){0===e.button&&this.mouseButtonDown&&(this.mouseButtonDown=!1,this.strokeEnd(e))}},{key:"handleTouchStart",value:function(e){if(1===e.targetTouches.length){var t=e.changedTouches[0];this.strokeBegin(t)}}},{key:"handleTouchMove",value:function(e){e.preventDefault();var t=e.targetTouches[0];this.strokeMoveUpdate(t)}},{key:"handleTouchEnd",value:function(e){e.target===this.canvas&&(e.preventDefault(),this.strokeEnd(e))}},{key:"strokeBegin",value:function(e){this.data.push([]),this.reset(),this.strokeUpdate(e),"function"===typeof this.props.onBegin&&this.props.onBegin(e)}},{key:"strokeUpdate",value:function(e){var t=e.clientX,a=e.clientY,s=this.createPoint(t,a),r=this.addPoint(s),n=r.curve,i=r.widths;n&&i&&this.drawCurve(n,i.start,i.end),this.data[this.data.length-1].push({x:s.x,y:s.y,time:s.time})}},{key:"strokeEnd",value:function(){var e=this.points.length>2,t=this.points[0];!e&&t&&this.drawDot(t),"function"===typeof this.props.onEnd&&this.props.onEnd(this.transformData(),this.isDataPresent())}},{key:"transformData",value:function(){var e=String(this.mimeType).toLowerCase(),t=void 0;if(t=(this.trim?(0,o.trim)(this.canvas):this.canvas).toDataURL(e,this.quality),this.blob){for(var a=atob(t.split(",")[1]),s=t.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(a.length),n=0;n<a.length;n+=1)r[n]=a.charCodeAt(n);t=new Blob([r],{type:s})}return t}},{key:"isDataPresent",value:function(){return(0,o.canvasHasData)(this.canvas)}},{key:"createPoint",value:function(e,t,a){var s=this.canvas.getBoundingClientRect();return new n.default(e-s.left,t-s.top,a||(new Date).getTime())}},{key:"addPoint",value:function(e){var t=this.points;if(t.push(e),t.length>2){3===t.length&&t.unshift(t[0]);var a=(0,o.calculateCurveControlPoints)(t[0],t[1],t[2]).c2,s=(0,o.calculateCurveControlPoints)(t[1],t[2],t[3]).c1,r=new i.default(t[1],a,s,t[2]),n=this.calculateCurveWidths(r);return t.shift(),{curve:r,widths:n}}return{}}},{key:"calculateCurveWidths",value:function(e){var t=e.startPoint,a=e.endPoint,s={start:null,end:null},r=this.velocityFilterWeight*a.velocityFrom(t)+(1-this.velocityFilterWeight)*this.lastVelocity,n=this.strokeWidth(r);return s.start=this.lastWidth,s.end=n,this.lastVelocity=r,this.lastWidth=n,s}},{key:"strokeWidth",value:function(e){return Math.max(this.maxWidth/(e+1),this.minWidth)}},{key:"drawPoint",value:function(e,t,a){this.ctx.moveTo(e,t),this.ctx.arc(e,t,a,0,2*Math.PI,!1),"function"===typeof this.props.onChange&&this.props.onChange(!1)}},{key:"drawCurve",value:function(e,t,a){var s=a-t,r=Math.floor(e.length());this.ctx.beginPath();for(var n=0;n<r;n+=1){var i=n/r,o=i*i,l=o*i,c=1-i,u=c*c,d=u*c,m=d*e.startPoint.x;m+=3*u*i*e.control1.x,m+=3*c*o*e.control2.x,m+=l*e.endPoint.x;var h=d*e.startPoint.y;h+=3*u*i*e.control1.y,h+=3*c*o*e.control2.y,h+=l*e.endPoint.y;var p=t+l*s;this.drawPoint(m,h,p)}this.ctx.closePath(),this.ctx.fill()}},{key:"drawDot",value:function(e){this.ctx.beginPath(),this.drawPoint(e.x,e.y,this.dotSize),this.ctx.closePath(),this.ctx.fill()}},{key:"clear",value:function(){this.ctx.fillStyle=this.backgroundColor,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.data=[],this.reset(),"function"===typeof this.props.onChange&&this.props.onChange(!0)}},{key:"reset",value:function(){this.points=[],this.lastVelocity=0,this.lastWidth=(this.minWidth+this.maxWidth)/2,this.ctx.fillStyle=this.penColor}},{key:"render",value:function(){var e=this;return r.default.createElement("canvas",{style:this.style,className:this.props.className,ref:function(t){e.canvas=t},onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd})}}]),t}(r.default.Component);t.default=c},,,,function(e,t,a){e.exports=a(310)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(39),i=a(7),o=r.a.createClass({displayName:"LoginForm",getDefaultProps:function(){return{isLoading:!1,differentUserWillBeLoggedIn:!1}},render:function(){return r.a.createElement("form",{className:"login-form"},r.a.createElement("div",{className:"user-login-info"},r.a.createElement("img",{className:"login-img",src:i.assetsUrl+"img/morpheus-m.png"}),r.a.createElement("div",{className:"login-input"},r.a.createElement("input",{type:"email",className:"form-control",name:"username",placeholder:"Email",value:this.props.info.username,onChange:this.props.onChange,autoFocus:!0,autoComplete:"off",disabled:this.props.isLoading})),r.a.createElement("div",{className:"login-input"},r.a.createElement("input",{type:"password",className:"form-control",name:"password",placeholder:"Password",value:this.props.info.password,onChange:this.props.onChange,autoComplete:"off",disabled:this.props.isLoading})),r.a.createElement("div",{className:"login-footer"},this.props.differentUserWillBeLoggedIn?r.a.createElement("div",{className:"btn-group",role:"group"},r.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.props.onLogin,disabled:this.props.isLoading},"Login and Clear Data"),r.a.createElement("button",{className:"btn btn-default",onClick:this.props.onCancel,disabled:this.props.isLoading},"Cancel")):r.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.props.onLogin,disabled:this.props.isLoading},"Login"),r.a.createElement(n.a,{className:"forgot-password",to:"/login/passwordreset"},"Forgot password?")),r.a.createElement("div",{className:this.props.isLoading?"cssload-container show":"hidden"},r.a.createElement("div",{className:this.props.isLoading?"cssload-wheel":""}))),r.a.createElement("img",{className:"login-img-footer",src:i.assetsUrl+"img/morpheus-brand-pb.png"}))}});t.default=o},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(39),i=a(7),o=r.a.createClass({displayName:"CallList",getDefaultProps:function(){return{isLoading:!1}},render:function(){return r.a.createElement("div",{className:"mor-list"},r.a.createElement("div",{className:this.props.isLoading?"cssload-container show":"hidden"},r.a.createElement("div",{className:this.props.isLoading?"cssload-wheel":""})),this.props.calls.length?r.a.createElement("table",{className:"table table-striped table-spaced",style:{marginTop:0}},r.a.createElement("tbody",null,this.props.calls.map((function(e){var t=null!=i.location.lat&&e.locations.length&&e.locations[0].latitude;return r.a.createElement("tr",{key:e.store_id,className:e.completed?"success":null},r.a.createElement("td",{className:"col-xs-8"},r.a.createElement("span",null,e.store_name),r.a.createElement("br",null),t?r.a.createElement("span",{className:"text-primary small pull-left"},i.getDistanceBetweenLatLonPointsInKm(i.location.lat,i.location.lng,e.locations[0].latitude,e.locations[0].longitude)+"km"):null,e.start_time?r.a.createElement("span",{className:"text-primary small pull-left",style:t?{marginLeft:"5px"}:null},e.start_time+"-"+e.end_time):null,e.was_requested?r.a.createElement("span",{className:"text-primary small pull-left",style:t||e.start_time?{marginLeft:"5px"}:null},"Requested"):null),r.a.createElement("td",{className:"col-xs-4 align-right",style:{paddingLeft:0}},r.a.createElement(n.a,{className:e.completed?"btn btn-success disabled":this.props.isLoading?"btn btn-primary disabled":"btn btn-primary",role:"button",to:"/calls/"+e.store_id},r.a.createElement("i",{className:e.submitted||e.completed?"fa fa-check":"fa fa-arrow-right"})," ",e.submitted?"Submitted":e.completed?"Completed":"View")))}),this))):r.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"Please refresh to obtain calls for today"))}});t.default=o},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(39),i=a(10),o=a(13),l=r.a.createClass({displayName:"CustomerInfoPanelList",getDefaultProps:function(){return{customerEditBaseURL:"",isLoading:!1}},renderField:function(e){return r.a.createElement("li",{key:e.name,className:"list-group-item"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},e.label)),r.a.createElement("div",{className:"col-xs-8"},r.a.createElement("span",{className:"text-primary"},this.props.customer[e.name]))))},renderAddress:function(e,t){if(null!=e.is_active&&1!=e.is_active)return null;var a=t+1,s=null!=e.description&&""!=e.description?e.description:"Location "+a;return r.a.createElement("div",{key:a,className:"panel panel-default cat-panel",style:0==t?{marginTop:0}:{}},r.a.createElement("div",{className:"panel-heading",role:"tab",id:"cat-title-address-"+a},r.a.createElement("h4",{className:"panel-title"},r.a.createElement("a",{className:0==t?"":"collapsed",role:"button","data-toggle":"collapse","data-parent":"#cust-address-accordion",href:"#cat-content-address-"+a},r.a.createElement("span",null,s),r.a.createElement("i",{className:"minimise fa fa-window-minimize"}),r.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),r.a.createElement("div",{className:"panel-collapse collapse"+(0==t?" in":""),role:"tabpanel",id:"cat-content-address-"+a},r.a.createElement("div",{className:"panel-body address-container"},r.a.createElement("address",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Description")),r.a.createElement("div",{className:"col-xs-8"},e.description)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Address")),r.a.createElement("div",{className:"col-xs-8"},e.address_1,r.a.createElement("br",null),e.address_2)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"City")),r.a.createElement("div",{className:"col-xs-8"},e.city)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Zip")),r.a.createElement("div",{className:"col-xs-8"},e.zip)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Location")),r.a.createElement("div",{className:"col-xs-8"},e.latitude,", ",e.longitude))))))},renderContact:function(e,t){var a=t+1,s=[];null!=e.first_name&&""!=e.first_name&&s.push(e.first_name),null!=e.last_name&&""!=e.last_name&&s.push(e.last_name);var n=s.join(" ");return n=""==n?"Contact "+a:n,r.a.createElement("div",{key:a,className:"panel panel-default cat-panel",style:0==t?{marginTop:0}:{}},r.a.createElement("div",{className:"panel-heading",role:"tab",id:"cat-title-contact-"+a},r.a.createElement("h4",{className:"panel-title"},r.a.createElement("a",{className:0==t?"":"collapsed",role:"button","data-toggle":"collapse","data-parent":"#cust-contact-accordion",href:"#cat-content-contact-"+a},r.a.createElement("span",null,n),r.a.createElement("i",{className:"minimise fa fa-window-minimize"}),r.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),r.a.createElement("div",{className:"panel-collapse collapse"+(0==t?" in":""),role:"tabpanel",id:"cat-content-contact-"+a},r.a.createElement("div",{className:"panel-body contact-container"},r.a.createElement("address",null,r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"First Name")),r.a.createElement("div",{className:"col-xs-8"},e.first_name)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Last Name")),r.a.createElement("div",{className:"col-xs-8"},e.last_name)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Email")),r.a.createElement("div",{className:"col-xs-8"},e.email)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Office Phone")),r.a.createElement("div",{className:"col-xs-8"},e.office_phone)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Cell Phone")),r.a.createElement("div",{className:"col-xs-8"},e.cell_phone)),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},"Fax")),r.a.createElement("div",{className:"col-xs-8"},e.fax))))))},renderInfoPanels:function(){var e=[];return e.push(r.a.createElement("div",{key:"details",className:"panel panel-default cat-panel"},r.a.createElement("div",{className:"panel-heading extra-control",role:"tab",id:"cat-title-details"},r.a.createElement("h4",{className:"panel-title"},r.a.createElement("a",{role:"button","data-toggle":"collapse","data-parent":"#cust-cat-accordion",href:"#cat-content-details"},r.a.createElement("span",null,"Details"),r.a.createElement("i",{className:"minimise fa fa-window-minimize"}),r.a.createElement("i",{className:"maximise fa fa-window-maximize"}))),r.a.createElement(n.a,{className:"panel-edit"+(this.props.isLoading?" disabled":""),role:"button",to:this.props.customerEditBaseURL+"/editdetails"},r.a.createElement("i",{className:"fa fa-edit"}))),r.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"cat-content-details"},r.a.createElement("ul",{className:"list-group"},this.props.customerFields.map(this.renderField))))),e.push(r.a.createElement("div",{key:"addresses",className:"panel panel-default cat-panel"},r.a.createElement("div",{className:"panel-heading extra-control",role:"tab",id:"cat-title-address"},r.a.createElement("h4",{className:"panel-title"},r.a.createElement("a",{className:"collapsed",role:"button","data-toggle":"collapse","data-parent":"#cust-cat-accordion",href:"#cat-content-address"},r.a.createElement("span",null,"Addresses"),r.a.createElement("i",{className:"minimise fa fa-window-minimize"}),r.a.createElement("i",{className:"maximise fa fa-window-maximize"}))),r.a.createElement(n.a,{className:"panel-edit"+(this.props.isLoading?" disabled":""),role:"button",to:this.props.customerEditBaseURL+"/editlocations"},r.a.createElement("i",{className:"fa fa-edit"}))),r.a.createElement("div",{className:"panel-collapse collapse",role:"tabpanel",id:"cat-content-address"},r.a.createElement("div",{className:"panel-body address-container"},r.a.createElement("div",{className:"panel-group",id:"cust-address-accordion",style:{marginBottom:0},role:"tablist"},this.props.customer.locations.map(this.renderAddress)))))),e.push(r.a.createElement("div",{key:"contacts",className:"panel panel-default cat-panel"},r.a.createElement("div",{className:"panel-heading extra-control",role:"tab",id:"cat-title-contact"},r.a.createElement("h4",{className:"panel-title"},r.a.createElement("a",{className:"collapsed",role:"button","data-toggle":"collapse","data-parent":"#cust-cat-accordion",href:"#cat-content-contact"},r.a.createElement("span",null,"Contacts"),r.a.createElement("i",{className:"minimise fa fa-window-minimize"}),r.a.createElement("i",{className:"maximise fa fa-window-maximize"}))),r.a.createElement(n.a,{className:"panel-edit"+(this.props.isLoading?" disabled":""),role:"button",to:this.props.customerEditBaseURL+"/editcontacts"},r.a.createElement("i",{className:"fa fa-edit"}))),r.a.createElement("div",{className:"panel-collapse collapse",role:"tabpanel",id:"cat-content-contact"},r.a.createElement("div",{className:"panel-body contact-container"},r.a.createElement("div",{className:"panel-group",id:"cust-contact-accordion",style:{marginBottom:0},role:"tablist"},this.props.customer.contacts.map(this.renderContact)))))),e},render:function(){var e=o.keys(this.props.customer);return r.a.createElement("div",{className:"panel-group mor-list",id:"cust-cat-accordion",role:"tablist"},r.a.createElement(i.a,{isVisible:this.props.isLoading}),e.length>2?this.renderInfoPanels():r.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"No information"))}});t.default=l},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).handleTextChange=function(e){r.customerEdits[e.target.dataset.field]=e.target.value,r.saveCustomerDetails()},r.saveCustomerDetails=function(){r.props.onSave(r.customerEdits)},r.createCustomerDetailsField=function(e){return l.a.createElement("div",{key:e.name,className:"form-group"},l.a.createElement("label",{htmlFor:"cust-edit-"+e.name,className:"col-xs-4 control-label"},l.a.createElement("small",{className:"text-muted"},e.label)),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("input",{type:"text",className:"form-control",id:"cust-edit-"+e.name,"data-field":e.name,value:r.props.customerEdits[e.name],onChange:r.handleTextChange,autoComplete:"off"})))},r.customerEdits=e.customerEdits,r}return Object(r.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.customerEdits=e.customerEdits}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("div",{className:"panel panel-default mor-list"},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"customer-details-edit-title"},l.a.createElement("h4",{className:"panel-title"},"Details")),l.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"customer-details-edit-content"},l.a.createElement("div",{className:"panel-body"},l.a.createElement("div",{className:"form-horizontal panel-form"},this.props.customerFields.map(this.createCustomerDetailsField))))),l.a.createElement("div",{className:"audit-footer"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onCancel},l.a.createElement("i",{className:"fa fa-close"})," Cancel"),l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onComplete},l.a.createElement("i",{className:"fa fa-check"})," Done"))))}}]),a}(l.a.Component);t.default=c},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(7),u=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e))._onLocationChange=function(){r.customerEdits[r.state.positionRequestedLocationID].latitude=null!=c.location.lat?c.location.lat+"":"",r.customerEdits[r.state.positionRequestedLocationID].longitude=null!=c.location.lng?c.location.lng+"":"",r.saveCustomerLocations(r.state.positionRequestedLocationID),r.setState({positionRequestedLocationID:null})},r.setCurrentPositionLatLng=function(){},r.requestCurrentPositionLatLng=function(e){var t=e.currentTarget.dataset.id;r.setState({positionRequestedLocationID:t}),c.refreshGeolocation()},r.handleTextChange=function(e){var t=e.target;r.customerEdits[t.dataset.id][t.dataset.field]=t.value,r.saveCustomerLocations(t.dataset.id)},r.saveCustomerLocations=function(e){r.props.onSave(r.customerEdits,e)},r.createCustomerLocationsPanels=function(){var e=[],t=0;for(var a in r.props.customerEdits)if(null!=r.props.customerEdits[a]){t++;var s=null!=r.props.customerEdits[a].description&&""!=r.props.customerEdits[a].description?r.props.customerEdits[a].description:"Location "+t,n=[],i=void 0;for(i=0;i<r.props.customerFields.length;i++)null!=r.props.customerFields[i]&&n.push(r.createCustomerLocationField(a,r.props.customerFields[i]));var o=null!=r.props.focusItemID&&r.props.focusItemID==a||null==r.props.focusItemID&&1==t;e.push(l.a.createElement("div",{key:a,className:"panel panel-default cat-panel",style:1==t?{marginTop:0}:{}},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"location-edit-title-"+a},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{className:o?"":"collapsed",role:"button","data-toggle":"collapse","data-parent":"#cust-address-accordion",href:"#location-edit-content-"+a},l.a.createElement("span",null,s),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse"+(o?" in":""),role:"tabpanel",id:"location-edit-content-"+a},l.a.createElement("div",{className:"panel-body"},l.a.createElement("div",{className:"form-horizontal panel-form"},n)))))}return e},r.createCustomerLocationField=function(e,t){return l.a.createElement("div",{key:t.name,className:"form-group"},l.a.createElement("label",{htmlFor:"loc-edit-"+e+"-"+t.name,className:"col-xs-4 control-label"},l.a.createElement("small",{className:"text-muted"},t.label)),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("input",{type:"text",className:"form-control",id:"loc-edit-"+e+"-"+t.name,"data-id":e,"data-field":t.name,value:r.props.customerEdits[e][t.name],disabled:("latitude"==t.name||"longitude"==t.name)&&r.state.positionRequestedLocationID==e,onChange:r.handleTextChange,autoComplete:"off"})),"longitude"==t.name?l.a.createElement("div",{className:"col-xs-8 col-xs-offset-4",style:{marginTop:"15px"}},l.a.createElement("button",{className:"btn btn-primary","data-id":e,onClick:r.requestCurrentPositionLatLng,disabled:r.state.positionRequestedLocationID==e},l.a.createElement("i",{className:"fa fa-map-marker"})," ",l.a.createElement("span",{style:{fontSize:"10px"}},"Use Current Location"))):null)},r.customerEdits=e.customerEdits,r.state={positionRequestedLocationID:null},r}return Object(r.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.customerEdits=e.customerEdits}},{key:"componentDidMount",value:function(){c.addChangeListener(this._onLocationChange)}},{key:"componentWillUnmount",value:function(){c.removeChangeListener(this._onLocationChange)}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("div",{className:"panel panel-default mor-list"},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"customer-locations-edit-title"},l.a.createElement("h4",{className:"panel-title"},"Locations")),l.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"customer-locations-edit-content"},l.a.createElement("div",{className:"panel-body address-container"},l.a.createElement("div",{className:"panel-group",id:"cust-address-accordion",style:{marginBottom:0},role:"tablist"},this.createCustomerLocationsPanels())))),l.a.createElement("div",{className:"audit-footer"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onCancel},l.a.createElement("i",{className:"fa fa-close"})," Cancel"),l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onComplete},l.a.createElement("i",{className:"fa fa-check"})," Done"))))}}]),a}(l.a.Component);t.default=u},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).handleTextChange=function(e){var t=e.target;r.customerEdits[t.dataset.id][t.dataset.field]=t.value,r.saveCustomerContacts(t.dataset.id)},r.saveCustomerContacts=function(e){r.props.onSave(r.customerEdits,e)},r.createCustomerContactsPanels=function(){var e=[],t=0;for(var a in r.props.customerEdits)if(null!=r.props.customerEdits[a]){t++;var s=[];null!=r.props.customerEdits[a].first_name&&""!=r.props.customerEdits[a].first_name&&s.push(r.props.customerEdits[a].first_name),null!=r.props.customerEdits[a].last_name&&""!=r.props.customerEdits[a].last_name&&s.push(r.props.customerEdits[a].last_name);var n=s.join(" ");n=""==n?"Contact "+t:n;var i=[],o=void 0;for(o=0;o<r.props.customerFields.length;o++)null!=r.props.customerFields[o]&&i.push(r.createCustomerContactField(a,r.props.customerFields[o]));var c=null!=r.props.focusItemID&&r.props.focusItemID==a||null==r.props.focusItemID&&1==t;e.push(l.a.createElement("div",{key:a,className:"panel panel-default cat-panel",style:1==t?{marginTop:0}:{}},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"contact-edit-title-"+a},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{className:c?"":"collapsed",role:"button","data-toggle":"collapse","data-parent":"#cust-contact-accordion",href:"#contact-edit-content-"+a},l.a.createElement("span",null,n),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse"+(c?" in":""),role:"tabpanel",id:"contact-edit-content-"+a},l.a.createElement("div",{className:"panel-body"},l.a.createElement("div",{className:"form-horizontal panel-form"},i)))))}return e},r.createCustomerContactField=function(e,t){return l.a.createElement("div",{key:t.name,className:"form-group"},l.a.createElement("label",{htmlFor:"con-edit-"+e+"-"+t.name,className:"col-xs-4 control-label"},l.a.createElement("small",{className:"text-muted"},t.label)),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("input",{type:"text",className:"form-control",id:"con-edit-"+e+"-"+t.name,"data-id":e,"data-field":t.name,value:r.props.customerEdits[e][t.name],onChange:r.handleTextChange,autoComplete:"off"})))},r.customerEdits=e.customerEdits,r}return Object(r.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.customerEdits=e.customerEdits}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("div",{className:"panel panel-default mor-list"},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"customer-contacts-edit-title"},l.a.createElement("h4",{className:"panel-title"},"Contacts")),l.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"customer-contacts-edit-content"},l.a.createElement("div",{className:"panel-body contact-container"},l.a.createElement("div",{className:"panel-group",id:"cust-contact-accordion",style:{marginBottom:0},role:"tablist"},this.createCustomerContactsPanels())))),l.a.createElement("div",{className:"audit-footer"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onCancel},l.a.createElement("i",{className:"fa fa-close"})," Cancel"),l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onComplete},l.a.createElement("i",{className:"fa fa-check"})," Done"))))}}]),a}(l.a.Component);t.default=c},function(e,t,a){"use strict";a.r(t),function(e){var t=a(0),s=a.n(t),r=a(39),n=a(10),i=s.a.createClass({displayName:"AuditList",getDefaultProps:function(){return{isLoading:!1}},render:function(){return s.a.createElement("div",{className:"mor-list"},s.a.createElement(n.a,{isVisible:this.props.isLoading}),this.props.audits.length?s.a.createElement("table",{className:"table table-striped table-spaced"},s.a.createElement("tbody",null,this.props.audits.map((function(e){return s.a.createElement("tr",{key:e.id,className:this.props.answers[e.id]&&this.props.answers[e.id].completed?"success":null},s.a.createElement("td",null,s.a.createElement("span",null,e.name),s.a.createElement("br",null),e.meta_data.is_compulsory?s.a.createElement("span",{className:"text-primary small pull-left"},"Compulsory"):null),this.props.answers.completed?null:s.a.createElement("td",{className:"align-right"},s.a.createElement(r.a,{className:(this.props.answers[e.id]&&this.props.answers[e.id].completed?"btn btn-success":"btn btn-primary")+(this.props.isLoading?" disabled":""),role:"button",to:"/calls/"+this.props.customerId+"/audits/"+e.id},s.a.createElement("i",{className:"fa fa-pencil-square-o"})," Open")))}),this))):s.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"Please refresh to obtain audits for this customer"))}});e.exports=i}.call(this,a(36)(e))},function(e,t,a){"use strict";a.r(t),function(e){var t=a(2),s=a(3),r=a(5),n=a(4),i=a(0),o=a.n(i),l=a(39),c=a(10),u=(a(13),function(e){Object(r.a)(i,e);var a=Object(n.a)(i);function i(){var e;Object(t.a)(this,i);for(var s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];return(e=a.call.apply(a,[this].concat(r))).haveAnswers=function(){for(var t in e.props.answers)if("customer_id"!=t&&"entry"!=t&&"exit"!=t&&"completed"!=t&&"submitted"!=t&&null!=e.props.answers[t]&&e.props.answers[t].length){var a=void 0;for(a=0;a<e.props.answers[t].length;a++)if(null!=e.props.answers[t][a])return!0}return!1},e.getNewAnswerIndex=function(t){return e.props.answers[t]&&e.props.answers[t].length?e.props.answers[t].length:0},e.createAuditRow=function(t,a,s,r,n){return o.a.createElement("tr",{key:t.id+(null!=r?"-"+n:""),className:null!=r&&r.completed?"success":null},o.a.createElement("td",null,o.a.createElement("span",null,t.name),o.a.createElement("br",null),t.meta_data.is_compulsory?o.a.createElement("span",{className:"text-primary small pull-left"},"Compulsory"):null),o.a.createElement("td",{className:"align-right"},o.a.createElement(l.a,{className:(null!=r&&r.completed?"btn btn-success":"btn btn-primary")+(e.props.isLoading?" disabled":""),role:"button",to:"/calls/"+e.props.customerId+"/adminaudits/"+t.id+"/"+(null!=r?n:e.getNewAnswerIndex(t.id))},o.a.createElement("i",{className:"fa fa-pencil-square-o"})," Open")))},e.createAuditsInProgressTable=function(){var t,a=[];for(t=0;t<e.props.audits.length;t++){var s=e.props.audits[t];if(e.props.answers[s.id]&&e.props.answers[s.id].length){var r=void 0;for(r=0;r<e.props.answers[s.id].length;r++)null!=e.props.answers[s.id][r]&&a.push(e.createAuditRow(s,null,null,e.props.answers[s.id][r],r))}}return o.a.createElement("div",{key:"admin-audits-inprogress",className:"panel panel-default table-responsive mor-list"},o.a.createElement("div",{className:"panel-heading"},o.a.createElement("h4",{className:"panel-title"},"Audits In Progress")),o.a.createElement("table",{className:"table table-striped"},o.a.createElement("tbody",null,a)))},e.createAuditsTable=function(){return o.a.createElement("div",{key:"admin-audits-available",className:"panel panel-default table-responsive mor-list"},o.a.createElement("div",{className:"panel-heading"},o.a.createElement("h4",{className:"panel-title"},"Audits Available")),o.a.createElement("table",{className:"table table-striped"},o.a.createElement("tbody",null,e.props.audits.map(e.createAuditRow))))},e}return Object(s.a)(i,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(c.a,{isVisible:this.props.isLoading}),this.props.audits.length?[this.haveAnswers()?this.createAuditsInProgressTable():null,this.createAuditsTable()]:o.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty mor-list"},"Please refresh to obtain admin audits for this customer"))}}]),i}(o.a.Component));u.defaultProps={isLoading:!1},e.exports=u}.call(this,a(36)(e))},function(e,t,a){"use strict";e.exports={DO_NOTHING:0,HIDE_REMAINING:1,SHOW_DEPENDENT:2,SHOW_DEPENDENT_HIDE_REMAINING_GROUP:3,SHOW_DEPENDENT_HIDE_REMAINING:4}},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(264),i=(a(76),r.a.createClass({displayName:"QuestionGroup",render:function(){return r.a.createElement("div",{className:"panel panel-default"},r.a.createElement("div",{className:"panel-heading"},r.a.createElement("h3",{className:"panel-title"},this.props.group.name)),r.a.createElement("ul",{className:"list-group"},this.props.group.questions.map((function(e){return this.props.auditAnswer[e.id]&&this.props.auditAnswer[e.id].visible?r.a.createElement(n,{key:e.id,question:e,answer:this.props.auditAnswer[e.id]?this.props.auditAnswer[e.id]:{},onChange:this.props.onChange}):null}),this)))}}));t.default=i},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(1),i=a.n(n);window.$=i.a;var o=a(76),l=a(265),c=a(144),u=a(146),d=a(56),m=a(13),h=a(7),p=r.a.createClass({displayName:"Question",getInitialState:function(){return{isSignatureModalVisible:!1}},handleQuestionChange:function(e){this.props.onChange(m.assign({question_id:this.props.question.id,type:this.props.question.type,score:this.props.question.weighting&&this.props.question.is_compulsory&&e.correct?this.props.question.weighting:0,location:h.location.string,timestamp:h.getUnixTime()},e))},handleYesNoClick:function(e){var t=i()(e.target).closest(".btn").attr("data-yes-no");this.handleQuestionChange({yes_no:t,correct:t==l.YES&&(1==this.props.question.correct_answer||"YES"==this.props.question.correct_answer.toUpperCase())||t==l.NO&&(0==this.props.question.correct_answer||"NO"==this.props.question.correct_answer.toUpperCase()),answered:!0})},handleProductAvailabilityClick:function(e){var t=i()(e.target).closest(".btn").attr("data-product-availability"),a=t==l.AVAILABLE,s=t==l.NOT_AVAILABLE,r=null!=this.props.answer.product_price&&""!==this.props.answer.product_price,n=null!=this.props.answer.product_facings&&""!==this.props.answer.product_facings;this.handleQuestionChange({product_availability:t,correct:!!s||(this.props.question.type==o.PRODUCT_FACING?a&&r&&n:a&&r),answered:!!s||(this.props.question.type==o.PRODUCT_FACING?r&&n:r)})},handleProductPriceChange:function(e){var t=h.formatCurrency(e.target.value,"blur"!=e.type,!0),a=t.displayValue,s=t.value,r=""!==s,n=null!=this.props.answer.product_facings&&""!==this.props.answer.product_facings,i=null!=this.props.answer.product_availability&&""!==this.props.answer.product_availability,c=null!=this.props.answer.product_availability&&this.props.answer.product_availability==l.AVAILABLE,u=null!=this.props.answer.product_availability&&this.props.answer.product_availability==l.NOT_AVAILABLE;this.handleQuestionChange({product_price_display:a,product_price:s,correct:!!u||(this.props.question.type==o.PRODUCT_FACING?c&&r&&n:c&&r),answered:!!u||(this.props.question.type==o.PRODUCT_FACING?i&&r&&n:i&&r)})},handleProductFacingsChange:function(e){var t=""!==e.target.value?parseInt(e.target.value):"",a=""!==t,s=null!=this.props.answer.product_price&&""!==this.props.answer.product_price,r=null!=this.props.answer.product_availability&&""!==this.props.answer.product_availability,n=null!=this.props.answer.product_availability&&this.props.answer.product_availability==l.AVAILABLE,i=null!=this.props.answer.product_availability&&this.props.answer.product_availability==l.NOT_AVAILABLE;this.handleQuestionChange({product_facings:t,correct:!!i||(this.props.question.type==o.PRODUCT_FACING?n&&s&&a:n&&s),answered:!!i||(this.props.question.type==o.PRODUCT_FACING?r&&s&&a:r&&s)})},handleFreeTextChange:function(e){var t=e.target.value;this.handleQuestionChange({free_text:t,correct:""!==t,answered:""!==t})},handleBarcodeChange:function(e){var t=e.target.value;this.handleQuestionChange({barcode:t,correct:""!==t,answered:""!==t})},handleNumericChange:function(e){var t=""!==e.target.value?parseFloat(e.target.value):"";this.handleQuestionChange({numeric:t,correct:""!==t,answered:""!==t})},handleCurrencyChange:function(e){var t=h.formatCurrency(e.target.value,"blur"!=e.type,!0),a=t.displayValue,s=t.value;this.handleQuestionChange({currency_display:a,currency:s,correct:""!==s,answered:""!==s})},handleSelectionChange:function(e){var t,a=!1,s=!1;if(this.props.question.type==o.MULTI_SELECT){t=[];for(var r=e.target.options,n=0,i=r.length;n<i;n++)if(r[n].selected&&(t.push(r[n].value),s=!0,""!=this.props.question.correct_answer&&!a))for(var l=0,c=this.props.question.correct_answer_array.length;l<c;l++)if(this.props.question.correct_answer_array[l]==r[n].text){a=!0;break}}else if(s=""!==(t=e.target.value),""!=this.props.question.correct_answer)for(var u=m.result(m.find(e.target.options,{value:t}),"text"),d=0,h=this.props.question.correct_answer_array.length;d<h;d++)if(this.props.question.correct_answer_array[d]==u){a=!0;break}this.handleQuestionChange({options_selected:t,correct:a,answered:s})},handleDateChange:function(e){this.handleQuestionChange({date:null!=e?e.format("YYYY-MM-DD"):"",correct:null!=e,answered:null!=e})},handleFileChange:function(e){if(e.target.files.length){var t=e.target.files[0],a=this;i.a.canvasResize(t,{width:500,height:500,crop:!1,quality:70,callback:function(e,t,s){var r="";e&&(r=e.split(",")[1].replace(/\+/g,"%2B")),a.handleQuestionChange({image:r,correct:""!==r,answered:""!==r})}})}else this.handleQuestionChange({image:"",correct:!1,answered:!1})},handleFileRemove:function(){this.handleQuestionChange({image:"",correct:!1,answered:!1})},handleSignatureChange:function(e){var t=Boolean(null!=e.id&&null!=e.name&&e.name.length&&null!=e.file&&e.file.length);this.handleQuestionChange({signature_id:e.id,signature_name:e.name,signature_comments:e.comments,signature_file:e.file,correct:t,answered:t})},handleSignatureOpen:function(){this.setState({isSignatureModalVisible:!0})},handleSignatureClose:function(){this.setState({isSignatureModalVisible:!1})},signatureIsComplete:function(){return null!=this.props.answer.signature_id&&null!=this.props.answer.signature_name&&this.props.answer.signature_name.length&&null!=this.props.answer.signature_file&&this.props.answer.signature_file.length},renderInputs:function(){var e,t="options"+this.props.question.id,a="option"+this.props.question.id;switch(this.props.question.type){case o.PRODUCT:case o.PRODUCT_FACING:var s=h.getCompanyCurrency().symbol,n="";this.props.question.type==o.PRODUCT_FACING&&(n=r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"number",min:"0",step:"1",className:"form-control",placeholder:"Facings",value:this.props.answer.product_facings,onChange:this.handleProductFacingsChange,disabled:this.props.answer.product_availability==l.NOT_AVAILABLE,autoComplete:"off"}))),e=r.a.createElement("div",{className:"question-inputs"},r.a.createElement("div",{className:"btn-group","data-toggle":"buttons"},r.a.createElement("label",{className:this.props.answer.product_availability==l.AVAILABLE?"btn btn-primary active":"btn btn-default","data-product-availability":l.AVAILABLE,onClick:this.handleProductAvailabilityClick},r.a.createElement("input",{type:"radio",name:t,id:a+l.AVAILABLE,autoComplete:"off"})," Available"),r.a.createElement("label",{className:this.props.answer.product_availability==l.OUT_OF_STOCK?"btn btn-primary active":"btn btn-default","data-product-availability":l.OUT_OF_STOCK,onClick:this.handleProductAvailabilityClick},r.a.createElement("input",{type:"radio",name:t,id:a+l.OUT_OF_STOCK,autoComplete:"off"})," Out Of Stock"),r.a.createElement("label",{className:this.props.answer.product_availability==l.NOT_AVAILABLE?"btn btn-primary active":"btn btn-default","data-product-availability":l.NOT_AVAILABLE,onClick:this.handleProductAvailabilityClick},r.a.createElement("input",{type:"radio",name:t,id:a+l.NOT_AVAILABLE,autoComplete:"off"})," Not Available")),r.a.createElement("div",{className:"row",style:{marginTop:"5px"}},r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("div",{className:"input-group"},r.a.createElement("span",{className:"input-group-addon"},s),r.a.createElement("input",{type:"text",className:"form-control",placeholder:"Price",value:this.props.answer.product_price_display,onChange:this.handleProductPriceChange,onBlur:this.handleProductPriceChange,disabled:this.props.answer.product_availability==l.NOT_AVAILABLE,autoComplete:"off"}))),n));break;case o.YES_NO:e=r.a.createElement("div",{className:"question-inputs"},r.a.createElement("div",{className:"btn-group","data-toggle":"buttons"},r.a.createElement("label",{className:this.props.answer.yes_no==l.YES?"btn btn-primary active":"btn btn-default","data-yes-no":l.YES,onClick:this.handleYesNoClick},r.a.createElement("input",{type:"radio",name:t,id:a+l.YES,autoComplete:"off"})," Yes"),r.a.createElement("label",{className:this.props.answer.yes_no==l.NO?"btn btn-primary active":"btn btn-default","data-yes-no":l.NO,onClick:this.handleYesNoClick},r.a.createElement("input",{type:"radio",name:t,id:a+l.NO,autoComplete:"off"})," No")));break;case o.FREE_TEXT:e=r.a.createElement("div",{className:"question-inputs"},r.a.createElement("input",{type:"text",className:"form-control",value:this.props.answer.free_text,onChange:this.handleFreeTextChange,autoComplete:"off"}));break;case o.BARCODE:e=r.a.createElement("div",{className:"question-inputs"},r.a.createElement("input",{type:"text",className:"form-control",value:this.props.answer.barcode,onChange:this.handleBarcodeChange,autoComplete:"off"}));break;case o.MULTIPLE_CHOICE:case o.MULTI_SELECT:e=r.a.createElement("div",{className:"question-inputs"},r.a.createElement("select",{multiple:this.props.question.type==o.MULTI_SELECT,className:"form-control",value:this.props.answer.options_selected,onChange:this.handleSelectionChange,autoComplete:"off"},this.props.question.type==o.MULTIPLE_CHOICE?r.a.createElement("option",{key:"noselection",value:""},"(Please select)"):"",this.props.question.multiple_choice_options.map((function(e){return r.a.createElement("option",{key:e.id,value:e.id},e.title)}))));break;case o.PHOTO:e=r.a.createElement("div",{className:"question-inputs"},null!=this.props.answer.image&&""!==this.props.answer.image?r.a.createElement("div",null,r.a.createElement("span",{className:"text-primary"},"File added"),r.a.createElement("button",{className:"btn btn-default",onClick:this.handleFileRemove,style:{marginLeft:"5px"}},"Remove")):r.a.createElement("input",{type:"file",accept:"image/*",capture:"camera",onChange:this.handleFileChange}));break;case o.NUMERIC:e=r.a.createElement("div",{className:"row question-inputs"},r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("input",{type:"number",min:"0",step:"1",className:"form-control",value:this.props.answer.numeric,onChange:this.handleNumericChange,autoComplete:"off"})));break;case o.CURRENCY:s=h.getCompanyCurrency().symbol;e=r.a.createElement("div",{className:"row question-inputs"},r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("div",{className:"input-group"},r.a.createElement("span",{className:"input-group-addon"},s),r.a.createElement("input",{type:"text",className:"form-control",value:this.props.answer.currency_display,onChange:this.handleCurrencyChange,onBlur:this.handleCurrencyChange,autoComplete:"off"}))));break;case o.DATE:e=r.a.createElement("div",{className:"row question-inputs"},r.a.createElement("div",{className:"col-xs-6"},r.a.createElement(u,{selected:this.props.answer.date?d(this.props.answer.date,"YYYY-MM-DD"):null,onChange:this.handleDateChange,placeholderText:"Select date",className:"form-control"})));break;case o.SIGNATURE:var i=this.signatureIsComplete();e=r.a.createElement("div",{className:"row question-inputs"},this.state.isSignatureModalVisible?r.a.createElement(c,{title:this.props.question.signature_name.substr(0,1).toUpperCase()+this.props.question.signature_name.substr(1)+" Signature",signature:{id:this.props.question.signature_id,name:this.props.answer.signature_name,comments:this.props.answer.signature_comments,file:this.props.answer.signature_file},onSave:this.handleSignatureChange,onClose:this.handleSignatureClose}):null,r.a.createElement("div",{className:"col-xs-6"},r.a.createElement("button",{className:"btn btn-"+(i?"success":"default"),onClick:this.handleSignatureOpen},r.a.createElement("i",{className:"fa fa-"+(i?"check":"pencil")})," ",this.props.question.signature_name)))}return e},render:function(){return r.a.createElement("li",{className:"list-group-item"},r.a.createElement("div",null,this.props.question.title," ",this.props.question.is_compulsory?r.a.createElement("span",{className:"text-primary"},"*"):""),this.renderInputs())}});t.default=p},function(e,t,a){"use strict";e.exports={AVAILABLE:"1",OUT_OF_STOCK:"2",NOT_AVAILABLE:"3",YES:"Yes",NO:"No"}},function(e,t,a){"use strict";function s(e,t,a,s){this.startPoint=e,this.control1=t,this.control2=a,this.endPoint=s}Object.defineProperty(t,"__esModule",{value:!0}),s.prototype.length=function(){for(var e=0,t=void 0,a=void 0,s=0;s<=10;s+=1){var r=s/10,n=this.point(r,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),i=this.point(r,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(s>0){var o=n-t,l=i-a;e+=Math.sqrt(o*o+l*l)}t=n,a=i}return e},s.prototype.point=function(e,t,a,s,r){return t*(1-e)*(1-e)*(1-e)+3*a*(1-e)*(1-e)*e+3*s*(1-e)*e*e+r*e*e*e},t.default=s},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throttle=function(e,t,a){for(var s=arguments.length,r=Array(s>3?s-3:0),n=3;n<s;n++)r[n-3]=arguments[n];var i=void 0,o=void 0,l=void 0,c=null,u=0,d=a||{},m=function(){u=!1===d.leading?0:Date.now(),c=null,l=e.apply(i,o),c||(i=o=null)};return function(){var a=Date.now();u||!1!==d.leading||(u=a);var s=t-(a-u);return i=this,o=r,s<=0||s>t?(c&&(clearTimeout(c),c=null),u=a,l=e.apply(i,o),c||(i=o=null)):c||!1===d.trailing||(c=setTimeout(m,s)),l}},t.trim=function(e){for(var t=e.getContext("2d"),a=document.createElement("canvas").getContext("2d"),s=t.getImageData(0,0,e.width,e.height),r=s.data.length,n={top:null,left:null,right:null,bottom:null},i=0;i<r;i+=4)if(0!==s.data[i+3]){var o=i/4%e.width,l=Math.floor(i/4/e.width);null===n.top&&(n.top=l),(null===n.left||o<n.left)&&(n.left=o),(null===n.right||n.right<o)&&(n.right=o),(null===n.bottom||n.bottom<l)&&(n.bottom=l)}var c=n.bottom-n.top,u=n.right-n.left,d=t.getImageData(n.left,n.top,u,c);return a.canvas.width=u,a.canvas.height=c,a.putImageData(d,0,0),a.canvas},t.canvasHasData=function(e){for(var t=e.getContext("2d").getImageData(0,0,e.width,e.height),a=t.data.length,s=!1,r=0;r<a;r+=4)if(0!==t.data[r+3]){s=!0;break}return s},t.calculateCurveControlPoints=function(e,t,a){var s=e.x-t.x,r=e.y-t.y,i=t.x-a.x,o=t.y-a.y,l={x:(e.x+t.x)/2,y:(e.y+t.y)/2},c={x:(t.x+a.x)/2,y:(t.y+a.y)/2},u=Math.sqrt(s*s+r*r),d=Math.sqrt(i*i+o*o),m=d/(u+d),h={x:c.x+(l.x-c.x)*m,y:c.y+(l.y-c.y)*m},p=t.x-h.x,g=t.y-h.y;return{c1:new n.default(l.x+p,l.y+g),c2:new n.default(c.x+p,c.y+g)}};var s,r=a(145),n=(s=r)&&s.__esModule?s:{default:s}},,function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(144),u=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).getFreshSignatureObject=function(e){return{id:e,name:"",comments:"",file:""}},r.editSignature=function(e){var t=e.currentTarget.dataset;r.signatureEditIndex=parseInt(t.idx),r.setState({isSignatureModalVisible:!0,signatureModalTitle:t.name.substr(0,1).toUpperCase()+t.name.substr(1)+" Signature",signatureEditing:null!=r.savedSignatures[r.signatureEditIndex]?r.savedSignatures[r.signatureEditIndex]:r.getFreshSignatureObject(t.id)})},r.saveSignature=function(e){r.savedSignatures[r.signatureEditIndex]=e,r.props.onChange(r.savedSignatures)},r.closeSignatureModal=function(){r.signatureEditIndex=null,r.setState({isSignatureModalVisible:!1,signatureModalTitle:null,signatureEditing:null})},r.signatureIsComplete=function(e){return null!=r.savedSignatures&&null!=r.savedSignatures[e]&&null!=r.savedSignatures[e].name&&r.savedSignatures[e].name.length&&null!=r.savedSignatures[e].file&&r.savedSignatures[e].file.length},r.savedSignatures=e.savedSignatures,r.signatureEditIndex=null,r.state={isSignatureModalVisible:!1,signatureModalTitle:null},r}return Object(r.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.savedSignatures=e.savedSignatures}},{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"panel panel-default"},this.state.isSignatureModalVisible?l.a.createElement(c,{title:this.state.signatureModalTitle,signature:this.state.signatureEditing,onSave:this.saveSignature,onClose:this.closeSignatureModal}):null,l.a.createElement("div",{className:"panel-heading"},l.a.createElement("h3",{className:"panel-title"},"Signatures")),l.a.createElement("ul",{className:"list-group"},this.props.signatures.map((function(t,a){var s=e.signatureIsComplete(parseInt(a));return l.a.createElement("li",{className:"list-group-item",key:a},l.a.createElement("button",{className:"btn btn-"+(s?"success":"default"),"data-idx":a,"data-id":t.id,"data-name":t.name,onClick:e.editSignature},l.a.createElement("i",{className:"fa fa-"+(s?"check":"pencil")})," ",t.name))}))))}}]),a}(l.a.Component);t.default=u},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(77),i=a(7),o=r.a.createClass({displayName:"FileList",getDefaultProps:function(){return{isLoading:!1}},render:function(){return r.a.createElement("div",null,this.props.files.length?r.a.createElement("table",{className:"table table-striped",style:{marginBottom:0}},r.a.createElement("tbody",null,this.props.files.map((function(e){var t=n.getFile(e);return r.a.createElement("tr",{key:this.props.categoryID+"-"+e},r.a.createElement("td",null,t.name),r.a.createElement("td",{className:"align-right"},r.a.createElement("a",{href:i.apiUrl+"file/download?file_id="+t.id+"&"+i.getURLAuthString(),className:this.props.isLoading?"btn btn-primary disabled":"btn btn-primary",role:"button"},r.a.createElement("i",{className:"fa fa-download"})," Download")))}),this))):r.a.createElement("div",{className:this.props.isLoading?"hidden":"text-muted"},"No files to display"))}});t.default=o},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(10),i=a(153),o=a.n(i),l=r.a.createClass({displayName:"CommentForm",getDefaultProps:function(){return{isLoading:!1,isVisible:!1,isValid:!1}},render:function(){return r.a.createElement(o.a,{component:"div",transitionName:"comment-form",transitionEnterTimeout:150,transitionLeaveTimeout:100},this.props.isVisible?r.a.createElement("form",null,r.a.createElement("div",{className:"comment-input"},r.a.createElement("textarea",{className:"form-control",name:"new-comment",rows:"3",placeholder:"Comment",value:this.props.comment,onChange:this.props.onChange,autoComplete:"off",disabled:this.props.isLoading})),r.a.createElement("div",{className:"comment-footer"},r.a.createElement("div",{className:"btn-group",role:"group"},r.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.props.onSave,disabled:this.props.isLoading||!this.props.isValid},"Add"),r.a.createElement("button",{className:"btn btn-default",onClick:this.props.onCancel,disabled:this.props.isLoading},"Cancel"))),r.a.createElement(n.a,{isVisible:this.props.isLoading})):null)}});t.default=l},,,,,,,,,,,function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(10),i=a(56),o=r.a.createClass({displayName:"CommentList",getDefaultProps:function(){return{isLoading:!1}},render:function(){return r.a.createElement("div",{className:"mor-list"},r.a.createElement(n.a,{isVisible:this.props.isLoading}),this.props.comments.length?r.a.createElement("table",{className:"table table-striped table-spaced"},r.a.createElement("tbody",null,this.props.comments.map((function(e){return r.a.createElement("tr",{key:e.id},r.a.createElement("td",null,r.a.createElement("span",{className:"text-muted small pull-left"},r.a.createElement("strong",{className:"text-primary"},e.user)," on "+i.unix(e.date).format("ddd D MMM YYYY [at] HH:mm:ss")),r.a.createElement("br",null),r.a.createElement("span",{style:{whiteSpace:"pre-line"}},e.comment)))}),this))):r.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"No comments to display"))}});t.default=o},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(39),u=a(10),d=a(104),m=(a(13),a(7)),h=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).countItems=function(e){var t,a=0;if(e.length)for(t=0;t<e.length;t++)null!=e[t]&&a++;return a},r.createOrderRow=function(e){var t=r.countItems(e.items);return l.a.createElement("tr",{key:e.id,className:e.status==d.PLACED?"success":null},l.a.createElement("td",null,l.a.createElement("span",null,null!=e.customer_id?e.customer_name:"No customer added"),l.a.createElement("br",null),l.a.createElement("span",{className:"text-primary small pull-left"},"Total ",l.a.createElement("strong",null,(null!=e.currency_display_symbol?e.currency_display_symbol:r.defaultCurrencySymbol)+e.total_display)),l.a.createElement("span",{className:"text-primary small pull-left",style:{marginLeft:"5px"}},"("+t+" item"+(1==t?"":"s")+")")),l.a.createElement("td",{className:"align-right"},l.a.createElement(c.a,{className:e.status==d.PLACED?"btn btn-success disabled":r.props.isLoading?"btn btn-primary disabled":"btn btn-primary",role:"button",to:"/sales/orders/"+e.id},l.a.createElement("i",{className:e.status==d.PLACED?"fa fa-check":"fa fa-shopping-cart"})," ",e.status==d.PLACED?"Placed":"Open")))},r.defaultCurrencySymbol=m.getCompanyCurrency().symbol,r}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"mor-list"},l.a.createElement(u.a,{isVisible:this.props.isLoading}),this.props.orders.length?l.a.createElement("table",{className:"table table-striped table-spaced",style:{marginTop:0}},l.a.createElement("tbody",null,this.props.orders.map(this.createOrderRow))):l.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"No orders in progress"))}}]),a}(l.a.Component);h.defaultProps={isLoading:!1},t.default=h},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(79),u=(a(13),a(7)),d=a(22),m=a(21),h=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).handleNumericChange=function(e){var t=e.target,a=e.type,s=u.formatDecimal(t.value,"blur"!=a),n=null!=r.order.items[t.dataset.idx].quantity_min?r.order.items[t.dataset.idx].quantity_min:1,i=null!=r.order.items[t.dataset.idx].quantity_max?r.order.items[t.dataset.idx].quantity_max:0,o=null!=r.order.items[t.dataset.idx].quantity_mom?r.order.items[t.dataset.idx].quantity_mom:0;if(s.value<n&&(s.value=n,"blur"==a&&(s.displayValue=n)),r.order.items[t.dataset.idx].quantity=s.value,r.order.items[t.dataset.idx].quantity_display=s.displayValue,"blur"==a){var l=u.restrictNumber(r.order.items[t.dataset.idx].quantity,r.order.items[t.dataset.idx].quantity_display,n,i,o);r.order.items[t.dataset.idx].quantity=l.value,r.order.items[t.dataset.idx].quantity_display=l.displayValue}r.saveOrder()},r.handleCurrencyChange=function(e){var t=e.target.dataset,a=u.formatCurrency(e.target.value,"blur"!=e.type);0==a.value&&"blur"==e.type&&(a.displayValue="0.00"),"item-price"==t.field?(r.order.items[t.idx].price_display=a.displayValue,r.order.items[t.idx].price=a.value,r.saveOrder()):(r.order[t.field+"_display"]=a.displayValue,r.order[t.field]=a.value,r.saveOrder())},r.removeOrderItem=function(){null!=r.orderItemRemoveIndex&&(r.order.items[r.orderItemRemoveIndex]=null,r.orderItemRemoveIndex=null,r.setState({isOrderItemRemoveConfirmationVisible:!1}),r.saveOrder())},r.saveOrder=function(){r.props.onSave(r.order)},r.haveItems=function(){var e;if(r.props.order.items.length)for(e=0;e<r.props.order.items.length;e++)if(null!=r.props.order.items[e])return!0;return!1},r.showOrderItemRemoveConfirmationPrompt=function(e){r.orderItemRemoveIndex=e.target.dataset.idx,r.setState({isOrderItemRemoveConfirmationVisible:!0})},r.hideOrderItemRemoveConfirmationPrompt=function(){r.orderItemRemoveIndex=null,r.setState({isOrderItemRemoveConfirmationVisible:!1})},r.createOrderItemRow=function(e,t,a){return null!=e?l.a.createElement("tr",{key:t},l.a.createElement("td",{colSpan:"3"},l.a.createElement("div",{className:"order-item"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-11 text-primary"},e.sku),l.a.createElement("div",{className:"col-xs-1"},l.a.createElement("button",{type:"button",className:"close","data-idx":t,onClick:r.showOrderItemRemoveConfirmationPrompt},"\xd7"))),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-12"},e.name)),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-4"},l.a.createElement("input",{type:"text",className:"form-control",value:e.quantity_display,"data-idx":t,onChange:r.handleNumericChange,onBlur:r.handleNumericChange,autoComplete:"off"})),l.a.createElement("div",{className:"col-xs-4"},l.a.createElement("div",{className:"input-group"},l.a.createElement("span",{className:"input-group-addon"},r.currencySymbol),r.props.editablePricing?l.a.createElement("input",{type:"text",className:"form-control",value:e.price_display,"data-field":"item-price","data-idx":t,onChange:r.handleCurrencyChange,onBlur:r.handleCurrencyChange,autoComplete:"off"}):l.a.createElement("input",{type:"text",className:"form-control",value:e.price_display,"data-field":"item-price","data-idx":t,disabled:!0,autoComplete:"off"}))),l.a.createElement("div",{className:"col-xs-4"},l.a.createElement("div",{className:"input-group"},l.a.createElement("span",{className:"input-group-addon"},r.currencySymbol),l.a.createElement("input",{type:"text",className:"form-control",value:e.total_display,disabled:!0,autoComplete:"off"}))))))):null},r.order=e.order,r.defaultCurrencySymbol=u.getCompanyCurrency().symbol,r.currencySymbol=null!=e.order.currency_display_symbol?e.order.currency_display_symbol:r.defaultCurrencySymbol,r.orderItemRemoveIndex=null,r.orderItemRemoveConfirmDescription="Are you sure you want to remove this item?",r.state={isOrderItemRemoveConfirmationVisible:!1},r}return Object(r.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.order=e.order}},{key:"render",value:function(){return this.currencySymbol=null!=this.props.order.currency_display_symbol?this.props.order.currency_display_symbol:this.defaultCurrencySymbol,l.a.createElement("div",null,this.state.isOrderItemRemoveConfirmationVisible?l.a.createElement(c,{description:this.orderItemRemoveConfirmDescription,onYes:this.removeOrderItem,onNo:this.hideOrderItemRemoveConfirmationPrompt}):null,l.a.createElement("div",{className:"panel panel-default mor-list cat-panel"},l.a.createElement("div",{className:"panel-heading"},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#order-details-content"},l.a.createElement("span",null,"Order Details"),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"order-details-content"},l.a.createElement("table",{className:"table table-striped"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",{className:"col-xs-4"},"Quantity"),l.a.createElement("th",{className:"col-xs-4"},"Price"),l.a.createElement("th",{className:"col-xs-4"},"Total"))),l.a.createElement("tbody",null,this.haveItems()?this.props.order.items.map(this.createOrderItemRow):l.a.createElement("tr",null,l.a.createElement("td",{colSpan:"3"},l.a.createElement("span",{className:"text-muted"},"No order items"))))))),l.a.createElement("div",{className:"panel panel-default mor-list cat-panel"},l.a.createElement("div",{className:"panel-heading"},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#order-totals-content"},l.a.createElement("span",null,"Order Totals"),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"order-totals-content"},l.a.createElement("ul",{className:"list-group form-horizontal"},l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-subtotal",className:"col-xs-4 control-label"},"Subtotal"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",{className:"input-group-addon"},this.currencySymbol),l.a.createElement("input",{type:"text",className:"form-control",id:"order-subtotal",value:this.props.order.subtotal_display,disabled:!0,autoComplete:"off"})))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-adjustment",className:"col-xs-4 control-label"},"Adjustment"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",{className:"input-group-addon"},this.currencySymbol),this.props.editablePricing?l.a.createElement("input",{type:"text",className:"form-control",id:"order-adjustment",value:this.props.order.adjustment_display,"data-field":"adjustment",onChange:this.handleCurrencyChange,onBlur:this.handleCurrencyChange,autoComplete:"off"}):l.a.createElement("input",{type:"text",className:"form-control",id:"order-adjustment",value:this.props.order.adjustment_display,"data-field":"adjustment",disabled:!0,autoComplete:"off"})))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-shipping",className:"col-xs-4 control-label"},"Shipping"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",{className:"input-group-addon"},this.currencySymbol),this.props.editablePricing?l.a.createElement("input",{type:"text",className:"form-control",id:"order-shipping",value:this.props.order.shipping_display,"data-field":"shipping",onChange:this.handleCurrencyChange,onBlur:this.handleCurrencyChange,autoComplete:"off"}):l.a.createElement("input",{type:"text",className:"form-control",id:"order-shipping",value:this.props.order.shipping_display,"data-field":"shipping",disabled:!0,autoComplete:"off"})))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-tax",className:"col-xs-4 control-label"},"Tax"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",{className:"input-group-addon"},this.currencySymbol),l.a.createElement("input",{type:"text",className:"form-control",id:"order-tax",value:this.props.order.tax_display,disabled:!0,autoComplete:"off"})))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-total",className:"col-xs-4 control-label"},"Total"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",{className:"input-group-addon",style:{fontWeight:"bold"}},this.currencySymbol),l.a.createElement("input",{type:"text",className:"form-control",id:"order-total",style:{fontWeight:"bold"},value:this.props.order.total_display,disabled:!0,autoComplete:"off"}))))))),l.a.createElement("div",{className:"audit-footer"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onCancel},l.a.createElement("i",{className:"fa fa-close"})," Cancel"),m.activeProfile!=d.PROFILE_B2B&&l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onPlace},l.a.createElement("i",{className:"fa fa-check"})," Place"),l.a.createElement("button",{className:"btn btn-primary col-xs-"+(m.get(d.UI_BUTTON_CHANGE_CUSTOMER)?"4":"6"),onClick:this.showProductSelectionList},l.a.createElement("i",{className:"fa fa-plus"})," Add Item"))))}}]),a}(l.a.Component);h.defaultProps={editablePricing:!0},t.default=h},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(146),u=a(56),d=(a(13),a(7)),m=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).handleDateChange=function(e){r.order.expected_date=null!=e?e.unix():null,r.saveOrder()},r.handleSelectionChange=function(e){r.order[e.target.dataset.field]=parseInt(e.target.value),r.saveOrder()},r.handleTextChange=function(e){r.order[e.target.dataset.field]=e.target.value,r.saveOrder()},r.saveOrder=function(){r.props.onSave(r.order)},r.order=e.order,r}return Object(r.a)(a,[{key:"componentWillReceiveProps",value:function(e){this.order=e.order}},{key:"render",value:function(){return l.a.createElement("div",{className:"panel panel-default mor-list cat-panel"},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"order-info-title"},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#order-info-content"},l.a.createElement("span",null,"Order Information"),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse in order-info-form",role:"tabpanel",id:"order-info-content"},l.a.createElement("div",{className:"panel-body row"},l.a.createElement("div",{className:"form-horizontal col-xs-6"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-expected-date",className:"col-xs-4 control-label"},"Expected Date"),l.a.createElement("div",{className:"col-xs-8 order-date"},l.a.createElement(c,{selected:this.props.order.expected_date?u.unix(this.props.order.expected_date):null,onChange:this.handleDateChange,placeholderText:"Select date",className:"form-control"}))),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-preferred-carrier",className:"col-xs-4 control-label"},"Preferred Carrier"),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("select",{className:"form-control",id:"order-preferred-carrier","data-field":"carrier_id",value:this.props.order.carrier_id,onChange:this.handleSelectionChange,autoComplete:"off"},this.props.carriers.map((function(e){return l.a.createElement("option",{key:e.id,value:e.id},e.name)}))))),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-po",className:"col-xs-4 control-label"},"PO #"),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("input",{type:"text",className:"form-control",id:"order-po","data-field":"po",value:this.props.order.po,onChange:this.handleTextChange,autoComplete:"off"}))),this.props.customerLocations.length?l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-billing-location",className:"col-xs-4 control-label"},"Billing Address"),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("select",{className:"form-control",id:"order-billing-location","data-field":"billing_location_id",value:this.props.order.billing_location_id,onChange:this.handleSelectionChange,autoComplete:"off"},l.a.createElement("option",{key:"no-selection",value:"0"}),this.props.customerLocations.map((function(e){return l.a.createElement("option",{key:e.id,value:e.id},null!=e.description&&""!=e.description?e.description:e.address_1)}))))):null),l.a.createElement("div",{className:"form-horizontal col-xs-6"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-currency",className:"col-xs-4 control-label"},"Currency"),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("input",{type:"text",className:"form-control",id:"order-currency",value:null!=this.props.order.currency_display_name?this.props.order.currency_display_name:d.getCompanyCurrency().name,disabled:!0,autoComplete:"off"}))),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-payment-term",className:"col-xs-4 control-label"},"Payment Term"),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("select",{className:"form-control",id:"order-payment-term","data-field":"payment_terms_id",value:this.props.order.payment_terms_id,onChange:this.handleSelectionChange,autoComplete:"off"},this.props.paymentTerms.map((function(e){return l.a.createElement("option",{key:e.id,value:e.id},e.name)}))))),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-tax-class",className:"col-xs-4 control-label"},"Tax Class"),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("select",{className:"form-control",id:"order-tax-class","data-field":"tax_class_id",value:this.props.order.tax_class_id,onChange:this.handleSelectionChange,autoComplete:"off"},this.props.taxClasses.map((function(e){return l.a.createElement("option",{key:e.id,value:e.id},e.name)}))))),this.props.customerLocations.length?l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-shipping-location",className:"col-xs-4 control-label"},"Shipping Address"),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("select",{className:"form-control",id:"order-shipping-location","data-field":"shipping_location_id",value:this.props.order.shipping_location_id,onChange:this.handleSelectionChange,autoComplete:"off"},l.a.createElement("option",{key:"no-selection",value:"0"}),this.props.customerLocations.map((function(e){return l.a.createElement("option",{key:e.id,value:e.id},null!=e.description&&""!=e.description?e.description:e.address_1)}))))):null),l.a.createElement("div",{className:"form-horizontal col-xs-12"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-comments",className:"col-xs-2 control-label"},"Comments"),l.a.createElement("div",{className:"col-xs-10"},l.a.createElement("textarea",{className:"form-control",id:"order-comments","data-field":"review",rows:"3",value:this.props.order.review,onChange:this.handleTextChange,autoComplete:"off"})))))))}}]),a}(l.a.Component);m.defaultProps={customerLocations:[]},t.default=m},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(10),u=a(83),d=a(31),m=a(58),h=a(84),p=a(68),g=a(13),f=a(7),E=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).handleSearchTermChange=function(e){var t=e.target.value;r.props.onSearch(t,1,r.props.searchFilters)},r.handleCustomerSearchFilterChange=function(e){var t=r.props.searchFilters||{};t.customerProducts=e.target.dataset.filter,r.props.onSearch(r.props.searchTerm,1,t)},r.handleSearchPageChange=function(e){e.preventDefault();var t="prev"==e.target.dataset.dir?r.props.searchPage>1?r.props.searchPage-1:1:null!=r.props.searchTotalPages&&r.props.searchPage<r.props.searchTotalPages?r.props.searchPage+1:r.props.searchPage;t!=r.props.searchPage&&r.props.onSearch(r.props.searchTerm,t,r.props.searchFilters)},r.toggleFeaturedSearchFilter=function(){var e=r.props.searchFilters||{};e.featured=!(null!=e.featured&&e.featured),r.props.onSearch(r.props.searchTerm,1,e)},r.toggleCategorySearchFilterDisplay=function(){r.setState((function(e){return{isCategorySearchFilterVisible:!e.isCategorySearchFilterVisible}}))},r.handleCategorySearchFilterSelection=function(e){var t=r.props.searchFilters||{};t.categories=t.categories||[],t.categories.push(e),t.categories=g.uniq(t.categories),r.props.onSearch(r.props.searchTerm,1,t)},r.handleCategorySearchFilterDeselection=function(e){var t=r.props.searchFilters||{};t.categories=t.categories||[],g.pull(t.categories,e),r.props.onSearch(r.props.searchTerm,1,t)},r.handleProductQuantityChange=function(e){var t=e.target,a=e.type,s={id:t.dataset.id,name:t.dataset.name,sku:t.dataset.sku,calc_price:t.dataset.calcprice,is_taxable:t.dataset.istaxable>0,tax_class_id:t.dataset.taxclassid,quantity_min:parseFloat(t.dataset.min),quantity_max:parseFloat(t.dataset.max),quantity_mom:parseInt(t.dataset.mom)};r.setState((function(e,r){if("button"==t.type){var n=null!=e.selectedProducts[s.id]&&e.selectedProducts[s.id].quantity>0?e.selectedProducts[s.id].quantity:0,i=s.quantity_mom?s.quantity_min:1;s.quantity=f.fixNumber("up"==t.dataset.dir?n+i:n-i),s.quantity_display=s.quantity}else{var o=f.formatDecimal(t.value,"blur"!=a);s.quantity=o.value,s.quantity_display=o.displayValue}if(s.quantity<0&&(s.quantity=0,s.quantity_display=0),"button"==t.type||"blur"==a){var l=f.restrictNumber(s.quantity,s.quantity_display,s.quantity_min,s.quantity_max,s.quantity_mom);s.quantity=l.value,s.quantity_display=l.displayValue}return s.quantity>0?e.selectedProducts[s.id]=s:null!=e.selectedProducts[s.id]&&(e.selectedProducts[s.id]=void 0),{selectedProducts:e.selectedProducts}}))},r.handleClose=function(){r.props.onFinish(r.state.selectedProducts)},r.createProductRow=function(e,t){var a=e.product,s=null!=a.variants&&a.variants.length>0?a.variants[0].id:a.id,n=null!=a.default_image&&a.default_image.length;return l.a.createElement("tr",{key:a.id},l.a.createElement("td",{className:"col-xs-7"},l.a.createElement("div",{className:"product-info"+(n?" product-with-image":"")},n?l.a.createElement("div",{className:"product-image"},l.a.createElement("a",{href:"#",onClick:r.openImagesModal,"data-idx":t},l.a.createElement(m.a,{src:f.sanitiseForSecureURL(a.default_image)}))):null,l.a.createElement("span",null,a.name),l.a.createElement("br",null),a.unique_code?l.a.createElement("span",{className:"text-muted small pull-left add-info"},a.unique_code):null,a.SKU?l.a.createElement("span",{className:"text-muted small pull-left add-info",style:a.unique_code?{marginLeft:"5px"}:null},a.SKU):null,l.a.createElement("span",{className:"text-muted small pull-left add-info",style:a.unique_code||a.SKU?{marginLeft:"5px"}:null},"SOH:"+(a.stock_on_hand?a.stock_on_hand:"0")),l.a.createElement("span",{className:"text-primary pull-left price-info",style:{marginLeft:"5px"}},r.props.currencySymbol+a.calc_price),null!=a.is_featured&&1==a.is_featured?l.a.createElement("span",{className:"text-primary small pull-left",style:{marginLeft:"5px"}},l.a.createElement("i",{className:"fa fa-star"})):null)),l.a.createElement("td",{className:"col-xs-5"},l.a.createElement("div",{className:"input-group"},l.a.createElement("span",{className:"input-group-btn"},l.a.createElement("button",{className:r.props.isLoading?"btn btn-default disabled":"btn btn-default",type:"button",onClick:r.handleProductQuantityChange,"data-dir":"down","data-id":s,"data-name":a.name,"data-sku":a.SKU,"data-calcprice":a.calc_price,"data-istaxable":a.is_taxable,"data-taxclassid":a.tax_class_id,"data-min":a.min_order_qty,"data-max":a.max_order_qty,"data-mom":a.multiples_of_min},"-")),l.a.createElement("input",{type:"text",className:"form-control input-space-efficient input-centred",autoComplete:"off",value:null!=r.state.selectedProducts[s]?r.state.selectedProducts[s].quantity_display:r.state.unselectedProductQuantity,onChange:r.handleProductQuantityChange,onBlur:r.handleProductQuantityChange,disabled:r.props.isLoading,"data-id":s,"data-name":a.name,"data-sku":a.SKU,"data-calcprice":a.calc_price,"data-istaxable":a.is_taxable,"data-taxclassid":a.tax_class_id,"data-min":a.min_order_qty,"data-max":a.max_order_qty,"data-mom":a.multiples_of_min}),l.a.createElement("span",{className:"input-group-btn"},l.a.createElement("button",{className:r.props.isLoading?"btn btn-default disabled":"btn btn-default",type:"button",onClick:r.handleProductQuantityChange,"data-dir":"up","data-id":s,"data-name":a.name,"data-sku":a.SKU,"data-calcprice":a.calc_price,"data-istaxable":a.is_taxable,"data-taxclassid":a.tax_class_id,"data-min":a.min_order_qty,"data-max":a.max_order_qty,"data-mom":a.multiples_of_min},"+")))))},r.openImagesModal=function(e){e.preventDefault();var t=e.currentTarget.dataset.idx,a=r.props.searchResults[t].product;r.setState({isImagesModalVisible:!0,imagesModalTitle:a.name,imagesModalImages:a.images})},r.closeImagesModal=function(){r.setState({isImagesModalVisible:!1,imagesModalTitle:null,imagesModalImages:[]})},r.state={selectedProducts:{},unselectedProductQuantity:0,isCategorySearchFilterVisible:!1,isImagesModalVisible:!1,imagesModalTitle:null,imagesModalImages:[]},r}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.props.onSearch(this.props.searchTerm,this.props.searchPage,this.props.searchFilters)}},{key:"render",value:function(){var e=null!=this.props.searchFilters&&null!=this.props.searchFilters.featured&&this.props.searchFilters.featured,t=null!=this.props.searchFilters&&this.props.searchFilters.customerProducts==p.RECENT,a=null!=this.props.searchFilters&&null!=this.props.searchFilters.categories&&this.props.searchFilters.categories.length;return l.a.createElement("div",{className:"modal fade in",style:{display:"block"},tabIndex:"-1",role:"dialog"},l.a.createElement("div",{className:"modal-dialog",style:{margin:0}},l.a.createElement("div",{className:"modal-content"},l.a.createElement("div",{className:"modal-header"},l.a.createElement("button",{type:"button",className:"close","data-dismiss":"modal",onClick:this.handleClose},"\xd7"),l.a.createElement("h4",{className:"modal-title"},"Select Products",null!=this.props.subTitle?l.a.createElement("br",null):null,null!=this.props.subTitle?l.a.createElement("small",null,this.props.subTitle):null)),l.a.createElement("div",{className:"modal-body"},this.state.isImagesModalVisible?l.a.createElement(h.a,{title:this.state.imagesModalTitle,images:this.state.imagesModalImages,onClose:this.closeImagesModal}):null,this.props.customerSearchFiltersActive?l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-5"},l.a.createElement("input",{type:"text",className:"form-control",id:"product-search",placeholder:"Search",value:this.props.searchTerm,onChange:this.handleSearchTermChange,autoComplete:"off"})),l.a.createElement("div",{className:"col-xs-3 search-filters"},l.a.createElement("div",{className:"btn-group btn-group-justified",role:"group"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(e?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleFeaturedSearchFilter},l.a.createElement("i",{className:"fa fa-star"}))),l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(a?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleCategorySearchFilterDisplay},l.a.createElement("i",{className:"fa fa-filter"}))))),l.a.createElement("div",{className:"col-xs-4 search-filters"},l.a.createElement("div",{className:"btn-group btn-group-justified",role:"group"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn "+(t?"btn-primary":"btn-default"),disabled:t||this.props.isLoading,"data-filter":p.RECENT,onClick:this.handleCustomerSearchFilterChange},"Recent")),l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn "+(t?"btn-default":"btn-primary"),disabled:!t||this.props.isLoading,"data-filter":p.ALL,onClick:this.handleCustomerSearchFilterChange},"All"))))):l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-9"},l.a.createElement("input",{type:"text",className:"form-control",id:"product-search",placeholder:"Search",value:this.props.searchTerm,onChange:this.handleSearchTermChange,autoComplete:"off"})),l.a.createElement("div",{className:"col-xs-3 search-filters"},l.a.createElement("div",{className:"btn-group btn-group-justified",role:"group"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(e?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleFeaturedSearchFilter},l.a.createElement("i",{className:"fa fa-star"}))),l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(a?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleCategorySearchFilterDisplay},l.a.createElement("i",{className:"fa fa-filter"})))))),l.a.createElement(u.a,{categories:this.props.categories,selections:a?this.props.searchFilters.categories:[],onSelect:this.handleCategorySearchFilterSelection,onDeselect:this.handleCategorySearchFilterDeselection,isOpen:this.state.isCategorySearchFilterVisible}),l.a.createElement("div",{className:"mor-list mor-list-paging mor-list-paging-spaced"},l.a.createElement(c.a,{isVisible:this.props.isLoading}),l.a.createElement(d.a,{isVisible:!this.props.isLoading,info:{page:this.props.searchPage,pageSize:this.props.searchPageSize,total:this.props.searchTotal,totalPages:this.props.searchTotalPages}}),l.a.createElement("nav",null,l.a.createElement("ul",{className:"pager"},l.a.createElement("li",{className:1==this.props.searchPage?"previous disabled":"previous"},l.a.createElement("a",{href:"#","data-dir":"prev",onClick:this.handleSearchPageChange},l.a.createElement("span",{"aria-hidden":"true"},"<")," Prev")),l.a.createElement("li",{className:null==this.props.searchTotalPages||this.props.searchTotalPages<=1||this.props.searchPage==this.props.searchTotalPages?"next disabled":"next"},l.a.createElement("a",{href:"#","data-dir":"next",onClick:this.handleSearchPageChange},"Next ",l.a.createElement("span",{"aria-hidden":"true"},">"))))),this.props.searchResults.length?l.a.createElement("table",{className:"table table-striped table-spaced"},l.a.createElement("tbody",null,this.props.searchResults.map(this.createProductRow))):l.a.createElement("div",{className:"no-results "+(this.props.isLoading?"hidden":"text-muted")},"No products found"))),l.a.createElement("div",{className:"modal-footer"},l.a.createElement("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal",onClick:this.handleClose},"Done")))))}}]),a}(l.a.Component);E.defaultProps={subTitle:null,currencySymbol:f.getCompanyCurrency().symbol,categories:[],searchTerm:"",searchPage:1,searchPageSize:null,searchFilters:null,customerSearchFiltersActive:!1,searchTotal:null,searchTotalPages:null,searchResults:[],isLoading:!1},t.default=E},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(39),u=a(10),d=a(20),m=a(13),h=a(7),p=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).createOrderRow=function(e){var t=m.keys(e.items).length,a=h.formatCurrency(e.total),s=d.getCustomer(e.customer_id);return l.a.createElement("tr",{key:e.id},l.a.createElement("td",null,l.a.createElement("span",null,null!=s?s.name:"Customer info unavailable"),l.a.createElement("br",null),l.a.createElement("span",{className:"text-primary small pull-left"},"Total ",l.a.createElement("strong",null,(null!=e.currency.symbol?e.currency.symbol:r.defaultCurrencySymbol)+a.displayValue)),l.a.createElement("span",{className:"text-primary small pull-left",style:{marginLeft:"5px"}},"("+t+" item"+(1==t?"":"s")+")")),l.a.createElement("td",{className:"align-right"},l.a.createElement(c.a,{className:r.props.isLoading?"btn btn-primary disabled":"btn btn-primary",role:"button",to:"/sales/orders/past/"+e.id},l.a.createElement("i",{className:"fa fa-shopping-cart"})," View")))},r.defaultCurrencySymbol=h.getCompanyCurrency().symbol,r}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"mor-list"},l.a.createElement(u.a,{isVisible:this.props.isLoading}),this.props.orders.length?l.a.createElement("table",{className:"table table-striped table-spaced",style:{marginTop:0}},l.a.createElement("tbody",null,this.props.orders.map(this.createOrderRow))):l.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"No orders in progress"))}}]),a}(l.a.Component);p.defaultProps={isLoading:!1},t.default=p},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(27),u=a(20),d=a(56),m=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).state={paymentTerm:c.getPaymentTerm(e.order.payment_term_id),taxClass:c.getTaxClass(e.order.tax_class_id),billingLocation:e.order.billing_location_id>0?u.getCustomerLocation(e.order.customer_id,e.order.billing_location_id):null,shippingLocation:e.order.shipping_location_id>0?u.getCustomerLocation(e.order.customer_id,e.order.shipping_location_id):null},r}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"panel panel-default mor-list cat-panel"},l.a.createElement("div",{className:"panel-heading",role:"tab",id:"order-info-title"},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#order-info-content"},l.a.createElement("span",null,"Order Information"),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse in order-info-form",role:"tabpanel",id:"order-info-content"},l.a.createElement("div",{className:"panel-body row"},l.a.createElement("div",{className:"form-horizontal col-xs-6"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-expected-date",className:"col-xs-4 control-label"},"Expected Date"),l.a.createElement("div",{className:"col-xs-8 order-date"},d.unix(parseInt(this.props.order.expected_date)).format("DD/MM/YYYY"))),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-preferred-carrier",className:"col-xs-4 control-label"},"Preferred Carrier"),l.a.createElement("div",{className:"col-xs-8"},this.props.order.carriers[this.props.order.carrier_id])),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-po",className:"col-xs-4 control-label"},"PO #"),l.a.createElement("div",{className:"col-xs-8"},this.props.order.PO)),null!=this.state.billingLocation?l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-billing-location",className:"col-xs-4 control-label"},"Billing Address"),l.a.createElement("div",{className:"col-xs-8"},null!=this.state.billingLocation.description&&""!=this.state.billingLocation.description?this.state.billingLocation.description:this.state.billingLocation.address_1)):null),l.a.createElement("div",{className:"form-horizontal col-xs-6"},l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-currency",className:"col-xs-4 control-label"},"Currency"),l.a.createElement("div",{className:"col-xs-8"},null!=this.props.order.currency.name?this.props.order.currency.name:this.props.order.currency.symbol)),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-payment-term",className:"col-xs-4 control-label"},"Payment Term"),l.a.createElement("div",{className:"col-xs-8"},null!=this.state.paymentTerm?this.state.paymentTerm.name:null)),l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-tax-class",className:"col-xs-4 control-label"},"Tax Class"),l.a.createElement("div",{className:"col-xs-8"},null!=this.state.taxClass?this.state.taxClass.name:null)),null!=this.state.shippingLocation?l.a.createElement("div",{className:"form-group"},l.a.createElement("label",{htmlFor:"order-billing-location",className:"col-xs-4 control-label"},"Shipping Address"),l.a.createElement("div",{className:"col-xs-8"},null!=this.state.shippingLocation.description&&""!=this.state.shippingLocation.description?this.state.shippingLocation.description:this.state.shippingLocation.address_1)):null),l.a.createElement("div",{className:"form-horizontal col-xs-12"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-comments",className:"col-xs-2 control-label"},"Comments"),l.a.createElement("div",{className:"col-xs-10"},this.props.order.review))))))}}]),a}(l.a.Component);t.default=m},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(7),u=a(13),d=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).renderOrderItem=function(e){return null!=e?l.a.createElement("tr",{key:e.id},l.a.createElement("td",{colSpan:"3"},l.a.createElement("div",{className:"order-item"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-12 text-primary"},e.SKU)),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-12"},e.name)),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-4"},e.qty),l.a.createElement("div",{className:"col-xs-4"},r.currencySymbol+(null!=e.price?c.formatCurrency(e.price).displayValue:c.formatCurrencyNumber(e.discount_price).displayValue)),l.a.createElement("div",{className:"col-xs-4"},r.currencySymbol+c.formatCurrencyNumber(e.total).displayValue))))):null},r.renderOrderItems=function(e){var t=[];if(u.keys(e).length)for(var a in e)t.push(r.renderOrderItem(e[a]));else t.push(l.a.createElement("tr",{key:"1"},l.a.createElement("td",{colSpan:"3"},l.a.createElement("span",{className:"text-muted"},"No order items"))));return t},r.defaultCurrencySymbol=c.getCompanyCurrency().symbol,r.currencySymbol=null!=e.order.currency.symbol?e.order.currency.symbol:r.defaultCurrencySymbol,r}return Object(r.a)(a,[{key:"render",value:function(){var e=c.formatCurrency(this.props.order.subtotal),t=c.formatCurrency(this.props.order.adjustment_amount),a=c.formatCurrency(this.props.order.shipping_amount),s=c.formatCurrency(this.props.order.tax),r=c.formatCurrency(this.props.order.total);return this.currencySymbol=null!=this.props.order.currency.symbol?this.props.order.currency.symbol:this.defaultCurrencySymbol,l.a.createElement("div",null,l.a.createElement("div",{className:"panel panel-default mor-list cat-panel"},l.a.createElement("div",{className:"panel-heading"},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#order-details-content"},l.a.createElement("span",null,"Order Details"),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"order-details-content"},l.a.createElement("table",{className:"table table-striped"},l.a.createElement("thead",null,l.a.createElement("tr",null,l.a.createElement("th",{className:"col-xs-4"},"Quantity"),l.a.createElement("th",{className:"col-xs-4"},"Price"),l.a.createElement("th",{className:"col-xs-4"},"Total"))),l.a.createElement("tbody",null,this.renderOrderItems(this.props.order.items))))),l.a.createElement("div",{className:"panel panel-default mor-list cat-panel"},l.a.createElement("div",{className:"panel-heading"},l.a.createElement("h4",{className:"panel-title"},l.a.createElement("a",{role:"button","data-toggle":"collapse",href:"#order-totals-content"},l.a.createElement("span",null,"Order Totals"),l.a.createElement("i",{className:"minimise fa fa-window-minimize"}),l.a.createElement("i",{className:"maximise fa fa-window-maximize"})))),l.a.createElement("div",{className:"panel-collapse collapse in",role:"tabpanel",id:"order-totals-content"},l.a.createElement("ul",{className:"list-group form-horizontal"},l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-subtotal",className:"col-xs-4 control-label"},"Subtotal"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",null,this.currencySymbol+e.displayValue)))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-adjustment",className:"col-xs-4 control-label"},"Adjustment"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",null,this.currencySymbol+t.displayValue)))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-shipping",className:"col-xs-4 control-label"},"Shipping"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",null,this.currencySymbol+a.displayValue)))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-tax",className:"col-xs-4 control-label"},"Tax"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",null,this.currencySymbol+s.displayValue)))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"form-group",style:{marginBottom:0}},l.a.createElement("label",{htmlFor:"order-total",className:"col-xs-4 control-label"},"Total"),l.a.createElement("div",{className:"input-group col-xs-4"},l.a.createElement("span",null,l.a.createElement("strong",null,this.currencySymbol+r.displayValue)))))))),l.a.createElement("div",{className:"audit-footer"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-primary",onClick:this.props.onClone},l.a.createElement("i",{className:"fa fa-clone"})," Clone Order"))))}}]),a}(l.a.Component);t.default=d},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(10),u=a(83),d=a(31),m=a(58),h=a(84),p=a(68),g=a(13),f=a(7),E=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).handleSearchTermChange=function(e){var t=e.target.value;r.props.onSearch(t,1,r.props.searchFilters)},r.handleCustomerSearchFilterChange=function(e){var t=r.props.searchFilters||{};t.customerProducts=e.target.dataset.filter,r.props.onSearch(r.props.searchTerm,1,t)},r.handleSearchPageChange=function(e){e.preventDefault();var t="prev"==e.target.dataset.dir?r.props.searchPage>1?r.props.searchPage-1:1:null!=r.props.searchTotalPages&&r.props.searchPage<r.props.searchTotalPages?r.props.searchPage+1:r.props.searchPage;t!=r.props.searchPage&&r.props.onSearch(r.props.searchTerm,t,r.props.searchFilters)},r.toggleFeaturedSearchFilter=function(){var e=r.props.searchFilters||{};e.featured=!(null!=e.featured&&e.featured),r.props.onSearch(r.props.searchTerm,1,e)},r.toggleCategorySearchFilterDisplay=function(){r.setState((function(e){return{isCategorySearchFilterVisible:!e.isCategorySearchFilterVisible}}))},r.handleCategorySearchFilterSelection=function(e){var t=r.props.searchFilters||{};t.categories=t.categories||[],t.categories.push(e),t.categories=g.uniq(t.categories),r.props.onSearch(r.props.searchTerm,1,t)},r.handleCategorySearchFilterDeselection=function(e){var t=r.props.searchFilters||{};t.categories=t.categories||[],g.pull(t.categories,e),r.props.onSearch(r.props.searchTerm,1,t)},r.handleProductQuantityChange=function(e){var t=e.target,a=e.type,s={id:t.dataset.id,name:t.dataset.name,sku:t.dataset.sku,calc_price:t.dataset.calcprice,is_taxable:t.dataset.istaxable>0,tax_class_id:t.dataset.taxclassid,quantity_min:parseFloat(t.dataset.min),quantity_max:parseFloat(t.dataset.max),quantity_mom:parseInt(t.dataset.mom)};if("button"==t.type){var n=null!=r.props.selectedProducts[s.id]&&r.props.selectedProducts[s.id].quantity>0?r.props.selectedProducts[s.id].quantity:0,i=s.quantity_mom?s.quantity_min:1;s.quantity=f.fixNumber("up"==t.dataset.dir?n+i:n-i),s.quantity_display=s.quantity}else{var o=f.formatDecimal(t.value,"blur"!=a);s.quantity=o.value,s.quantity_display=o.displayValue}if(s.quantity<0&&(s.quantity=0,s.quantity_display=0),"button"==t.type||"blur"==a){var l=f.restrictNumber(s.quantity,s.quantity_display,s.quantity_min,s.quantity_max,s.quantity_mom);s.quantity=l.value,s.quantity_display=l.displayValue}r.props.onProductQuantityChange(s)},r.createProductRow=function(e,t){var a=e.product,s=null!=a.variants&&a.variants.length>0?a.variants[0].id:a.id,n=null!=a.default_image&&a.default_image.length;return l.a.createElement("tr",{key:a.id},l.a.createElement("td",{className:r.props.isProductSelectionAvailable?"col-xs-7":"col-xs-9"},l.a.createElement("div",{className:"product-info"+(n?" product-with-image":"")},n?l.a.createElement("div",{className:"product-image"},l.a.createElement("a",{href:"#",onClick:r.openImagesModal,"data-idx":t},l.a.createElement(m.a,{src:f.sanitiseForSecureURL(a.default_image)}))):null,l.a.createElement("span",null,a.name),l.a.createElement("br",null),a.unique_code?l.a.createElement("span",{className:"text-muted small pull-left add-info"},a.unique_code):null,a.SKU?l.a.createElement("span",{className:"text-muted small pull-left add-info",style:a.unique_code?{marginLeft:"5px"}:null},a.SKU):null,l.a.createElement("span",{className:"text-muted small pull-left add-info",style:a.unique_code||a.SKU?{marginLeft:"5px"}:null},"SOH:"+(a.stock_on_hand?a.stock_on_hand:"0")),r.props.isProductSelectionAvailable?l.a.createElement("span",{className:"text-primary pull-left price-info",style:{marginLeft:"5px"}},r.props.currencySymbol+a.calc_price):null,null!=a.is_featured&&1==a.is_featured?l.a.createElement("span",{className:"text-primary small pull-left",style:{marginLeft:"5px"}},l.a.createElement("i",{className:"fa fa-star"})):null)),l.a.createElement("td",{className:r.props.isProductSelectionAvailable?"col-xs-5":"col-xs-3",style:r.props.isProductSelectionAvailable?{}:{textAlign:"right"}},r.props.isProductSelectionAvailable?l.a.createElement("div",{className:"input-group"},l.a.createElement("span",{className:"input-group-btn"},l.a.createElement("button",{className:r.props.isLoading?"btn btn-default disabled":"btn btn-default",type:"button",onClick:r.handleProductQuantityChange,"data-dir":"down","data-id":s,"data-name":a.name,"data-sku":a.SKU,"data-calcprice":a.calc_price,"data-istaxable":a.is_taxable,"data-taxclassid":a.tax_class_id,"data-min":a.min_order_qty,"data-max":a.max_order_qty,"data-mom":a.multiples_of_min},"-")),l.a.createElement("input",{type:"text",className:"form-control input-space-efficient input-centred",autoComplete:"off",value:null!=r.props.selectedProducts[s]?r.props.selectedProducts[s].quantity_display:0,onChange:r.handleProductQuantityChange,onBlur:r.handleProductQuantityChange,disabled:r.props.isLoading,"data-id":s,"data-name":a.name,"data-sku":a.SKU,"data-calcprice":a.calc_price,"data-istaxable":a.is_taxable,"data-taxclassid":a.tax_class_id,"data-min":a.min_order_qty,"data-max":a.max_order_qty,"data-mom":a.multiples_of_min}),l.a.createElement("span",{className:"input-group-btn"},l.a.createElement("button",{className:r.props.isLoading?"btn btn-default disabled":"btn btn-default",type:"button",onClick:r.handleProductQuantityChange,"data-dir":"up","data-id":s,"data-name":a.name,"data-sku":a.SKU,"data-calcprice":a.calc_price,"data-istaxable":a.is_taxable,"data-taxclassid":a.tax_class_id,"data-min":a.min_order_qty,"data-max":a.max_order_qty,"data-mom":a.multiples_of_min},"+"))):l.a.createElement("span",{className:"text-primary price-info"},r.props.currencySymbol+a.calc_price)))},r.openImagesModal=function(e){e.preventDefault();var t=e.currentTarget.dataset.idx,a=r.props.products[t].product;r.setState({isImagesModalVisible:!0,imagesModalTitle:a.name,imagesModalImages:a.images})},r.closeImagesModal=function(){r.setState({isImagesModalVisible:!1,imagesModalTitle:null,imagesModalImages:[]})},r.state={isCategorySearchFilterVisible:!1,isImagesModalVisible:!1,imagesModalTitle:null,imagesModalImages:[]},r}return Object(r.a)(a,[{key:"render",value:function(){var e=null!=this.props.searchFilters&&null!=this.props.searchFilters.featured&&this.props.searchFilters.featured,t=null!=this.props.searchFilters&&this.props.searchFilters.customerProducts==p.RECENT,a=null!=this.props.searchFilters&&null!=this.props.searchFilters.categories&&this.props.searchFilters.categories.length;return l.a.createElement("div",{style:{marginTop:"15px"}},this.state.isImagesModalVisible?l.a.createElement(h.a,{title:this.state.imagesModalTitle,images:this.state.imagesModalImages,onClose:this.closeImagesModal}):null,this.props.customerSearchFiltersActive?l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-5"},l.a.createElement("input",{type:"text",className:"form-control",id:"product-search",placeholder:"Search",value:this.props.searchTerm,onChange:this.handleSearchTermChange,autoComplete:"off"})),l.a.createElement("div",{className:"col-xs-3 search-filters"},l.a.createElement("div",{className:"btn-group btn-group-justified",role:"group"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(e?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleFeaturedSearchFilter},l.a.createElement("i",{className:"fa fa-star"}))),l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(a?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleCategorySearchFilterDisplay},l.a.createElement("i",{className:"fa fa-filter"}))))),l.a.createElement("div",{className:"col-xs-4 search-filters"},l.a.createElement("div",{className:"btn-group btn-group-justified",role:"group"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn "+(t?"btn-primary":"btn-default"),disabled:t||this.props.isLoading,"data-filter":p.RECENT,onClick:this.handleCustomerSearchFilterChange},"Recent")),l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn "+(t?"btn-default":"btn-primary"),disabled:!t||this.props.isLoading,"data-filter":p.ALL,onClick:this.handleCustomerSearchFilterChange},"All"))))):l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-9"},l.a.createElement("input",{type:"text",className:"form-control",id:"product-search",placeholder:"Search",value:this.props.searchTerm,onChange:this.handleSearchTermChange,autoComplete:"off"})),l.a.createElement("div",{className:"col-xs-3 search-filters"},l.a.createElement("div",{className:"btn-group btn-group-justified",role:"group"},l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(e?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleFeaturedSearchFilter},l.a.createElement("i",{className:"fa fa-star"}))),l.a.createElement("div",{className:"btn-group",role:"group"},l.a.createElement("button",{className:"btn btn-block "+(a?"btn-primary":"btn-default"),disabled:this.props.isLoading,onClick:this.toggleCategorySearchFilterDisplay},l.a.createElement("i",{className:"fa fa-filter"})))))),l.a.createElement(u.a,{categories:this.props.categories,selections:a?this.props.searchFilters.categories:[],onSelect:this.handleCategorySearchFilterSelection,onDeselect:this.handleCategorySearchFilterDeselection,isOpen:this.state.isCategorySearchFilterVisible}),l.a.createElement("div",{className:"mor-list mor-list-paging mor-list-paging-spaced"},l.a.createElement(c.a,{isVisible:this.props.isLoading}),l.a.createElement(d.a,{isVisible:!this.props.isLoading,info:{page:this.props.searchPage,pageSize:this.props.searchPageSize,total:this.props.searchTotal,totalPages:this.props.searchTotalPages}}),l.a.createElement("nav",null,l.a.createElement("ul",{className:"pager"},l.a.createElement("li",{className:1==this.props.searchPage?"previous disabled":"previous"},l.a.createElement("a",{href:"#","data-dir":"prev",onClick:this.handleSearchPageChange},l.a.createElement("span",{"aria-hidden":"true"},"<")," Prev")),l.a.createElement("li",{className:null==this.props.searchTotalPages||this.props.searchTotalPages<=1||this.props.searchPage==this.props.searchTotalPages?"next disabled":"next"},l.a.createElement("a",{href:"#","data-dir":"next",onClick:this.handleSearchPageChange},"Next ",l.a.createElement("span",{"aria-hidden":"true"},">"))))),this.props.products.length?l.a.createElement("table",{className:"table table-striped table-spaced"},l.a.createElement("tbody",null,this.props.products.map(this.createProductRow))):l.a.createElement("div",{className:"no-results "+(this.props.isLoading?"hidden":"text-empty")},"No products found")))}}]),a}(l.a.Component);E.defaultProps={currencySymbol:f.getCompanyCurrency().symbol,products:[],selectedProducts:{},categories:[],searchTerm:"",searchPage:1,searchPageSize:null,searchFilters:null,customerSearchFiltersActive:!1,searchTotal:null,searchTotalPages:null,isLoading:!1,isProductSelectionAvailable:!1},t.default=E},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(39),u=a(10),d=a(31),m=(a(7),function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(){var e;Object(s.a)(this,a);for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).handleSearchTermChange=function(t){var a=t.target.value;e.props.onSearch(a,1)},e.handleSearchPageChange=function(t){t.preventDefault();var a="prev"==t.target.dataset.dir?e.props.searchPage>1?e.props.searchPage-1:1:null!=e.props.searchTotalPages&&e.props.searchPage<e.props.searchTotalPages?e.props.searchPage+1:e.props.searchPage;a!=e.props.searchPage&&e.props.onSearch(e.props.searchTerm,a)},e.createCustomerRow=function(t){return l.a.createElement("tr",{key:t.id},l.a.createElement("td",null,l.a.createElement("span",null,t.name),l.a.createElement("br",null),t.unique_code?l.a.createElement("span",{className:"text-primary small pull-left"},t.unique_code):null),l.a.createElement("td",{className:"align-right",style:{paddingLeft:0}},l.a.createElement(c.a,{className:e.props.isLoading?"btn btn-primary disabled":"btn btn-primary",role:"button",to:"/sales/customers/"+t.id},l.a.createElement("i",{className:"fa fa-arrow-right"})," View")))},e}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{style:{marginTop:"15px"}},l.a.createElement("input",{type:"text",className:"form-control",id:"customer-search",placeholder:"Search",value:this.props.searchTerm,onChange:this.handleSearchTermChange,autoComplete:"off"}),l.a.createElement("div",{className:"mor-list mor-list-paging mor-list-paging-spaced"},l.a.createElement(u.a,{isVisible:this.props.isLoading}),l.a.createElement(d.a,{isVisible:!this.props.isLoading,info:{page:this.props.searchPage,pageSize:this.props.searchPageSize,total:this.props.searchTotal,totalPages:this.props.searchTotalPages}}),l.a.createElement("nav",null,l.a.createElement("ul",{className:"pager"},l.a.createElement("li",{className:1==this.props.searchPage?"previous disabled":"previous"},l.a.createElement("a",{href:"#","data-dir":"prev",onClick:this.handleSearchPageChange},l.a.createElement("span",{"aria-hidden":"true"},"<")," Prev")),l.a.createElement("li",{className:null==this.props.searchTotalPages||this.props.searchTotalPages<=1||this.props.searchPage==this.props.searchTotalPages?"next disabled":"next"},l.a.createElement("a",{href:"#","data-dir":"next",onClick:this.handleSearchPageChange},"Next ",l.a.createElement("span",{"aria-hidden":"true"},">"))))),this.props.customers.length?l.a.createElement("table",{className:"table table-striped table-spaced"},l.a.createElement("tbody",null,this.props.customers.map(this.createCustomerRow))):l.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"No customers found")))}}]),a}(l.a.Component));m.defaultProps={customers:[],searchTerm:"",searchPage:1,searchPageSize:null,searchTotal:null,searchTotalPages:null,isLoading:!1},t.default=m},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(10),i=a(56),o=r.a.createClass({displayName:"UserInfoList",getDefaultProps:function(){return{isLoading:!1}},renderField:function(e){return r.a.createElement("li",{key:e.name,className:"list-group-item"},r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-xs-4"},r.a.createElement("small",{className:"text-muted"},e.label)),r.a.createElement("div",{className:"col-xs-8"},r.a.createElement("span",{className:"text-primary"},"date_of_birth"==e.name&&null!=this.props.user[e.name]?i.unix(this.props.user[e.name]).format("D MMM YYYY"):this.props.user[e.name]))))},render:function(){return r.a.createElement("div",{className:"panel-group mor-list"},r.a.createElement(n.a,{isVisible:this.props.isLoading}),null!=this.props.user.id?r.a.createElement("ul",{className:"list-group"},this.props.userFields.map(this.renderField)):r.a.createElement("div",{className:this.props.isLoading?"hidden":"text-empty"},"No information"))}});t.default=o},function(e,t,a){"use strict";a.r(t);var s=a(2),r=a(3),n=a(5),i=a(4),o=a(0),l=a.n(o),c=a(10),u=a(79),d=a(21),m=a.n(d),h=function(e){Object(n.a)(a,e);var t=Object(i.a)(a);function a(e){var r;return Object(s.a)(this,a),(r=t.call(this,e)).showAppDataSubmissionConfirmationPrompt=function(){r.setState({isAppDataSubmissionConfirmationVisible:!0})},r.hideAppDataSubmissionConfirmationPrompt=function(){r.setState({isAppDataSubmissionConfirmationVisible:!1})},r.submitAppData=function(){r.hideAppDataSubmissionConfirmationPrompt(),r.props.onSubmitAppData()},r.appDataSubmissionConfirmationDescription="Are you sure you want to submit your app data?",r.state={isAppDataSubmissionConfirmationVisible:!1},r}return Object(r.a)(a,[{key:"render",value:function(){return l.a.createElement("div",{className:"panel-group mor-list"},this.state.isAppDataSubmissionConfirmationVisible?l.a.createElement(u.default,{description:this.appDataSubmissionConfirmationDescription,onYes:this.submitAppData,onNo:this.hideAppDataSubmissionConfirmationPrompt}):null,l.a.createElement(c.a,{isVisible:this.props.isLoading}),l.a.createElement("ul",{className:"list-group"},l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-4"},l.a.createElement("small",{className:"text-muted"},"App Version")),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("span",{className:"text-primary"},m.a.appVersion)))),l.a.createElement("li",{className:"list-group-item"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-xs-4"},l.a.createElement("small",{className:"text-muted"},"App Data")),l.a.createElement("div",{className:"col-xs-8"},l.a.createElement("small",{className:"text-muted"},"You may be asked to submit your app data to help track down issues."),l.a.createElement("br",null),l.a.createElement("button",{type:"button",className:"btn btn-default btn-sm",onClick:this.showAppDataSubmissionConfirmationPrompt,disabled:this.props.isLoading},"Submit"))))))}}]),a}(l.a.Component);h.defaultProps={isLoading:!1},t.default=h},,,,,,,,,,,,,,function(e,t,a){"use strict";a.r(t);var s=a(1),r=a.n(s);window.$=r.a,function(){var e=function(e,t,a){var s=e,n=t||0,i=0,o=r()(this).IEBinary_getLength(),l=r()(this).IEBinary_getByteAt();this.getRawData=function(){return s},"string"==typeof e?(i=a||s.length,this.getByteAt=function(e){return 255&s.charCodeAt(e+n)}):"unknown"==typeof e&&(i=a||o(s),this.getByteAt=function(e){return l(s,e+n)}),this.getLength=function(){return i},this.getSByteAt=function(e){var t=this.getByteAt(e);return t>127?t-256:t},this.getShortAt=function(e,t){var a=t?(this.getByteAt(e)<<8)+this.getByteAt(e+1):(this.getByteAt(e+1)<<8)+this.getByteAt(e);return a<0&&(a+=65536),a},this.getSShortAt=function(e,t){var a=this.getShortAt(e,t);return a>32767?a-65536:a},this.getLongAt=function(e,t){var a=this.getByteAt(e),s=this.getByteAt(e+1),r=this.getByteAt(e+2),n=this.getByteAt(e+3),i=t?(((a<<8)+s<<8)+r<<8)+n:(((n<<8)+r<<8)+s<<8)+a;return i<0&&(i+=4294967296),i},this.getSLongAt=function(e,t){var a=this.getLongAt(e,t);return a>2147483647?a-4294967296:a},this.getStringAt=function(e,t){for(var a=[],s=e,r=0;s<e+t;s++,r++)a[r]=String.fromCharCode(this.getByteAt(s));return a.join("")},this.getCharAt=function(e){return String.fromCharCode(this.getByteAt(e))},this.toBase64=function(){return window.btoa(s)},this.fromBase64=function(e){s=window.atob(e)}},t=function(){function t(){var e=null,t=r()(this).ActiveXObject;return window.XMLHttpRequest?e=new XMLHttpRequest:window.ActiveXObject&&(e=new t("Microsoft.XMLHTTP")),e}function a(a,s,r,n,i,o){var l=t();if(l){var c=0;n&&!i&&(c=n[0]);var u=0;n&&(u=n[1]-n[0]+1),s&&("undefined"!=typeof l.onload?l.onload=function(){"200"==l.status||"206"==l.status||"0"==l.status?(this.binaryResponse=new e(this.responseText,c,u),this.fileSize=o||this.getResponseHeader("Content-Length"),s(this)):r&&r(),l=null}:l.onreadystatechange=function(){4==l.readyState&&("200"==l.status||"206"==l.status||"0"==l.status?(this.binaryResponse=new e(l.responseBody,c,u),this.fileSize=o||this.getResponseHeader("Content-Length"),s(this)):r&&r(),l=null)}),l.open("GET",a,!0),l.overrideMimeType&&l.overrideMimeType("text/plain; charset=x-user-defined"),n&&i&&l.setRequestHeader("Range","bytes="+n[0]+"-"+n[1]),l.setRequestHeader("If-Modified-Since","Sat, 1 Jan 1970 00:00:00 GMT"),l.send(null)}else r&&r()}return function(e,s,r,n){n?function(e,a,s){var r=t();r?(a&&("undefined"!=typeof r.onload?r.onload=function(){"200"==r.status?a(this):s&&s(),r=null}:r.onreadystatechange=function(){4==r.readyState&&("200"==r.status?a(this):s&&s(),r=null)}),r.open("HEAD",e,!0),r.send(null)):s&&s()}(e,(function(t){var i,o,l=parseInt(t.getResponseHeader("Content-Length"),10),c=t.getResponseHeader("Accept-Ranges");i=n[0],n[0]<0&&(i+=l),o=i+n[1]-1,a(e,s,r,[i,o],"bytes"==c,l)})):a(e,s,r)}}();document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n\tIEBinary_getByteAt = AscB(MidB(strBinary,iOffset+1,1))\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n\tIEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n<\/script>\r\n");var a={};!function(){function s(e){return!!e.exifdata}function n(e){if(255!=e.getByteAt(0)||216!=e.getByteAt(1))return!1;for(var t=2,a=e.getLength();t<a;){if(255!=e.getByteAt(t))return!1;var s=e.getByteAt(t+1);if(22400==s)return l(e,t+4,e.getShortAt(t+2,!0)-2);if(225==s)return l(e,t+4,e.getShortAt(t+2,!0)-2);t+=2+e.getShortAt(t+2,!0)}}function i(e,t,a,s,r){for(var n=e.getShortAt(a,r),i={},l=0;l<n;l++){var c=a+12*l+2,u=s[e.getShortAt(c,r)];0,i[u]=o(e,c,t,a,r)}return i}function o(e,t,a,s,r){var n=e.getShortAt(t+2,r),i=e.getLongAt(t+4,r),o=e.getLongAt(t+8,r)+a;switch(n){case 1:case 7:if(1==i)return e.getByteAt(t+8,r);for(var l=i>4?o:t+8,c=[],u=0;u<i;u++)c[u]=e.getByteAt(l+u);return c;case 2:var d=i>4?o:t+8;return e.getStringAt(d,i-1);case 3:if(1==i)return e.getShortAt(t+8,r);for(l=i>2?o:t+8,c=[],u=0;u<i;u++)c[u]=e.getShortAt(l+2*u,r);return c;case 4:if(1==i)return e.getLongAt(t+8,r);for(c=[],u=0;u<i;u++)c[u]=e.getLongAt(o+4*u,r);return c;case 5:if(1==i)return e.getLongAt(o,r)/e.getLongAt(o+4,r);for(c=[],u=0;u<i;u++)c[u]=e.getLongAt(o+8*u,r)/e.getLongAt(o+4+8*u,r);return c;case 9:if(1==i)return e.getSLongAt(t+8,r);for(c=[],u=0;u<i;u++)c[u]=e.getSLongAt(o+4*u,r);return c;case 10:if(1==i)return e.getSLongAt(o,r)/e.getSLongAt(o+4,r);for(c=[],u=0;u<i;u++)c[u]=e.getSLongAt(o+8*u,r)/e.getSLongAt(o+4+8*u,r);return c}}function l(e,t,s){if("Exif"!=e.getStringAt(t,4))return!1;var r,n=t+6;if(18761==e.getShortAt(n))r=!1;else{if(19789!=e.getShortAt(n))return!1;r=!0}if(42!=e.getShortAt(n+2,r))return!1;if(8!=e.getLongAt(n+4,r))return!1;var o=i(e,n,n+8,a.TiffTags,r);if(o.ExifIFDPointer){var l=i(e,n,n+o.ExifIFDPointer,a.Tags,r);for(var c in l){switch(c){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":l[c]=a.StringValues[c][l[c]];break;case"ExifVersion":case"FlashpixVersion":l[c]=String.fromCharCode(l[c][0],l[c][1],l[c][2],l[c][3]);break;case"ComponentsConfiguration":l[c]=a.StringValues.Components[l[c][0]]+a.StringValues.Components[l[c][1]]+a.StringValues.Components[l[c][2]]+a.StringValues.Components[l[c][3]]}o[c]=l[c]}}if(o.GPSInfoIFDPointer){var u=i(e,n,n+o.GPSInfoIFDPointer,a.GPSTags,r);for(var c in u){switch(c){case"GPSVersionID":u[c]=u[c][0]+"."+u[c][1]+"."+u[c][2]+"."+u[c][3]}o[c]=u[c]}}return o}a.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},a.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},a.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},a.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},a.getData=function(e,a){return!!e.complete&&(s(e)?a&&a():function(e,a){t(e.src,(function(t){console.log("BINARY",t.binaryResponse);var s=n(t.binaryResponse);e.exifdata=s||{},a&&a()}))}(e,a),!0)},a.getDataFromDataURL=function(t,a){return!!t.complete&&(s(t)?a&&a():function(t,a){var s=atob(t.src.split(",")[1]),r=n(new e(s,0,s.length));t.exifdata=r||{},a&&a()}(t,a),!0)},a.getTag=function(e,t){if(s(e))return e.exifdata[t]},a.getAllTags=function(e){if(!s(e))return{};var t=e.exifdata,a={};for(var r in t)t.hasOwnProperty(r)&&(a[r]=t[r]);return a},a.pretty=function(e){if(!s(e))return"";var t=e.exifdata,a="";for(var r in t)t.hasOwnProperty(r)&&("object"==typeof t[r]?a+=r+" : ["+t[r].length+" values]\r\n":a+=r+" : "+t[r]+"\r\n");return a},a.readFromBinaryFile=function(e){return n(e)},r()(document).ready((function(){for(var e,t,s,r=document.getElementsByTagName("img"),n=0;n<r.length;n++)"true"==r[n].getAttribute("exif")&&(r[n].complete?a.getData(r[n]):(e=r[n],t="load",s=function(){a.getData(this)},e.addEventListener?e.addEventListener(t,s,!1):e.attachEvent&&e.attachEvent("on"+t,s)))})),r.a.fn.exifLoad=function(e){return this.each((function(){a.getData(this,e)}))},r.a.fn.exifLoadFromDataURL=function(e){return this.each((function(){return a.getDataFromDataURL(this,e),!0}))},r.a.fn.exif=function(e){var t=[];return this.each((function(){t.push(a.getTag(this,e))})),t},r.a.fn.exifAll=function(){var e=[];return this.each((function(){e.push(a.getAllTags(this))})),e},r.a.fn.exifPretty=function(){var e=[];return this.each((function(){e.push(a.pretty(this))})),e}}()}(r.a)},function(e,t,a){"use strict";a.r(t);var s=a(1);!function(e){var t={newsize:function(e,t,a,s,r){var n=r?"h":"";if(a&&e>a||s&&t>s){var i=e/t;(i>=1||0===s)&&a&&!r?(e=a,t=a/i>>0):r&&i<=a/s?(e=a,t=a/i>>0,n="w"):(e=s*i>>0,t=s)}return{width:e,height:t,cropped:n}},dataURLtoBlob:function(e){for(var t=e.split(",")[0].split(":")[1].split(";")[0],a=atob(e.split(",")[1]),s=new ArrayBuffer(a.length),r=new Uint8Array(s),n=0;n<a.length;n++)r[n]=a.charCodeAt(n);var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;return i?((i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)).append(s),i.getBlob(t)):i=new Blob([s],{type:t})},detectSubsampling:function(e){var t=e.width;if(t*e.height>1048576){var a=document.createElement("canvas");a.width=a.height=1;var s=a.getContext("2d");return s.drawImage(e,1-t,0),0===s.getImageData(0,0,1,1).data[3]}return!1},rotate:function(e,t){var a={1:{90:6,180:3,270:8},2:{90:7,180:4,270:5},3:{90:8,180:1,270:6},4:{90:5,180:2,270:7},5:{90:2,180:7,270:4},6:{90:3,180:8,270:1},7:{90:4,180:5,270:2},8:{90:1,180:6,270:3}};return a[e][t]?a[e][t]:e},transformCoordinate:function(e,t,a,s){switch(s){case 5:case 6:case 7:case 8:e.width=a,e.height=t;break;default:e.width=t,e.height=a}var r=e.getContext("2d");switch(s){case 1:break;case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,a),r.rotate(Math.PI);break;case 4:r.translate(0,a),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-a);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-a),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}},detectVerticalSquash:function(e,t,a){var s=document.createElement("canvas");s.width=1,s.height=a;var r=s.getContext("2d");r.drawImage(e,0,0);for(var n=r.getImageData(0,0,1,a).data,i=0,o=a,l=a;l>i;){0===n[4*(l-1)+3]?o=l:i=l,l=o+i>>1}var c=l/a;return 0===c?1:c},callback:function(e){return e}},a={width:300,height:0,crop:!1,quality:80,callback:t.callback};function s(t,s){this.file=t,this.options=e.extend({},a,s),this._defaults=a,this._name="canvasResize",this.init()}s.prototype={init:function(){var a=this,s=this.file,r=new FileReader;r.onloadend=function(r){var n=r.target.result,i=new Image;i.onload=function(r){e(i).exifLoadFromDataURL((function(){var r=e(i).exif("Orientation")[0]||1,n=(r=t.rotate(r,a.options.rotate))>=5&&r<=8?t.newsize(i.height,i.width,a.options.width,a.options.height,a.options.crop):t.newsize(i.width,i.height,a.options.width,a.options.height,a.options.crop),o=i.width,l=i.height,c=n.width,u=n.height,d=document.createElement("canvas"),m=d.getContext("2d");m.save(),t.transformCoordinate(d,c,u,r),t.detectSubsampling(i)&&(o/=2,l/=2);var h=1024,p=document.createElement("canvas");p.width=p.height=h;for(var g=p.getContext("2d"),f=t.detectVerticalSquash(i,o,l),E=0;E<l;){for(var S=E+h>l?l-E:h,C=0;C<o;){var y=C+h>o?o-C:h;g.clearRect(0,0,h,h),g.drawImage(i,-C,-E);var R=Math.floor(C*c/o),b=Math.ceil(y*c/o),_=Math.floor(E*u/l/f),v=Math.ceil(S*u/l/f);m.drawImage(p,0,0,y,S,R,_,b,v),C+=h}E+=h}m.restore(),p=g=null;var N=document.createElement("canvas");N.width="h"===n.cropped?u:c,N.height="w"===n.cropped?c:u;var T="h"===n.cropped?.5*(u-c):0,O="w"===n.cropped?.5*(c-u):0;if(N.getContext("2d").drawImage(d,T,O,c,u),"image/png"===s.type)var L=N.toDataURL(s.type);else L=N.toDataURL("image/jpeg",.01*a.options.quality);a.options.callback(L,c,u)}))},i.src=n},r.readAsDataURL(s)}},e.canvasResize=function(e,a){if("string"===typeof e)return t[e](a);new s(e,a)}}(a.n(s).a)},function(e,t,a){"use strict";a.r(t),function(e){var t=a(38),s=a(23),r=a(15),n={initApp:function(){return s.dispatch({actionType:r.INITIALISE,initialData:{}}),t.a.getReady()}};e.exports=n}.call(this,a(36)(e))},function(e,t,a){"use strict";a.r(t);var s=a(0),r=a.n(s),n=a(57),i=a.n(n),o=a(2),l=a(3),c=a(5),u=a(4),d=a(7),m=a.n(d),h=a(38),p=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.props.preloadImages.length&&h.a.setReady(Promise.all(this.props.preloadImages.map((function(e){return new Promise((function(t,a){var s=new Image;s.onload=function(){t(e+" loaded")},s.onerror=function(){a(Error(e+" failed to load"))},s.src=e}))}))).catch((function(){})))}},{key:"render",value:function(){return r.a.createElement("div",{className:"splash"},r.a.createElement("img",{src:m.a.assetsUrl+"img/morpheus-m.png"}))}}]),a}(r.a.Component);p.defaultProps={preloadImages:[]};var g=p,f=a(85),E=a(312),S=a(313),C=a(314),y=a(316),R=a(39),b=a(315),_=a(42),v=a(64),N=a(22),T=a(21),O=a(7),L=window.$,D=r.a.createClass({displayName:"Header",getInitialState:function(){return{screenTitle:O.screenData.title,menuVisible:!1,loggedInName:v.getFullName(),companyLogoBase64:v.getCompanyLogo(),redirectToLoginPage:!1}},componentWillMount:function(){O.addChangeListener(this._onScreenDataChange)},componentDidMount:function(){v.addChangeListener(this._onChange),L(document).on("click",".navbar-collapse.in",(function(e){L(e.target).is("a")&&"dropdown-toggle"!=L(e.target).attr("class")&&L(this).collapse("hide")})),O.refreshBackgroundImage()},componentWillReceiveProps:function(e){this.setState({menuVisible:!1})},componentWillUnmount:function(){v.removeChangeListener(this._onChange),O.removeChangeListener(this._onScreenDataChange)},_onChange:function(){v.hasUser()?this.setState({loggedInName:v.getFullName(),companyLogoBase64:v.getCompanyLogo(),redirectToLoginPage:!1}):this.setState({loggedInName:"",companyLogoBase64:"",redirectToLoginPage:!0}),O.refreshBackgroundImage()},_onScreenDataChange:function(){this.setState({screenTitle:O.screenData.title})},toggleMenu:function(){this.setState((function(e){return{menuVisible:!e.menuVisible}}))},logout:function(e){e.preventDefault(),_.logout()},render:function(){return r.a.createElement("div",null,this.state.loggedInName?r.a.createElement("header",{className:"navbar navbar-fixed-top navbar-inverse"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"navbar-header"},null!=this.state.companyLogoBase64&&""!=this.state.companyLogoBase64?r.a.createElement("button",{type:"button",className:"navbar-toggle navbar-toggle-logo pull-left",onClick:this.toggleMenu,"aria-expanded":"false"},r.a.createElement("img",{src:"data:image/png;base64,"+this.state.companyLogoBase64})):r.a.createElement("button",{type:"button",className:"navbar-toggle pull-left",onClick:this.toggleMenu,"aria-expanded":"false"},r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"}),r.a.createElement("span",{className:"icon-bar"}))),r.a.createElement("div",{className:"navbar-title"},this.state.screenTitle),this.state.loggedInName?r.a.createElement("div",{className:"navbar-inverse side-collapse"+(this.state.menuVisible?"":" in")},r.a.createElement("nav",{className:"navbar-collapse"},r.a.createElement("ul",{className:"nav navbar-nav"},r.a.createElement("li",{className:"nav-home"},r.a.createElement(R.a,{className:"nav-link",to:"/"},r.a.createElement("img",{src:O.assetsUrl+"img/morpheus-m-white.png"}),"HOME")),T.get(N.UI_BUTTON_CALL_LIST)?r.a.createElement("li",{className:"nav-item"},r.a.createElement(R.a,{className:"nav-link",to:"/calls"},r.a.createElement("i",{className:"fa fa-list-ul"}),"MY CALL LIST")):null,T.get(N.UI_BUTTON_CALL_LIST)?r.a.createElement("div",{className:"mui-divider"}):null,r.a.createElement("li",{className:"nav-item"},r.a.createElement(R.a,{className:"nav-link",to:"/sales"},r.a.createElement("i",{className:"fa fa-shopping-cart"}),"MY SALES")),r.a.createElement("div",{className:"mui-divider"}),r.a.createElement("li",{className:"nav-item"},r.a.createElement(R.a,{className:"nav-link",to:"/info"},r.a.createElement("i",{className:"fa fa-info-circle",style:{marginRight:"12px"}}),"MY INFORMATION")),r.a.createElement("div",{className:"mui-divider"}),T.get(N.UI_BUTTON_LIBRARY)?r.a.createElement("li",{className:"nav-item"},r.a.createElement(R.a,{className:"nav-link",to:"/library"},r.a.createElement("i",{className:"fa fa-cloud"}),"LIBRARY")):null,T.get(N.UI_BUTTON_LIBRARY)?r.a.createElement("div",{className:"mui-divider"}):null,r.a.createElement("li",{className:"nav-item"},r.a.createElement("a",{href:"#",className:"nav-link",onClick:this.logout},r.a.createElement("i",{className:"fa fa-sign-out"}),"LOGOUT")),r.a.createElement("li",{className:"nav-logo"},r.a.createElement("img",{src:O.assetsUrl+"img/morpheus-brand-pb.png"}),r.a.createElement("button",{type:"button",className:"navbar-toggle pull-right",onClick:this.toggleMenu},r.a.createElement("i",{className:"fa fa-chevron-left"})))))):null)):null,this.state.redirectToLoginPage?r.a.createElement(S.a,{push:!0,to:"/login"}):null)}}),I=Object(b.a)(D),A=a(65),P=a(9),x=a(37),U=a(15),F=a(43),w=a(20),M=a(44),k=a(27),q=a(25),B=a(64),H=a(78),j=a(22),V=a(21),G=a(7),K=a(17),W=a(13),z=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=F.getStatus(s.lastPendingAction),t=F.getEntityStatuses(s.lastPendingAction),a=F.getPercentageComplete(s.lastPendingAction);if(e==P.PENDING){var r="default";if(null!=t)for(var n in t)if(t[n]==P.PENDING){r=n;break}s.setState({isLoading:!0,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:s.progressDescriptions[r]+" ("+Math.round(a)+"%)"})}else s.setState({isLoading:!1,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:"Complete ("+Math.round(a)+"%)"}),setTimeout(s.closeRefreshProgressModal,1e3),null!=s.lastPendingAction&&null!=s.completionMessages[s.lastPendingAction]&&(e==P.OK?K.success(s.completionMessages[s.lastPendingAction][P.OK]):e==P.ERROR?K.error(s.completionMessages[s.lastPendingAction][P.ERROR]):e==P.PARTIAL&&K.warning(s.completionMessages[s.lastPendingAction][P.PARTIAL]))},s.refreshAll=function(e){if(null!=e&&e.preventDefault(),!s.state.isLoading){s.lastPendingAction=U.ALL_REFRESH;var t=W.union(w.getCustomerIDs(),q.getCallCustomerIDs(),k.getOrderCustomerIDs());A.refreshAll(M.getLastRefresh(),M.getRefreshRetryIDs(),k.getPastOrdersLastRefresh(),k.getPastOrdersRefreshRetryIDs(),t)}},s.closeRefreshProgressModal=function(){s.setState({isRefreshProgressVisible:!1})},s.state={welcomeName:B.getName(),isLoading:!1,isRefreshProgressVisible:!1,refreshProgressPercentage:0,refreshProgressDescription:""},s.lastPendingAction=null,s.progressDescriptions={},s.progressDescriptions.default="Refreshing",s.progressDescriptions[x.PAYMENT_TERM]="Refreshing payment terms",s.progressDescriptions[x.TAX_CLASS]="Refreshing tax classes",s.progressDescriptions[x.CARRIER]="Refreshing carriers",s.progressDescriptions[x.CURRENCY]="Refreshing currencies",s.progressDescriptions[x.PRODUCT]="Refreshing products",s.progressDescriptions[x.CATEGORY]="Refreshing categories",s.progressDescriptions[x.ORDER]="Refreshing orders",s.progressDescriptions[x.CUSTOMER]="Refreshing customers",s.progressDescriptions[x.PRICE_LIST]="Refreshing price lists",s.progressDescriptions[x.PRODUCT_RULE]="Refreshing product rules",s.completionMessages={},s.completionMessages[U.ALL_REFRESH]={},s.completionMessages[U.ALL_REFRESH][P.OK]="Sales and calls data refreshed",s.completionMessages[U.ALL_REFRESH][P.ERROR]="Unable to refresh sales and calls data",s.completionMessages[U.ALL_REFRESH][P.PARTIAL]="Unable to refresh all sales and calls data",s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){this.screenTitle="Welcome"+(this.state.welcomeName?" "+this.state.welcomeName:""),G.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){F.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){F.removeChangeListener(this._onChange)}},{key:"render",value:function(){var e={pathname:"/refresh",state:{from:this.props.location,fromTitle:"Home"}};return r.a.createElement("div",null,V.get(j.FUNC_ONLINE_CUSTOMERS)&&V.get(j.FUNC_ONLINE_PRODUCTS)?null:r.a.createElement("div",{className:"btn-group btn-group-header-refresh"},r.a.createElement("button",{className:"btn btn-header-refresh dropdown-toggle",disabled:this.state.isLoading,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("ul",{className:"dropdown-menu"},r.a.createElement("li",null,r.a.createElement("a",{href:"#",onClick:this.refreshAll,className:this.state.isLoading?" disabled":""},"Refresh All")),r.a.createElement("li",null,r.a.createElement(R.a,{to:e,className:this.state.isLoading?" disabled":""},"More Options")))),this.state.isRefreshProgressVisible?r.a.createElement(H,{percentage:this.state.refreshProgressPercentage,description:this.state.refreshProgressDescription,title:"Refresh Progress",isLoading:this.state.isLoading}):null,r.a.createElement("ul",{className:"home-menu"},V.get(j.UI_BUTTON_CALL_LIST)?r.a.createElement("li",{className:"wow fadeInLeft","data-wow-delay":"0.2s"},r.a.createElement(R.a,{className:"btn btn-outline-white btn-round-lg btn-lg",to:"/calls"},r.a.createElement("h1",null,r.a.createElement("i",{className:"fa fa-list-ul"}),r.a.createElement("strong",null,"My Call List")))):null,r.a.createElement("li",{className:"wow fadeInLeft","data-wow-delay":"0.2s"},r.a.createElement(R.a,{className:"btn btn-outline-white btn-round-lg btn-lg",to:"/sales"},r.a.createElement("h1",null,r.a.createElement("i",{className:"fa fa-shopping-cart"}),r.a.createElement("strong",null,"My Sales")))),r.a.createElement("li",{className:"wow fadeInLeft","data-wow-delay":"0.2s"},r.a.createElement(R.a,{className:"btn btn-outline-white btn-round-lg btn-lg",to:"/info"},r.a.createElement("h1",null,r.a.createElement("i",{className:"fa fa-info-circle"}),r.a.createElement("strong",null,"My Information")))),V.get(j.UI_BUTTON_LIBRARY)?r.a.createElement("li",{className:"wow fadeInLeft","data-wow-delay":"0.2s"},r.a.createElement(R.a,{className:"btn btn-outline-white btn-round-lg btn-lg",to:"/library"},r.a.createElement("h1",null,r.a.createElement("i",{className:"fa fa-cloud"}),r.a.createElement("strong",null,"Library")))):null))}}]),a}(r.a.Component),J=z,Y=a(7),Q=r.a.createClass({displayName:"NotFoundPage",componentWillMount:function(){Y.setScreenTitle("Not Found")},render:function(){return r.a.createElement("div",null,r.a.createElement("h1",null,"Page Not Found"),r.a.createElement("p",null,"Please make a selection from the menu above."))}}),X=Q,$=a(42),Z=a(9),ee=a(64),te=a(254),ae=a(7),se=a(17),re=r.a.createClass({displayName:"LoginPage",getInitialState:function(){return{info:{username:"",password:""},isLoading:!1,differentUserWillBeLoggedIn:!1,redirectToReferrer:ae.isLoggedIn()}},componentDidMount:function(){ee.addChangeListener(this._onChange)},componentWillUnmount:function(){ee.removeChangeListener(this._onChange)},_onChange:function(){var e=ee.getStatus();e==Z.OK?(se.success("Welcome "+ee.getName()),this.setState({redirectToReferrer:!0})):e==Z.PENDING?this.setState({isLoading:!0}):e==Z.ERROR&&(this.setState({isLoading:!1}),se.error(ee.getLoginError()))},setLoginInfo:function(e){var t=e.target.name,a=e.target.value;return this.state.info[t]=a,this.setState({info:this.state.info})},loginFormIsValid:function(){var e=!0;return this.state.info.username.length&&this.state.info.password.length||(e=!1),e},loginUserHasChanged:function(){var e=!1,t=ee.getLastUser();return null!=t&&t.username!=this.state.info.username&&(e=!0),e},login:function(e){if(e.preventDefault(),!this.state.isLoading){if(!this.loginFormIsValid())return void se.error("Please complete both fields");if(!this.state.differentUserWillBeLoggedIn&&this.loginUserHasChanged())return se.warning("If you login as a different user, any existing user data will be deleted"),void this.setState({differentUserWillBeLoggedIn:!0});$.login(this.state.info,this.state.differentUserWillBeLoggedIn)}},cancelDifferentUserLogin:function(){this.state.isLoading||this.setState({differentUserWillBeLoggedIn:!1})},render:function(){if(this.state.redirectToReferrer){var e=(this.props.location.state&&this.props.location.state.from?this.props.location.state.from:null)||{pathname:"/"};return r.a.createElement(S.a,{to:e})}return r.a.createElement("div",{className:"login-wrap"},r.a.createElement(te,{info:this.state.info,onChange:this.setLoginInfo,onLogin:this.login,onCancel:this.cancelDifferentUserLogin,isLoading:this.state.isLoading,differentUserWillBeLoggedIn:this.state.differentUserWillBeLoggedIn}))}}),ne=re,ie=a(10),oe=a(15),le=a(9),ce=a(42),ue=a(43),de=a(7),me=a(17),he=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=ue.getStatus(oe.USER_PASSWORD_RESET_REQUEST);e==le.OK?(s.setState({isLoading:!1,done:!0}),me.success("Password reset requested")):e==le.PENDING?s.setState({isLoading:!0}):e==le.ERROR&&(s.setState({isLoading:!1}),me.error("Unable to request a password reset. Please check that your email is correct or contact your administrator.",null,{timeOut:5e3}))},s.setEmail=function(e){return s.state.email=e.target.value,s.setState({email:s.state.email})},s.formIsValid=function(){return s.state.email.length},s.requestPasswordReset=function(e){if(e.preventDefault(),!s.state.isLoading){if(!s.formIsValid())return void me.error("Please provide your email address");ce.requestPasswordReset(s.state.email)}},s.state={email:"",done:!1,isLoading:!1},s}return Object(l.a)(a,[{key:"componentDidMount",value:function(){ue.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){ue.removeChangeListener(this._onChange)}},{key:"render",value:function(){return this.state.done?r.a.createElement(S.a,{push:!0,to:"/login"}):r.a.createElement("div",{className:"login-wrap"},r.a.createElement("form",{className:"login-form"},r.a.createElement("div",{className:"user-login-info"},r.a.createElement("img",{className:"login-img",src:de.assetsUrl+"img/morpheus-m.png"}),r.a.createElement("div",{className:"login-instructions"},"Provide your email to request a password reset"),r.a.createElement("div",{className:"login-input"},r.a.createElement("input",{type:"email",className:"form-control",name:"username",placeholder:"Email",value:this.state.email,onChange:this.setEmail,autoFocus:!0,autoComplete:"off",disabled:this.state.isLoading})),r.a.createElement("div",{className:"login-footer"},r.a.createElement("div",{className:"btn-group",role:"group"},r.a.createElement(R.a,{className:"btn btn-default",role:"button",to:"/login"},"Cancel"),r.a.createElement("button",{type:"submit",className:"btn btn-primary",onClick:this.requestPasswordReset,disabled:this.state.isLoading},"Request Password Reset"))),r.a.createElement(ie.a,{isVisible:this.state.isLoading})),r.a.createElement("img",{className:"login-img-footer",src:de.assetsUrl+"img/morpheus-brand-pb.png"})))}}]),a}(r.a.Component),pe=he,ge=a(7),fe=a(25),Ee=a(43),Se=a(69),Ce=a(20),ye=a(44),Re=a(27),be=a(26),_e=a(65),ve=a(37),Ne=a(15),Te=a(9),Oe=a(54),Le=a(55),De=a(255),Ie=a(143),Ae=a(78),Pe=a(22),xe=a(21),Ue=a(17),Fe=a(13),we=r.a.createClass({displayName:"CallsPage",getInitialState:function(){return{calls:fe.getAllCalls(),isLoading:!1,isRefreshProgressVisible:!1,refreshProgressPercentage:0,refreshProgressDescription:"",customerSearchTerm:"",customerSearchPage:1,customerSearchPageSize:null,customerSearchTotal:null,customerSearchTotalPages:null,customerSearchResults:[],isCustomerSearchLoading:!1,isCustomerRequestLoading:!1,isCustomerRequestVisible:!1,customerWasRequested:!1,auditsToSubmit:!1}},componentWillMount:function(){this.lastPendingAction=null,this.progressDescriptions={},this.progressDescriptions.default="Refreshing",this.progressDescriptions[ve.PAYMENT_TERM]="Refreshing payment terms",this.progressDescriptions[ve.TAX_CLASS]="Refreshing tax classes",this.progressDescriptions[ve.CARRIER]="Refreshing carriers",this.progressDescriptions[ve.CURRENCY]="Refreshing currencies",this.progressDescriptions[ve.PRODUCT]="Refreshing products",this.progressDescriptions[ve.CATEGORY]="Refreshing categories",this.progressDescriptions[ve.ORDER]="Refreshing orders",this.progressDescriptions[ve.CUSTOMER]="Refreshing customers",this.progressDescriptions[ve.PRICE_LIST]="Refreshing price lists",this.progressDescriptions[ve.PRODUCT_RULE]="Refreshing product rules",this.completionMessages={},this.completionMessages[Ne.CALLS_RELATED_REFRESH]={},this.completionMessages[Ne.CALLS_RELATED_REFRESH][Te.OK]="Call list and related data refreshed",this.completionMessages[Ne.CALLS_RELATED_REFRESH][Te.ERROR]="Unable to refresh call list and related data",this.completionMessages[Ne.CALLS_RELATED_REFRESH][Te.PARTIAL]="Unable to refresh all call list related data",this.completionMessages[Ne.ALL_REFRESH]={},this.completionMessages[Ne.ALL_REFRESH][Te.OK]="Sales and calls data refreshed",this.completionMessages[Ne.ALL_REFRESH][Te.ERROR]="Unable to refresh sales and calls data",this.completionMessages[Ne.ALL_REFRESH][Te.PARTIAL]="Unable to refresh all sales and calls data",this.screenTitle="My Call List",ge.setScreenTitle(this.screenTitle),ge.refreshGeolocation()},componentDidMount:function(){fe.addChangeListener(this._onChange),Ee.addChangeListener(this._onRefreshChange),Se.addChangeListener(this._onAuditSubmitChange),Ce.addChangeListener(this._onCustomerSearchChange),this.refreshAuditSubmissionStatusIndicator(),ge.isBeforeToday(fe.getLastRefresh())&&(this.lastPendingAction=Ne.CALLS_RELATED_REFRESH,be.refreshCallsAndRelatedData())},componentWillUnmount:function(){fe.removeChangeListener(this._onChange),Ee.removeChangeListener(this._onRefreshChange),Se.removeChangeListener(this._onAuditSubmitChange),Ce.removeChangeListener(this._onCustomerSearchChange)},_onChange:function(){var e=fe.getStatus();e==Te.OK||e==Te.PARTIAL?this.setState({calls:fe.getAllCalls()}):e==Te.PENDING||Te.ERROR},_onRefreshChange:function(){var e=Ee.getStatus(this.lastPendingAction),t=Ee.getEntityStatuses(this.lastPendingAction),a=Ee.getPercentageComplete(this.lastPendingAction);if(e==Te.PENDING){var s="default";if(null!=t)for(var r in t)if(t[r]==Te.PENDING){s=r;break}this.setState({isLoading:!0,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:this.progressDescriptions[s]+" ("+Math.round(a)+"%)"})}else this.setState({isLoading:!1,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:"Complete ("+Math.round(a)+"%)"}),setTimeout(this.closeRefreshProgressModal,1e3),null!=this.lastPendingAction&&null!=this.completionMessages[this.lastPendingAction]&&(e==Te.OK?Ue.success(this.completionMessages[this.lastPendingAction][Te.OK]):e==Te.ERROR?Ue.error(this.completionMessages[this.lastPendingAction][Te.ERROR]):e==Te.PARTIAL&&Ue.warning(this.completionMessages[this.lastPendingAction][Te.PARTIAL]))},_onAuditSubmitChange:function(){var e=Se.getStatus(),t=Se.getStatusAuditType();e==Te.OK?(Ue.success((t==Oe.ADMIN?"Admin audits":"Audits")+" submitted"),this.setState({isLoading:!1}),this.refreshAuditSubmissionStatusIndicator()):e==Te.PENDING?this.setState({isLoading:!0}):e==Te.ERROR?(Ue.error("Unable to submit "+(t==Oe.ADMIN?"admin audits":"audits")),this.setState({isLoading:!1})):e==Te.PARTIAL&&(Ue.warning("Unable to submit all "+(t==Oe.ADMIN?"admin audits":"audits")),this.setState({isLoading:!1}),this.refreshAuditSubmissionStatusIndicator())},_onCustomerSearchChange:function(){var e=Ce.getStatus(Ne.CUSTOMERS_SEARCH_SERVER),t=Ce.getStatus(Ne.CUSTOMER_REQUEST)==Te.PENDING,a=Ce.wasRequestSuccessful();e==Te.OK?this.setState({isCustomerRequestLoading:t,customerWasRequested:a,isCustomerSearchLoading:!1,customerSearchTerm:Ce.getSearchTerm(Le.SERVER),customerSearchPage:Ce.getSearchPage(Le.SERVER),customerSearchPageSize:Ce.getSearchPageSize(Le.SERVER),customerSearchTotal:Ce.getSearchTotal(Le.SERVER),customerSearchTotalPages:Ce.getSearchTotalPages(Le.SERVER),customerSearchResults:Ce.getSearchResults(Le.SERVER)}):e==Te.PENDING?this.setState({isCustomerRequestLoading:t,customerWasRequested:a,isCustomerSearchLoading:!0,customerSearchTerm:Ce.getSearchTerm(Le.SERVER),customerSearchPage:Ce.getSearchPage(Le.SERVER)}):e==Te.ERROR&&this.setState({isCustomerRequestLoading:t,customerWasRequested:a,isCustomerSearchLoading:!1,customerSearchTerm:Ce.getSearchTerm(Le.SERVER),customerSearchPage:Ce.getSearchPage(Le.SERVER)})},refreshCalls:function(e){null!=e&&e.preventDefault(),this.state.isLoading||(this.lastPendingAction=Ne.CALLS_RELATED_REFRESH,be.refreshCallsAndRelatedData())},refreshAll:function(e){if(null!=e&&e.preventDefault(),!this.state.isLoading){this.lastPendingAction=Ne.ALL_REFRESH;var t=Fe.union(Ce.getCustomerIDs(),fe.getCallCustomerIDs(),Re.getOrderCustomerIDs());_e.refreshAll(ye.getLastRefresh(),ye.getRefreshRetryIDs(),Re.getPastOrdersLastRefresh(),Re.getPastOrdersRefreshRetryIDs(),t)}},showCustomerRequestList:function(){this.state.isLoading||this.setState({isCustomerRequestVisible:!0,customerSearchTerm:"",customerSearchPage:1,customerSearchTotalPages:null,customerSearchResults:[]})},hideCustomerRequestList:function(){this.state.isLoading||(this.state.customerWasRequested&&this.refreshCalls(),this.setState({isCustomerRequestVisible:!1,customerWasRequested:!1}),Ce.resetRequestSuccessful())},searchCustomers:function(e,t){this.lastPendingAction=Ne.CUSTOMERS_SEARCH_SERVER,be.searchCustomersOnServer(e,t)},requestCustomer:function(e){this.state.isCustomerSearchLoading||(this.lastPendingAction=Ne.CUSTOMER_REQUEST,be.requestCustomer(e))},submitAudits:function(){if(!this.state.isLoading){var e=Se.getAuditSubmissions(),t=Se.getAuditSubmissions(!0);if(!e.length&&!t.length)return void Ue.success("No audits to submit");this.lastPendingAction=Ne.AUDITS_SUBMIT,be.submitAuditsAndRelatedData(e,t,Ce.getValidCustomerVisits())}},refreshAuditSubmissionStatusIndicator:function(){var e=Se.getAuditSubmissions(),t=Se.getAuditSubmissions(!0);this.setState({auditsToSubmit:e.length>0||t.length>0})},closeRefreshProgressModal:function(){this.setState({isRefreshProgressVisible:!1})},render:function(){var e={pathname:"/refresh",state:{from:this.props.location,fromTitle:this.screenTitle}};return r.a.createElement("div",null,xe.get(Pe.FUNC_ONLINE_CUSTOMERS)?r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshCalls,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})):r.a.createElement("div",{className:"btn-group btn-group-header-refresh"},r.a.createElement("button",{className:"btn btn-header-refresh dropdown-toggle",disabled:this.state.isLoading,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("ul",{className:"dropdown-menu"},r.a.createElement("li",null,r.a.createElement("a",{href:"#",onClick:this.refreshCalls,className:this.state.isLoading?" disabled":""},"Refresh Calls")),r.a.createElement("li",null,r.a.createElement("a",{href:"#",onClick:this.refreshAll,className:this.state.isLoading?" disabled":""},"Refresh All")),r.a.createElement("li",null,r.a.createElement(R.a,{to:e,className:this.state.isLoading?" disabled":""},"More Options")))),r.a.createElement("button",{className:"btn btn-header-submit",onClick:this.submitAudits,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-upload fa-2x"}),this.state.auditsToSubmit?r.a.createElement("i",{className:"fa fa-circle icon-badge"}):null),r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement("button",{className:"btn btn-primary col-xs-12",onClick:this.showCustomerRequestList,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-user-plus"})," Request Customer")),this.state.isRefreshProgressVisible?r.a.createElement(Ae,{percentage:this.state.refreshProgressPercentage,description:this.state.refreshProgressDescription,title:"Refresh Progress",isLoading:this.state.isLoading}):null,this.state.isCustomerRequestVisible?r.a.createElement(Ie,{searchTerm:this.state.customerSearchTerm,searchPage:this.state.customerSearchPage,searchPageSize:this.state.customerSearchPageSize,searchTotal:this.state.customerSearchTotal,searchTotalPages:this.state.customerSearchTotalPages,searchResults:this.state.customerSearchResults,onSearch:this.searchCustomers,onRequest:this.requestCustomer,onFinish:this.hideCustomerRequestList,isLoading:this.state.isCustomerSearchLoading||this.state.isCustomerRequestLoading}):null,r.a.createElement(De,{calls:this.state.calls,isLoading:this.state.isLoading}))}}),Me=we,ke=a(25),qe=a(20),Be=a(27),He=a(15),je=a(9),Ve=a(26),Ge=a(30),Ke=a(22),We=a(21),ze=a(7),Je=a(17),Ye=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onOrderChange=function(){var e=Be.getOrder(s.state.order.id);null!=e&&s.setState({order:e,orderWithCustomerCreated:null!=e.customer_id&&e.customer_id>0})},s._onCustomerRefreshChange=function(){var e=qe.getStatus(He.CUSTOMER_REFRESH);if(e==je.OK||e==je.PARTIAL){Je.success(e==je.OK?"Customer information refreshed":"Unable to refresh all customer information");var t=qe.getCustomer(s.props.match.params.id);null!=t&&(s.screenTitle=t.name,ze.setScreenTitle(s.screenTitle))}else e==je.ERROR&&Je.error("Unable to refresh customer information");s.setState((function(t){return{isCustomerRefreshLoading:e==je.PENDING}}))},s.enterCustomer=function(){Ge.enterCustomer(s.props.match.params.id),s.setState({isCustomerVisited:qe.isCustomerVisited(s.props.match.params.id)})},s.exitCustomer=function(){Ge.exitCustomer(s.props.match.params.id),s.setState({customerExited:!0})},s.createOrderWithCustomer=function(){var e=qe.getCustomer(s.props.match.params.id);if(null!=e)if(e.is_approved_for_orders){s.state.order.customer_id=e.id,s.state.order.customer_name=e.name,s.state.order.expected_date=null!=e.default_lead_time?ze.getUnixTimeStartOfDay()+86400*e.default_lead_time:null,s.state.order.payment_terms_id=null==s.state.order.payment_terms_id&&null!=e.payment_term?e.payment_term:s.state.order.payment_terms_id;var t=Be.getCurrencyOrDefault(e.default_currency_id);s.state.order.currency_id=t.id,s.state.order.currency_display_name=t.name,s.state.order.currency_display_symbol=t.symbol,s.state.order.billing_location_id=0,s.state.order.shipping_location_id=0,Ge.saveOrder(s.state.order)}else Je.warning("This customer is not approved to place orders");else Je.warning("This customer has missing sales data: please refresh your Calls or Sales")},s.state={isCustomerVisited:!1,isCallCustomer:!1,order:Be.getOrder(),orderWithCustomerCreated:!1,customerCreationRedirection:!1,customerExited:!1,isCustomerRefreshLoading:!1},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){this.screenTitle="Customer";var e=this.props.match.params.id;if(e)if("new"==e&&"sales/customers"==this.props.match.params.area)this.setState({customerCreationRedirection:!0});else{var t=ke.getCallById(e);if(null!=t)this.setState({isCallCustomer:!0}),this.screenTitle=t.store_name;else{this.setState({isCallCustomer:!1});var a=qe.getCustomer(e);null!=a&&(this.screenTitle=a.name)}this.setState({isCustomerVisited:qe.isCustomerVisited(e)})}ze.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){Be.addChangeListener(this._onOrderChange),qe.addChangeListener(this._onCustomerRefreshChange);var e=this.props.match.params.id;"new"!=e&&We.get(Ke.FUNC_ONLINE_CUSTOMERS)&&ze.isBeforeToday(qe.getLastRefreshForCustomer(e))&&Ve.doAfterAccessCheck("refreshCustomer",[e])}},{key:"componentWillUnmount",value:function(){Be.removeChangeListener(this._onOrderChange),qe.removeChangeListener(this._onCustomerRefreshChange)}},{key:"render",value:function(){return this.state.customerCreationRedirection?r.a.createElement(S.a,{push:!0,to:"/sales/customers/new/editdetails"}):this.state.orderWithCustomerCreated?r.a.createElement(S.a,{push:!0,to:"/sales/orders/"+this.state.order.id}):this.state.customerExited?r.a.createElement(S.a,{push:!0,to:"/"+this.props.match.params.area}):r.a.createElement("div",null,r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6",role:"button",to:"/"+this.props.match.params.area},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"calls"==this.props.match.params.area?"My Call List":"Customers")),this.state.isCustomerVisited?r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.exitCustomer,disabled:this.state.isCustomerRefreshLoading},r.a.createElement("i",{className:"fa fa-sign-out fa-rotate-180"})," ",r.a.createElement("strong",null,"Exit Customer")):r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.enterCustomer,disabled:this.state.isCustomerRefreshLoading},r.a.createElement("i",{className:"fa fa-sign-in"})," Enter Customer")),r.a.createElement("div",{className:"list-group list-group-spaced",style:{marginTop:"15px"}},r.a.createElement(ie.a,{isVisible:this.state.isCustomerRefreshLoading}),r.a.createElement(R.a,{to:"/"+this.props.match.params.area+"/"+this.props.match.params.id+"/info",className:"list-group-item"+(this.state.isCustomerRefreshLoading?" disabled":"")},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-info-circle"})," Customer Information"),r.a.createElement("p",{className:"list-group-item-text"},"View customer details.")),this.state.isCallCustomer?r.a.createElement(R.a,{to:"/calls/"+this.props.match.params.id+"/audits",className:"list-group-item"+(this.state.isCustomerRefreshLoading?" disabled":"")},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-list-ul"})," Audits/Feedback"),r.a.createElement("p",{className:"list-group-item-text"},"View and perform customer audits for this call.")):null,We.get(Ke.UI_BUTTON_CUSTOMER_FILES)?r.a.createElement(R.a,{to:"/"+this.props.match.params.area+"/"+this.props.match.params.id+"/files",className:"list-group-item"+(this.state.isCustomerRefreshLoading?" disabled":"")},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-folder-open"})," Files"),r.a.createElement("p",{className:"list-group-item-text"},"View files for this customer.")):null,We.get(Ke.UI_BUTTON_CUSTOMER_COMMENTS)?r.a.createElement(R.a,{to:"/"+this.props.match.params.area+"/"+this.props.match.params.id+"/comments",className:"list-group-item"+(this.state.isCustomerRefreshLoading?" disabled":"")},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-comments"})," Comments"),r.a.createElement("p",{className:"list-group-item-text"},"View and add comments for this customer.")):null,r.a.createElement("button",{onClick:this.createOrderWithCustomer,className:"list-group-item"+(this.state.isCustomerRefreshLoading?" disabled":""),disabled:this.state.isCustomerRefreshLoading},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-shopping-cart"})," New Order"),r.a.createElement("p",{className:"list-group-item-text"},"Create a new order for this customer."))))}}]),a}(r.a.Component),Qe=Ye,Xe=a(26),$e=a(9),Ze=a(15),et=a(25),tt=a(20),at=a(256),st=a(7),rt=a(17),nt=a(13),it=r.a.createClass({displayName:"CustomerInfoPage",getInitialState:function(){return{customer:{id:0,name:""},customerFields:[],isLoading:!1,editsToSubmit:!1,editCancelled:!1,isNewCustomer:!1}},componentWillMount:function(){this.screenTitle="Customer Information",this.newCustomerID=null;var e=this.props.match.params.id;if(e){var t="new"==e||st.isLocalID(e),a={};if(t)a=tt.getEditedCustomer(e),this.screenTitle="New Customer";else{if(!(a=tt.getCustomer(e))){var s=et.getCallById(e);s||(s={store_id:0,store_name:""}),a={id:s.store_id,name:s.store_name}}this.screenTitle=a.name?a.name:this.screenTitle}this.setState({customer:a,isNewCustomer:t})}st.setScreenTitle(this.screenTitle),this.setState({customerFields:tt.getFields()})},componentDidMount:function(){if(this.refreshStatus=$e.OK,this.submitStatus=$e.OK,tt.addChangeListener(this._onChange),this.refreshEditSubmissionStatusIndicator(),!this.state.isNewCustomer){var e=st.isBeforeToday(tt.getLastRefreshForCustomer(this.state.customer.id)),t=st.isBeforeToday(tt.getLastRefreshForFields());(e||t)&&Xe.doAfterAccessCheck("refreshCustomer",[this.state.customer.id,t])}},componentWillUnmount:function(){tt.removeChangeListener(this._onChange)},_onChange:function(){var e=tt.getStatus(Ze.CUSTOMER_REFRESH),t=tt.getStatus(Ze.CUSTOMER_EDITS_SUBMIT);if(this.refreshStatus!=e)if(this.refreshStatus=e,this.refreshStatus==$e.OK||this.refreshStatus==$e.PARTIAL){var a=null!=this.newCustomerID&&this.newCustomerID>0,s=tt.getCustomer(a?this.newCustomerID:this.state.customer.id);this.newCustomerID=null,this.screenTitle=s.name?s.name:"Customer Information",st.setScreenTitle(this.screenTitle),this.setState({isLoading:!1,isNewCustomer:!1,customer:s,customerFields:tt.getFields()}),rt.success(this.refreshStatus==$e.OK?"Customer information refreshed":"Unable to refresh all customer information")}else this.refreshStatus==$e.PENDING?this.setState({isLoading:!0}):this.refreshStatus==$e.ERROR&&(this.setState({isLoading:!1}),rt.error("Unable to refresh customer information"));this.submitStatus!=t&&(this.submitStatus=t,this.submitStatus==$e.OK||this.submitStatus==$e.PARTIAL?(this.state.isNewCustomer&&(this.newCustomerID=tt.getCustomerLastCreated()),this.setState({isLoading:!1}),rt.success(this.submitStatus==$e.OK?"Customer edits submitted":"Unable to submit all customer edits"),this.refreshEditSubmissionStatusIndicator()):this.submitStatus==$e.PENDING?this.setState({isLoading:!0}):this.submitStatus==$e.ERROR&&(this.setState({isLoading:!1}),rt.error("Unable to submit customer edits")))},refreshDetails:function(){this.state.isLoading||Xe.doAfterAccessCheck("refreshCustomer",[this.state.customer.id,st.isBeforeToday(tt.getLastRefreshForFields())])},submitEdits:function(){if(!this.state.isLoading){var e=tt.getCustomerEdits(this.state.customer.id);if(nt.isEmpty(e))return void rt.success("No customer edits to submit");if(this.state.isNewCustomer&&nt.isEmpty(e.details))return void rt.error("Please provide a Company Name");Xe.submitCustomerEdits(this.state.customer.id,e)}},refreshEditSubmissionStatusIndicator:function(){var e=tt.getCustomerEdits(this.state.customer.id);this.setState({editsToSubmit:!nt.isEmpty(e)})},cancelCustomerEdit:function(){Xe.cancelCustomerEdit(this.state.customer.id),this.setState({editCancelled:!0})},render:function(){return this.state.editCancelled?r.a.createElement(S.a,{to:"/"+this.props.match.params.area}):r.a.createElement("div",null,this.state.isNewCustomer?null:r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshDetails,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),this.state.editsToSubmit?r.a.createElement("button",{className:"btn btn-header-submit"+(this.state.isNewCustomer?" right-align":""),onClick:this.submitEdits,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-upload fa-2x"}),r.a.createElement("i",{className:"fa fa-circle icon-badge"})):null,r.a.createElement("div",{className:"btn-bar",role:"group"},this.state.isNewCustomer?r.a.createElement("button",{className:"btn btn-primary col-xs-12",onClick:this.cancelCustomerEdit},r.a.createElement("i",{className:"fa fa-close"})," Cancel"):r.a.createElement(R.a,{className:"btn btn-primary col-xs-12"+(this.state.isLoading?" disabled":""),role:"button",to:"/"+this.props.match.params.area+"/"+this.state.customer.id},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"Customer"))),r.a.createElement("h1",{className:"sub-button-heading"},"Customer Information"),r.a.createElement(at,{customer:this.state.customer,customerFields:this.state.customerFields,customerEditBaseURL:"/"+this.props.match.params.area+"/"+this.state.customer.id,isLoading:this.state.isLoading}))}}),ot=it,lt=a(26),ct=(a(9),a(257)),ut=a(20),dt=a(7),mt=a(17),ht=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){s.setState({customerEdits:ut.getCustomerDetailsEdits(s.state.customer.id)})},s.customerIsLoaded=function(){return null!=s.state.customer.id&&(s.state.customer.id>0||dt.isLocalID(s.state.customer.id))},s.customerEditsAreValid=function(){return null!=s.state.customerEdits.name&&""!=s.state.customerEdits.name},s.saveCustomerDetailsEdit=function(e){lt.saveCustomerDetailsEdit(s.state.customer.id,e)},s.completeCustomerDetailsEdit=function(){s.customerEditsAreValid()?(lt.completeCustomerDetailsEdit(s.state.customer.id,s.state.customerEdits),s.setState({editCompleted:!0})):mt.error("Please provide a Company Name")},s.cancelCustomerDetailsEdit=function(){lt.cancelCustomerDetailsEdit(s.state.customer.id),s.setState({editCompleted:!0})},s.screenTitle="Edit Customer Details";var r={id:0,name:""},n={},i=e.match.params.id;return i&&("new"==i||dt.isLocalID(i)?("new"==i&&(i=ut.getNewID()),r={id:i,name:"New Customer"}):r=ut.getCustomer(i)||{id:0,name:""},n=ut.getCustomerDetailsEdits(i)||{}),s.state={customer:r,customerEdits:n,customerFields:ut.getFields(),editCompleted:!1},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){this.customerIsLoaded()&&(this.screenTitle=this.state.customer.name),dt.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){ut.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){ut.removeChangeListener(this._onChange)}},{key:"render",value:function(){return this.state.editCompleted?r.a.createElement(S.a,{push:!0,to:"/"+this.props.match.params.area+"/"+this.state.customer.id+"/info"}):r.a.createElement("div",null,r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.cancelCustomerDetailsEdit},r.a.createElement("i",{className:"fa fa-close"})," Cancel"),r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.completeCustomerDetailsEdit},r.a.createElement("i",{className:"fa fa-check"})," Done")),r.a.createElement("h1",{className:"sub-button-heading"},"Edit Customer Details"),r.a.createElement(ct,{customerEdits:this.state.customerEdits,customerFields:this.state.customerFields,onSave:this.saveCustomerDetailsEdit,onComplete:this.completeCustomerDetailsEdit,onCancel:this.cancelCustomerDetailsEdit}))}}]),a}(r.a.Component),pt=ht,gt=a(26),ft=(a(9),a(258)),Et=a(20),St=a(7),Ct=a(17),yt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){s.setState({customerEdits:Et.getCustomerLocationsEdits(s.state.customer.id),focusLocationID:Et.getCustomerLocationLastEdited(s.state.customer.id)})},s.customerIsLoaded=function(){return null!=s.state.customer.id&&(s.state.customer.id>0||St.isLocalID(s.state.customer.id))},s.customerEditsAreValid=function(){for(var e in s.state.customerEdits)if((null==s.state.customerEdits[e].description||""==s.state.customerEdits[e].description)&&(null==s.state.customerEdits[e].address_1||""==s.state.customerEdits[e].address_1))return!1;return!0},s.addCustomerLocation=function(){gt.addCustomerLocation(s.state.customer.id)},s.saveCustomerLocationsEdit=function(e,t){gt.saveCustomerLocationsEdit(s.state.customer.id,e,t)},s.completeCustomerLocationsEdit=function(){s.customerEditsAreValid()?(gt.completeCustomerLocationsEdit(s.state.customer.id,s.state.customerEdits),s.setState({editCompleted:!0})):Ct.error("Please provide at least Description or Address 1 for every location")},s.cancelCustomerLocationsEdit=function(){gt.cancelCustomerLocationsEdit(s.state.customer.id),s.setState({editCompleted:!0})},s.screenTitle="Edit Customer Locations";var r={id:0,name:""},n={},i=null,l=e.match.params.id;return l&&("new"==l||St.isLocalID(l)?("new"==l&&(l=Et.getNewID()),r={id:l,name:"New Customer"}):r=Et.getCustomer(l)||{id:0,name:""},n=Et.getCustomerLocationsEdits(l)||{},i=Et.getCustomerLocationLastEdited(l)),s.state={customer:r,customerEdits:n,customerFields:Et.getLocationFields(),editCompleted:!1,focusLocationID:i},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){this.customerIsLoaded()&&(this.screenTitle=this.state.customer.name),St.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){Et.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){Et.removeChangeListener(this._onChange)}},{key:"render",value:function(){return this.state.editCompleted?r.a.createElement(S.a,{push:!0,to:"/"+this.props.match.params.area+"/"+this.state.customer.id+"/info"}):r.a.createElement("div",null,r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.cancelCustomerLocationsEdit},r.a.createElement("i",{className:"fa fa-close"})," Cancel"),r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.addCustomerLocation},r.a.createElement("i",{className:"fa fa-plus"})," Add Location"),r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.completeCustomerLocationsEdit},r.a.createElement("i",{className:"fa fa-check"})," Done")),r.a.createElement("h1",{className:"sub-button-heading"},"Edit Customer Locations"),r.a.createElement(ft,{customerEdits:this.state.customerEdits,customerFields:this.state.customerFields,onSave:this.saveCustomerLocationsEdit,onComplete:this.completeCustomerLocationsEdit,onCancel:this.cancelCustomerLocationsEdit,focusItemID:this.state.focusLocationID}))}}]),a}(r.a.Component),Rt=yt,bt=a(26),_t=(a(9),a(259)),vt=a(20),Nt=a(7),Tt=a(17),Ot=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){s.setState({customerEdits:vt.getCustomerContactsEdits(s.state.customer.id),focusContactID:vt.getCustomerContactLastEdited(s.state.customer.id)})},s.customerIsLoaded=function(){return null!=s.state.customer.id&&(s.state.customer.id>0||Nt.isLocalID(s.state.customer.id))},s.customerEditsAreValid=function(){for(var e in s.state.customerEdits)if(null==s.state.customerEdits[e].first_name||""==s.state.customerEdits[e].first_name)return!1;return!0},s.addCustomerContact=function(){bt.addCustomerContact(s.state.customer.id)},s.saveCustomerContactsEdit=function(e,t){bt.saveCustomerContactsEdit(s.state.customer.id,e,t)},s.completeCustomerContactsEdit=function(){s.customerEditsAreValid()?(bt.completeCustomerContactsEdit(s.state.customer.id,s.state.customerEdits),s.setState({editCompleted:!0})):Tt.error("Please provide at least First Name for every contact")},s.cancelCustomerContactsEdit=function(){bt.cancelCustomerContactsEdit(s.state.customer.id),s.setState({editCompleted:!0})},s.screenTitle="Edit Customer Contacts";var r={id:0,name:""},n={},i=null,l=e.match.params.id;return l&&("new"==l||Nt.isLocalID(l)?("new"==l&&(l=vt.getNewID()),r={id:l,name:"New Customer"}):r=vt.getCustomer(l)||{id:0,name:""},n=vt.getCustomerContactsEdits(l)||{},i=vt.getCustomerContactLastEdited(l)),s.state={customer:r,customerEdits:n,customerFields:vt.getContactFields(),editCompleted:!1,focusContactID:i},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){this.customerIsLoaded()&&(this.screenTitle=this.state.customer.name),Nt.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){vt.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){vt.removeChangeListener(this._onChange)}},{key:"render",value:function(){return this.state.editCompleted?r.a.createElement(S.a,{push:!0,to:"/"+this.props.match.params.area+"/"+this.state.customer.id+"/info"}):r.a.createElement("div",null,r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.cancelCustomerContactsEdit},r.a.createElement("i",{className:"fa fa-close"})," Cancel"),r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.addCustomerContact},r.a.createElement("i",{className:"fa fa-plus"})," Add Contact"),r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.completeCustomerContactsEdit},r.a.createElement("i",{className:"fa fa-check"})," Done")),r.a.createElement("h1",{className:"sub-button-heading"},"Edit Customer Contacts"),r.a.createElement(_t,{customerEdits:this.state.customerEdits,customerFields:this.state.customerFields,onSave:this.saveCustomerContactsEdit,onComplete:this.completeCustomerContactsEdit,onCancel:this.cancelCustomerContactsEdit,focusItemID:this.state.focusContactID}))}}]),a}(r.a.Component),Lt=Ot,Dt=a(66),It=(a(26),a(30)),At=a(9),Pt=a(67),xt=a(69),Ut=a(25),Ft=a(260),wt=a(7),Mt=a(17),kt=r.a.createClass({displayName:"AuditsPage",getInitialState:function(){return{customer:{store_name:"",store_id:0},audits:[],answers:{completed:!1,submitted:!1},isLoading:!1,callCompleted:!1}},componentWillMount:function(){this.screenTitle="Audits/Feedback";var e=this.props.match.params.id;if(e){var t=Ut.getCallById(e);this.setState({customer:t,audits:Pt.getAudits(t.audits),answers:xt.getAuditAnswersForCustomer(e)}),this.screenTitle=null!=t?t.store_name:this.screenTitle}wt.setScreenTitle(this.screenTitle),wt.refreshGeolocation()},componentDidMount:function(){Pt.addChangeListener(this._onChange),wt.isBeforeToday(Pt.getLastRefreshForCustomer(this.state.customer.store_id))&&Dt.doAfterAccessCheck("refreshAudits",[this.state.customer.store_id,this.state.customer.audits]),It.enterCustomer(this.state.customer.store_id)},componentWillUnmount:function(){Pt.removeChangeListener(this._onChange)},_onChange:function(){var e=Pt.getStatus();e==At.OK?(this.setState({isLoading:!1,audits:Pt.getAudits(this.state.customer.audits),answers:xt.getAuditAnswersForCustomer(this.state.customer.store_id)}),Mt.success("Audit list refreshed")):e==At.PENDING?this.setState({isLoading:!0}):e==At.ERROR?(this.setState({isLoading:!1,audits:Pt.getAudits(this.state.customer.audits),answers:xt.getAuditAnswersForCustomer(this.state.customer.store_id)}),Mt.error("Unable to refresh audit list")):e==At.PARTIAL&&(this.setState({isLoading:!1,audits:Pt.getAudits(this.state.customer.audits),answers:xt.getAuditAnswersForCustomer(this.state.customer.store_id)}),Mt.warning("Unable to obtain all audits"))},render:function(){return this.state.callCompleted?r.a.createElement(S.a,{push:!0,to:"/calls/"+this.state.customer.store_id}):r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshAudits,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isLoading?" disabled":""),role:"button",to:"/calls/"+this.state.customer.store_id},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"Customer")),r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.completeCall,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-check"})," Complete")),r.a.createElement("h1",{className:"sub-button-heading"},"Audits/Feedback"),r.a.createElement(Ft,{customerId:this.state.customer.store_id,audits:this.state.audits,answers:this.state.answers,isLoading:this.state.isLoading}))},refreshAudits:function(){this.state.isLoading||Dt.doAfterAccessCheck("refreshAudits",[this.state.customer.store_id,this.state.customer.audits])},callIsValid:function(){for(var e=!0,t=0,a=this.state.audits.length;t<a;t++)if(this.state.audits[t].meta_data.is_compulsory&&(!this.state.answers[this.state.audits[t].id]||!this.state.answers[this.state.audits[t].id].completed)){e=!1;break}return e},completeCall:function(){if(!this.state.isLoading){if(!this.callIsValid())return void Mt.error("Please complete all compulsory audits");It.exitCustomer(this.state.customer.store_id,!0),this.setState({callCompleted:!0})}}}),qt=a(66),Bt=(a(26),a(9)),Ht=a(67),jt=a(69),Vt=a(25),Gt=a(261),Kt=a(7),Wt=a(17),zt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=Ht.getStatus();e==Bt.OK?(s.setState({isLoading:!1,audits:Ht.getAudits(s.auditIDs,!0,!1),answers:jt.getAuditAnswersForCustomer(s.state.customer.store_id,!0)}),Wt.success("Audit list refreshed")):e==Bt.PENDING?s.setState({isLoading:!0}):e==Bt.ERROR?(s.setState({isLoading:!1,audits:Ht.getAudits(s.auditIDs,!0,!1),answers:jt.getAuditAnswersForCustomer(s.state.customer.store_id,!0)}),Wt.error("Unable to refresh audit list")):e==Bt.PARTIAL&&(s.setState({isLoading:!1,audits:Ht.getAudits(s.auditIDs,!0,!1),answers:jt.getAuditAnswersForCustomer(s.state.customer.store_id,!0)}),Wt.warning("Unable to obtain all audits"))},s.refreshAudits=function(){s.state.isLoading||qt.doAfterAccessCheck("refreshAudits",[s.state.customer.store_id,s.auditIDs,!0])},s.auditIDs=[],s.screenTitle="Admin Audits/Feedback";var r={store_name:"",store_id:0},n=[],i={completed:!0,submitted:!1},l=e.match.params.id;return l&&(r=Vt.getCallById(l)||r,s.auditIDs=Ht.getAdminAuditIDsForCustomer(l),n=Ht.getAudits(s.auditIDs,!0,!1),i=jt.getAuditAnswersForCustomer(l,!0),s.screenTitle=null!=r&&""!=r.store_name?r.store_name:s.screenTitle),s.state={customer:r,audits:n,answers:i,isLoading:!1},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){Kt.setScreenTitle(this.screenTitle),Kt.refreshGeolocation()}},{key:"componentDidMount",value:function(){Ht.addChangeListener(this._onChange),Kt.isBeforeToday(Ht.getLastRefreshForCustomer(this.state.customer.store_id,!0))&&qt.doAfterAccessCheck("refreshAudits",[this.state.customer.store_id,this.auditIDs,!0])}},{key:"componentWillUnmount",value:function(){Ht.removeChangeListener(this._onChange)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshAudits,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isLoading?" disabled":""),role:"button",to:"/calls/"+this.state.customer.store_id},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"Customer")),r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isLoading?" disabled":""),role:"button",to:"/calls/"+this.state.customer.store_id+"/audits"},r.a.createElement("i",{className:"fa fa-list-ul"})," Audits/Feedback")),r.a.createElement("h1",{className:"sub-button-heading"},"Admin Audits/Feedback"),r.a.createElement(Gt,{customerId:this.state.customer.store_id,audits:this.state.audits,answers:this.state.answers,isLoading:this.state.isLoading}))}}]),a}(r.a.Component),Jt=a(66),Yt=a(9),Qt=(a(76),a(262)),Xt=a(67),$t=a(69),Zt=a(25),ea=a(263),ta=a(269),aa=a(13),sa=a(7),ra=a(17),na=r.a.createClass({displayName:"AuditPage",getInitialState:function(){return{customer:{store_name:""},audit:{},answer:{weight:0,score:0,completed:!1},auditCompleted:!1}},componentWillMount:function(){this.blnAdmin=-1!=this.props.match.path.indexOf("adminaudits"),this.adminAuditIndex=this.blnAdmin?parseInt(this.props.match.params.aidx):null,this.screenTitle="Audit";var e=this.props.match.params.id;if(e){var t=Zt.getCallById(e);this.setState({customer:t}),this.screenTitle=null!=t?t.store_name:this.screenTitle}var a=this.props.match.params.aid;a&&(this.state.audit=Xt.getAudit(a,this.blnAdmin),this.state.answer=$t.getAuditAnswer(e,a,this.blnAdmin,this.adminAuditIndex),this.refreshAnswerVisibilityAndScore(),this.setState({audit:this.state.audit,answer:this.state.answer})),sa.setScreenTitle(this.screenTitle),sa.refreshGeolocation()},componentDidMount:function(){Xt.addChangeListener(this._onAuditChange),$t.addChangeListener(this._onAnswerChange)},componentWillUnmount:function(){Xt.removeChangeListener(this._onAuditChange),$t.removeChangeListener(this._onAnswerChange)},_onAuditChange:function(){var e=Xt.getStatus();e==Yt.OK?this.setState({audit:Xt.getAudit(this.state.audit.id,this.blnAdmin)}):e==Yt.PENDING||e==Yt.ERROR||e==Yt.PARTIAL&&this.setState({audit:Xt.getAudit(this.state.audit.id,this.blnAdmin)})},_onAnswerChange:function(){this.setState({answer:$t.getAuditAnswer(this.state.customer.store_id,this.state.audit.id,this.blnAdmin,this.adminAuditIndex)})},saveAnswer:function(e){this.signaturesArePresent()?ra.error("Remove signatures to make changes to this audit"):(this.state.answer[e.question_id]||(this.state.answer[e.question_id]={}),aa.assign(this.state.answer[e.question_id],e),this.refreshAnswerVisibilityAndScore())},refreshAnswerVisibilityAndScore:function(){for(var e=0,t=0,a=!1,s=!0,r=!0,n=0,i=this.state.audit.question_groups.length;n<i;n++){r=!0;for(var o=0,l=this.state.audit.question_groups[n].questions.length;o<l;o++){var c=this.state.audit.question_groups[n].questions[o];if(this.state.answer[c.id]||(this.state.answer[c.id]={answered:!1,correct:!1}),s&&r?c.is_dependant?this.state.answer[c.id].visible=a:this.state.answer[c.id].visible=!0:this.state.answer[c.id].visible=a&&c.is_dependant,this.state.answer[c.id].visible){if(c.correct_answer_action>0||c.incorrect_answer_action>0)if(a=!1,this.state.answer[c.id].answered&&this.state.answer[c.id].correct){if(c.correct_answer_action>0)switch(c.correct_answer_action){case Qt.HIDE_REMAINING:s=!1,a=!1;break;case Qt.SHOW_DEPENDENT:a=!0;break;case Qt.SHOW_DEPENDENT_HIDE_REMAINING_GROUP:a=!0,r=!1;break;case Qt.SHOW_DEPENDENT_HIDE_REMAINING:a=!0,s=!1}}else if(c.incorrect_answer_action>0)switch(c.incorrect_answer_action){case Qt.HIDE_REMAINING:s=!1,a=!1;break;case Qt.SHOW_DEPENDENT:a=!0;break;case Qt.SHOW_DEPENDENT_HIDE_REMAINING_GROUP:a=!0,r=!1;break;case Qt.SHOW_DEPENDENT_HIDE_REMAINING:a=!0,s=!1}c.is_compulsory&&c.weighting&&(e+=c.weighting,this.state.answer[c.id].answered&&this.state.answer[c.id].correct&&(t+=c.weighting))}else(c.correct_answer_action>0||c.incorrect_answer_action>0)&&(a=!1)}}this.state.answer.weight=e,this.state.answer.score=t,this.setState({answer:this.state.answer}),Jt.saveAuditAnswer(this.state.answer,this.blnAdmin)},saveSignatures:function(e){null!=this.state.answer.signatures&&(this.state.answer.signatures=[]),this.state.answer.signatures=e,this.setState({answer:this.state.answer}),Jt.saveAuditAnswer(this.state.answer,this.blnAdmin)},auditIsValid:function(){for(var e=!0,t=0,a=this.state.audit.question_groups.length;t<a;t++){for(var s=0,r=this.state.audit.question_groups[t].questions.length;s<r;s++)if(this.state.audit.question_groups[t].questions[s].is_compulsory&&(!this.state.answer[this.state.audit.question_groups[t].questions[s].id]||this.state.answer[this.state.audit.question_groups[t].questions[s].id].visible&&!this.state.answer[this.state.audit.question_groups[t].questions[s].id].answered)){e=!1;break}if(!e)break}if(e&&this.signaturesAreRequired())for(var n=0,i=this.state.audit.meta_data.signatures.length;n<i;n++)if(null==this.state.answer.signatures||null==this.state.answer.signatures[n]||null==this.state.answer.signatures[n].name||!this.state.answer.signatures[n].name.length||null==this.state.answer.signatures[n].file||!this.state.answer.signatures[n].file.length){e=!1;break}return this.state.answer.completed=e,this.setState({answer:this.state.answer}),Jt.saveAuditAnswer(this.state.answer,this.blnAdmin),e},completeAudit:function(){this.auditIsValid()?this.setState({auditCompleted:!0}):ra.error("Please complete all compulsory questions"+(this.signaturesAreRequired()?" and signatures":""))},signaturesAreRequired:function(){return null!=this.state.audit.meta_data&&null!=this.state.audit.meta_data.allow_signatures&&this.state.audit.meta_data.allow_signatures&&null!=this.state.audit.meta_data.signatures&&this.state.audit.meta_data.signatures.length},signaturesArePresent:function(){var e=!1;if(null!=this.state.answer.signatures&&this.state.answer.signatures.length)for(var t=0,a=this.state.answer.signatures.length;t<a;t++)if(null!=this.state.answer.signatures[t]&&null!=this.state.answer.signatures[t].name&&this.state.answer.signatures[t].name.length){e=!0;break}return e},render:function(){return this.state.auditCompleted?r.a.createElement(S.a,{push:!0,to:"/calls/"+this.state.customer.store_id+(this.blnAdmin?"/adminaudits":"/audits")}):r.a.createElement("div",null,r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-12",role:"button",to:"/calls/"+this.state.customer.store_id+(this.blnAdmin?"/adminaudits":"/audits")},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,this.blnAdmin?"Admin Audits/Feedback":"Audits/Feedback"))),r.a.createElement("h1",{className:"sub-button-heading",style:{marginBottom:0}},this.state.audit.name),r.a.createElement("div",{className:"text-primary pull-right small"},"* Compulsory"),r.a.createElement("div",{className:"clear"}),r.a.createElement("div",null,this.state.audit.question_groups.map((function(e){return r.a.createElement(ea,{key:e.id,group:e,auditAnswer:this.state.answer,onChange:this.saveAnswer})}),this)),this.signaturesAreRequired()?r.a.createElement(ta,{signatures:this.state.audit.meta_data.signatures,savedSignatures:null!=this.state.answer.signatures?this.state.answer.signatures:[],onChange:this.saveSignatures}):null,r.a.createElement("div",{className:"audit-footer"},r.a.createElement("button",{className:"btn btn-primary",onClick:this.completeAudit},r.a.createElement("i",{className:"fa fa-check"})," Complete")))}}),ia=a(25),oa=a(20),la=a(77),ca=a(103),ua=a(9),da=a(147),ma=a(17),ha=a(7),pa=r.a.createClass({displayName:"FilesPage",getInitialState:function(){return{customer:{id:0,name:""},categoryTree:la.getCategories(),categoryTreeCounts:{},isLoading:!1}},componentWillMount:function(){la.addChangeListener(this._onChange),this.screenTitle="Files";var e=this.props.match.params.id;if(e){var t=oa.getCustomer(e);if(null==t){t={id:0,name:""};var a=ia.getCallById(e);null!=a&&(t.id=a.store_id,t.name=a.store_name)}this.setState({customer:t,categoryTreeCounts:la.getCustomerCategoriesFileCounts(e)}),this.screenTitle=t.name.length?t.name:this.screenTitle}ha.setScreenTitle(this.screenTitle)},componentDidMount:function(){ha.isBeforeToday(la.getLastRefreshForKey(this.state.customer.id))&&ca.doAfterAccessCheck("refreshLibrary",[this.state.customer.id])},componentWillUnmount:function(){la.removeChangeListener(this._onChange)},_onChange:function(){var e=la.getStatus();e==ua.OK?(this.setState({isLoading:!1,categoryTree:la.getCategories(),categoryTreeCounts:la.getCustomerCategoriesFileCounts(this.state.customer.id)}),ma.success("Customer files refreshed")):e==ua.PENDING?this.setState({isLoading:!0}):e==ua.ERROR?(this.setState({isLoading:!1}),ma.error("Unable to refresh customer files")):e==ua.PARTIAL&&(this.setState({isLoading:!1,categoryTree:la.getCategories(),categoryTreeCounts:la.getCustomerCategoriesFileCounts(this.state.customer.id)}),ma.warning("Unable to refresh all customer files"))},refreshLibrary:function(){this.state.isLoading||ca.doAfterAccessCheck("refreshLibrary",[this.state.customer.id])},render:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshLibrary,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-12"+(this.state.isLoading?" disabled":""),role:"button",to:"/"+this.props.match.params.area+"/"+this.state.customer.id},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"Customer"))),r.a.createElement("h1",{className:"sub-button-heading"},"Files"),r.a.createElement(da,{categoryTree:this.state.categoryTree,categoryTreeCounts:this.state.categoryTreeCounts,assignmentKey:this.state.customer.id,filterTopCategoryId:ha.customerLibraryCategoryID,isLoading:this.state.isLoading}))}}),ga=a(26),fa=a(9),Ea=a(15),Sa=a(25),Ca=a(20),ya=a(43),Ra=a(271),ba=a(282),_a=a(7),va=a(17),Na=r.a.createClass({displayName:"CommentsPage",getInitialState:function(){return{customer:{id:0,name:""},comments:[],newComment:"",isLoading:!1,isSubmitting:!1,isFormVisible:!1,isFormValid:!1}},componentWillMount:function(){this.screenTitle="Comments";var e=this.props.match.params.id;if(e){var t=Ca.getCustomer(e);if(null==t){t={id:0,name:"",comments:[]};var a=Sa.getCallById(e);null!=a&&(t.id=a.store_id,t.name=a.store_name)}var s=(t||{comments:[]}).comments;this.setState({customer:t,comments:s||[]}),this.screenTitle=t.name.length?t.name:this.screenTitle}_a.setScreenTitle(this.screenTitle)},componentDidMount:function(){Ca.addChangeListener(this._onChange),ya.addChangeListener(this._onSubmissionChange),_a.isBeforeToday(Ca.getLastRefreshForCustomer(this.state.customer.id))&&ga.doAfterAccessCheck("refreshCustomer",[this.state.customer.id])},componentWillUnmount:function(){Ca.removeChangeListener(this._onChange),ya.removeChangeListener(this._onSubmissionChange)},_onChange:function(){var e=Ca.getStatus();if(e==fa.OK){var t=(Ca.getCustomer(this.state.customer.id)||{comments:[]}).comments;this.setState({isLoading:!1,comments:t||[]}),va.success("Comments refreshed")}else e==fa.PENDING?this.setState({isLoading:!0}):e==fa.ERROR&&(this.setState({isLoading:!1}),va.error("Unable to refresh comments"))},_onSubmissionChange:function(){var e=ya.getStatus(Ea.CUSTOMER_ADD_COMMENT);e==fa.OK?(this.setState({isSubmitting:!1,isFormVisible:!1,isFormValid:!1,newComment:""}),va.success("Comment added")):e==fa.PENDING?this.setState({isSubmitting:!0}):e==fa.ERROR&&(this.setState({isSubmitting:!1}),va.error("Unable to add comment"))},refreshComments:function(){this.state.isLoading||this.state.isSubmitting||ga.doAfterAccessCheck("refreshCustomer",[this.state.customer.id])},openCommentForm:function(){this.setState({isFormVisible:!0})},closeCommentForm:function(e){e.preventDefault(),this.setState({isFormVisible:!1})},setNewCommentInfo:function(e){return this.state.newComment=e.target.value,this.setState({newComment:this.state.newComment,isFormValid:this.commentFormIsValid()})},commentFormIsValid:function(){var e=!0;return this.state.newComment.length||(e=!1),e},addComment:function(e){if(e.preventDefault(),!this.state.isLoading&&!this.state.isSubmitting){if(!this.commentFormIsValid())return void va.error("Comment may not be blank");ga.addCustomerComment(this.state.customer.id,this.state.newComment)}},render:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshComments,disabled:this.state.isLoading||this.state.isSubmitting},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isLoading?" disabled":""),role:"button",to:"/"+this.props.match.params.area+"/"+this.state.customer.id},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"Customer")),r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.openCommentForm,disabled:this.state.isLoading||this.state.isSubmitting},r.a.createElement("i",{className:"fa fa-plus"})," Add Comment")),r.a.createElement("h1",{className:"sub-button-heading"},"Comments"),r.a.createElement(Ra,{comment:this.state.newComment,onChange:this.setNewCommentInfo,onSave:this.addComment,onCancel:this.closeCommentForm,isLoading:this.state.isSubmitting,isVisible:this.state.isFormVisible&&!this.state.isLoading,isValid:this.state.isFormValid}),r.a.createElement(ba,{comments:this.state.comments,isLoading:this.state.isLoading}))}}),Ta=a(30),Oa=a(65),La=a(9),Da=a(37),Ia=a(15),Aa=a(43),Pa=a(20),xa=a(44),Ua=a(27),Fa=a(25),wa=a(78),Ma=a(22),ka=a(21),qa=a(7),Ba=a(17),Ha=a(13),ja=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=Aa.getStatus(s.lastPendingAction),t=Aa.getEntityStatuses(s.lastPendingAction),a=Aa.getPercentageComplete(s.lastPendingAction);if(e==La.PENDING){var r="default";if(null!=t)for(var n in t)if(t[n]==La.PENDING){r=n;break}s.setState({isLoading:!0,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:s.progressDescriptions[r]+" ("+Math.round(a)+"%)"})}else s.setState({isLoading:!1,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:"Complete ("+Math.round(a)+"%)",salesMessage:s.refreshSalesMessage()}),setTimeout(s.closeRefreshProgressModal,1e3),null!=s.lastPendingAction&&null!=s.completionMessages[s.lastPendingAction]&&(e==La.OK?Ba.success(s.completionMessages[s.lastPendingAction][La.OK]):e==La.ERROR?Ba.error(s.completionMessages[s.lastPendingAction][La.ERROR]):e==La.PARTIAL&&Ba.warning(s.completionMessages[s.lastPendingAction][La.PARTIAL]))},s.refreshSalesMessage=function(){var e="";if(!ka.get(Ma.FUNC_ONLINE_CUSTOMERS)||!ka.get(Ma.FUNC_ONLINE_PRODUCTS)){var t=Pa.getActiveCustomersCount()>0,a=xa.getActiveProductsCount()>0;if(!t||!a){e="You have "+(t||a?t?"no products":"no customers":"no customers or products")+" at the moment.\n Please refresh your sales data using the button above."}}return e},s.refreshSalesData=function(e){if(null!=e&&e.preventDefault(),!s.state.isLoading){s.lastPendingAction=Ia.SALES_REFRESH;var t=Ha.union(Pa.getCustomerIDs(),Fa.getCallCustomerIDs(),Ua.getOrderCustomerIDs());Ta.refreshSalesData(xa.getLastRefresh(),xa.getRefreshRetryIDs(),Ua.getPastOrdersLastRefresh(),Ua.getPastOrdersRefreshRetryIDs(),t)}},s.refreshSalesDataForOnline=function(){s.lastPendingAction=Ia.ONLINE_SALES_REFRESH,Ta.refreshSalesDataForOnline()},s.refreshAll=function(e){if(null!=e&&e.preventDefault(),!s.state.isLoading){s.lastPendingAction=Ia.ALL_REFRESH;var t=Ha.union(Pa.getCustomerIDs(),Fa.getCallCustomerIDs(),Ua.getOrderCustomerIDs());Oa.refreshAll(xa.getLastRefresh(),xa.getRefreshRetryIDs(),Ua.getPastOrdersLastRefresh(),Ua.getPastOrdersRefreshRetryIDs(),t)}},s.closeRefreshProgressModal=function(){s.setState({isRefreshProgressVisible:!1})},s.state={isLoading:!1,isRefreshProgressVisible:!1,refreshProgressPercentage:0,refreshProgressDescription:"",salesMessage:""},s.lastPendingAction=null,s.progressDescriptions={},s.progressDescriptions.default="Refreshing",s.progressDescriptions[Da.PAYMENT_TERM]="Refreshing payment terms",s.progressDescriptions[Da.TAX_CLASS]="Refreshing tax classes",s.progressDescriptions[Da.CARRIER]="Refreshing carriers",s.progressDescriptions[Da.CURRENCY]="Refreshing currencies",s.progressDescriptions[Da.PRODUCT]="Refreshing products",s.progressDescriptions[Da.CATEGORY]="Refreshing categories",s.progressDescriptions[Da.ORDER]="Refreshing orders",s.progressDescriptions[Da.CUSTOMER]="Refreshing customers",s.progressDescriptions[Da.PRICE_LIST]="Refreshing price lists",s.progressDescriptions[Da.PRODUCT_RULE]="Refreshing product rules",s.completionMessages={},s.completionMessages[Ia.SALES_REFRESH]={},s.completionMessages[Ia.SALES_REFRESH][La.OK]="Sales data refreshed",s.completionMessages[Ia.SALES_REFRESH][La.ERROR]="Unable to refresh sales data",s.completionMessages[Ia.SALES_REFRESH][La.PARTIAL]="Unable to refresh all sales data",s.completionMessages[Ia.ONLINE_SALES_REFRESH]={},s.completionMessages[Ia.ONLINE_SALES_REFRESH][La.OK]="Sales data refreshed",s.completionMessages[Ia.ONLINE_SALES_REFRESH][La.ERROR]="Unable to refresh sales data",s.completionMessages[Ia.ONLINE_SALES_REFRESH][La.PARTIAL]="Unable to refresh all sales data",s.completionMessages[Ia.ALL_REFRESH]={},s.completionMessages[Ia.ALL_REFRESH][La.OK]="Sales and calls data refreshed",s.completionMessages[Ia.ALL_REFRESH][La.ERROR]="Unable to refresh sales and calls data",s.completionMessages[Ia.ALL_REFRESH][La.PARTIAL]="Unable to refresh all sales and calls data",s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){this.screenTitle="My Sales",qa.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){Aa.addChangeListener(this._onChange),ka.get(Ma.FUNC_ONLINE_CUSTOMERS)&&ka.get(Ma.FUNC_ONLINE_PRODUCTS)?qa.isBeforeToday(Aa.getLastTimestampForSuccessfulAction(Ia.ONLINE_SALES_REFRESH))&&this.refreshSalesDataForOnline():this.setState({salesMessage:this.refreshSalesMessage()})}},{key:"componentWillUnmount",value:function(){Aa.removeChangeListener(this._onChange)}},{key:"render",value:function(){var e={pathname:"/refresh",state:{from:this.props.location,fromTitle:this.screenTitle}};return r.a.createElement("div",null,ka.get(Ma.FUNC_ONLINE_CUSTOMERS)&&ka.get(Ma.FUNC_ONLINE_PRODUCTS)?r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshSalesDataForOnline,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})):r.a.createElement("div",{className:"btn-group btn-group-header-refresh"},r.a.createElement("button",{className:"btn btn-header-refresh dropdown-toggle",disabled:this.state.isLoading,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("ul",{className:"dropdown-menu"},r.a.createElement("li",null,r.a.createElement("a",{href:"#",onClick:this.refreshSalesData,className:this.state.isLoading?" disabled":""},"Refresh Sales")),r.a.createElement("li",null,r.a.createElement("a",{href:"#",onClick:this.refreshAll,className:this.state.isLoading?" disabled":""},"Refresh All")),r.a.createElement("li",null,r.a.createElement(R.a,{to:e,className:this.state.isLoading?" disabled":""},"More Options")))),this.state.salesMessage.length?r.a.createElement("div",{className:"alert alert-info",role:"alert"},r.a.createElement("span",{style:{whiteSpace:"pre-line"}},this.state.salesMessage)):null,this.state.isRefreshProgressVisible?r.a.createElement(wa,{percentage:this.state.refreshProgressPercentage,description:this.state.refreshProgressDescription,title:"Refresh Progress",isLoading:this.state.isLoading}):null,r.a.createElement("div",{className:"list-group list-group-spaced mor-list",style:{marginTop:0}},r.a.createElement(R.a,{to:"/sales/orders",className:"list-group-item"},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-shopping-cart"})," My Orders"),r.a.createElement("p",{className:"list-group-item-text"},"Create and submit your orders.")),r.a.createElement(R.a,{to:"/sales/products",className:"list-group-item"},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-list-ul"})," Products"),r.a.createElement("p",{className:"list-group-item-text"},"View products.")),ka.get(Ma.UI_BUTTON_CUSTOMERS)?r.a.createElement(R.a,{to:"/sales/customers",className:"list-group-item"},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-users"})," Customers"),r.a.createElement("p",{className:"list-group-item-text"},"View customers.")):null))}}]),a}(r.a.Component),Va=a(30),Ga=a(9),Ka=a(20),Wa=a(27),za=a(283),Ja=a(7),Ya=a(17),Qa=a(22),Xa=a(21),$a=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=Wa.getStatus();e==Ga.OK?(Ya.success("Order"+(s.blnMultipleSubmissions?"s":"")+" submitted"),s.setState({isLoading:!1,orders:Wa.getOrders()}),s.refreshOrderSubmissionStatusIndicator()):e==Ga.PENDING?s.setState({isLoading:!0}):e==Ga.ERROR?(Ya.error("Unable to submit order"+(s.blnMultipleSubmissions?"s":"")),s.setState({isLoading:!1,orders:Wa.getOrders()})):e==Ga.PARTIAL&&(Ya.warning("Unable to submit all orders"),s.setState({isLoading:!1,orders:Wa.getOrders()}),s.refreshOrderSubmissionStatusIndicator())},s.submitOrders=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!s.state.isLoading){Array.isArray(e)||(e=[]);var t=Wa.getOrderSubmissions(e);if(!t.length)return void Ya.success("No orders to submit");s.blnMultipleSubmissions=t.length>1,Va.submitOrdersAndRelatedData(t,Ka.getValidCustomerVisits())}},s.refreshOrderSubmissionStatusIndicator=function(){var e=Wa.getOrderSubmissions();s.setState({ordersToSubmit:e.length>0})},s.state={orders:Wa.getOrders(),isLoading:!1,ordersToSubmit:!1},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){Ja.setScreenTitle("My Orders")}},{key:"componentDidMount",value:function(){Wa.addChangeListener(this._onChange),this.refreshOrderSubmissionStatusIndicator();var e=this.props.location.state;e&&e.submitOrders&&e.submitOrders.length&&this.submitOrders(e.submitOrders)}},{key:"componentWillUnmount",value:function(){Wa.removeChangeListener(this._onChange)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-submit",style:{right:"8px"},onClick:this.submitOrders,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-upload fa-2x"}),this.state.ordersToSubmit?r.a.createElement("i",{className:"fa fa-circle icon-badge"}):null),r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-4"+(this.state.isLoading?" disabled":""),role:"button",to:"/sales"},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back"),r.a.createElement(R.a,{className:"btn btn-primary col-xs-4"+(this.state.isLoading?" disabled":""),role:"button",to:"/sales/orders/past"},r.a.createElement("i",{className:"fa fa-history"})," Past Orders"),r.a.createElement(R.a,{className:"btn btn-primary col-xs-4"+(this.state.isLoading?" disabled":""),role:"button",to:"/sales/orders/new"},r.a.createElement("i",{className:"fa fa-plus"})," New Order")),!this.state.isLoading&&Xa.activeProfile==Qa.PROFILE_B2B&&this.state.ordersToSubmit&&r.a.createElement("div",{className:"alert alert-info",style:{margin:"15px 0 10px"},role:"alert"},r.a.createElement("button",{className:"btn btn-primary pull-right",style:{marginLeft:"1.25rem"},onClick:this.submitOrders,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-upload"})),r.a.createElement("span",{style:{whiteSpace:"pre-line"}},"You have unsubmitted placed orders.\n Please check your connection and submit them.\n")),r.a.createElement(za,{orders:this.state.orders,isLoading:this.state.isLoading}))}}]),a}(r.a.Component),Za=a(48),es=a(15),ts=a(30),as=a(26),ss=a(9),rs=a(104),ns=a(27),is=a(284),os=a(285),ls=a(20),cs=a(150),us=a(44),ds=a(286),ms=a(68),hs=a(55),ps=a(79),gs=a(22),fs=a(21),Es=a(7),Ss=a(17),Cs=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){s.setState({order:ns.getOrder(s.state.order.id)}),fs.get(gs.FUNC_ONLINE_CUSTOMERS)&&!fs.get(gs.FUNC_CUSTOMER_AUTOSELECTION)?(Es.setPostCompletedActionDispatchCallback(es.CUSTOMER_REFRESH,Object(Za.a)(s),"checkCompulsorySelections"),Es.setPostCompletedActionDispatchCallback(es.ORDER_SAVE,Object(Za.a)(s),"checkCompulsorySelections")):s.checkCompulsorySelections()},s._onCustomerSearchOrSelectChange=function(){var e=ls.getStatus(fs.get(gs.FUNC_ONLINE_CUSTOMERS)?es.CUSTOMERS_SEARCH_SERVER:es.CUSTOMERS_SEARCH_LOCAL),t=fs.get(gs.FUNC_ONLINE_CUSTOMERS)?hs.SERVER:hs.LOCAL;if(e==ss.OK?s.setState({isCustomerSearchLoading:!1,customerSearchTerm:ls.getSearchTerm(t),customerSearchPage:ls.getSearchPage(t),customerSearchPageSize:ls.getSearchPageSize(t),customerSearchTotal:ls.getSearchTotal(t),customerSearchTotalPages:ls.getSearchTotalPages(t),customerSearchResults:ls.getSearchResults(t)}):e==ss.PENDING?s.setState({isCustomerSearchLoading:!0,customerSearchTerm:ls.getSearchTerm(t),customerSearchPage:ls.getSearchPage(t)}):e==ss.ERROR&&s.setState({isCustomerSearchLoading:!1,customerSearchTerm:ls.getSearchTerm(t),customerSearchPage:ls.getSearchPage(t)}),null!=s.selectedRefreshedCustomerID){var a=ls.getStatus();if(a==ss.OK||a==ss.PARTIAL){var r=ls.getCustomer(s.selectedRefreshedCustomerID);null!=r&&(s.setState({customerLocations:null!=r.locations?r.locations:[]}),s.screenTitle=r.name,Es.setScreenTitle(s.screenTitle),s.hideCustomerSelectionList(!1),Ss.success("Customer details loaded"))}else a==ss.ERROR&&Ss.error("Unable to load customer details");a!=ss.PENDING&&(s.selectedRefreshedCustomerID=null),s.setState({isCustomerSelectionLoading:a==ss.PENDING})}},s.showCustomerSelectionList=function(){s.setState({isCustomerSelectionVisible:!0,customerSearchTerm:"",customerSearchPage:1,customerSearchTotalPages:null,customerSearchResults:[]})},s.hideCustomerSelectionList=function(e){e=null==e||e,s.setState({isCustomerSelectionVisible:!1}),e&&!s.orderHasCustomer()&&s.cancelOrder()},s.searchCustomers=function(e,t){ts.searchCustomers(e,t,5)},s.selectCustomer=function(e){if(!s.state.isCustomerSearchLoading)if(1==e.is_approved_for_orders){if(fs.get(gs.FUNC_ONLINE_CUSTOMERS)&&!fs.get(gs.FUNC_CUSTOMER_AUTOSELECTION))s.selectedRefreshedCustomerID=e.id,as.refreshCustomer(e.id,!1,[s.state.order.id]);else{var t=ls.getCustomer(e.id);null!=t&&(s.loadCustomerOrderDetails(t),s.hideCustomerSelectionList(!1),Ss.success("Customer details loaded"))}ts.enterCustomer(e.id)}else Ss.warning("This customer is not approved to place orders")},s.loadCustomerOrderDetails=function(e){s.state.order.customer_id=e.id,s.state.order.customer_name=e.name,s.state.order.expected_date=null!=e.default_lead_time?Es.getUnixTimeStartOfDay()+86400*e.default_lead_time:null,s.state.order.payment_terms_id=null==s.state.order.payment_terms_id&&null!=e.payment_term?e.payment_term:s.state.order.payment_terms_id;var t=ns.getCurrencyOrDefault(e.default_currency_id);s.state.order.currency_id=t.id,s.state.order.currency_display_name=t.name,s.state.order.currency_display_symbol=t.symbol,s.state.order.billing_location_id=0,s.state.order.shipping_location_id=0,ts.saveOrder(s.state.order),s.setState({customerLocations:null!=e.locations?e.locations:[]}),s.screenTitle=e.name,Es.setScreenTitle(s.screenTitle)},s.initialiseCustomerLocations=function(){if(s.orderHasCustomer()){var e=ls.getCustomer(s.state.order.customer_id);null!=e&&s.setState({customerLocations:null!=e.locations?e.locations:[]})}},s.initialiseCustomerEntry=function(){s.orderHasCustomer()&&ts.enterCustomer(s.state.order.customer_id)},s._onProductSearchChange=function(){var e=us.getStatus(fs.get(gs.FUNC_ONLINE_PRODUCTS)?es.PRODUCTS_SEARCH_SERVER:es.PRODUCTS_SEARCH_LOCAL),t=fs.get(gs.FUNC_ONLINE_PRODUCTS)?hs.SERVER:hs.LOCAL;e==ss.OK?s.setState({isProductSearchLoading:!1,productSearchTerm:us.getSearchTerm(t),productSearchPage:us.getSearchPage(t),productSearchPageSize:us.getSearchPageSize(t),productSearchFilters:us.getSearchFilters(t),productSearchTotal:us.getSearchTotal(t),productSearchTotalPages:us.getSearchTotalPages(t),productSearchResults:us.getSearchResults(t)}):e==ss.PENDING?s.setState({isProductSearchLoading:!0,productSearchTerm:us.getSearchTerm(t),productSearchPage:us.getSearchPage(t),productSearchFilters:us.getSearchFilters(t)}):e==ss.ERROR&&s.setState({isProductSearchLoading:!1,productSearchTerm:us.getSearchTerm(t),productSearchPage:us.getSearchPage(t),productSearchFilters:us.getSearchFilters(t)})},s.showProductSelectionList=function(){var e=s.state.productSearchFilters;if(s.orderHasCustomer()){ls.getCustomer(s.state.order.customer_id);(e=e||{}).customerProducts=ms.ALL}s.setState({isProductSelectionVisible:!0,productSearchTerm:"",productSearchPage:1,productSearchFilters:e,productSearchTotalPages:null,productSearchResults:[]})},s.hideProductSelectionList=function(){s.setState({isProductSelectionVisible:!1})},s.searchProducts=function(e,t,a){ts.searchProducts(e,t,null,a,s.state.order.customer_id)},s.selectProducts=function(e){if(!s.state.isProductSearchLoading){var t=!1;for(var a in e)null!=e[a]&&(s.addOrderItem(e[a]),t=!0,Ss.success(e[a].name+" added to order"));t&&ts.saveOrder(s.state.order),s.hideProductSelectionList()}},s.addOrderItem=function(e){var t={value:0,displayValue:"0.00"};null!=e.calc_price&&(t=Es.formatCurrency(e.calc_price)),s.state.order.items.push({product_id:e.id,sku:e.sku,name:e.name,quantity:e.quantity,quantity_display:e.quantity,quantity_min:e.quantity_min,quantity_max:e.quantity_max,quantity_mom:e.quantity_mom,is_taxable:e.is_taxable,tax_class_id:e.tax_class_id,price:t.value,price_orig:t.value,price_display:t.displayValue,total:t.value,total_display:t.displayValue})},s.orderHasCustomer=function(){return null!=s.state.order.customer_id&&s.state.order.customer_id>0},s.checkCompulsorySelections=function(){s.orderHasCustomer()?null==s.state.order.itemsEdited||s.state.order.itemsEdited||s.showProductSelectionList():s.showCustomerSelectionList()},s.orderIsValid=function(){if(!s.orderHasCustomer())return!1;var e;if(s.state.order.items.length)for(e=0;e<s.state.order.items.length;e++)if(null!=s.state.order.items[e])return!0;return!1},s.saveOrder=function(e){ts.saveOrder(e)},s.placeOrder=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=s.orderIsValid();s.state.order.status=t?rs.PLACED:rs.INCOMPLETE,ts.saveOrder(s.state.order),t?(ts.exitCustomer(s.state.order.customer_id),s.setState({orderResolved:!0,orderSubmit:!0===e})):Ss.error("Please complete all necessary fields")},s.placeAndSubmitOrder=function(){s.placeOrder(!0)},s.cancelOrder=function(){ts.cancelOrder(s.state.order.id),s.setState({orderResolved:!0})},s.showOrderCancelConfirmationPrompt=function(){s.setState({isOrderCancelConfirmationVisible:!0})},s.hideOrderCancelConfirmationPrompt=function(){s.setState({isOrderCancelConfirmationVisible:!1})},s.screenTitle="Order",s.orderCancelConfirmDescription="Are you sure you want to cancel this order?",s.selectedRefreshedCustomerID=null;var r={},n=e.match.params.oid;return n&&(r=ns.getOrder("new"==n?null:n)),s.state={order:r,paymentTerms:ns.getPaymentTerms(),taxClasses:ns.getTaxClasses(),carriers:ns.getCarriers(),customerLocations:[],orderResolved:!1,orderSubmit:!1,customerSearchTerm:"",customerSearchPage:1,customerSearchPageSize:null,customerSearchTotal:null,customerSearchTotalPages:null,customerSearchResults:[],isCustomerSearchLoading:!1,isCustomerSelectionLoading:!1,isCustomerSelectionVisible:!1,productSearchTerm:"",productSearchPage:1,productSearchPageSize:null,productSearchFilters:null,productSearchTotal:null,productSearchTotalPages:null,productSearchResults:[],isProductSearchLoading:!1,isProductSelectionLoading:!1,isProductSelectionVisible:!1,isOrderCancelConfirmationVisible:!1,categories:us.getCategoryTree()},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){this.orderHasCustomer()&&(this.screenTitle=this.state.order.customer_name),Es.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){ns.addChangeListener(this._onChange),ls.addChangeListener(this._onCustomerSearchOrSelectChange),us.addChangeListener(this._onProductSearchChange),fs.get(gs.FUNC_CUSTOMER_AUTOSELECTION)&&"new"==this.props.match.params.oid?this.selectCustomer({id:Es.getB2BCustomerID(),is_approved_for_orders:1}):(this.initialiseCustomerLocations(),this.initialiseCustomerEntry(),this.checkCompulsorySelections())}},{key:"componentWillUnmount",value:function(){ns.removeChangeListener(this._onChange),ls.removeChangeListener(this._onCustomerSearchOrSelectChange),us.removeChangeListener(this._onProductSearchChange)}},{key:"render",value:function(){if(this.state.orderResolved)return r.a.createElement(S.a,{push:!0,to:{pathname:"/sales/orders",state:{submitOrders:this.state.orderSubmit?[this.state.order.id]:null}}});var e=null!=this.state.order.customer_id;return r.a.createElement("div",null,r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-"+(fs.get(gs.UI_BUTTON_CHANGE_CUSTOMER)?"3":"6"),role:"button",to:"/sales/orders"},r.a.createElement("i",{className:"fa fa-arrow-left"})," Close"),fs.get(gs.UI_BUTTON_CHANGE_CUSTOMER)?r.a.createElement("button",{className:"btn btn-primary col-xs-5",onClick:this.showCustomerSelectionList},r.a.createElement("i",{className:"fa fa-user"})," ",e?"Change":"Select"," Customer"):null,r.a.createElement("button",{className:"btn btn-primary col-xs-"+(fs.get(gs.UI_BUTTON_CHANGE_CUSTOMER)?"4":"6"),onClick:this.showProductSelectionList},r.a.createElement("i",{className:"fa fa-plus"})," Add Item")),r.a.createElement("h1",{className:"sub-button-heading"},"Order"),this.state.isCustomerSelectionVisible?r.a.createElement(cs,{searchTerm:this.state.customerSearchTerm,searchPage:this.state.customerSearchPage,searchPageSize:this.state.customerSearchPageSize,searchTotal:this.state.customerSearchTotal,searchTotalPages:this.state.customerSearchTotalPages,searchResults:this.state.customerSearchResults,onSearch:this.searchCustomers,onSelect:this.selectCustomer,onFinish:this.hideCustomerSelectionList,isLoading:this.state.isCustomerSearchLoading||this.state.isCustomerSelectionLoading}):null,this.state.isProductSelectionVisible?r.a.createElement(ds,{subTitle:e?this.state.order.customer_name:null,currencySymbol:this.state.order.currency_display_symbol,searchTerm:this.state.productSearchTerm,searchPage:this.state.productSearchPage,searchPageSize:this.state.productSearchPageSize,searchFilters:this.state.productSearchFilters,customerSearchFiltersActive:e,searchTotal:this.state.productSearchTotal,searchTotalPages:this.state.productSearchTotalPages,searchResults:this.state.productSearchResults,categories:this.state.categories,onSearch:this.searchProducts,onFinish:this.selectProducts,isLoading:this.state.isProductSearchLoading||this.state.isProductSelectionLoading}):null,this.state.isOrderCancelConfirmationVisible?r.a.createElement(ps,{description:this.orderCancelConfirmDescription,onYes:this.cancelOrder,onNo:this.hideOrderCancelConfirmationPrompt}):null,r.a.createElement(os,{order:this.state.order,paymentTerms:this.state.paymentTerms,taxClasses:this.state.taxClasses,carriers:this.state.carriers,customerLocations:this.state.customerLocations,onSave:this.saveOrder}),r.a.createElement(is,{order:this.state.order,onSave:this.saveOrder,onPlace:this.placeOrder,onPlaceAndSubmit:this.placeAndSubmitOrder,onCancel:this.showOrderCancelConfirmationPrompt,editablePricing:fs.get(gs.FUNC_EDIT_ORDER_PRICING)}))}}]),a}(r.a.Component),ys=a(30),Rs=a(9),bs=a(15),_s=a(43),vs=a(27),Ns=a(287),Ts=a(22),Os=a(21),Ls=a(7),Ds=a(17),Is=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=_s.getStatus(bs.PAST_ORDERS_CUSTOMERS_REFRESH);e==Rs.PENDING?s.setState({isLoading:!0}):(s.setState({isLoading:!1,orders:vs.getPastOrders()}),e==Rs.OK?Ds.success("Past orders refreshed"):e==Rs.ERROR?Ds.error("Unable to refresh past orders"):e==Rs.PARTIAL&&Ds.warning("Unable to refresh all past orders"))},s.refreshPastOrders=function(){s.state.isLoading||ys.refreshPastOrdersAndAssociatedCustomers(vs.getPastOrdersLastRefresh(),vs.getPastOrdersRefreshRetryIDs())},s.state={orders:vs.getPastOrders(),isLoading:!1},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){Ls.setScreenTitle("My Past Orders")}},{key:"componentDidMount",value:function(){_s.addChangeListener(this._onChange),Os.get(Ts.FUNC_ONLINE_CUSTOMERS)&&Ls.isBeforeToday(vs.getPastOrdersLastRefresh())&&ys.refreshPastOrdersAndAssociatedCustomers(vs.getPastOrdersLastRefresh(),vs.getPastOrdersRefreshRetryIDs())}},{key:"componentWillUnmount",value:function(){_s.removeChangeListener(this._onChange)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshPastOrders,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isLoading?" disabled":""),role:"button",to:"/sales/orders"},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"My Orders")),r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isLoading?" disabled":""),role:"button",to:"/sales/orders/new"},r.a.createElement("i",{className:"fa fa-plus"})," New Order")),r.a.createElement(Ns,{orders:this.state.orders,isLoading:this.state.isLoading}))}}]),a}(r.a.Component),As=a(30),Ps=a(27),xs=a(20),Us=a(288),Fs=a(289),ws=a(7),Ms=a(13),ks=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){},s.cloneOrder=function(){s.state.clonedOrder.customer_id=s.state.customer.id,s.state.clonedOrder.customer_name=s.state.customer.name,s.state.clonedOrder.expected_date=null!=s.state.customer.default_lead_time?ws.getUnixTimeStartOfDay()+86400*s.state.customer.default_lead_time:null,s.state.clonedOrder.payment_terms_id=null==s.state.order.payment_term_id&&null!=s.state.customer.payment_term?s.state.customer.payment_term:parseInt(s.state.order.payment_term_id),s.state.clonedOrder.billing_location_id=parseInt(s.state.order.billing_location_id),s.state.clonedOrder.shipping_location_id=parseInt(s.state.order.shipping_location_id),s.state.clonedOrder.carrier_id=parseInt(s.state.order.carrier_id),s.state.clonedOrder.tax_class_id=parseInt(s.state.order.tax_class_id);var e=Ps.getCurrency(s.state.order.currency.id);null==e&&(e=Ps.getCurrencyOrDefault(s.state.customer.default_currency_id)),s.state.clonedOrder.currency_id=e.id,s.state.clonedOrder.currency_display_name=e.name,s.state.clonedOrder.currency_display_symbol=e.symbol;var t=ws.formatCurrency(s.state.order.adjustment_amount),a=ws.formatCurrency(s.state.order.shipping_amount);if(s.state.clonedOrder.adjustment=t.value,s.state.clonedOrder.adjustment_display=t.displayValue,s.state.clonedOrder.shipping=a.value,s.state.clonedOrder.shipping_display=a.displayValue,s.state.clonedOrder.itemsEdited=!0,Ms.keys(s.state.order.items).length)for(var r in s.state.order.items){var n=s.state.order.items[r],i=null!=n.price?ws.formatCurrency(n.price):ws.formatCurrencyNumber(n.discount_price),o=ws.formatCurrencyNumber(n.total);s.state.clonedOrder.items.push({product_id:n.product_id,sku:n.SKU,name:n.name,quantity:parseFloat(n.qty),quantity_display:parseFloat(n.qty),quantity_min:parseFloat(n.min_order_qty),quantity_max:parseFloat(n.max_order_qty),quantity_mom:parseInt(n.multiples_of_min),is_taxable:n.is_taxable>0,tax_class_id:n.tax_class_id,price:i.value,price_orig:i.value,price_display:i.displayValue,total:o.value,total_display:o.displayValue})}As.saveOrder(s.state.clonedOrder),s.setState({orderIsCloned:!0})},s.screenTitle="Past Order";var r={},n={},i=e.match.params.oid;return i&&(r=Ps.getPastOrder(i),n=xs.getCustomer(r.customer_id),s.screenTitle=n.name),s.state={order:r,customer:n,orderIsCloned:!1,clonedOrder:Ps.getOrder(null)},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){ws.setScreenTitle(this.screenTitle)}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return this.state.orderIsCloned?r.a.createElement(S.a,{push:!0,to:"/sales/orders/"+this.state.clonedOrder.id}):r.a.createElement("div",null,r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6",role:"button",to:"/sales/orders/past"},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"My Past Orders")),r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.cloneOrder},r.a.createElement("i",{className:"fa fa-clone"})," Clone Order")),r.a.createElement("h1",{className:"sub-button-heading"},"Past Order"),r.a.createElement(Us,{order:this.state.order}),r.a.createElement(Fs,{order:this.state.order,onClone:this.cloneOrder}))}}]),a}(r.a.Component),qs=a(15),Bs=a(30),Hs=a(26),js=a(9),Vs=a(55),Gs=a(68),Ks=a(44),Ws=a(20),zs=a(27),Js=a(290),Ys=a(150),Qs=a(22),Xs=a(21),$s=a(7),Zs=a(17),er=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;if(Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=Ks.getStatus(Xs.get(Qs.FUNC_ONLINE_PRODUCTS)?qs.PRODUCTS_SEARCH_SERVER:qs.PRODUCTS_SEARCH_LOCAL),t=Xs.get(Qs.FUNC_ONLINE_PRODUCTS)?Vs.SERVER:Vs.LOCAL;e==js.OK?s.setState({isProductSearchLoading:!1,searchTerm:Ks.getSearchTerm(t),searchPage:Ks.getSearchPage(t),searchPageSize:Ks.getSearchPageSize(t),searchFilters:Ks.getSearchFilters(t),searchTotal:Ks.getSearchTotal(t),searchTotalPages:Ks.getSearchTotalPages(t),products:Ks.getSearchResults(t)}):e==js.PENDING?s.setState({isProductSearchLoading:!0,searchTerm:Ks.getSearchTerm(t),searchPage:Ks.getSearchPage(t),searchFilters:Ks.getSearchFilters(t)}):e==js.ERROR&&s.setState({isProductSearchLoading:!1,searchTerm:Ks.getSearchTerm(t),searchPage:Ks.getSearchPage(t),searchFilters:Ks.getSearchFilters(t)})},s._onCustomerSearchOrSelectChange=function(){var e=Ws.getStatus(Xs.get(Qs.FUNC_ONLINE_CUSTOMERS)?qs.CUSTOMERS_SEARCH_SERVER:qs.CUSTOMERS_SEARCH_LOCAL),t=Xs.get(Qs.FUNC_ONLINE_CUSTOMERS)?Vs.SERVER:Vs.LOCAL;if(e==js.OK?s.setState({isCustomerSearchLoading:!1,customerSearchTerm:Ws.getSearchTerm(t),customerSearchPage:Ws.getSearchPage(t),customerSearchPageSize:Ws.getSearchPageSize(t),customerSearchTotal:Ws.getSearchTotal(t),customerSearchTotalPages:Ws.getSearchTotalPages(t),customerSearchResults:Ws.getSearchResults(t)}):e==js.PENDING?s.setState({isCustomerSearchLoading:!0,customerSearchTerm:Ws.getSearchTerm(t),customerSearchPage:Ws.getSearchPage(t)}):e==js.ERROR&&s.setState({isCustomerSearchLoading:!1,customerSearchTerm:Ws.getSearchTerm(t),customerSearchPage:Ws.getSearchPage(t)}),null!=s.selectedRefreshedCustomerID){var a=Ws.getStatus();if(a==js.OK||a==js.PARTIAL){var r=Ws.getCustomer(s.selectedRefreshedCustomerID);if(null!=r){var n=s.state.order.customer_id!=r.id&&!Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION);if(s.hideCustomerSelectionList(),n){s.currencySymbol=zs.getCurrencyOrDefault(r.default_currency_id).symbol;var i=s.state.searchFilters||{};i.customerProducts=Gs.ALL,$s.setPostCompletedActionDispatchCallback(qs.CUSTOMER_REFRESH,Object(Za.a)(s),"searchProducts",[s.state.searchTerm,1,i,r.id])}}}else a==js.ERROR&&Zs.error("Unable to load customer details");a!=js.PENDING&&(s.selectedRefreshedCustomerID=null),s.setState({isCustomerSelectionLoading:a==js.PENDING})}},s._onOrderChange=function(){var e=zs.getOrder(s.state.order.id);null==e&&(e=zs.getOrder()),s.setState({order:e,orderWithCustomerCreated:null!=e.customer_id&&e.customer_id>0})},s.searchProducts=function(e,t,a,r){r=void 0!==r?r:Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION)?$s.getB2BCustomerID():s.state.order.customer_id,Bs.searchProducts(e,t,null,a,r)},s.changeProductQuantityForOrder=function(e){s.setState((function(t,a){for(var s in e.quantity>0?(null==t.selectedProducts[e.id]&&Zs.success(e.name+" added to order"),t.selectedProducts[e.id]=e):null!=t.selectedProducts[e.id]&&(Zs.success(e.name+" removed from order"),t.selectedProducts[e.id]=void 0),t.order.items=[],t.selectedProducts){var r=t.selectedProducts[s];if(null!=r){var n={value:0,displayValue:"0.00"};null!=r.calc_price&&(n=$s.formatCurrency(r.calc_price)),this.state.order.items.push({product_id:r.id,sku:r.sku,name:r.name,quantity:r.quantity,quantity_display:r.quantity,quantity_min:r.quantity_min,quantity_max:r.quantity_max,quantity_mom:r.quantity_mom,is_taxable:r.is_taxable,tax_class_id:r.tax_class_id,price:n.value,price_orig:n.value,price_display:n.displayValue,total:n.value,total_display:n.displayValue})}}return Bs.saveOrder(this.state.order),{selectedProducts:t.selectedProducts,order:t.order}}))},s.createNewOrder=function(){Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION)?s.selectCustomerForOrder({id:$s.getB2BCustomerID(),is_approved_for_orders:1}):s.showCustomerSelectionList()},s.showCustomerSelectionList=function(){s.setState({isCustomerSelectionVisible:!0,customerSearchTerm:"",customerSearchPage:1,customerSearchTotalPages:null,customerSearchResults:[]})},s.hideCustomerSelectionList=function(){s.setState({isCustomerSelectionVisible:!1})},s.searchCustomers=function(e,t){Bs.searchCustomers(e,t,5)},s.selectCustomerForOrder=function(e){if(!s.state.isCustomerSearchLoading)if(1==e.is_approved_for_orders)if(Xs.get(Qs.FUNC_ONLINE_CUSTOMERS)&&!Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION))s.selectedRefreshedCustomerID=e.id,Hs.refreshCustomer(e.id,!1,[s.state.order.id]);else{var t=Ws.getCustomer(e.id);if(null!=t){var a=s.state.order.customer_id!=t.id&&!Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION);s.state.order.customer_id=t.id,s.state.order.customer_name=t.name,s.state.order.expected_date=null!=t.default_lead_time?$s.getUnixTimeStartOfDay()+86400*t.default_lead_time:null,s.state.order.payment_terms_id=null==s.state.order.payment_terms_id&&null!=t.payment_term?t.payment_term:s.state.order.payment_terms_id;var r=zs.getCurrencyOrDefault(t.default_currency_id);if(s.state.order.currency_id=r.id,s.state.order.currency_display_name=r.name,s.state.order.currency_display_symbol=r.symbol,s.state.order.billing_location_id=0,s.state.order.shipping_location_id=0,Bs.saveOrder(s.state.order),s.hideCustomerSelectionList(),a){s.currencySymbol=r.symbol;var n=s.state.searchFilters||{};n.customerProducts=Gs.ALL,s.searchProducts(s.state.searchTerm,1,n,t.id)}}}else Zs.warning("This customer is not approved to place orders")},s.cancelOrder=function(){if(Bs.cancelOrder(s.state.order.id),!Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION)){s.currencySymbol=s.defaultCurrencySymbol;var e=s.state.searchFilters;null!=e&&null!=e.customerProducts&&(e.customerProducts=Gs.ALL),s.searchProducts(s.state.searchTerm,1,e,null)}},s.selectedRefreshedCustomerID=null,s.defaultCurrencySymbol=$s.getCompanyCurrency().symbol,s.currencySymbol=s.defaultCurrencySymbol,Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION)){var r=Ws.getCustomer($s.getB2BCustomerID());null!=r&&(s.currencySymbol=zs.getCurrencyOrDefault(r.default_currency_id).symbol)}return s.state={products:[],searchTerm:"",searchPage:1,searchPageSize:null,searchFilters:null,searchTotal:null,searchTotalPages:null,isProductSearchLoading:!1,categories:Ks.getCategoryTree(),customerSearchResults:[],customerSearchTerm:"",customerSearchPage:1,customerSearchPageSize:null,customerSearchTotal:null,customerSearchTotalPages:null,isCustomerSearchLoading:!1,isCustomerSelectionLoading:!1,isCustomerSelectionVisible:!1,orderWithCustomerCreated:!1,order:zs.getOrder(),selectedProducts:{}},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){$s.setScreenTitle("Products")}},{key:"componentDidMount",value:function(){Ks.addChangeListener(this._onChange),Ws.addChangeListener(this._onCustomerSearchOrSelectChange),zs.addChangeListener(this._onOrderChange),this.searchProducts()}},{key:"componentWillUnmount",value:function(){Ks.removeChangeListener(this._onChange),Ws.removeChangeListener(this._onCustomerSearchOrSelectChange),zs.removeChangeListener(this._onOrderChange)}},{key:"render",value:function(){return r.a.createElement("div",null,this.state.orderWithCustomerCreated?r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-3"+(this.state.isProductSearchLoading?" disabled":""),role:"button",to:"/sales"},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back"),r.a.createElement(R.a,{className:"btn btn-primary col-xs-5"+(this.state.isProductSearchLoading?" disabled":""),role:"button",to:"/sales/orders/"+this.state.order.id},r.a.createElement("i",{className:"fa fa-shopping-cart"})," Proceed to Order"),r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.cancelOrder,disabled:this.state.isProductSearchLoading},r.a.createElement("i",{className:"fa fa-close"})," Cancel Order")):r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isProductSearchLoading?" disabled":""),role:"button",to:"/sales"},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,"My Sales")),r.a.createElement("button",{className:"btn btn-primary col-xs-6",onClick:this.createNewOrder,disabled:this.state.isProductSearchLoading},r.a.createElement("i",{className:"fa fa-plus"})," New Order")),this.state.orderWithCustomerCreated?r.a.createElement("h1",{className:"sub-button-heading"},this.state.order.customer_name):null,this.state.isCustomerSelectionVisible?r.a.createElement(Ys,{searchTerm:this.state.customerSearchTerm,searchPage:this.state.customerSearchPage,searchPageSize:this.state.customerSearchPageSize,searchTotal:this.state.customerSearchTotal,searchTotalPages:this.state.customerSearchTotalPages,searchResults:this.state.customerSearchResults,onSearch:this.searchCustomers,onSelect:this.selectCustomerForOrder,onFinish:this.hideCustomerSelectionList,isLoading:this.state.isCustomerSearchLoading||this.state.isCustomerSelectionLoading}):null,r.a.createElement(Js,{currencySymbol:this.currencySymbol,products:this.state.products,selectedProducts:this.state.selectedProducts,searchTerm:this.state.searchTerm,searchPage:this.state.searchPage,searchPageSize:this.state.searchPageSize,searchFilters:this.state.searchFilters,customerSearchFiltersActive:this.state.orderWithCustomerCreated||Xs.get(Qs.FUNC_CUSTOMER_AUTOSELECTION),searchTotal:this.state.searchTotal,searchTotalPages:this.state.searchTotalPages,categories:this.state.categories,onSearch:this.searchProducts,onProductQuantityChange:this.changeProductQuantityForOrder,isLoading:this.state.isProductSearchLoading,isProductSelectionAvailable:this.state.orderWithCustomerCreated}))}}]),a}(r.a.Component),tr=a(30),ar=a(9),sr=a(37),rr=a(55),nr=a(15),ir=a(43),or=a(20),lr=a(27),cr=a(291),ur=a(143),dr=a(22),mr=a(21),hr=a(7),pr=a(17),gr=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){if(s.state.isCustomerRequestVisible){var e=or.getStatus(nr.CUSTOMERS_SEARCH_SERVER);e==ar.OK?s.setState({isCustomerRequestSearchLoading:!1,customerRequestSearchTerm:or.getSearchTerm(rr.SERVER),customerRequestSearchPage:or.getSearchPage(rr.SERVER),customerRequestSearchPageSize:or.getSearchPageSize(rr.SERVER),customerRequestSearchTotal:or.getSearchTotal(rr.SERVER),customerRequestSearchTotalPages:or.getSearchTotalPages(rr.SERVER),customerRequestSearchResults:or.getSearchResults(rr.SERVER)}):e==ar.PENDING?s.setState({isCustomerRequestSearchLoading:!0,customerRequestSearchTerm:or.getSearchTerm(rr.SERVER),customerRequestSearchPage:or.getSearchPage(rr.SERVER)}):e==ar.ERROR&&s.setState({isCustomerRequestSearchLoading:!1,customerRequestSearchTerm:or.getSearchTerm(rr.SERVER),customerRequestSearchPage:or.getSearchPage(rr.SERVER)})}else{var t=or.getStatus(mr.get(dr.FUNC_ONLINE_CUSTOMERS)?nr.CUSTOMERS_SEARCH_SERVER:nr.CUSTOMERS_SEARCH_LOCAL),a=mr.get(dr.FUNC_ONLINE_CUSTOMERS)?rr.SERVER:rr.LOCAL;t==ar.OK?s.setState({isCustomerSearchLoading:!1,searchTerm:or.getSearchTerm(a),searchPage:or.getSearchPage(a),searchPageSize:or.getSearchPageSize(a),searchTotal:or.getSearchTotal(a),searchTotalPages:or.getSearchTotalPages(a),customers:or.getSearchResults(a)}):t==ar.PENDING?s.setState({isCustomerSearchLoading:!0,searchTerm:or.getSearchTerm(a),searchPage:or.getSearchPage(a)}):t==ar.ERROR&&s.setState({isCustomerSearchLoading:!1,searchTerm:or.getSearchTerm(a),searchPage:or.getSearchPage(a)})}},s._onCustomerRequestStatusChange=function(){var e=ir.getStatus(nr.CUSTOMERS_SALES_REFRESH),t=ir.getEntityStatuses(nr.SALES_REFRESH),a=null!=t?t[sr.CUSTOMER]:null;if(e!=ar.PENDING&&(a==ar.OK?pr.success("Customer added"):a==ar.PARTIAL?pr.warning("Customer partially added"):a==ar.ERROR&&pr.error("Customer could not be added"),a==ar.OK||a==ar.PARTIAL)){var r=t[sr.PRICE_LIST],n=t[sr.PRODUCT_RULE];r==ar.OK&&n==ar.OK?pr.success("Customer sales data refreshed"):r==ar.ERROR&&n==ar.ERROR||pr.warning("Customer sales data partially refreshed")}s.setState((function(t){return{isCustomerRequestLoading:e==ar.PENDING,customerWasRequested:t.customerWasRequested||a==ar.OK||a==ar.PARTIAL}}))},s._onOrderChange=function(){var e=lr.getOrder(s.state.order.id);s.setState({order:e,orderWithCustomerCreated:null!=e.customer_id&&e.customer_id>0})},s.searchCustomers=function(e,t){tr.searchCustomers(e,t)},s.showCustomerRequestList=function(){s.state.isCustomerSearchLoading||s.setState({isCustomerRequestVisible:!0,customerRequestSearchTerm:"",customerRequestSearchPage:1,customerRequestSearchTotalPages:null,customerRequestSearchResults:[]})},s.hideCustomerRequestList=function(){if(!s.state.isCustomerSearchLoading){var e=s.state.customerWasRequested;s.setState((function(e){return{isCustomerRequestVisible:!1,customerWasRequested:!1}}),(function(){e&&s.searchCustomers(s.state.searchTerm,s.state.searchPage)}))}},s.searchCustomersOnServer=function(e,t){tr.searchCustomersRemotely(e,t)},s.requestCustomer=function(e){s.state.isCustomerRequestSearchLoading||tr.refreshCustomersAndSalesData([e.id])},s.state={customers:[],searchTerm:"",searchPage:1,searchPageSize:null,searchTotal:null,searchTotalPages:null,isCustomerSearchLoading:!1,customerRequestSearchTerm:"",customerRequestSearchPage:1,customerRequestSearchPageSize:null,customerRequestSearchTotal:null,customerRequestSearchTotalPages:null,customerRequestSearchResults:[],isCustomerRequestSearchLoading:!1,isCustomerRequestLoading:!1,isCustomerRequestVisible:!1,customerWasRequested:!1,orderWithCustomerCreated:!1,order:lr.getOrder()},s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){hr.setScreenTitle("Customers")}},{key:"componentDidMount",value:function(){or.addChangeListener(this._onChange),ir.addChangeListener(this._onCustomerRequestStatusChange),lr.addChangeListener(this._onOrderChange),this.searchCustomers()}},{key:"componentWillUnmount",value:function(){or.removeChangeListener(this._onChange),ir.removeChangeListener(this._onCustomerRequestStatusChange),lr.removeChangeListener(this._onOrderChange)}},{key:"render",value:function(){return this.state.orderWithCustomerCreated?r.a.createElement(S.a,{push:!0,to:"/sales/orders/"+this.state.order.id}):r.a.createElement("div",null,mr.get(dr.FUNC_ONLINE_CUSTOMERS)?r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isCustomerSearchLoading?" disabled":""),role:"button",to:"/sales"},r.a.createElement("i",{className:"fa fa-arrow-left"})," ",r.a.createElement("span",null,"Back to ",r.a.createElement("strong",null,"My Sales"))),r.a.createElement(R.a,{className:"btn btn-primary col-xs-6"+(this.state.isCustomerSearchLoading?" disabled":""),role:"button",to:"/sales/customers/new"},r.a.createElement("i",{className:"fa fa-user-plus"})," ",r.a.createElement("span",null,"Add Customer"))):r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-4"+(this.state.isCustomerSearchLoading?" disabled":""),role:"button",to:"/sales"},r.a.createElement("i",{className:"fa fa-arrow-left"})," ",r.a.createElement("span",{style:{fontSize:"10px"}},"Back to ",r.a.createElement("strong",null,"My Sales"))),r.a.createElement("button",{className:"btn btn-primary col-xs-4",onClick:this.showCustomerRequestList,disabled:this.state.isCustomerSearchLoading},r.a.createElement("i",{className:"fa fa-user-plus"})," ",r.a.createElement("span",{style:{fontSize:"10px"}},"Request Customer")),r.a.createElement(R.a,{className:"btn btn-primary col-xs-4"+(this.state.isCustomerSearchLoading?" disabled":""),role:"button",to:"/sales/customers/new"},r.a.createElement("i",{className:"fa fa-user-plus"})," ",r.a.createElement("span",{style:{fontSize:"10px"}},"Add Customer"))),this.state.isCustomerRequestVisible?r.a.createElement(ur,{searchTerm:this.state.customerRequestSearchTerm,searchPage:this.state.customerRequestSearchPage,searchPageSize:this.state.customerRequestSearchPageSize,searchTotal:this.state.customerRequestSearchTotal,searchTotalPages:this.state.customerRequestSearchTotalPages,searchResults:this.state.customerRequestSearchResults,onSearch:this.searchCustomersOnServer,onRequest:this.requestCustomer,onFinish:this.hideCustomerRequestList,isLoading:this.state.isCustomerRequestSearchLoading||this.state.isCustomerRequestLoading}):null,r.a.createElement(cr,{customers:this.state.customers,searchTerm:this.state.searchTerm,searchPage:this.state.searchPage,searchPageSize:this.state.searchPageSize,searchTotal:this.state.searchTotal,searchTotalPages:this.state.searchTotalPages,onSearch:this.searchCustomers,isLoading:this.state.isCustomerSearchLoading}))}}]),a}(r.a.Component),fr=a(77),Er=a(103),Sr=a(9),Cr=a(147),yr=a(17),Rr=a(7),br=r.a.createClass({displayName:"LibraryPage",getInitialState:function(){return{categoryTree:fr.getCategories(),categoryTreeCounts:fr.getGlobalCategoriesFileCounts(),isLoading:!1}},componentWillMount:function(){Rr.setScreenTitle("Library")},componentDidMount:function(){fr.addChangeListener(this._onChange),Rr.isBeforeToday(fr.getLastRefreshForKey("global"))&&Er.doAfterAccessCheck("refreshLibrary")},componentWillUnmount:function(){fr.removeChangeListener(this._onChange)},_onChange:function(){var e=fr.getStatus();e==Sr.OK?(this.setState({isLoading:!1,categoryTree:fr.getCategories(),categoryTreeCounts:fr.getGlobalCategoriesFileCounts()}),yr.success("File library refreshed")):e==Sr.PENDING?this.setState({isLoading:!0}):e==Sr.ERROR?(this.setState({isLoading:!1}),yr.error("Unable to refresh file library")):e==Sr.PARTIAL&&(this.setState({isLoading:!1,categoryTree:fr.getCategories(),categoryTreeCounts:fr.getGlobalCategoriesFileCounts()}),yr.warning("Unable to refresh all files in library"))},refreshLibrary:function(){this.state.isLoading||Er.doAfterAccessCheck("refreshLibrary")},render:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshLibrary,disabled:this.state.isLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("div",{style:{marginTop:"-5px"}},r.a.createElement(Cr,{categoryTree:this.state.categoryTree,categoryTreeCounts:this.state.categoryTreeCounts,assignmentKey:"global",filterTopCategoryId:Rr.globalLibraryCategoryID,isLoading:this.state.isLoading})))}}),_r=a(42),vr=a(65),Nr=a(15),Tr=a(9),Or=a(64),Lr=a(25),Dr=a(67),Ir=a(69),Ar=a(20),Pr=a(44),xr=a(27),Ur=a(77),Fr=a(43),wr=a(292),Mr=a(293),kr=a(7),qr=a(17),Br=r.a.createClass({displayName:"InfoPage",getInitialState:function(){return{user:Or.getUser(),userFields:Or.getFields(),isLoading:!1,isAppDataSubmissionLoading:!1}},componentWillMount:function(){kr.setScreenTitle("My Information")},componentDidMount:function(){Or.addChangeListener(this._onChange),Fr.addChangeListener(this._onAppDataSubmissionChange),kr.isBeforeToday(Or.getLastRefreshForFields())&&_r.refreshUser(!0)},componentWillUnmount:function(){Or.removeChangeListener(this._onChange),Fr.removeChangeListener(this._onAppDataSubmissionChange)},_onChange:function(){if(Or.hasUser()){var e=Or.getStatus();e==Tr.OK?(this.setState({isLoading:!1,user:Or.getUser(),userFields:Or.getFields()}),qr.success("User information refreshed")):e==Tr.PENDING?this.setState({isLoading:!0}):e==Tr.ERROR?(this.setState({isLoading:!1}),qr.error("Unable to refresh user information")):e==Tr.PARTIAL&&(this.setState({isLoading:!1,user:Or.getUser(),userFields:Or.getFields()}),qr.warning("Unable to refresh all user information"))}},_onAppDataSubmissionChange:function(){var e=Fr.getStatus(Nr.APP_DATA_SUBMIT);e==Tr.OK?(this.setState({isAppDataSubmissionLoading:!1}),qr.success("App data submitted")):e==Tr.PENDING?this.setState({isAppDataSubmissionLoading:!0}):e==Tr.ERROR&&(this.setState({isAppDataSubmissionLoading:!1}),qr.error("Unable to submit app data. Please contact your administrator.",null,{timeOut:5e3}))},refreshUserInfo:function(){this.state.isLoading||this.state.isAppDataSubmissionLoading||_r.refreshUser(kr.isBeforeToday(Or.getLastRefreshForFields()))},submitAppData:function(){this.state.isLoading||this.state.isAppDataSubmissionLoading||vr.submitAppData(kr.base64Encode('{"userStore":'+Or.exportData()+',"callStore":'+Lr.exportData()+',"auditStore":'+Dr.exportData()+',"auditAnswerStore":'+Ir.exportData()+',"customerStore":'+Ar.exportData()+',"productStore":'+Pr.exportData()+',"orderStore":'+xr.exportData()+',"libraryStore":'+Ur.exportData()+"}").replace(/\+/g,"%2B"))},render:function(){return r.a.createElement("div",null,r.a.createElement("button",{className:"btn btn-header-refresh",onClick:this.refreshUserInfo,disabled:this.state.isLoading||this.state.isAppDataSubmissionLoading},r.a.createElement("i",{className:"fa fa-refresh fa-2x"+(this.state.isLoading?" fa-spin":"")})),r.a.createElement("div",{style:{marginTop:"-5px"}},r.a.createElement(wr,{user:this.state.user,userFields:this.state.userFields,isLoading:this.state.isLoading})),r.a.createElement(Mr,{onSubmitAppData:this.submitAppData,isLoading:this.state.isAppDataSubmissionLoading}))}}),Hr=a(30),jr=a(26),Vr=a(65),Gr=a(9),Kr=a(37),Wr=a(15),zr=a(43),Jr=a(20),Yr=a(44),Qr=a(27),Xr=a(25),$r=a(78),Zr=a(7),en=a(17),tn=a(13),an=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e))._onChange=function(){var e=zr.getStatus(s.lastPendingAction),t=zr.getEntityStatuses(s.lastPendingAction),a=zr.getPercentageComplete(s.lastPendingAction);if(e==Gr.PENDING){var r="default";if(null!=t)for(var n in t)if(t[n]==Gr.PENDING){r=n;break}s.setState({isLoading:!0,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:s.progressDescriptions[r]+" ("+Math.round(a)+"%)"})}else s.setState({isLoading:!1,isRefreshProgressVisible:!0,refreshProgressPercentage:a,refreshProgressDescription:"Complete ("+Math.round(a)+"%)"}),setTimeout(s.closeRefreshProgressModal,1e3),null!=s.lastPendingAction&&null!=s.completionMessages[s.lastPendingAction]&&(e==Gr.OK?en.success(s.completionMessages[s.lastPendingAction][Gr.OK]):e==Gr.ERROR?en.error(s.completionMessages[s.lastPendingAction][Gr.ERROR]):e==Gr.PARTIAL&&en.warning(s.completionMessages[s.lastPendingAction][Gr.PARTIAL]))},s.refreshCalls=function(){s.state.isLoading||(s.lastPendingAction=Wr.CALLS_RELATED_REFRESH,jr.refreshCallsAndRelatedData())},s.refreshSalesData=function(){if(!s.state.isLoading){s.lastPendingAction=Wr.SALES_REFRESH;var e=tn.union(Jr.getCustomerIDs(),Xr.getCallCustomerIDs(),Qr.getOrderCustomerIDs());Hr.refreshSalesData(Yr.getLastRefresh(),Yr.getRefreshRetryIDs(),Qr.getPastOrdersLastRefresh(),Qr.getPastOrdersRefreshRetryIDs(),e)}},s.refreshAll=function(){if(!s.state.isLoading){s.lastPendingAction=Wr.ALL_REFRESH;var e=tn.union(Jr.getCustomerIDs(),Xr.getCallCustomerIDs(),Qr.getOrderCustomerIDs());Vr.refreshAll(Yr.getLastRefresh(),Yr.getRefreshRetryIDs(),Qr.getPastOrdersLastRefresh(),Qr.getPastOrdersRefreshRetryIDs(),e)}},s.closeRefreshProgressModal=function(){s.setState({isRefreshProgressVisible:!1})},s.state={isLoading:!1,isRefreshProgressVisible:!1,refreshProgressPercentage:0,refreshProgressDescription:""},s.lastPendingAction=null,s.progressDescriptions={},s.progressDescriptions.default="Refreshing",s.progressDescriptions[Kr.PAYMENT_TERM]="Refreshing payment terms",s.progressDescriptions[Kr.TAX_CLASS]="Refreshing tax classes",s.progressDescriptions[Kr.CARRIER]="Refreshing carriers",s.progressDescriptions[Kr.CURRENCY]="Refreshing currencies",s.progressDescriptions[Kr.PRODUCT]="Refreshing products",s.progressDescriptions[Kr.CATEGORY]="Refreshing categories",s.progressDescriptions[Kr.ORDER]="Refreshing orders",s.progressDescriptions[Kr.CUSTOMER]="Refreshing customers",s.progressDescriptions[Kr.PRICE_LIST]="Refreshing price lists",s.progressDescriptions[Kr.PRODUCT_RULE]="Refreshing product rules",s.completionMessages={},s.completionMessages[Wr.CALLS_RELATED_REFRESH]={},s.completionMessages[Wr.CALLS_RELATED_REFRESH][Gr.OK]="Call list and related data refreshed",s.completionMessages[Wr.CALLS_RELATED_REFRESH][Gr.ERROR]="Unable to refresh call list and related data",s.completionMessages[Wr.CALLS_RELATED_REFRESH][Gr.PARTIAL]="Unable to refresh all call list related data",s.completionMessages[Wr.SALES_REFRESH]={},s.completionMessages[Wr.SALES_REFRESH][Gr.OK]="Sales data refreshed",s.completionMessages[Wr.SALES_REFRESH][Gr.ERROR]="Unable to refresh sales data",s.completionMessages[Wr.SALES_REFRESH][Gr.PARTIAL]="Unable to refresh all sales data",s.completionMessages[Wr.ALL_REFRESH]={},s.completionMessages[Wr.ALL_REFRESH][Gr.OK]="Sales and calls data refreshed",s.completionMessages[Wr.ALL_REFRESH][Gr.ERROR]="Unable to refresh sales and calls data",s.completionMessages[Wr.ALL_REFRESH][Gr.PARTIAL]="Unable to refresh all sales and calls data",s}return Object(l.a)(a,[{key:"componentWillMount",value:function(){Zr.setScreenTitle("Refresh")}},{key:"componentDidMount",value:function(){zr.addChangeListener(this._onChange)}},{key:"componentWillUnmount",value:function(){zr.removeChangeListener(this._onChange)}},{key:"render",value:function(){var e=this.props.location.state&&this.props.location.state.from?this.props.location.state.from:null,t=null!=e;return r.a.createElement("div",null,t?r.a.createElement("div",{className:"btn-bar",role:"group"},r.a.createElement(R.a,{className:"btn btn-primary col-xs-12",role:"button",to:e},r.a.createElement("i",{className:"fa fa-arrow-left"})," Back to ",r.a.createElement("strong",null,this.props.location.state.fromTitle))):null,this.state.isRefreshProgressVisible?r.a.createElement($r,{percentage:this.state.refreshProgressPercentage,description:this.state.refreshProgressDescription,title:"Refresh Progress",isLoading:this.state.isLoading}):null,r.a.createElement("div",{className:"list-group list-group-spaced",style:{marginTop:t?"15px":0}},r.a.createElement("button",{onClick:this.refreshAll,className:"list-group-item",disabled:this.state.isLoading},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-refresh"+(this.state.isLoading&&this.lastPendingAction==Wr.ALL_REFRESH?" fa-spin":"")})," Refresh All"),r.a.createElement("p",{className:"list-group-item-text"},"Refresh data for performing calls and placing orders.")),r.a.createElement("button",{onClick:this.refreshCalls,className:"list-group-item",disabled:this.state.isLoading},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-refresh"+(this.state.isLoading&&this.lastPendingAction==Wr.CALLS_RELATED_REFRESH?" fa-spin":"")})," Refresh Calls"),r.a.createElement("p",{className:"list-group-item-text"},"Refresh data for performing calls, including customer data.")),r.a.createElement("button",{onClick:this.refreshSalesData,className:"list-group-item",disabled:this.state.isLoading},r.a.createElement("h4",{className:"list-group-item-heading"},r.a.createElement("i",{className:"fa fa-refresh"+(this.state.isLoading&&this.lastPendingAction==Wr.SALES_REFRESH?" fa-spin":"")})," Refresh Sales Data"),r.a.createElement("p",{className:"list-group-item-text"},"Refresh data for placing orders, including products/pricing."))))}}]),a}(r.a.Component);a(19).a.init();var sn=a(1);window.$=window.jQuery=sn,a(294),a(307),a(308);var rn=a(7);rn.initApp();var nn=function(e){var t=e.component,a=Object(f.a)(e,["component"]);return r.a.createElement(E.a,Object.assign({},a,{render:function(e){return rn.isLoggedIn()?r.a.createElement(t,e):r.a.createElement(S.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},on=function(){return r.a.createElement(C.a,{basename:window.location.pathname.split("mobile-sales")[0]+"mobile-sales"},r.a.createElement("div",null,r.a.createElement(I,null),r.a.createElement("div",{className:"container-fluid"},r.a.createElement(y.a,null,r.a.createElement(E.a,{path:"/login",exact:!0,component:ne}),r.a.createElement(E.a,{path:"/login/passwordreset",component:pe}),r.a.createElement(nn,{path:"/",exact:!0,component:J}),r.a.createElement(nn,{path:"/calls",exact:!0,component:Me}),r.a.createElement(nn,{path:"/:area(calls|sales/customers)/:id",exact:!0,component:Qe}),r.a.createElement(nn,{path:"/:area(calls|sales/customers)/:id/info",component:ot}),r.a.createElement(nn,{path:"/:area(calls|sales/customers)/:id/editdetails",component:pt}),r.a.createElement(nn,{path:"/:area(calls|sales/customers)/:id/editlocations",component:Rt}),r.a.createElement(nn,{path:"/:area(calls|sales/customers)/:id/editcontacts",component:Lt}),r.a.createElement(nn,{path:"/:area(calls|sales/customers)/:id/files",component:pa}),r.a.createElement(nn,{path:"/:area(calls|sales/customers)/:id/comments",component:Na}),r.a.createElement(nn,{path:"/calls/:id/audits",exact:!0,component:kt}),r.a.createElement(nn,{path:"/calls/:id/audits/:aid",component:na}),r.a.createElement(nn,{path:"/calls/:id/adminaudits",exact:!0,component:zt}),r.a.createElement(nn,{path:"/calls/:id/adminaudits/:aid/:aidx",component:na}),r.a.createElement(nn,{path:"/sales",exact:!0,component:ja}),r.a.createElement(nn,{path:"/sales/orders",exact:!0,component:$a}),r.a.createElement(nn,{path:"/sales/orders/past",exact:!0,component:Is}),r.a.createElement(nn,{path:"/sales/orders/past/:oid",component:ks}),r.a.createElement(nn,{path:"/sales/orders/:oid",component:Cs}),r.a.createElement(nn,{path:"/sales/products",exact:!0,component:er}),r.a.createElement(nn,{path:"/sales/customers",exact:!0,component:gr}),r.a.createElement(nn,{path:"/library",component:br}),r.a.createElement(nn,{path:"/info",component:Br}),r.a.createElement(nn,{path:"/refresh",component:an}),r.a.createElement(nn,{component:X})))))},ln=a(7),cn=a(309),un=[ln.assetsUrl+"img/background.jpg"];i.a.render(r.a.createElement(g,{preloadImages:un}),document.getElementById("app")),cn.initApp().catch((function(){})).then((function(){document.getElementById("appbg").classList.remove("apploading"),i.a.render(r.a.createElement(on,null),document.getElementById("app"))}))}],[[156,1,2]]]);
//# sourceMappingURL=main.28ec7642.chunk.js.map